import{r as c,u as D,a as m,j as e,H as L,L as h}from"./app-BWZ_nHt1.js";import{S as M}from"./SuperAdminLayout-Co4xClb9.js";import{B as l}from"./button-Zm_FOSge.js";import{T as B}from"./textarea-C-1JrkTj.js";import{B as x}from"./badge-B48L7827.js";import{C as i,a as f,b as j,c as F,d as p}from"./card-Cf_rG8vI.js";import{A as b,k as g}from"./dropdown-menu-BGaiVCet.js";import{S as I}from"./separator-BzGk3VOl.js";import{S as N,a as v,b as w,c as y,d as r}from"./select-pZyXwyw_.js";import{C as U}from"./chevron-left-C02MmKWr.js";import{S as z}from"./shield-CchamuUB.js";import{U as H}from"./user-C6WTETwj.js";import{L as P}from"./lock-DNNq-nvY.js";import{S as V}from"./send-BVx_xgsP.js";import{I as q}from"./info-ankJnrbv.js";import{E as O}from"./external-link-DPXPJHef.js";import{C as G}from"./circle-check-sQ4QhFFV.js";import{f as J}from"./formatDistanceToNow-CJnsltzk.js";import{e as K}from"./es-BteQoBuv.js";import"./chevron-right-_55ej7ZQ.js";import"./createLucideIcon-DsHLbH4u.js";import"./chevrons-up-down-BWehE4NK.js";import"./badge-check-smr4Gzab.js";import"./ApplicationLogo-BAQzSBsF.js";import"./users-CrNYFBXW.js";import"./layout-grid-Doks1yyB.js";import"./utils-Vt5GpmJK.js";import"./index-DuSKGNGS.js";import"./index-D0LUdmaD.js";import"./index-B5MO-qFS.js";import"./index-C7sgVbPo.js";import"./trash-2-bA_uJBZi.js";import"./check-DJuaI-ps.js";import"./credit-card-DAsMxP4w.js";import"./shopping-bag-BBv1wZ7q.js";import"./dialog-5zjqAkxW.js";import"./x-Bj9BVCWR.js";import"./input-DV8OdLmB.js";import"./sheet-EfXDWqjX.js";import"./index-CJAdGrJl.js";import"./index-l3LWksYO.js";import"./index-4bmCwMJV.js";import"./index-BqHU8kdB.js";import"./index-Bn4exDLh.js";import"./index-CXJmo4iv.js";import"./index-DUhcubli.js";import"./index-DplrVXlQ.js";import"./index-BdQq_4o_.js";import"./index-BUvU2dRD.js";import"./chevron-down-B8aG1258.js";import"./chevron-up-DN-ugvap.js";import"./constructNow-ChcPjMH_.js";import"./differenceInCalendarMonths-B3kfrhWB.js";import"./endOfMonth-DL9zlqV0.js";const C={open:{label:"Abierto",color:"bg-blue-100 text-blue-700"},in_progress:{label:"En progreso",color:"bg-amber-100 text-amber-700"},awaiting_response:{label:"Esperando respuesta",color:"bg-purple-100 text-purple-700"},resolved:{label:"Resuelto",color:"bg-emerald-100 text-emerald-700"},closed:{label:"Cerrado",color:"bg-slate-100 text-slate-700"}},S={low:{label:"Baja",color:"bg-slate-400"},medium:{label:"Media",color:"bg-blue-500"},high:{label:"Alta",color:"bg-orange-500"},urgent:{label:"Urgente",color:"bg-red-500"}},_={technical:"Problema Técnico",billing:"Facturación",account:"Mi Cuenta",feature_request:"Solicitud de Funcionalidad",other:"Otros"},Q=s=>{try{const t=new Date(s);return isNaN(t.getTime())?"recientemente":J(t,{addSuffix:!0,locale:K})}catch{return"recientemente"}};function Xe({ticket:s}){const t=c.useRef(null),{data:o,setData:E,post:T,processing:u,reset:R,errors:W}=D({message:""}),n=a=>{m.patch(route("superadmin.support.update",s.id),{status:a,priority:s.priority})},A=a=>{m.patch(route("superadmin.support.update",s.id),{status:s.status,priority:a})},$=a=>{a.preventDefault(),o.message.trim()&&T(route("superadmin.support.reply",s.id),{onSuccess:()=>{R("message")}})};return c.useEffect(()=>{t.current&&(t.current.scrollTop=t.current.scrollHeight)},[s.replies]),c.useEffect(()=>{if(window.Echo){const a="superadmin-updates";return window.Echo.channel(a).listen(".ticket.replied",d=>{d.ticket_id===s.id&&(console.log("[Echo] Real-time reply received for this ticket:",d),m.reload())}),()=>{try{window.Echo&&window.Echo.leave(a)}catch{}}}},[s.id]),e.jsxs(M,{header:`Ticket ${s.reference_id||`#${s.id}`}`,breadcrumbs:[{label:"Soporte Técnico",href:route("superadmin.support.index")},{label:s.reference_id||`#${s.id}`}],children:[e.jsx(L,{title:`${s.subject} - Soporte Admin`}),e.jsxs("div",{className:"max-w-6xl mx-auto space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between flex-shrink-0",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-mono text-muted-foreground uppercase tracking-tight",children:"Referencia"}),e.jsx(x,{variant:"outline",className:"font-mono text-base font-bold",children:s?.reference_id||`#${s?.id}`})]})}),e.jsx(i,{children:e.jsx(f,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(l,{variant:"ghost",size:"icon",asChild:!0,children:e.jsx(h,{href:route("superadmin.support.index"),children:e.jsx(U,{className:"h-4 w-4"})})}),e.jsxs("div",{children:[e.jsx(j,{className:"text-lg",children:s.subject}),e.jsxs(F,{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"font-semibold",children:s.tenant.name}),e.jsx("span",{children:"•"}),e.jsx("span",{children:_[s.category]||s.category})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:"secondary",children:(C?.[s.status]||C?.open||{label:"Abierto"}).label}),e.jsx(x,{variant:"outline",children:(S?.[s.priority]||S?.medium||{label:"Media"}).label})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx(i,{className:"lg:col-span-3",children:e.jsxs(p,{className:"p-0",children:[e.jsx("div",{ref:t,className:"h-[calc(100vh-400px)] overflow-y-auto p-6 space-y-6",children:s.replies.map(a=>e.jsx("div",{className:`flex ${a.is_staff?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`flex gap-3 max-w-[85%] ${a.is_staff?"flex-row-reverse":""}`,children:[e.jsx(b,{className:"h-8 w-8 mt-1 border",children:e.jsx(g,{className:a.is_staff?"bg-blue-600 text-white text-[10px]":"bg-slate-200 text-slate-600 text-[10px]",children:a.is_staff?e.jsx(z,{className:"h-4 w-4"}):e.jsx(H,{className:"h-4 w-4"})})}),e.jsxs("div",{className:`space-y-1 ${a.is_staff?"items-end":"items-start"}`,children:[e.jsxs("div",{className:`flex items-center gap-2 px-1 ${a.is_staff?"flex-row-reverse":""}`,children:[e.jsx("span",{className:"text-xs font-bold text-slate-700",children:a.user?.name||(a.is_staff?"Soporte":"Usuario")}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:Q(a.created_at)})]}),e.jsx("div",{className:`p-4 rounded-2xl text-sm leading-relaxed ${a.is_staff?"bg-blue-600 text-white rounded-tr-none shadow-blue-100 shadow-md":"bg-white text-slate-700 border border-slate-200 rounded-tl-none shadow-sm"}`,children:a.message})]})]})},a.id))}),e.jsx("div",{className:"p-4 border-t bg-white",children:s.status==="closed"||s.status==="resolved"?e.jsxs("div",{className:"bg-slate-50 border rounded-xl p-4 flex flex-col items-center gap-3 text-center",children:[e.jsx("div",{className:"h-10 w-10 bg-slate-200 rounded-full flex items-center justify-center text-slate-500",children:e.jsx(P,{className:"h-5 w-5"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm font-semibold text-slate-900",children:["Ticket ",s.status==="resolved"?"Resuelto":"Cerrado"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Este ticket ya no acepta nuevas respuestas."})]}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>n("open"),children:"Reabrir Ticket"})]}):e.jsxs("form",{onSubmit:$,className:"space-y-3",children:[e.jsx(B,{placeholder:"Escribe tu respuesta aquí...",className:"min-h-[100px] bg-slate-50/50 focus:bg-white resize-none border-slate-200",value:o.message,onChange:a=>E("message",a.target.value)}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground",children:"Tu respuesta se enviará al correo del usuario."}),e.jsx(l,{type:"submit",disabled:u||!o.message.trim(),className:"gap-2 bg-blue-600 hover:bg-blue-700 text-white shadow-lg shadow-blue-100",children:u?"Enviando...":e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"h-4 w-4"})," Enviar Respuesta"]})})]})]})})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(i,{className:"shadow-sm border-slate-200 overflow-hidden",children:[e.jsx(f,{className:"bg-slate-50/50 border-b pb-4",children:e.jsxs(j,{className:"text-sm font-bold flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4 text-blue-600"}),"Detalles del Ticket"]})}),e.jsxs(p,{className:"pt-4 space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground",children:"Estado"}),e.jsxs(N,{value:s.status,onValueChange:n,children:[e.jsx(v,{className:"h-9",children:e.jsx(w,{})}),e.jsxs(y,{children:[e.jsx(r,{value:"open",children:"Abierto"}),e.jsx(r,{value:"in_progress",children:"En progreso"}),e.jsx(r,{value:"awaiting_response",children:"Esperando respuesta"}),e.jsx(r,{value:"resolved",children:"Resuelto"}),e.jsx(r,{value:"closed",children:"Cerrado"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground",children:"Prioridad"}),e.jsxs(N,{value:s.priority,onValueChange:A,children:[e.jsx(v,{className:"h-9",children:e.jsx(w,{})}),e.jsxs(y,{children:[e.jsx(r,{value:"low",children:"Baja"}),e.jsx(r,{value:"medium",children:"Media"}),e.jsx(r,{value:"high",children:"Alta"}),e.jsx(r,{value:"urgent",children:"Urgente"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground",children:"Categoría"}),e.jsx("div",{className:"text-sm font-semibold text-slate-700",children:_[s.category]||s.category})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground",children:"ID Referencia"}),e.jsx("div",{className:"text-sm font-mono text-blue-600 font-bold",children:s.reference_id||`#${s.id}`})]}),e.jsx(I,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] uppercase font-bold text-muted-foreground mb-1",children:"Información del Cliente"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-6 w-6",children:e.jsx(g,{className:"text-[8px]",children:s.user.name.charAt(0)})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-semibold",children:s.user.name}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:s.user.email})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] uppercase font-bold text-muted-foreground mb-1",children:"Tienda (Tenant)"}),e.jsxs("div",{className:"bg-slate-50 rounded-lg p-2 border border-slate-100 flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium",children:s.tenant.name}),e.jsx(l,{variant:"ghost",size:"icon",className:"h-6 w-6",asChild:!0,children:e.jsx(h,{href:route("tenants.show",s.tenant.id),children:e.jsx(O,{className:"h-3 w-3"})})})]})]})]})]})]}),e.jsx(i,{className:"shadow-sm border-slate-200",children:e.jsx(p,{className:"pt-6 space-y-4",children:e.jsxs("div",{className:"flex items-center gap-3 text-emerald-600 bg-emerald-50 p-3 rounded-xl border border-emerald-100/50",children:[e.jsx(G,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold",children:"Acción Rápida"}),e.jsx("button",{onClick:()=>n("resolved"),className:"text-[10px] hover:underline",children:"Resolver ticket ahora"})]})]})})})]})]})]})]})}export{Xe as default};
