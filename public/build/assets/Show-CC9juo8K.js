import{c as R,r as p,u as D,a as x,j as e,H as M,L as g}from"./app-C6YMifTY.js";import{A as $}from"./AdminLayout-Byd6Tqt2.js";import{B as l}from"./button-BdaJZ0B3.js";import{T}from"./textarea-eT7ADchW.js";import{B as o}from"./badge-B3b3-wRu.js";import{L as u}from"./label-D24g5yt_.js";import{C as i,a as h,b as f,d as n}from"./card-B5tRKjHS.js";import{A as N,j as v,k as j}from"./dropdown-menu-SOMavdwh.js";import{C as z}from"./chevron-left-BHuqazIP.js";import{R as B}from"./refresh-cw-C8DIrsjX.js";import{S as H}from"./shield-check-DElx5cgJ.js";import{L as q}from"./lock-BocHb6LW.js";import{S as I}from"./send-DVDSl1LM.js";import{C as w}from"./circle-question-mark-D5XARrks.js";import{C as O}from"./circle-check-nEbbNZYN.js";import{f as U}from"./formatDistanceToNow-CJnsltzk.js";import{e as P}from"./es-BteQoBuv.js";import"./utils-DyIEM9Hy.js";import"./progress-Cm4jCk3n.js";import"./index-DiNYh9qr.js";import"./index-BqTUZrhs.js";import"./index-BfC7CqbM.js";import"./menuConfig-DAYmXPHE.js";import"./video-C0Ywn_TJ.js";import"./createLucideIcon-BySXGuRP.js";import"./chef-hat-DCJyIcCS.js";import"./table-D42HSQkY.js";import"./user-DitzkkBA.js";import"./map-pin-mNUy7ITu.js";import"./banknote-S0aL_sZI.js";import"./star-DamxJ_Yp.js";import"./users-DrSXnRGz.js";import"./calendar-check-DYxKrS9Z.js";import"./calendar-BZ8a-Bsy.js";import"./briefcase-CsKd1tC9.js";import"./truck-9WCJqKH5.js";import"./message-circle-N4NBu5OJ.js";import"./credit-card-DgCsg7Hg.js";import"./package-CrEPQoFv.js";import"./shopping-bag-Dvb7bWDl.js";import"./layout-dashboard-C-FjtN6k.js";import"./badge-check-CV7QNrff.js";import"./chevron-right-C535Mj24.js";import"./sparkles-CSy2FdAH.js";import"./separator-BXKUKxOr.js";import"./external-link-BMDME733.js";import"./chevron-down-BPnUVb9f.js";import"./headphones-DWZm_fAg.js";import"./shield-B3x-AlHy.js";import"./sonner-en7cM1_O.js";import"./dialog-IMN9tC2d.js";import"./index-Br9IGBm2.js";import"./index-E7WpQLQ8.js";import"./index-4n3Yzccs.js";import"./x-a1jEoxTs.js";import"./trash-2-CdCRBxCQ.js";import"./check-C1SVBju5.js";import"./input-Eblj3hbc.js";import"./sheet-DSRsPMRX.js";import"./index-CpLyPKqI.js";import"./index-CYR4JIyf.js";import"./index-CZchoUT1.js";import"./index-FjXa2hFn.js";import"./index-qUve72FO.js";import"./constructNow-ChcPjMH_.js";import"./differenceInCalendarMonths-B3kfrhWB.js";import"./endOfMonth-DL9zlqV0.js";const y={open:{label:"Abierto",color:"bg-blue-100 text-blue-700"},in_progress:{label:"En progreso",color:"bg-amber-100 text-amber-700"},awaiting_response:{label:"Esperando tu respuesta",color:"bg-purple-100 text-purple-700"},resolved:{label:"Resuelto",color:"bg-emerald-100 text-emerald-700"},closed:{label:"Cerrado",color:"bg-slate-100 text-slate-700"}},C={low:{label:"Baja",color:"bg-slate-400"},medium:{label:"Media",color:"bg-blue-500"},high:{label:"Alta",color:"bg-orange-500"},urgent:{label:"Urgente",color:"bg-red-500"}},Q={technical:"Problema Técnico",billing:"Facturación",account:"Mi Cuenta",feature_request:"Solicitud de Funcionalidad",other:"Otros"},V=s=>{try{const r=new Date(s);return isNaN(r.getTime())?"recientemente":U(r,{addSuffix:!0,locale:P})}catch{return"recientemente"}},_=s=>{try{const r=new Date(s);return isNaN(r.getTime())?"Fecha no disponible":r.toLocaleString()}catch{return"Fecha no disponible"}};function os({ticket:s,currentTenant:r}){const{auth:m}=R().props,c=p.useRef(null),{data:d,setData:S,post:E,processing:A,reset:L,errors:G}=D({message:""}),b=s.status==="closed"||s.status==="resolved",F=a=>{a.preventDefault(),d.message.trim()&&E(route("tenant.support.reply",{tenant:r.slug,ticket:s.id}),{onSuccess:()=>{L("message")}})};return p.useEffect(()=>{c.current&&(c.current.scrollTop=c.current.scrollHeight)},[s.replies]),p.useEffect(()=>{if(window.Echo){const a=`tenant-updates.${r.id}`;return window.Echo.channel(a).listen(".ticket.replied",t=>{t.ticket_id===s.id&&(console.log("[Echo] Real-time reply received for this ticket:",t),x.reload())}),()=>{try{window.Echo&&window.Echo.leave(a)}catch{}}}},[s.id,r.id]),e.jsxs($,{title:`Ticket ${s.reference_id||`#${s.id}`}`,breadcrumbs:[{label:"Soporte y Ayuda",href:route("tenant.support.index",{tenant:r.slug})},{label:s.reference_id||`#${s.id}`}],children:[e.jsx(M,{title:`${s.subject} - Soporte`}),e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-mono text-muted-foreground uppercase",children:"Referencia"}),e.jsx(o,{variant:"outline",className:"font-mono text-base font-bold",children:s.reference_id||`#${s.id}`})]})}),e.jsx(i,{children:e.jsx(h,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(l,{variant:"ghost",size:"icon",asChild:!0,children:e.jsx(g,{href:route("tenant.support.index",{tenant:r.slug}),children:e.jsx(z,{className:"h-4 w-4"})})}),e.jsxs("div",{children:[e.jsx(f,{className:"text-xl",children:s.subject}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(o,{variant:"secondary",children:(y?.[s.status]||y?.open||{label:"Ticket"}).label}),e.jsx(o,{variant:"outline",children:(C?.[s.priority]||C?.medium||{label:"Media"}).label})]})]})]}),e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>x.reload(),children:e.jsx(B,{className:"h-4 w-4"})})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx(i,{className:"lg:col-span-3",children:e.jsxs(n,{className:"p-0",children:[e.jsxs("div",{ref:c,className:"h-[calc(100vh-400px)] overflow-y-auto p-6 space-y-6",children:[s.replies.length>0&&e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(N,{className:"h-10 w-10 border-2 border-primary/10",children:[e.jsx(v,{src:m.user.profile_photo_url||s.replies[0]?.user?.profile_photo_url}),e.jsx(j,{children:(m.user.name||s.replies[0]?.user?.name||"U").charAt(0)})]}),e.jsxs("div",{className:"space-y-1 max-w-[85%]",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-sm",children:m.user.name||s.replies[0]?.user?.name}),e.jsx(o,{variant:"secondary",className:"text-xs h-4",children:"Original"})]}),e.jsx(i,{className:"border-slate-200",children:e.jsx(n,{className:"p-4 text-sm",children:s.replies[0]?.message})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:_(s.created_at||s.replies[0]?.created_at)})]})]}),s.replies.slice(1).map(a=>{const t=a.is_staff;return e.jsxs("div",{className:t?"flex gap-4":"flex gap-4 flex-row-reverse",children:[e.jsx(N,{className:t?"h-10 w-10 border-2 border-primary/10":"h-10 w-10 border-2 border-blue-500/20",children:t?e.jsx(j,{className:"bg-slate-200 text-slate-600",children:e.jsx(H,{className:"h-5 w-5"})}):e.jsxs(e.Fragment,{children:[e.jsx(v,{src:a.user?.profile_photo_url}),e.jsx(j,{children:a.user?.name?.charAt(0)||"U"})]})}),e.jsxs("div",{className:t?"space-y-1 max-w-[85%]":"space-y-1 max-w-[85%] items-end",children:[e.jsxs("div",{className:t?"flex items-center gap-2":"flex items-center gap-2 flex-row-reverse",children:[e.jsx("span",{className:"font-semibold text-sm",children:t?"Soporte Linkiu":a.user?.name||"Voz del Cliente"}),t&&e.jsx(o,{variant:"secondary",className:"text-xs h-4",children:"Oficial"})]}),e.jsx("div",{className:t?"p-4 rounded-2xl text-sm bg-white text-slate-800 border border-slate-200 rounded-tl-none shadow-sm":"p-4 rounded-2xl text-sm bg-blue-600 text-white rounded-tr-none shadow-md",children:a.message}),e.jsx("span",{className:t?"text-xs text-muted-foreground block":"text-xs text-muted-foreground block text-right",children:V(a.created_at)})]})]},a.id)})]}),e.jsx("div",{className:"p-4 border-t bg-slate-50/50 dark:bg-slate-900/30",children:b?e.jsxs("div",{className:"flex items-center justify-center p-4 bg-slate-100 dark:bg-slate-800 rounded-xl text-muted-foreground gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Este ticket está cerrado y no permite más respuestas."})]}):e.jsxs("form",{onSubmit:F,className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(T,{placeholder:"Escribe tu respuesta aquí...",value:d.message,onChange:a=>S("message",a.target.value),className:"min-h-[100px] pr-12"}),e.jsx(l,{type:"submit",size:"icon",disabled:A||!d.message.trim(),className:"absolute bottom-3 right-3 h-8 w-8",children:e.jsx(I,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex justify-between items-center px-1",children:e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(w,{className:"h-3 w-3"})," Soporte te responderá lo antes posible."]})})]})})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(i,{className:"border-slate-200 shadow-sm overflow-hidden",children:[e.jsx(h,{className:"bg-slate-50/50 border-b pb-3",children:e.jsx(f,{className:"text-xs font-bold uppercase tracking-wider text-slate-500",children:"Información"})}),e.jsxs(n,{className:"pt-4 space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(u,{className:"text-[10px] uppercase text-slate-400 font-bold",children:"Categoría"}),e.jsx("div",{className:"text-sm font-semibold text-slate-700",children:Q[s.category]||s.category})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(u,{className:"text-[10px] uppercase text-slate-400 font-bold",children:"ID de Referencia"}),e.jsx("div",{className:"text-sm font-mono text-slate-600",children:s.reference_id||`#${s.id}`})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(u,{className:"text-[10px] uppercase text-slate-400 font-bold",children:"Última actualización"}),e.jsx("div",{className:"text-xs text-slate-600",children:_(s.updated_at)})]})]})]}),e.jsxs(i,{className:"border-none shadow-sm bg-blue-50/30",children:[e.jsxs(h,{className:"pb-2 text-center",children:[e.jsx(w,{className:"h-8 w-8 mx-auto text-blue-500/50"}),e.jsx(f,{className:"text-sm",children:"¿Necesitas algo más?"})]}),e.jsxs(n,{className:"text-center space-y-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Si el problema persiste o tienes una nueva consulta, puedes abrir un nuevo ticket."}),e.jsx(l,{className:"w-full cursor-pointer",asChild:!0,children:e.jsx(g,{href:route("tenant.support.create",{tenant:r.slug}),children:"Nuevo Ticket"})}),!b&&e.jsxs(l,{variant:"destructive",className:"w-full gap-2 cursor-pointer",onClick:()=>{confirm("¿Estás seguro de que deseas cerrar este ticket? No podrás enviar más respuestas.")&&x.post(route("tenant.support.close",{tenant:r.slug,support:s.id}))},children:[e.jsx(O,{className:"h-4 w-4"}),"Cerrar Ticket"]})]})]})]})]})]})]})}export{os as default};
