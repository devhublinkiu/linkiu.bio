import{c as pe,r as h,t as n,u as P,j as e,H as he,a as M}from"./app-B2i56772.js";import{A as ue}from"./AdminLayout-DpFX9UTo.js";import{B as d}from"./button-BddZHLbc.js";import{I as j}from"./input-DBNIwXu0.js";import{L as l}from"./label-B6Q_Fw8J.js";import{B as b}from"./badge-v4EM3Inb.js";import{C as je,a as ge,b as ve,d as fe}from"./card-BWsdLjRP.js";import{S as O,a as R,b as F,c as V,d as B,e as H}from"./sheet-BYmPEYHR.js";import{S as g,a as v,b as f,c as y,d as m}from"./select-ClRMxfXi.js";import{D as U,i as J,l as K,p as N,P as ye}from"./dropdown-menu-DmXnVWVS.js";import{A as be,a as Ne,b as Se,c as Ce,d as we,e as ke,f as _e,g as De}from"./alert-dialog-yqHfK6BW.js";import{E as Me,a as Ee,e as ze,c as Te,d as Ze}from"./empty-Cl3nGRpl.js";import{c as ee}from"./createLucideIcon-D_eBnp1W.js";import{M as I}from"./map-pin-ri_iNx9P.js";import{P as q}from"./plus-CXHr8mdQ.js";import{U as Ae}from"./user-plus-1ZmgWtQx.js";import{E as W}from"./ellipsis-CHJbh5YJ.js";import{S as X}from"./square-pen-C5XBxQsK.js";import{T as Y}from"./trash-2-DFiSLFW9.js";import{R as Pe}from"./refresh-cw-CQr7iCv5.js";import"./utils-DyIEM9Hy.js";import"./progress-CHg3IQdJ.js";import"./index-DBzmoSVG.js";import"./index-CAHj415D.js";import"./index-BKbrreay.js";import"./menuConfig-DmcJDscn.js";import"./video-DGfX4q0e.js";import"./chef-hat-CvyNNXzc.js";import"./table-BLLfHlez.js";import"./user-DHzOQ6OD.js";import"./banknote-DNARpvAy.js";import"./star-BpzXTGgh.js";import"./users-4ML6WyRj.js";import"./calendar-check-CnVNb9CI.js";import"./calendar-Ck1wG4bv.js";import"./briefcase-C3iT5Z4z.js";import"./truck-lFBp_-Xb.js";import"./message-circle-5eeJlDPf.js";import"./credit-card-C_C5Gl_c.js";import"./package-DDNPJLjr.js";import"./shopping-bag-Bo9Pazs1.js";import"./layout-dashboard-Cd8XF3JQ.js";import"./badge-check-D1_tuun5.js";import"./lock-DD0Y-Lpl.js";import"./chevron-right-CbumkvGd.js";import"./sparkles-hzHxndp_.js";import"./separator-BeNm-P6u.js";import"./external-link-B2fnfMGN.js";import"./chevron-down-BDQOlKUd.js";import"./headphones-CDKhQ2od.js";import"./shield-BMdEYS_D.js";import"./sonner-BG1d_7G1.js";import"./dialog-BfzucGwq.js";import"./index-DJSPV-or.js";import"./index-ykKLN3SD.js";import"./index-DvWOdVYN.js";import"./x-B5LJUYBC.js";import"./index-BdQq_4o_.js";import"./index-OfG7Dj8W.js";import"./index-BbbmFCg3.js";import"./index-0TEkSQsx.js";import"./index-o5QoyLO9.js";import"./index-BdpBaZAv.js";import"./check-BXudH8di.js";import"./chevron-up-DBoP92CZ.js";import"./circle-check-qwWqnypp.js";import"./index-DHp04QnP.js";const Oe=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],Re=ee("hash",Oe);const Fe=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],L=ee("qr-code",Fe);function Ve(x){return x==="active"?"available":x==="inactive"?"maintenance":x}function Ls({zones:x,locations:E,currentLocationId:p}){const{currentTenant:o,currentUserRole:S,flash:z}=pe().props,[se,$]=h.useState(!1);h.useEffect(()=>{z?.error&&n.error(z.error)},[z?.error]);const[ae,C]=h.useState(!1),[te,w]=h.useState(!1),[re,T]=h.useState(!1),[k,Q]=h.useState(null),[_,G]=h.useState(null),[u,D]=h.useState(null),ie=s=>S?S.is_owner===!0||S.permissions?.includes("*")===!0||S.permissions?.includes(s)===!0:!1,c=(s,r,xe)=>{ie(r)?xe():$(!0)},i=P({name:"",location_id:p.toString()}),a=P({zone_id:"",location_id:p.toString(),name:"",capacity:"",status:"available"}),t=P({zone_id:"",location_id:p.toString(),prefix:"Mesa ",start_number:1,count:10,capacity:""}),Z=s=>{s?(Q(s),i.setData({name:s.name,location_id:(s.location_id??p).toString()})):(Q(null),i.reset("name"),i.setData("location_id",p.toString())),C(!0)},A=(s,r)=>{s?(G(s),a.setData({zone_id:s.zone_id.toString(),name:s.name,capacity:s.capacity?.toString()||"",status:Ve(s.status),location_id:(s.location_id??p).toString()})):(G(null),a.reset("name","capacity","status"),a.setData("location_id",p.toString()),r&&a.setData("zone_id",r.toString())),w(!0)},ne=s=>{s.preventDefault();const r=()=>n.error("Revisa los campos del formulario.");k?i.put(route("tenant.admin.zones.update",[o?.slug,k.id]),{onSuccess:()=>{n.success("Zona actualizada"),C(!1)},onError:r}):i.post(route("tenant.admin.zones.store",o?.slug),{onSuccess:()=>{n.success("Zona creada"),C(!1)},onError:r})},le=s=>{s.preventDefault();const r=()=>n.error("Revisa los campos del formulario.");_?a.put(route("tenant.admin.tables.update",[o?.slug,_.id]),{onSuccess:()=>{n.success("Mesa actualizada"),w(!1)},onError:r}):a.post(route("tenant.admin.tables.store",o?.slug),{onSuccess:()=>{n.success("Mesa creada"),w(!1)},onError:r})},oe=s=>{s.preventDefault(),t.post(route("tenant.admin.tables.bulk",o?.slug),{onSuccess:()=>{n.success("Mesas creadas masivamente"),T(!1),t.reset()},onError:()=>n.error("No se pudieron crear las mesas. Revisa los campos o intenta con menos cantidad.")})},ce=()=>{if(!u)return;const s=u.type==="zone"?route("tenant.admin.zones.destroy",[o?.slug,u.id]):route("tenant.admin.tables.destroy",[o?.slug,u.id]);M.delete(s,{onSuccess:()=>{n.success(`${u.type==="zone"?"Zona":"Mesa"} eliminada`),D(null)},onError:()=>n.error("No se pudo eliminar. Inténtalo de nuevo.")})},de=s=>{M.post(route("tenant.admin.tables.regenerate-token",[o?.slug,s]),{},{onSuccess:()=>n.success("Token regenerado. El QR antiguo ya no funcionará.")})},me=s=>{switch(s){case"available":case"active":return e.jsx(b,{className:"bg-emerald-500",children:"Disponible"});case"occupied":return e.jsx(b,{className:"bg-amber-500",children:"Ocupada"});case"reserved":return e.jsx(b,{className:"bg-indigo-500",children:"Reservada"});case"maintenance":case"inactive":return e.jsx(b,{variant:"outline",className:"text-slate-400 border-slate-200 bg-slate-50",children:"Mantenimiento"})}};return e.jsxs(ue,{title:"Mesas y Zonas",children:[e.jsx(he,{title:"Mesas y Zonas"}),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Mesas y Zonas"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Organiza tus espacios y genera QRs para pedidos en mesa."}),e.jsxs("div",{className:"mt-4 flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:"Sede:"}),e.jsxs(g,{value:p.toString(),onValueChange:s=>M.get(route("tenant.admin.tables.index",[o?.slug]),{location_id:s},{preserveState:!0}),children:[e.jsx(v,{className:"w-[200px] h-8 text-xs bg-white",children:e.jsx(f,{placeholder:"Seleccionar Sede"})}),e.jsx(y,{children:E.map(s=>e.jsx(m,{value:s.id.toString(),children:s.name},s.id))})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{variant:"outline",onClick:()=>c(null,"tables.view",()=>M.get(route("tenant.admin.tables.print",[o?.slug]))),children:[e.jsx(L,{className:"w-4 h-4 mr-2"})," Centro de QRs"]}),e.jsxs(d,{variant:"outline",onClick:()=>c(null,"tables.create",()=>Z()),children:[e.jsx(I,{className:"w-4 h-4 mr-2"})," Nueva Zona"]}),e.jsxs(d,{onClick:()=>c(null,"tables.create",()=>A()),children:[e.jsx(q,{className:"w-4 h-4 mr-2"})," Nueva Mesa"]})]})]}),x.length===0?e.jsxs(Me,{className:"border-2 border-dashed rounded-xl bg-white py-12",children:[e.jsxs(Ee,{children:[e.jsx(ze,{variant:"icon",children:e.jsx(I,{className:"size-4"})}),e.jsx(Te,{children:"No hay zonas configuradas"}),e.jsx(Ze,{children:'Empieza creando una zona como "Salón Principal" o "Terraza".'})]}),e.jsxs(d,{className:"mt-4",onClick:()=>c(null,"tables.create",()=>Z()),children:[e.jsx(q,{className:"w-4 h-4 mr-2"})," Crear mi primera zona"]})]}):e.jsx("div",{className:"grid gap-6",children:x.map(s=>e.jsxs(je,{className:"overflow-hidden border-none shadow-sm ring-1 ring-slate-200",children:[e.jsxs(ge,{className:"bg-slate-50/50 border-b flex flex-row items-center justify-between py-4",children:[e.jsx("div",{children:e.jsxs(ve,{className:"text-lg flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4 text-primary"}),s.name,e.jsxs(b,{variant:"outline",className:"ml-2 bg-white",children:[s.tables.length," mesas"]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(d,{variant:"ghost",size:"sm",onClick:()=>c(null,"tables.create",()=>{T(!0),t.setData("zone_id",s.id.toString())}),children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"})," Carga Masiva"]}),e.jsxs(U,{children:[e.jsx(J,{asChild:!0,children:e.jsx(d,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(W,{className:"w-4 h-4"})})}),e.jsxs(K,{align:"end",children:[e.jsxs(N,{onClick:()=>c(null,"tables.update",()=>Z(s)),children:[e.jsx(X,{className:"w-4 h-4 mr-2"})," Editar Zona"]}),e.jsxs(N,{className:"text-red-600 focus:text-red-700",onClick:()=>c(null,"tables.delete",()=>D({type:"zone",id:s.id})),children:[e.jsx(Y,{className:"w-4 h-4 mr-2"})," Eliminar Zona"]})]})]})]})]}),e.jsx(fe,{className:"p-0",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-px bg-slate-200",children:[s.tables.map(r=>e.jsxs("div",{className:"bg-white p-4 group hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-slate-900 group-hover:text-primary transition-colors",children:r.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[me(r.status),r.capacity&&e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center",children:[e.jsx(Re,{className:"w-3 h-3 mr-0.5"})," Cap. ",r.capacity]})]})]}),e.jsxs(U,{children:[e.jsx(J,{asChild:!0,children:e.jsx(d,{variant:"ghost",size:"icon",className:"h-7 w-7 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(W,{className:"w-4 h-4"})})}),e.jsxs(K,{align:"end",children:[e.jsxs(N,{onClick:()=>c(null,"tables.update",()=>A(r)),children:[e.jsx(X,{className:"w-4 h-4 mr-2"})," Editar Mesa"]}),e.jsxs(N,{onClick:()=>c(null,"tables.update",()=>de(r.id)),children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"})," Regenerar Token"]}),e.jsxs(N,{className:"text-red-600 focus:text-red-700",onClick:()=>c(null,"tables.delete",()=>D({type:"table",id:r.id})),children:[e.jsx(Y,{className:"w-4 h-4 mr-2"})," Eliminar"]})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 mt-4",children:[e.jsx("div",{className:"text-[10px] uppercase font-bold text-slate-400 tracking-wider",children:"Acceso Cliente"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(d,{variant:"secondary",size:"sm",className:"flex-1 h-8 text-xs font-bold",onClick:()=>window.open(`${window.location.origin}/${o?.slug}?m=${r.token}`,"_blank"),children:[e.jsx(L,{className:"w-3 h-3 mr-1.5"})," Ver QR"]})})]})]},r.id)),e.jsxs("button",{type:"button",onClick:()=>c(null,"tables.create",()=>A(void 0,s.id)),className:"bg-slate-50 border-2 border-dashed border-slate-200 p-4 flex flex-col items-center justify-center text-slate-400 hover:text-primary hover:border-primary hover:bg-white transition-all group cursor-pointer",children:[e.jsx(q,{className:"w-6 h-6 mb-2 group-hover:scale-110 transition-transform"}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-tight",children:"Agregar Mesa"})]})]})})]},s.id))})]}),e.jsx(O,{open:ae,onOpenChange:C,children:e.jsxs(R,{children:[e.jsxs(F,{children:[e.jsx(V,{children:k?"Editar Zona":"Nueva Zona"}),e.jsx(B,{children:"Las zonas ayudan a organizar tus mesas (ej. Terraza, VIP)."})]}),e.jsxs("form",{onSubmit:ne,className:"space-y-4 py-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"zone-name",children:"Nombre de la Zona"}),e.jsx(j,{id:"zone-name",value:i.data.name,onChange:s=>i.setData("name",s.target.value),placeholder:"Ej. Terraza",required:!0}),i.errors.name&&e.jsx("p",{className:"text-destructive text-xs",children:i.errors.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Sede"}),e.jsxs(g,{value:i.data.location_id,onValueChange:s=>i.setData("location_id",s),children:[e.jsx(v,{children:e.jsx(f,{})}),e.jsx(y,{children:E.map(s=>e.jsx(m,{value:s.id.toString(),children:s.name},s.id))})]}),i.errors.location_id&&e.jsx("p",{className:"text-destructive text-xs",children:i.errors.location_id})]}),e.jsx(H,{children:e.jsx(d,{type:"submit",disabled:i.processing,className:"w-full",children:i.processing?"Guardando...":k?"Actualizar":"Crear Zona"})})]})]})}),e.jsx(O,{open:te,onOpenChange:w,children:e.jsxs(R,{children:[e.jsxs(F,{children:[e.jsx(V,{children:_?"Editar Mesa":"Nueva Mesa"}),e.jsx(B,{children:"Configura los detalles de la mesa individual."})]}),e.jsxs("form",{onSubmit:le,className:"space-y-4 py-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"table-zone",children:"Zona"}),e.jsxs(g,{value:a.data.zone_id,onValueChange:s=>a.setData("zone_id",s),children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Seleccionar zona"})}),e.jsx(y,{children:x.map(s=>e.jsx(m,{value:s.id.toString(),children:s.name},s.id))})]}),a.errors.zone_id&&e.jsx("p",{className:"text-destructive text-xs",children:a.errors.zone_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"table-name",children:"Nombre / ID de Mesa"}),e.jsx(j,{id:"table-name",value:a.data.name,onChange:s=>a.setData("name",s.target.value),placeholder:"Ej. Mesa 01",required:!0}),a.errors.name&&e.jsx("p",{className:"text-destructive text-xs",children:a.errors.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"table-capacity",children:"Capacidad (Personas)"}),e.jsx(j,{id:"table-capacity",type:"number",value:a.data.capacity,onChange:s=>a.setData("capacity",s.target.value),placeholder:"Ej. 4"}),a.errors.capacity&&e.jsx("p",{className:"text-destructive text-xs",children:a.errors.capacity})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"table-status",children:"Estado"}),e.jsxs(g,{value:a.data.status,onValueChange:s=>a.setData("status",s),children:[e.jsx(v,{children:e.jsx(f,{})}),e.jsxs(y,{children:[e.jsx(m,{value:"available",children:"Disponible"}),e.jsx(m,{value:"occupied",children:"Ocupada"}),e.jsx(m,{value:"reserved",children:"Reservada"}),e.jsx(m,{value:"maintenance",children:"Mantenimiento"})]})]}),a.errors.status&&e.jsx("p",{className:"text-destructive text-xs",children:a.errors.status})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Sede"}),e.jsxs(g,{value:a.data.location_id,onValueChange:s=>a.setData("location_id",s),children:[e.jsx(v,{children:e.jsx(f,{})}),e.jsx(y,{children:E.map(s=>e.jsx(m,{value:s.id.toString(),children:s.name},s.id))})]}),a.errors.location_id&&e.jsx("p",{className:"text-destructive text-xs",children:a.errors.location_id})]}),e.jsx(H,{children:e.jsx(d,{type:"submit",disabled:a.processing,className:"w-full",children:a.processing?"Guardando...":_?"Actualizar":"Crear Mesa"})})]})]})}),e.jsx(O,{open:re,onOpenChange:T,children:e.jsxs(R,{children:[e.jsxs(F,{children:[e.jsx(V,{children:"Carga Masiva de Mesas"}),e.jsx(B,{children:"Crea múltiples mesas rápidamente con un prefijo."})]}),e.jsxs("form",{onSubmit:oe,className:"space-y-4 py-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Zona Destino"}),e.jsxs(g,{value:t.data.zone_id,onValueChange:s=>t.setData("zone_id",s),children:[e.jsx(v,{children:e.jsx(f,{})}),e.jsx(y,{children:x.map(s=>e.jsx(m,{value:s.id.toString(),children:s.name},s.id))})]}),t.errors.zone_id&&e.jsx("p",{className:"text-destructive text-xs",children:t.errors.zone_id}),t.errors.location_id&&e.jsx("p",{className:"text-destructive text-xs",children:t.errors.location_id})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Prefijo"}),e.jsx(j,{value:t.data.prefix,onChange:s=>t.setData("prefix",s.target.value),placeholder:"Ej. Mesa "})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Inicia en"}),e.jsx(j,{type:"number",value:t.data.start_number,onChange:s=>t.setData("start_number",parseInt(s.target.value)||1)}),t.errors.start_number&&e.jsx("p",{className:"text-destructive text-xs",children:t.errors.start_number})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Cantidad a crear"}),e.jsx(j,{type:"number",max:"50",value:t.data.count,onChange:s=>t.setData("count",parseInt(s.target.value)||1)}),t.errors.count&&e.jsx("p",{className:"text-destructive text-xs",children:t.errors.count})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Capacidad por mesa"}),e.jsx(j,{type:"number",value:t.data.capacity,onChange:s=>t.setData("capacity",s.target.value)}),t.errors.capacity&&e.jsx("p",{className:"text-destructive text-xs",children:t.errors.capacity})]}),e.jsx(H,{children:e.jsx(d,{type:"submit",disabled:t.processing,className:"w-full",children:t.processing?"Procesando...":`Generar ${t.data.count} Mesas`})})]})]})}),e.jsx(be,{open:!!u,onOpenChange:s=>!s&&D(null),children:e.jsxs(Ne,{children:[e.jsxs(Se,{children:[e.jsx(Ce,{children:"¿Confirmas la eliminación?"}),e.jsxs(we,{children:["Esta acción no se puede deshacer.",u?.type==="zone"&&" Al eliminar la zona se eliminarán también todas sus mesas asociadas."]})]}),e.jsxs(ke,{children:[e.jsx(_e,{children:"Cancelar"}),e.jsx(De,{variant:"destructive",onClick:ce,children:"Eliminar"})]})]})}),e.jsx(ye,{open:se,onOpenChange:$})]})}export{Ls as default};
