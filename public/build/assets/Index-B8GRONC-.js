import{r as i,t as p,j as e,b as v,H as K,L as U}from"./app-arqQV-bc.js";import{A as W}from"./AdminLayout-DCtk7OxF.js";import{B as I}from"./button-Bd640uTA.js";import{S as q,a as G,b as J,c as Q,d as M}from"./select-Ci9oU9C1.js";import{A as X,a as Y,b as Z,c as ee,d as te,e as se,f as ae,g as re}from"./alert-dialog-Bm-s-qWR.js";import{KitchenOrderCard as oe}from"./KitchenOrderCard-COubwUFn.js";import{J as D}from"./dropdown-menu-mNq1McYa.js";import{A as ie}from"./arrow-left-XHfuuPY4.js";import{C as ne}from"./chef-hat-q1zMrLCc.js";import{R as le}from"./refresh-cw-B9LMUw7v.js";import{U as ce}from"./utensils-crossed-BIo0Ya1O.js";import{A as de}from"./index-BykUB7pr.js";import{c as T}from"./createLucideIcon-kbomgvBs.js";import"./utils-BegMJZHH.js";import"./badge-t3wrEXXG.js";import"./card-BQPJWSk4.js";import"./progress-BWnj_no5.js";import"./index-CVnnicxK.js";import"./index-C-vN8jX4.js";import"./menuConfig-C-Q0avcz.js";import"./video-B-ftvkxj.js";import"./table-Bk0hf6m9.js";import"./user-KA4Ja2_R.js";import"./map-pin-D1VGCzYf.js";import"./banknote-byFf_CZb.js";import"./star-qP03KNv_.js";import"./users-DyLj9nwM.js";import"./calendar-check-BUphR3zi.js";import"./calendar-DHlqI9qY.js";import"./briefcase-CG7ArIFZ.js";import"./truck-DCx-3LGs.js";import"./message-circle-DV6RjH4d.js";import"./credit-card-4AdI57T8.js";import"./package-34OeiGxz.js";import"./shopping-bag-TtCDC01g.js";import"./layout-dashboard-DnE9OzLr.js";import"./badge-check-C3DjHgnO.js";import"./lock-Cb_9eXlT.js";import"./chevron-right-CyE8jcbn.js";import"./sparkles-fY3WANvl.js";import"./separator-DpUia1Ar.js";import"./external-link-r8YAPN_c.js";import"./chevron-down-CS-ozzzB.js";import"./headphones-Uo3Em3Q5.js";import"./shield-BQB1r0z5.js";import"./sonner-SWZRrF5D.js";import"./index-BdQq_4o_.js";import"./index-B_Os2ghw.js";import"./index-Bz80iYGN.js";import"./index-DiBfayRM.js";import"./index-CwhdJaVg.js";import"./index-CJZqa-kr.js";import"./index-C9GonLHF.js";import"./index-CfChaKac.js";import"./index-DzhEK4jt.js";import"./index-DLsOI5U2.js";import"./check-BZhepUpU.js";import"./chevron-up-D9DUAay6.js";import"./scroll-area-CONigBOn.js";import"./proxy-5VOmEZnq.js";import"./clock-D6SFixQE.js";import"./ban-db-ezUjT.js";import"./loader-circle-C7WOXZ8A.js";import"./circle-check-CJmQNw_U.js";import"./trash-2-D8UpIHBH.js";import"./dialog-Do7ESPrT.js";import"./x-hBSqTjfa.js";import"./input-CnYabjbM.js";import"./sheet-BJFcoitR.js";import"./index-iS2GCZ5y.js";import"./index-DDCOIm2e.js";const me=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],pe=T("wifi-off",me);const he=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],xe=T("wifi",he);function Tt({orders:O,tenant:r,currentLocationId:R,locations:y=[]}){const[h,x]=i.useState(O),[_,k]=i.useState(null),[g,b]=i.useState(!1),[l,j]=i.useState("all"),[n,L]=i.useState(R),[u,N]=i.useState(null),C=i.useCallback(()=>{try{const t=window.AudioContext||window.webkitAudioContext,s=new t;[830,1046,1318].forEach((o,a)=>{const c=s.createOscillator(),m=s.createGain();c.type="sine",c.frequency.value=o,m.gain.setValueAtTime(.4,s.currentTime+a*.18),m.gain.exponentialRampToValueAtTime(.01,s.currentTime+a*.18+.3),c.connect(m),m.connect(s.destination),c.start(s.currentTime+a*.18),c.stop(s.currentTime+a*.18+.3)})}catch{p.info("ðŸ”” Nuevo pedido recibido",{icon:e.jsx(D,{className:"w-4 h-4 text-blue-500"})})}},[]),A=i.useCallback(async(t,s)=>{k(t);try{(await v.post(route("tenant.admin.kitchen.ready",{tenant:r.slug,order:t}),{status:s})).data.success&&(s==="ready"?(x(o=>o.filter(a=>a.id!==t)),p.success("Pedido despachado")):(x(o=>o.map(a=>a.id===t?{...a,status:"preparing"}:a)),p.success("Pedido marcado como preparando")))}catch{p.error("Error al actualizar pedido")}finally{k(null),N(null)}},[r.slug]),P=t=>{N({id:t,action:"ready"})},$=t=>{A(t,"preparing")},z=()=>{u&&A(u.id,u.action)};i.useEffect(()=>{const t=window.Echo;if(!t?.connector||!r.id){b(!1);return}b(!0);const s=n?`tenant.${r.id}.location.${n}.kitchen`:`tenant.${r.id}.kitchen`;let d=null;try{d=t.channel(s).listen(".order.sent",o=>{const a=o;x(c=>{const m=c.findIndex(f=>f.id===a.id);if(m!==-1){const f=[...c];return f[m]=a,f}return[...c,a]}),C(),p.info(`Nuevo pedido: ${a.ticket_number}`,{description:`${a.service_type==="dine_in"?a.table?.name||"Mesa":"Para llevar"}`,icon:e.jsx(D,{className:"w-4 h-4 text-blue-500"})})})}catch(o){console.error("Error subscribing to Echo channel:",o),b(!1)}return()=>{try{t.leave(s)}catch{}}},[r.id,n,C]),i.useEffect(()=>{if(g)return;const s=setInterval(async()=>{try{const d={};n&&(d.location_id=String(n)),l!=="all"&&(d.status=l);const o=await v.get(route("tenant.admin.kitchen.orders",{tenant:r.slug}),{params:d});x(o.data)}catch{}},3e4);return()=>clearInterval(s)},[g,r.slug,n,l]);const[S,E]=i.useState(!1),F=async()=>{E(!0);try{const t={};n&&(t.location_id=String(n));const s=await v.get(route("tenant.admin.kitchen.orders",{tenant:r.slug}),{params:t});x(s.data),p.success("Comandas actualizadas")}catch{p.error("Error al refrescar")}finally{E(!1)}},H=t=>{const s=t==="all"?null:Number(t);L(s),window.location.href=route("tenant.admin.kitchen.index",{tenant:r.slug,...s?{location_id:s}:{}})},w=l==="all"?h:h.filter(t=>t.status===l),V=h.filter(t=>t.status==="confirmed").length,B=h.filter(t=>t.status==="preparing").length;return e.jsxs(W,{hideSidebar:!0,hideNavbar:!0,hideFooter:!0,maxwidth:"w-full h-screen",children:[e.jsx(K,{title:"Monitor de Cocina"}),e.jsxs("div",{className:"flex flex-col h-screen bg-slate-900 overflow-hidden",children:[e.jsxs("header",{className:"bg-slate-800 border-b border-slate-700 p-4 flex justify-between items-center shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(I,{variant:"ghost",size:"icon",className:"text-slate-400 hover:text-white hover:bg-slate-700 rounded-full",asChild:!0,children:e.jsx(U,{href:route("tenant.dashboard",{tenant:r.slug}),children:e.jsx(ie,{className:"w-6 h-6"})})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-blue-600 p-2 rounded-lg",children:e.jsx(ne,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-white tracking-tight",children:"MONITOR DE COCINA"}),e.jsx("p",{className:"text-xs text-slate-400 font-medium uppercase tracking-widest",children:"Panel de Control de Comandas"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[y.length>1&&e.jsxs(q,{value:n?String(n):"all",onValueChange:H,children:[e.jsx(G,{className:"w-[160px] h-9 bg-slate-700 border-slate-600 text-white text-xs",children:e.jsx(J,{placeholder:"Todas las sedes"})}),e.jsxs(Q,{children:[e.jsx(M,{value:"all",children:"Todas las sedes"}),y.map(t=>e.jsx(M,{value:String(t.id),children:t.name},t.id))]})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-slate-700/50 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>j("all"),className:`px-3 py-1.5 rounded text-[10px] font-bold uppercase transition-colors ${l==="all"?"bg-slate-600 text-white":"text-slate-400 hover:text-white"}`,children:["Todos (",h.length,")"]}),e.jsxs("button",{onClick:()=>j("confirmed"),className:`px-3 py-1.5 rounded text-[10px] font-bold uppercase transition-colors ${l==="confirmed"?"bg-slate-100 text-slate-900":"text-slate-400 hover:text-white"}`,children:["Nuevos (",V,")"]}),e.jsxs("button",{onClick:()=>j("preparing"),className:`px-3 py-1.5 rounded text-[10px] font-bold uppercase transition-colors ${l==="preparing"?"bg-blue-600 text-white":"text-slate-400 hover:text-white"}`,children:["Preparando (",B,")"]})]}),e.jsx("div",{className:"h-10 w-px bg-slate-700 mx-1"}),e.jsx(I,{variant:"ghost",size:"icon",className:"text-slate-400 hover:text-white hover:bg-slate-700",onClick:F,disabled:S,children:e.jsx(le,{className:`w-5 h-5 ${S?"animate-spin":""}`})}),e.jsxs("div",{className:"hidden lg:flex gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-slate-100"}),e.jsx("span",{className:"text-[10px] text-slate-300 font-bold uppercase",children:"A tiempo"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-amber-500"}),e.jsx("span",{className:"text-[10px] text-slate-300 font-bold uppercase",children:"Retraso"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),e.jsx("span",{className:"text-[10px] text-slate-300 font-bold uppercase",children:"Urgente"})]})]}),e.jsx("div",{className:"h-10 w-px bg-slate-700 mx-1"}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-mono font-bold text-blue-400 leading-none",children:w.length}),e.jsx("span",{className:"text-[10px] text-slate-500 font-bold uppercase",children:"Activos"})]})]})]}),e.jsx("main",{className:"flex-1 p-4 overflow-hidden relative",children:w.length===0?e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-slate-600",children:[e.jsx(ce,{className:"w-24 h-24 mb-4 opacity-10"}),e.jsx("h2",{className:"text-2xl font-bold opacity-20",children:l!=="all"?"SIN COMANDAS EN ESTE FILTRO":"COCINA SIN COMANDAS"}),e.jsx("p",{className:"text-slate-700 opacity-20",children:"Esperando nuevos pedidos..."})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-4 h-full content-start overflow-y-auto pr-2 custom-scrollbar",children:e.jsx(de,{mode:"popLayout",children:w.map(t=>e.jsx(oe,{order:t,onReady:P,onPreparing:$,processingId:_},t.id))})})}),e.jsx("footer",{className:"bg-slate-800/50 p-2 shrink-0 border-t border-slate-700",children:e.jsxs("div",{className:"flex justify-center items-center gap-4 text-[10px] text-slate-500 font-mono uppercase tracking-widest",children:[g?e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"w-3.5 h-3.5 text-green-500"}),e.jsx("span",{className:"text-green-400",children:"Tiempo Real Conectado"}),e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"})]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"w-3.5 h-3.5 text-amber-500"}),e.jsx("span",{className:"text-amber-400",children:"Modo Polling (30s)"}),e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-amber-500"})]}),e.jsx("span",{className:"opacity-50",children:"|"}),e.jsx("span",{children:"KDS v2.0"})]})})]}),e.jsx(X,{open:!!u,onOpenChange:t=>{t||N(null)},children:e.jsxs(Y,{children:[e.jsxs(Z,{children:[e.jsx(ee,{children:"Â¿Despachar pedido?"}),e.jsxs(te,{children:["El pedido serÃ¡ marcado como ",e.jsx("strong",{className:"text-green-600",children:"Listo"})," y notificado al POS. Esta acciÃ³n no se puede deshacer."]})]}),e.jsxs(se,{children:[e.jsx(ae,{children:"Cancelar"}),e.jsx(re,{onClick:z,className:"bg-green-600 text-white hover:bg-green-700",children:"SÃ­, Despachar"})]})]})}),e.jsx("style",{children:`
                .custom-scrollbar::-webkit-scrollbar {
                    width: 6px;
                }
                .custom-scrollbar::-webkit-scrollbar-track {
                    background: rgba(30, 41, 59, 0.5);
                    border-radius: 10px;
                }
                .custom-scrollbar::-webkit-scrollbar-thumb {
                    background: #334155;
                    border-radius: 10px;
                }
                .custom-scrollbar::-webkit-scrollbar-thumb:hover {
                    background: #475569;
                }
            `})]})}export{Tt as default};
