import{j as e,H as _s,L as lt,r as l,t as S,a as G,b as We}from"./app-CzmtjlCW.js";import{T as it}from"./sonner-CR6Tr01l.js";import{A as ot}from"./arrow-left-CHMgq-Bp.js";import{U as Xe}from"./user-D2yrztw3.js";import{B as C}from"./button-DHDYV-Vu.js";import{I as L}from"./input-CkrKzdip.js";import{S as ue}from"./scroll-area-BkKwIDU9.js";import{A as le,a as ie,b as oe,c as ce,d as de,e as me,f as xe,g as he}from"./alert-dialog-BdvmeaMn.js";import{S as Ss,a as ks,c as ct}from"./sheet-BCCP-sjc.js";import{D as fe,a as ge,b as Se,c as ke,e as Je,d as dt}from"./dialog-CDtZpi6V.js";import{T as mt,a as xt,b as qe,c as Ue}from"./tabs-D2Zj1Laj.js";import{L as B}from"./label-s6Z-YQDs.js";import{Q as ht}from"./index-B7OX6jvy.js";import{f as N,c as Ye,R as ut}from"./currency-CbSp2N4L.js";import{U as pt}from"./utensils-K4erno8v.js";import{B as Ts}from"./banknote-B4QtVHv_.js";import{C as we}from"./credit-card-o3EdvoAE.js";import{S as ft}from"./smartphone-BCwrcGAU.js";import{C as ye}from"./circle-check-big-3tN7PW87.js";import{C as Qe}from"./clock-D1X9wNgA.js";import{M as Is}from"./minus-DAU_1RQK.js";import{P as Ce}from"./plus-BCBDbY-P.js";import{T as gt}from"./textarea-BVs60Bnz.js";import{S as se}from"./search-CetFsz5w.js";import{L as pe}from"./loader-circle-CrqYqwPq.js";import{C as bt}from"./check-CDpry8EA.js";import{B as vs}from"./badge-C86koyY8.js";import{c as Ps}from"./createLucideIcon-CaH5oZCX.js";import{P as Ge}from"./package-A6FRi7Sy.js";import{T as jt}from"./trash-2-D8FHOsLd.js";import{U as vt}from"./user-plus-OCAEwWtV.js";import{B as Nt}from"./ban-BdsZZIG6.js";import{C as Ke}from"./chef-hat-DMkmJSds.js";import{C as wt}from"./card-Cio2ZpWt.js";import{X as yt}from"./x-B2qOMX6F.js";import{P as Ct}from"./printer-CyEp20Pn.js";import{S as _t,a as St,b as kt,c as Tt,d as It}from"./select-BsP5-Mx7.js";import{A as Be}from"./armchair-CKK2rb5V.js";import{B as Ns}from"./badge-check-bj2LNrR7.js";import{I as Pt}from"./image-P2aBp7_n.js";import"./utils-BH2tHD_A.js";import"./index-Bik950zP.js";import"./index-D4uLenfM.js";import"./index-BKdn1L7U.js";import"./index-BdQq_4o_.js";import"./index-DLCIQy2W.js";import"./index-tuvqS7go.js";import"./index-BPIYxXZn.js";import"./index-Bdv8as05.js";import"./index-B7u58P25.js";import"./index-0rkHg0Ic.js";import"./index-i2FoVhyH.js";import"./index-CqTlmCQK.js";import"./chevron-down-DmTOaxVY.js";import"./chevron-up-Dd6KBSzl.js";const $t=[["rect",{x:"2",y:"6",width:"20",height:"8",rx:"1",key:"1estib"}],["path",{d:"M17 14v7",key:"7m2elx"}],["path",{d:"M7 14v7",key:"1cm7wv"}],["path",{d:"M17 3v3",key:"1v4jwn"}],["path",{d:"M7 3v3",key:"7o6guu"}],["path",{d:"M10 14 2.3 6.3",key:"1023jk"}],["path",{d:"m14 6 7.7 7.7",key:"1s8pl2"}],["path",{d:"m8 6 8 8",key:"hl96qh"}]],ws=Ps("construction",$t);const Mt=[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]],_e=Ps("shopping-cart",Mt);function At({children:a,title:x,tenant:n,user:u}){const g=u?.label==="waiter"||u?.permissions?.includes("pos.waiter_mode");return e.jsxs("div",{className:"h-screen bg-slate-100 flex flex-col font-outfit overflow-hidden",children:[e.jsx(_s,{title:`POS - ${x}`}),e.jsxs("header",{className:"h-14 bg-slate-900 flex items-center justify-between px-4 shrink-0 z-50 shadow-md border-b border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[!g&&e.jsx(lt,{href:route("tenant.dashboard",n.slug),className:"p-2 -ml-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-full transition-all",title:"Volver al Dashboard",children:e.jsx(ot,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-black text-white text-lg tracking-tight",children:["LINKIU",e.jsx("span",{className:"text-indigo-400",children:"POS"})]}),e.jsx("span",{className:"text-slate-600",children:"/"}),e.jsx("span",{className:"font-medium text-slate-300 text-sm hidden sm:inline",children:x})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1 bg-emerald-500/10 rounded-full border border-emerald-500/20",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500 animate-pulse"}),e.jsx("span",{className:"text-[10px] font-bold text-emerald-500 uppercase tracking-wider",children:"En LÃ­nea"})]}),e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-800 flex items-center justify-center text-xs font-bold text-white border border-slate-700 shadow-inner",children:e.jsx(Xe,{className:"w-4 h-4 text-slate-400"})})]})]}),e.jsx("main",{className:"flex-1 flex overflow-hidden relative",children:a}),e.jsx(it,{position:"bottom-center"})]})}const A=[];for(let a=0;a<256;++a)A.push((a+256).toString(16).slice(1));function Et(a,x=0){return(A[a[x+0]]+A[a[x+1]]+A[a[x+2]]+A[a[x+3]]+"-"+A[a[x+4]]+A[a[x+5]]+"-"+A[a[x+6]]+A[a[x+7]]+"-"+A[a[x+8]]+A[a[x+9]]+"-"+A[a[x+10]]+A[a[x+11]]+A[a[x+12]]+A[a[x+13]]+A[a[x+14]]+A[a[x+15]]).toLowerCase()}let He;const Dt=new Uint8Array(16);function Ot(){if(!He){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");He=crypto.getRandomValues.bind(crypto)}return He(Dt)}const Lt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ys={randomUUID:Lt};function Rt(a,x,n){a=a||{};const u=a.random??a.rng?.()??Ot();if(u.length<16)throw new Error("Random bytes length must be >= 16");return u[6]=u[6]&15|64,u[8]=u[8]&63|128,Et(u)}function Ft(a,x,n){return ys.randomUUID&&!a?ys.randomUUID():Rt(a)}function zt({open:a,onOpenChange:x,total:n,items:u,onSuccess:g,customer:j,tenant:w,table:T,isWaiter:v=!1,locationId:c}){const[o,m]=l.useState("cash"),[b,k]=l.useState(""),[E,M]=l.useState(""),[r,f]=l.useState(""),[$,P]=l.useState(null),[p,O]=l.useState(!1),[R,Ze]=l.useState(!0);if(!w)return console.error("CheckoutDialog: Tenant prop is missing or undefined."),null;l.useEffect(()=>{a&&!r&&f(Ft()),a||(f(""),P(null),M(""))},[a]),l.useEffect(()=>{if(!r||!w.id)return;let I=null;try{const D=window.Echo;D?.connector&&(I=D.private(`pos.${w.id}.magic.${r}`).listen(".proof.uploaded",te=>{P(te.fileUrl),M("Linkiu MÃ¡gico - Recibido"),S.success("Â¡Comprobante recibido!")}))}catch(D){console.error("Echo subscription error:",D)}return()=>{I?.stopListening(".proof.uploaded")}},[r,w?.id]);const V=o==="cash"&&b?parseFloat(b)-n:0,H=o!=="cash"||parseFloat(b)>=n,be=(I=!0)=>{I&&!H||(O(!0),G.post(route("tenant.pos.store",{tenant:w.slug}),{location_id:c,items:u.filter(D=>!D.is_sent).map(D=>({product_id:D.product_id,quantity:D.quantity,variant_options:D.variant_options,notes:D.notes||null})),payment_method:I?o:null,service_type:T?"dine_in":"takeout",cash_amount:I&&o==="cash"?parseFloat(b):null,cash_change:I&&o==="cash"?V:null,payment_reference:I&&o==="transfer"?E:null,customer_id:j?j.id:null,customer_name:j?j.name:T?`Mesa ${T.name}`:"Mostrador",customer_phone:j?j.phone:null,table_id:T?T.id:null,send_to_kitchen:R},{onSuccess:()=>{O(!1),x(!1),I?g({orderId:0,paymentMethod:o,cashAmount:o==="cash"?parseFloat(b):void 0,change:o==="cash"?V:void 0}):(g(),S.success("Â¡Pedido guardado y mesa ocupada!"))},onError:D=>{O(!1),console.error(D),S.error("Error al procesar el pedido.")}}))};return e.jsx(fe,{open:a,onOpenChange:I=>!p&&x(I),children:e.jsxs(ge,{className:"sm:max-w-md",children:[e.jsx(Se,{children:e.jsx(ke,{className:"text-center text-xl font-bold",children:"Cobrar Pedido"})}),e.jsxs("div",{className:"py-4",children:[e.jsxs("div",{className:"flex items-center justify-between bg-slate-50 p-3 rounded-lg border border-slate-200 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pt,{className:"w-5 h-5 text-indigo-600"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-bold text-slate-900",children:"Enviar a Cocina"}),e.jsx("span",{className:"text-[10px] text-slate-500",children:"Â¿Emitir comanda al KDS?"})]})]}),e.jsx(C,{variant:R?"default":"outline",size:"sm",className:`h-8 px-3 ${R?"bg-indigo-600":""}`,onClick:()=>Ze(!R),children:R?"SÃ":"NO"})]}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("span",{className:"text-slate-500 text-sm",children:"Total a Pagar"}),e.jsx("div",{className:"text-5xl font-black text-slate-900 mt-1",children:N(n)})]}),e.jsxs(mt,{value:o,onValueChange:I=>m(I),className:"w-full",children:[e.jsxs(xt,{className:"grid w-full grid-cols-3 mb-4",children:[e.jsxs(qe,{value:"cash",className:"flex flex-col gap-1 py-2 h-auto",children:[e.jsx(Ts,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Efectivo"})]}),e.jsxs(qe,{value:"card",className:"flex flex-col gap-1 py-2 h-auto",children:[e.jsx(we,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Tarjeta"})]}),e.jsxs(qe,{value:"transfer",className:"flex flex-col gap-1 py-2 h-auto",children:[e.jsx(ft,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Transferencia"})]})]}),e.jsxs(Ue,{value:"cash",className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Dinero Recibido"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 font-bold text-slate-500",children:"$"}),e.jsx(L,{type:"number",value:b,onChange:I=>k(I.target.value),className:"pl-7 text-lg font-bold",placeholder:"0",autoFocus:!0})]})]}),b&&e.jsxs("div",{className:`p-4 rounded-lg flex justify-between items-center ${V>=0?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:[e.jsx("span",{className:"font-bold",children:"Cambio / Devuelta:"}),e.jsx("span",{className:"font-black text-xl",children:N(Math.max(0,V))})]}),o==="cash"&&V<0&&e.jsxs("p",{className:"text-red-500 text-xs font-bold text-center",children:["Faltan ",N(Math.abs(V))]})]}),e.jsx(Ue,{value:"card",children:e.jsxs("div",{className:"bg-slate-50 p-6 rounded-xl border border-dashed border-slate-300 flex flex-col items-center justify-center text-center gap-2",children:[e.jsx("div",{className:"w-12 h-12 bg-white rounded-full flex items-center justify-center shadow-sm border border-slate-200",children:e.jsx(we,{className:"w-6 h-6 text-slate-900"})}),e.jsxs("p",{className:"text-sm text-slate-600 font-medium",children:["Procesar pago en datÃ¡fono por ",e.jsx("span",{className:"font-bold text-slate-900",children:N(n)})]})]})}),e.jsx(Ue,{value:"transfer",children:e.jsxs("div",{className:"bg-slate-50 p-6 rounded-xl border border-dashed border-slate-300 flex flex-col items-center justify-center text-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-slate-600 font-medium mb-1",children:"Total a Transferir"}),e.jsx("span",{className:"font-bold text-2xl text-slate-900",children:N(n)})]}),$?e.jsxs("div",{className:"w-full bg-green-50 border border-green-200 rounded-lg p-4 flex flex-col items-center gap-2 animate-in fade-in zoom-in",children:[e.jsx(ye,{className:"w-8 h-8 text-green-600"}),e.jsx("p",{className:"text-green-800 font-bold text-sm",children:"Â¡Comprobante Recibido!"}),e.jsx("a",{href:$,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-indigo-600 underline",children:"Ver Comprobante"}),e.jsx("img",{src:$,alt:"Comprobante",className:"w-16 h-16 object-cover rounded border"})]}):e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"bg-white p-2 rounded shadow-sm border",children:r&&e.jsx(ht,{value:route("tenant.magic.show",{tenant:w.slug,token:r}),size:128,level:"M"})}),e.jsx("p",{className:"text-[10px] text-slate-500 uppercase tracking-wider font-bold",children:"Escanear para cargar comprobante"})]}),e.jsxs("div",{className:"w-full space-y-2 text-left",children:[e.jsx(B,{children:"Referencia / Comprobante (Opcional)"}),e.jsx(L,{placeholder:"#123456",value:E,onChange:I=>M(I.target.value),className:"bg-white"})]})]})})]})]}),e.jsxs(Je,{className:"flex-col sm:flex-row gap-2",children:[e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx(C,{variant:"outline",onClick:()=>x(!1),className:"flex-1",children:"Cancelar"}),T&&e.jsxs(C,{variant:"secondary",className:"flex-1 bg-slate-100 hover:bg-slate-200 text-slate-900",onClick:()=>be(!1),disabled:p,children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Guardar"]})]}),e.jsx(C,{size:"lg",className:"w-full sm:w-auto bg-slate-900 hover:bg-slate-800 text-white font-bold",onClick:()=>be(!0),disabled:!H||p,children:p?"Procesando...":e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"w-5 h-5 mr-2"}),v?"Enviar (PrecauciÃ³n)":"Confirmar Pago"]})})]})]})})}function Vt({product:a,open:x,onOpenChange:n,onAddToCart:u}){const[g,j]=l.useState(1),[w,T]=l.useState({}),[v,c]=l.useState("");l.useEffect(()=>{x&&a&&(j(1),T({}),c(""))},[x,a]);const o=a?Number(a.price):0,m=r=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}).format(r),b=l.useMemo(()=>{if(!a)return 0;let r=o;return a.variant_groups&&a.variant_groups.forEach(f=>{(w[f.id]||[]).forEach(P=>{const p=f.options.find(O=>O.id===P);p&&(r+=Number(p.price_adjustment))})}),r},[a,w,o]),k=b*g,E=(r,f,$)=>{T(P=>{const p=P[r]||[];return $==="radio"?{...P,[r]:[f]}:p.includes(f)?{...P,[r]:p.filter(O=>O!==f)}:{...P,[r]:[...p,f]}})},M=()=>{if(a){if(a.variant_groups){for(const r of a.variant_groups)if(r.is_required&&(w[r.id]||[]).length<r.min_selection){S.error(`Selecciona al menos ${r.min_selection} opciÃ³n en ${r.name}`);return}}u(a,g,w,k,v.trim()||void 0)}};return a?e.jsx(fe,{open:x,onOpenChange:n,children:e.jsxs(ge,{className:"sm:max-w-[500px] max-h-[90vh] flex flex-col p-0 gap-0 bg-white border-0 shadow-2xl",children:[e.jsx(Se,{className:"p-4 border-b border-slate-100 flex-shrink-0",children:e.jsxs(ke,{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-bold text-lg text-slate-900",children:a.name}),e.jsx("span",{className:"text-lg font-black text-indigo-600",children:m(b)})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6 intro-y",children:[a.variant_groups?.map(r=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-slate-800 text-sm",children:r.name}),r.is_required&&e.jsx("span",{className:"bg-red-50 text-red-600 text-[10px] font-bold px-2 py-0.5 rounded-full uppercase",children:"Requerido"})]}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:r.options.map(f=>{const $=(w[r.id]||[]).includes(f.id),P=Number(f.price_adjustment);return e.jsxs("label",{className:`flex items-center justify-between p-3 rounded-lg border cursor-pointer transition-all active:scale-[0.99] ${$?"border-indigo-600 bg-indigo-50/50 ring-1 ring-indigo-600":"border-slate-200 hover:border-slate-300 bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-4 h-4 rounded-full border flex items-center justify-center transition-colors ${$?"bg-indigo-600 border-indigo-600":"border-slate-300"}`,children:$&&e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full"})}),e.jsx("span",{className:`text-sm font-medium ${$?"text-indigo-900":"text-slate-700"}`,children:f.name})]}),e.jsx("input",{type:r.type==="radio"?"radio":"checkbox",name:`group-${r.id}`,className:"hidden",checked:$,onChange:()=>E(r.id,f.id,r.type)}),P>0&&e.jsxs("span",{className:"text-xs font-bold text-slate-600",children:["+",m(P)]})]},f.id)})})]},r.id)),(!a.variant_groups||a.variant_groups.length===0)&&e.jsx("div",{className:"text-center py-4 text-slate-400 text-sm",children:"Este producto no tiene opciones adicionales."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-bold text-slate-800 text-sm",children:"Notas especiales"}),e.jsx("textarea",{value:v,onChange:r=>c(r.target.value),placeholder:"Ej: Sin cebolla, extra queso, tÃ©rmino medio...",maxLength:200,rows:2,className:"w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2.5 text-sm text-slate-700 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none"}),e.jsxs("div",{className:"text-[10px] text-slate-400 text-right",children:[v.length,"/200"]})]})]}),e.jsxs(Je,{className:"p-4 border-t border-slate-100 bg-slate-50 flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"flex items-center justify-center bg-white rounded-xl border border-slate-200 h-12 w-full sm:w-auto px-1 shadow-sm",children:[e.jsx("button",{onClick:()=>j(Math.max(1,g-1)),className:"w-10 h-full flex items-center justify-center text-slate-500 hover:text-red-600 active:scale-90 transition-transform",children:e.jsx(Is,{className:"w-4 h-4"})}),e.jsx("span",{className:"w-10 text-center font-bold text-lg text-slate-900",children:g}),e.jsx("button",{onClick:()=>j(g+1),className:"w-10 h-full flex items-center justify-center text-slate-500 hover:text-indigo-600 active:scale-90 transition-transform",children:e.jsx(Ce,{className:"w-4 h-4"})})]}),e.jsxs(C,{onClick:M,className:"flex-1 h-12 text-base font-bold bg-indigo-600 hover:bg-indigo-700 text-white shadow-lg shadow-indigo-600/20",children:[e.jsxs("span",{children:["Agregar ",g>1&&`(${g})`]}),e.jsx("span",{className:"ml-auto bg-black/20 px-2 py-0.5 rounded text-sm",children:m(k)})]})]})]})}):null}function qt({open:a,onOpenChange:x,onSelect:n}){const[u,g]=l.useState("search"),[j,w]=l.useState(""),[T,v]=l.useState([]),[c,o]=l.useState(!1),[m,b]=l.useState({name:"",phone:"",document:"",email:"",address:"",notes:""});l.useEffect(()=>{if(a&&u==="search"){const r=setTimeout(()=>{j.length>0?k():v([])},300);return()=>clearTimeout(r)}},[j,u,a]);const k=async()=>{o(!0);try{const r=await We.get(route("tenant.admin.pos.customers.index"),{params:{search:j}});v(r.data)}catch(r){console.error(r),S.error("Error buscando clientes")}finally{o(!1)}},E=async r=>{r.preventDefault(),o(!0);try{const $=(await We.post(route("tenant.admin.pos.customers.store"),{name:m.name,phone:m.phone,identification_number:m.document,email:m.email,address:m.address,notes:m.notes})).data;S.success("Cliente creado correctamente"),n($),b({name:"",phone:"",document:"",email:"",address:"",notes:""}),g("search")}catch(f){console.error(f),S.error("Error creando cliente. Verifica los datos.")}finally{o(!1)}},M=r=>{n(r)};return e.jsx(fe,{open:a,onOpenChange:x,children:e.jsxs(ge,{className:"sm:max-w-[500px] h-[600px] flex flex-col p-0 gap-0 bg-white border-0 shadow-2xl",children:[e.jsx(Se,{className:"p-4 border-b border-slate-100 flex-shrink-0 bg-slate-50",children:e.jsxs(ke,{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-bold text-lg text-slate-900",children:u==="search"?"Seleccionar Cliente":"Nuevo Cliente"}),u==="search"?e.jsxs(C,{size:"sm",onClick:()=>g("create"),className:"bg-indigo-600 hover:bg-indigo-700 text-white shadow-sm gap-1",children:[e.jsx(Ce,{className:"w-4 h-4"})," Nuevo"]}):e.jsxs(C,{size:"sm",variant:"ghost",onClick:()=>g("search"),className:"text-slate-500 hover:text-slate-900 gap-1",children:[e.jsx(se,{className:"w-4 h-4"})," Buscar"]})]})}),e.jsx("div",{className:"flex-1 overflow-hidden flex flex-col",children:u==="search"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 border-b border-slate-100",children:e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(L,{placeholder:"Buscar por nombre, telÃ©fono o documento...",value:j,onChange:r=>w(r.target.value),className:"pl-9 h-12 text-base",autoFocus:!0})]})}),e.jsx(ue,{className:"flex-1",children:e.jsxs("div",{className:"p-2 space-y-1",children:[T.length===0&&j.length>0&&!c&&e.jsxs("div",{className:"text-center py-10 text-slate-400",children:[e.jsx("p",{children:"No se encontraron clientes."}),e.jsx(C,{variant:"link",onClick:()=>g("create"),className:"text-indigo-600",children:"Crear nuevo"})]}),T.length===0&&j.length===0&&e.jsxs("div",{className:"text-center py-10 text-slate-400",children:[e.jsx(Xe,{className:"w-12 h-12 mx-auto mb-2 opacity-20"}),e.jsx("p",{children:"Busca un cliente para empezar"})]}),c?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx(pe,{className:"w-6 h-6 animate-spin text-slate-400"})}):T.map(r=>e.jsxs("button",{onClick:()=>M(r),className:"w-full text-left p-3 rounded-lg hover:bg-slate-50 transition-colors flex items-center justify-between group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center font-bold text-sm text-slate-500 group-hover:bg-indigo-100 group-hover:text-indigo-600 transition-colors",children:r.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-slate-700 group-hover:text-indigo-900",children:r.name}),e.jsxs("div",{className:"text-xs text-slate-400 flex gap-2",children:[r.phone&&e.jsx("span",{children:r.phone}),r.identification_number&&e.jsxs("span",{children:["â€¢ ",r.identification_number]})]})]})]}),e.jsx(bt,{className:"w-5 h-5 text-indigo-600 opacity-0 group-hover:opacity-100 transition-opacity"})]},r.id))]})})]}):e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("form",{id:"create-customer-form",onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"name",children:"Nombre Completo *"}),e.jsx(L,{id:"name",required:!0,value:m.name,onChange:r=>b({...m,name:r.target.value}),className:"h-11",placeholder:"Ej. Juan PÃ©rez"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"phone",children:"TelÃ©fono / WhatsApp"}),e.jsx(L,{id:"phone",value:m.phone,onChange:r=>b({...m,phone:r.target.value}),className:"h-11",placeholder:"300 123 4567"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"document",children:"Documento / NIT"}),e.jsx(L,{id:"document",value:m.document,onChange:r=>b({...m,document:r.target.value}),className:"h-11",placeholder:"Opcional"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"email",children:"Email (FacturaciÃ³n)"}),e.jsx(L,{id:"email",type:"email",value:m.email,onChange:r=>b({...m,email:r.target.value}),className:"h-11",placeholder:"cliente@email.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"address",children:"DirecciÃ³n (Delivery)"}),e.jsx(gt,{id:"address",value:m.address,onChange:r=>b({...m,address:r.target.value}),className:"resize-none",placeholder:"Calle 123... (Opcional)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"notes",children:"Notas Internas"}),e.jsx(L,{id:"notes",value:m.notes,onChange:r=>b({...m,notes:r.target.value}),className:"h-11",placeholder:"Preferencias, alergias, etc."})]})]})})}),e.jsx(Je,{className:`p-4 border-t border-slate-100 bg-slate-50 ${u==="create"?"justify-between":"justify-end"}`,children:u==="create"?e.jsxs(e.Fragment,{children:[e.jsx(C,{type:"button",variant:"ghost",onClick:()=>g("search"),children:"Cancelar"}),e.jsxs(C,{type:"submit",form:"create-customer-form",disabled:c,className:"bg-indigo-600 hover:bg-indigo-700 w-32",children:[c&&e.jsx(pe,{className:"w-4 h-4 mr-2 animate-spin"}),"Guardar"]})]}):e.jsx(C,{variant:"outline",onClick:()=>x(!1),children:"Cerrar"})})]})})}function Cs({cart:a,cartTotal:x,selectedCustomer:n,onUpdateQuantity:u,onRemoveFromCart:g,onClearCart:j,onOpenCustomerModal:w,onShowCheckout:T,onSendToKitchen:v,canPay:c,isProcessing:o=!1,isTakeoutMode:m=!1,selectedTable:b,onAddProducts:k,onFreeTable:E,onCancelSentItem:M,taxSettings:r}){const{subtotal:f,taxAmount:$,grandTotal:P}=l.useMemo(()=>Ye(x,r?.tax_rate||0,r?.price_includes_tax||!1),[x,r]);return!b&&!m?e.jsxs("div",{className:"flex flex-col h-full bg-white items-center justify-center p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(_e,{className:"w-8 h-8 text-slate-300"})}),e.jsx("h3",{className:"font-bold text-slate-800 text-lg mb-2",children:"Sin Mesa Seleccionada"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"Selecciona una mesa del mapa para comenzar una orden."})]}):e.jsxs("div",{className:"flex flex-col h-full bg-white w-full",children:[e.jsxs("div",{className:`h-16 px-4 py-3 border-b border-slate-100 flex items-center justify-between shrink-0 ${m?"bg-indigo-100":"bg-indigo-50"}`,children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-black text-xl text-indigo-900 flex items-center gap-2",children:m?e.jsxs(e.Fragment,{children:[e.jsx(Ge,{className:"w-5 h-5"})," Pedido RÃ¡pido"]}):b?.name}),e.jsx("p",{className:"text-xs text-indigo-400 font-medium",children:m?"Takeout / Delivery":"Orden en curso"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[b?.status==="occupied"&&E&&!m&&e.jsx(C,{variant:"ghost",size:"sm",className:"text-[10px] font-bold text-red-500 hover:bg-red-50 hover:text-red-600 h-8 px-2 border border-red-100 uppercase",onClick:E,children:"Liberar"}),e.jsx(C,{variant:"ghost",size:"icon",className:"text-slate-400 hover:text-red-500",onClick:j,children:e.jsx(jt,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"px-4 py-3 bg-slate-50 border-b border-slate-100 shrink-0",children:e.jsxs(C,{variant:"outline",className:`w-full justify-between bg-white border-dashed h-auto py-3 ${n?"border-indigo-200 bg-indigo-50/50":"text-slate-500 hover:text-indigo-600 hover:border-indigo-300"}`,onClick:w,children:[e.jsxs("div",{className:"flex items-center gap-3 text-left",children:[e.jsx("div",{className:`p-2 rounded-full ${n?"bg-indigo-100 text-indigo-600":"bg-slate-100 text-slate-400"}`,children:n?e.jsx(Xe,{className:"w-4 h-4"}):e.jsx(vt,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("div",{className:`text-sm font-bold ${n?"text-indigo-900":"text-slate-600"}`,children:n?n.name:"Seleccionar Cliente"}),e.jsx("div",{className:"text-[10px] text-slate-400",children:n?n.phone||"Cliente Registrado":"Venta de Mostrador"})]})]}),n?e.jsx(we,{className:"w-4 h-4 text-indigo-300"}):e.jsx(vs,{variant:"secondary",className:"opacity-50",children:"INVITADO"})]})}),e.jsx(ue,{className:"flex-1 px-4",children:e.jsx("div",{className:"py-4 space-y-3",children:a.length===0?e.jsxs("div",{className:"h-40 flex flex-col items-center justify-center text-slate-300 text-sm italic",children:[e.jsx(_e,{className:"w-10 h-10 mb-2 opacity-20"}),"Carrito vacÃ­o",e.jsx(C,{variant:"link",onClick:k,className:"mt-2 text-indigo-600",children:"Agregar Productos"})]}):a.map(p=>e.jsxs("div",{className:"flex gap-3 bg-white p-2 rounded-lg border border-slate-100 hover:border-indigo-100 transition-colors group",children:[e.jsx("div",{className:"w-12 h-12 bg-slate-100 rounded-md shrink-0 overflow-hidden",children:p.image_url&&e.jsx("img",{src:p.image_url,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:"font-bold text-sm text-slate-800 truncate pr-2",children:p.name}),e.jsx("div",{className:"font-bold text-sm text-slate-900",children:N(p.total)})]}),e.jsxs("div",{className:"text-xs text-slate-400 min-h-[16px] flex items-center justify-between",children:[e.jsxs("span",{children:[N(p.price)," c/u"]}),p.is_sent&&e.jsx(vs,{variant:"outline",className:"text-[9px] h-4 bg-orange-50 text-orange-600 border-orange-200",children:"En Cocina"})]}),p.notes&&e.jsxs("div",{className:"text-[10px] text-amber-600 bg-amber-50 px-2 py-0.5 rounded mt-1 border border-amber-100 italic",children:["ðŸ“ ",p.notes]}),e.jsx("div",{className:"flex items-center justify-between mt-2",children:p.is_sent?e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("span",{className:"text-xs font-bold text-slate-400",children:["Cantidad: ",p.quantity]}),M&&e.jsxs("button",{onClick:()=>M(p.id),className:"text-[10px] font-bold text-red-400 hover:text-red-600 flex items-center gap-1 transition-colors",title:"Anular item",children:[e.jsx(Nt,{className:"w-3 h-3"}),"Anular"]})]}):e.jsxs("div",{className:"flex items-center gap-3 bg-slate-50 rounded-full px-1 border border-slate-200",children:[e.jsx("button",{onClick:()=>p.quantity>1?u(p.id,-1):g(p.id),className:"w-6 h-6 flex items-center justify-center text-slate-500 hover:text-red-500",children:e.jsx(Is,{className:"w-3 h-3"})}),e.jsx("span",{className:"text-xs font-bold w-4 text-center",children:p.quantity}),e.jsx("button",{onClick:()=>u(p.id,1),className:"w-6 h-6 flex items-center justify-center text-slate-500 hover:text-indigo-600",children:e.jsx(Ce,{className:"w-3 h-3"})})]})})]})]},p.id))})}),e.jsx("div",{className:"p-4 border-t border-slate-100",children:e.jsxs(C,{variant:"outline",className:"w-full border-dashed border-indigo-300 text-indigo-600 hover:bg-indigo-50",onClick:k,children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Agregar Productos"]})}),e.jsxs("div",{className:"p-4 bg-white border-t border-slate-200 shadow-[0_-5px_20px_rgba(0,0,0,0.05)] shrink-0",children:[e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-500",children:"Subtotal"}),e.jsx("span",{className:"font-medium",children:N(f)})]}),r&&r.tax_rate>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-slate-500",children:[r.tax_name," (",r.tax_rate,"%)"]}),e.jsx("span",{className:"font-medium",children:N($)})]}),e.jsxs("div",{className:"flex justify-between items-end pt-2 border-t border-dashed border-slate-200",children:[e.jsx("span",{className:"font-bold text-lg text-slate-900",children:"Total"}),e.jsx("span",{className:"font-black text-2xl text-indigo-600",children:N(P)})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:c?e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(C,{variant:"outline",size:"lg",className:"h-14 flex flex-col items-center justify-center gap-1 border-orange-300 text-orange-600 hover:bg-orange-50",disabled:a.length===0||o||!a.some(p=>!p.is_sent),onClick:v,children:[o?e.jsx(pe,{className:"w-5 h-5 mb-0.5 animate-spin"}):e.jsx(Ke,{className:"w-5 h-5 mb-0.5"}),e.jsx("span",{className:"text-xs font-bold",children:"Cocina"})]}),e.jsxs(C,{size:"lg",className:"h-14 flex flex-col items-center justify-center gap-1 bg-green-600 hover:bg-green-700 text-white",disabled:a.length===0||o,onClick:T,children:[e.jsx(Ts,{className:"w-5 h-5 mb-0.5"}),e.jsx("span",{className:"text-xs font-bold",children:"Cobrar"})]})]}):e.jsxs(C,{size:"lg",className:"h-14 flex flex-col items-center justify-center gap-1 bg-orange-500 hover:bg-orange-600 text-white w-full",disabled:a.length===0||o,onClick:v,children:[o?e.jsx(pe,{className:"w-6 h-6 mb-0.5 animate-spin"}):e.jsx(Ke,{className:"w-6 h-6 mb-0.5"}),e.jsx("span",{className:"text-xs font-bold uppercase",children:o?"Enviando...":"Enviar a Cocina"})]})})]})]})}function Ut({open:a,onOpenChange:x,categories:n,onProductSelect:u}){const[g,j]=l.useState(""),[w,T]=l.useState(n.length>0?String(n[0].id):"all"),v=l.useMemo(()=>{let c=[];if(w==="all")n.forEach(o=>c.push(...o.products));else{const o=n.find(m=>String(m.id)===w);o&&(c=o.products)}if(g){const o=g.toLowerCase();c=c.filter(m=>m.name.toLowerCase().includes(o)||m.description?.toLowerCase().includes(o))}return c},[n,w,g]);return e.jsx(Ss,{open:a,onOpenChange:x,children:e.jsxs(ks,{side:"right",className:"w-[100vw] sm:w-[600px] p-0 flex flex-col h-full bg-slate-50",children:[e.jsxs("div",{className:"p-4 border-b bg-white",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx(ct,{children:"CatÃ¡logo de Productos"})}),e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-2.5 h-4 w-4 text-slate-400"}),e.jsx(L,{placeholder:"Buscar productos...",className:"pl-9 bg-slate-100 border-none",value:g,onChange:c=>j(c.target.value),autoFocus:!0})]})]}),e.jsx("div",{className:"border-b bg-white px-4 pb-2",children:e.jsx(ue,{className:"w-full whitespace-nowrap",children:e.jsxs("div",{className:"flex space-x-2 pb-2",children:[e.jsx(C,{variant:w==="all"?"default":"outline",size:"sm",onClick:()=>T("all"),className:w==="all"?"bg-indigo-600 hover:bg-indigo-700":"",children:"Todo"}),n.map(c=>e.jsx(C,{variant:w===String(c.id)?"default":"outline",size:"sm",onClick:()=>T(String(c.id)),className:w===String(c.id)?"bg-indigo-600 hover:bg-indigo-700":"",children:c.name},c.id))]})})}),e.jsx(ue,{className:"flex-1 p-4",children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3 pb-20",children:[v.map(c=>e.jsxs(wt,{className:"group cursor-pointer overflow-hidden hover:shadow-md transition-all border-slate-200",onClick:()=>{u(c)},children:[e.jsxs("div",{className:"aspect-[4/3] bg-slate-200 relative overflow-hidden",children:[c.image_url?e.jsx("img",{src:c.image_url,alt:c.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-slate-300",children:e.jsx(Ke,{className:"w-8 h-8"})}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors"})]}),e.jsxs("div",{className:"p-3",children:[e.jsx("div",{className:"font-medium text-slate-800 line-clamp-2 text-sm h-10 leading-tight",children:c.name}),e.jsx("div",{className:"font-bold text-indigo-600 mt-1",children:N(c.price)})]})]},c.id)),v.length===0&&e.jsx("div",{className:"col-span-full text-center py-10 text-slate-500",children:e.jsx("p",{children:"No se encontraron productos"})})]})})]})})}function Bt({open:a,onOpenChange:x,data:n}){const u=l.useRef(null);if(!n)return null;const g=n.items.reduce((k,E)=>k+E.total,0),{subtotal:j,taxAmount:w,grandTotal:T}=Ye(g,n.taxSettings?.tax_rate||0,n.taxSettings?.price_includes_tax||!1),v={cash:"Efectivo",card:"Tarjeta",transfer:"Transferencia"},c=new Date,o=c.toLocaleDateString("es-CO",{day:"2-digit",month:"2-digit",year:"numeric"}),m=c.toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit"}),b=()=>{if(!n)return;const k=n.items.map(f=>`<div class="row"><span class="item-name">${f.name}</span><span class="item-price">${N(f.total)}</span></div>
             <div class="detail">${f.quantity} x ${N(f.price)}</div>${f.notes?`<div class="detail" style="font-style:italic;">* ${f.notes}</div>`:""}`).join(""),E=n.taxSettings.tax_rate>0?`<div class="row"><span>${n.taxSettings.tax_name} (${n.taxSettings.tax_rate}%)</span><span>${N(w)}</span></div>`:"",M=n.paymentMethod==="cash"&&n.cashAmount!==void 0?`<div class="row"><span>Recibido</span><span>${N(n.cashAmount)}</span></div>
               <div class="row bold"><span>Cambio</span><span>${N(n.change??0)}</span></div>`:"",r=window.open("","_blank","width=350,height=700");r&&(r.document.write(`<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Recibo #${n.orderId}</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
@page {
    size: 80mm auto;
    margin: 0;
}
html, body {
    width: 80mm;
    margin: 0;
    padding: 0;
}
body {
    font-family: 'Courier New', 'Lucida Console', monospace;
    font-size: 12px;
    line-height: 1.5;
    color: #000;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
}
.receipt {
    width: 80mm;
    max-width: 80mm;
    margin: 0 auto;
    padding: 6mm 5mm;
}
.center { text-align: center; }
.bold { font-weight: bold; }
.shop-name {
    font-size: 18px;
    font-weight: 900;
    letter-spacing: -0.5px;
    margin-bottom: 3px;
}
.date { font-size: 10px; color: #333; margin-top: 2px; }
.divider {
    border: none;
    border-top: 1px dashed #000;
    margin: 8px 0;
}
.row {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    padding: 2px 0;
    font-size: 12px;
    gap: 8px;
}
.detail {
    font-size: 10px;
    color: #333;
    padding-left: 10px;
    margin-bottom: 5px;
}
.item-name {
    flex: 1;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    padding-right: 8px;
}
.item-price {
    white-space: nowrap;
    font-weight: bold;
}
.total-section .row { font-size: 12px; }
.grand-total {
    font-size: 20px;
    font-weight: 900;
    padding: 5px 0;
}
.footer {
    font-size: 9px;
    color: #555;
    margin-top: 10px;
    padding-top: 5px;
}
@media print {
    html, body { width: 80mm; }
    .receipt { width: 100%; padding: 4mm 4mm; }
}
@media screen {
    body { display: flex; justify-content: center; background: #f0f0f0; padding: 10px 0; }
    .receipt { background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.15); }
}
</style>
</head>
<body>
<div class="receipt">
<div class="center">
    <div class="shop-name">${n.tenant.name}</div>
    <div class="date">${o} - ${m}</div>
</div>
<div class="divider"></div>
<div class="row"><span>Pedido</span><span class="bold">#${String(n.orderId).padStart(4,"0")}</span></div>
${n.table?`<div class="row"><span>Mesa</span><span class="bold">${n.table.name}</span></div>`:""}
${n.customer?`<div class="row"><span>Cliente</span><span class="bold">${n.customer.name}</span></div>`:""}
<div class="divider"></div>
${k}
<div class="divider"></div>
<div class="total-section">
    <div class="row"><span>Subtotal</span><span>${N(j)}</span></div>
    ${E}
    <div class="divider"></div>
    <div class="row grand-total"><span>TOTAL</span><span>${N(T)}</span></div>
</div>
<div class="divider"></div>
<div class="row"><span>MÃ©todo</span><span class="bold">${v[n.paymentMethod]||n.paymentMethod}</span></div>
${M}
<div class="divider"></div>
<div class="center footer">
    <div class="bold" style="font-size:11px;color:#000;">Gracias por su compra</div>
    <div style="margin-top:3px;">Powered by Linkiu.bio</div>
</div>
</div>
<script>window.onload = function() { window.print(); window.close(); }<\/script>
</body>
</html>`),r.document.close())};return e.jsx(fe,{open:a,onOpenChange:x,children:e.jsxs(ge,{className:"sm:max-w-[360px] p-0 gap-0 bg-white overflow-hidden",children:[e.jsxs("div",{ref:u,className:"p-6 font-mono text-xs text-slate-900 leading-relaxed",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"text-lg font-black tracking-tight",children:n.tenant.name}),e.jsxs("div",{className:"text-[10px] text-slate-500 mt-1",children:[o," Â· ",m]})]}),e.jsx("div",{className:"border-t border-dashed border-slate-300 my-3"}),e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"text-slate-500",children:"Pedido"}),e.jsxs("span",{className:"font-bold",children:["#",String(n.orderId).padStart(4,"0")]})]}),n.table&&e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"text-slate-500",children:"Mesa"}),e.jsx("span",{className:"font-bold",children:n.table.name})]}),n.customer&&e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"text-slate-500",children:"Cliente"}),e.jsx("span",{className:"font-bold truncate ml-4",children:n.customer.name})]}),e.jsx("div",{className:"border-t border-dashed border-slate-300 my-3"}),e.jsx("div",{className:"space-y-2",children:n.items.map(k=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"truncate max-w-[180px] font-medium",children:k.name}),e.jsx("span",{className:"font-bold shrink-0 ml-2",children:N(k.total)})]}),e.jsxs("div",{className:"text-[10px] text-slate-400 pl-2",children:[k.quantity," x ",N(k.price)]}),k.notes&&e.jsxs("div",{className:"text-[10px] text-amber-600 pl-2 italic",children:["â†’ ",k.notes]})]},k.id))}),e.jsx("div",{className:"border-t border-dashed border-slate-300 my-3"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Subtotal"}),e.jsx("span",{children:N(j)})]}),n.taxSettings.tax_rate>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-slate-500",children:[n.taxSettings.tax_name," (",n.taxSettings.tax_rate,"%)"]}),e.jsx("span",{children:N(w)})]}),e.jsx("div",{className:"border-t border-slate-200 my-1"}),e.jsxs("div",{className:"flex justify-between text-base font-black",children:[e.jsx("span",{children:"TOTAL"}),e.jsx("span",{children:N(T)})]})]}),e.jsx("div",{className:"border-t border-dashed border-slate-300 my-3"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"MÃ©todo"}),e.jsx("span",{className:"font-bold",children:v[n.paymentMethod]||n.paymentMethod})]}),n.paymentMethod==="cash"&&n.cashAmount!==void 0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Recibido"}),e.jsx("span",{children:N(n.cashAmount)})]}),e.jsxs("div",{className:"flex justify-between font-bold text-green-700",children:[e.jsx("span",{children:"Cambio"}),e.jsx("span",{children:N(n.change??0)})]})]})]}),e.jsx("div",{className:"border-t border-dashed border-slate-300 my-4"}),e.jsxs("div",{className:"text-center text-[10px] text-slate-400 space-y-1",children:[e.jsx("p",{className:"font-bold text-slate-600",children:"Gracias por su compra"}),e.jsx("p",{children:"Powered by Linkiu.bio"})]})]}),e.jsxs("div",{className:"flex gap-2 p-4 border-t border-slate-200 bg-slate-50",children:[e.jsxs(C,{variant:"outline",className:"flex-1",onClick:()=>x(!1),children:[e.jsx(yt,{className:"w-4 h-4 mr-2"}),"Cerrar"]}),e.jsxs(C,{className:"flex-1 bg-slate-900 hover:bg-slate-800 text-white",onClick:b,children:[e.jsx(Ct,{className:"w-4 h-4 mr-2"}),"Imprimir"]})]})]})})}function Ga({tenant:a,categories:x,zones:n=[],taxSettings:u,currentUserRole:g,reservations:j=[],locations:w=[],currentLocationId:T}){const[v,c]=l.useState([]),[o,m]=l.useState(null),[b,k]=l.useState("all"),[E,M]=l.useState(!1),[r,f]=l.useState(!1),[$,P]=l.useState(!1),[p,O]=l.useState(!1),[R,Ze]=l.useState(T),[V,H]=l.useState(!1),[be,I]=l.useState(!1),[D,te]=l.useState(!1),[Te,es]=l.useState(null),[q,$s]=l.useState(""),[Ms,ss]=l.useState(!1),[As,Es]=l.useState(null),[W,je]=l.useState(!1),[Ds,Ie]=l.useState(!1),[ae,Pe]=l.useState(null),[$e,ts]=l.useState(!1),[re,as]=l.useState(""),[Os,Ls]=l.useState(!1),Rs=g?.label==="waiter"||g?.permissions?.includes("pos.waiter_mode")||!1,[ne,rs]=l.useState(null),[Fs,Me]=l.useState(!1),[ve,Ae]=l.useState(null),[K,Ee]=l.useState(null),ns=g?.is_owner||g?.permissions?.includes("pos.process_payment")||!1,{cartSubtotal:ls,cartTaxAmount:Ht,cartGrandTotal:zs}=l.useMemo(()=>{const s=v.reduce((i,y)=>i+y.total,0),{subtotal:t,taxAmount:d,grandTotal:h}=Ye(s,u?.tax_rate||0,u?.price_includes_tax||!1);return{cartSubtotal:t,cartTaxAmount:d,cartGrandTotal:h}},[v,u]);l.useEffect(()=>{const s=setTimeout(()=>Ls(!0),300);return()=>clearTimeout(s)},[]);const is=l.useMemo(()=>{const s=[];return x.forEach(t=>{t.products&&s.push(...t.products)}),s},[x]),os=l.useMemo(()=>{if(!re||re.length<2)return[];const s=re.toLowerCase();return is.filter(t=>t.name.toLowerCase().includes(s)).slice(0,6)},[re,is]),[De,cs]=l.useState(new Set),[ds,ms]=l.useState(!1),[Vs,qs]=l.useState(new Set),Oe=()=>{try{const s=window.AudioContext||window.webkitAudioContext,t=new s;[830,1046,1318].forEach((h,i)=>{const y=t.createOscillator(),_=t.createGain();y.type="sine",y.frequency.value=h,_.gain.setValueAtTime(.4,t.currentTime+i*.18),_.gain.exponentialRampToValueAtTime(.01,t.currentTime+i*.18+.3),y.connect(_),_.connect(t.destination),y.start(t.currentTime+i*.18),y.stop(t.currentTime+i*.18+.3)})}catch{}},X=l.useMemo(()=>{const s=[];return n.forEach(t=>{t.tables.forEach(d=>{d.active_order?.id&&s.push(d.active_order.id)})}),s},[n]);l.useEffect(()=>{const s=window.Echo;if(!s?.connector||!a.id||X.length===0){ms(!1);return}ms(!0);const t=[];return X.forEach(d=>{const h=s.channel(`tenant.${a.id}.orders.${d}`).listen(".order.status.updated",i=>{i.comment==="waiter_collected"?(qs(y=>new Set(y).add(i.id)),Oe(),S.success(`Mesero registrÃ³ cobro del Pedido #${i.id}`,{id:`waiter-collected-${i.id}`,duration:2e4,description:"Toca la mesa para verificar el pago",style:{background:"#ecfdf5",border:"2px solid #059669",fontWeight:"bold"}}),G.reload({only:["zones"]})):i.status==="ready"?(cs(y=>new Set(y).add(i.id)),Oe(),S.success(`Pedido #${i.id} LISTO en cocina`,{id:`ready-${i.id}`,duration:15e3,description:"Toca la mesa para ver el pedido",style:{background:"#ecfdf5",border:"2px solid #10b981",fontWeight:"bold"}})):i.status==="preparing"&&S.info(`Pedido #${i.id} en preparaciÃ³n`,{id:`preparing-${i.id}`,duration:5e3})});t.push(h)}),()=>{t.forEach(d=>d.stopListening(".order.status.updated"))}},[a.id,X]),l.useEffect(()=>{if(ds||X.length===0||!a.slug)return;const s=async()=>{try{const d=await fetch(`/${a.slug}/admin/gastronomy/kitchen/orders?status=ready`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!d.ok)return;(await d.json()).forEach(i=>{i.status==="ready"&&X.includes(i.id)&&!De.has(i.id)&&(cs(y=>new Set(y).add(i.id)),Oe(),S.success(`Pedido #${i.id} LISTO en cocina`,{id:`ready-${i.id}`,duration:15e3,description:"Toca la mesa para ver el pedido",style:{background:"#ecfdf5",border:"2px solid #10b981",fontWeight:"bold"}}))})}catch{}},t=setInterval(s,2e4);return s(),()=>clearInterval(t)},[ds,X,a.slug,De]),l.useEffect(()=>{const s=setInterval(()=>{if(!j)return;const t=new Date;j.forEach(d=>{if(d.status==="seated"){const h=new Date(`${d.reservation_date}T${d.reservation_time}`),i=new Date(h.getTime()+72e5);t>i&&S.warning(`La mesa ${d.table?d.table.name:"Sin Mesa"} ha excedido el tiempo de reserva.`,{duration:1e4,action:{label:"Entendido",onClick:()=>console.log("Alert acknowledged")}})}})},6e4);return()=>clearInterval(s)},[j]);const xs=(s,t)=>{Ae(s),Ee(t),Me(!0)},Le=s=>{if(s.active_order&&s.active_order.items){const t=u?.price_includes_tax||!1,d=u?.tax_rate||0,h=s.active_order.items.map(i=>{const y=parseFloat(String(i.total)),_=parseFloat(String(i.price)),Z=t?y:y/(1+d/100),z=t?_:_/(1+d/100);return{id:`sent-${i.id}`,product_id:i.product_id,name:i.product_name,price:z,quantity:i.quantity,total:Z,variant_options:typeof i.variant_options=="string"?JSON.parse(i.variant_options):i.variant_options,notes:i.notes,is_sent:!0}});c(h),s.active_order.customer_id?F({id:s.active_order.customer_id,name:s.active_order.customer_name,phone:s.active_order.customer_phone||void 0}):F(null)}else c([]),F(null)},Us=async()=>{if(ae?.active_order?.id){ts(!0);try{await We.post(route("tenant.admin.pos.verify-payment",{tenant:a.slug,order:ae.active_order.id})),S.success("Pago verificado y orden completada. Mesa liberada."),Ie(!1),Pe(null),G.reload()}catch{S.error("Error al verificar el pago")}finally{ts(!1)}}},Bs=s=>{if(W&&je(!1),s.active_order?.waiter_collected){Pe(s),Ie(!0);return}if(ne){xs(s,ne);return}if(s.status==="reserved"){const d=j.find(h=>h.table_id===s.id&&h.status==="confirmed");if(d){xs(s,d);return}}if(o?.id===s.id){Le(s);return}const t=v.some(d=>!d.is_sent);if(o&&t){es(s),H(!0);return}m(s),Le(s)},Hs=()=>{if(!K||!ve)return;const s=K,t=ve;G.put(route("tenant.admin.reservations.update",{tenant:a.slug,reservation:s.id}),{status:"seated",table_id:t.id},{onSuccess:()=>{S.success(`Check-in completado para ${s.customer_name}`),m(t),F({id:s.customer_id||0,name:s.customer_name,phone:s.customer_phone,email:s.customer_email||""}),c([]),Me(!1),Ae(null),Ee(null),rs(null)}})},[Ws,Qs]=l.useState(null),[Gs,Re]=l.useState(!1),[Q,F]=l.useState(null),[Ks,Ne]=l.useState(!1),hs=s=>{Qs(s),Re(!0)},Xs=(s,t=null,d=null,h=1,i)=>{const y=parseFloat(String(s.price)),_=d!==null?d:y,Z=`item-${Date.now()}-${Math.random()}`;let z;if(t&&s.variant_groups){const U=[];for(const[at,rt]of Object.entries(t)){const ze=s.variant_groups?.find(Ve=>Ve.id===Number(at));if(ze)for(const Ve of rt){const ee=ze.options.find(nt=>nt.id===Ve);ee&&U.push({id:ee.id,name:ee.name,price_adjustment:ee.price_adjustment,group_name:ze.name,option_name:ee.name,price:Number(ee.price_adjustment)})}}z=U.length>0?U:void 0}const Fe={id:Z,product_id:s.id,name:s.name,price:_,quantity:h,image_url:s.image_url,total:_*h,variant_options:z,notes:i};c(U=>[...U,Fe]),S.success("Producto agregado")},us=(s,t)=>{c(d=>d.map(h=>{if(h.id===s){const i=Math.max(1,h.quantity+t);return{...h,quantity:i,total:i*h.price}}return h}))},ps=s=>{c(t=>t.filter(d=>d.id!==s))},fs=()=>{const s=v.filter(t=>!t.is_sent);if(s.length===0){S.error("No hay productos nuevos para enviar a cocina");return}if(!o){S.error("Selecciona una mesa primero");return}O(!0),G.post(route("tenant.pos.store",{tenant:a.slug}),{location_id:R,items:s.map(t=>({product_id:t.product_id,quantity:t.quantity,variant_options:t.variant_options,notes:t.notes||null})),service_type:"dine_in",table_id:o.id,payment_method:null,customer_id:Q?.id||null,customer_name:Q?.name||(o.name.toLowerCase().startsWith("mesa")?o.name:`Mesa ${o.name}`),customer_phone:Q?.phone||null,send_to_kitchen:!0},{onSuccess:()=>{O(!1),S.success("Pedido enviado a cocina"),c([]),m(null),F(null),f(!1)},onError:()=>{O(!1),S.error("Error al enviar pedido")}})},[J,Y]=l.useState(null),gs=s=>{Y(s)},Js=()=>{if(!J)return;const s=J.replace("sent-","");if(!s||s===J){c(t=>t.filter(d=>d.id!==J)),Y(null);return}O(!0),fetch(route("tenant.admin.pos.cancel-item",{tenant:a.slug,item:s}),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",Accept:"application/json"}}).then(t=>t.json()).then(t=>{O(!1),t.success?(c(d=>d.filter(h=>h.id!==J)),S.success(t.message||"Item anulado"),Y(null)):(S.error(t.message||"Error al anular item"),Y(null))}).catch(()=>{O(!1),S.error("Error de red al anular item"),Y(null)})},bs=()=>{o&&te(!0)},Ys=()=>{o&&G.post(route("tenant.admin.pos.free-table",{tenant:a.slug,table:o.id}),{},{onSuccess:()=>{S.success("Mesa liberada correctamente"),m(null),c([]),te(!1)}})},Zs=s=>{G.visit(route("tenant.admin.pos",{tenant:a.slug,location_id:s}))},js=()=>{if(v.length===0)return;v.some(t=>!t.is_sent)?I(!0):c([])},et=()=>{c(s=>s.filter(t=>t.is_sent)),I(!1)},[Wt,st]=l.useState(0);l.useEffect(()=>{const s=setInterval(()=>st(t=>t+1),3e4);return()=>clearInterval(s)},[]);const tt=s=>{const t=new Date(s),h=new Date().getTime()-t.getTime(),i=Math.floor(h/6e4);if(i<60)return`${i}min`;const y=Math.floor(i/60),_=i%60;return`${y}h ${_}m`};return e.jsxs(At,{title:"POS | Mesas",user:g,tenant:a,children:[e.jsx(_s,{title:"Punto de Venta"}),e.jsxs("div",{className:"w-full flex h-[calc(100vh-64px)] overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col bg-slate-100 min-w-0",children:[e.jsxs("div",{className:"bg-white border-b px-4 md:px-6 py-3 flex flex-col md:flex-row md:justify-between md:items-center gap-3 z-10 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto",children:[e.jsx("button",{onClick:()=>k("all"),className:`px-4 py-2 rounded-full text-sm font-bold transition-all shrink-0 ${b==="all"?"bg-slate-900 text-white":"bg-slate-100 text-slate-500 hover:bg-slate-200"}`,children:"Todas"}),n.map(s=>e.jsx("button",{onClick:()=>k(String(s.id)),className:`px-4 py-2 rounded-full text-sm font-bold transition-all shrink-0 ${b===String(s.id)?"bg-slate-900 text-white":"bg-slate-100 text-slate-500 hover:bg-slate-200"}`,children:s.name},s.id)),e.jsx("div",{className:"w-px h-6 bg-slate-200 mx-1 shrink-0"}),e.jsxs("button",{onClick:()=>{je(!0),m(null),c([]),F(null),P(!0)},className:"px-4 py-2 rounded-full text-sm font-bold transition-all shrink-0 bg-indigo-100 text-indigo-700 hover:bg-indigo-200 flex items-center gap-1.5",children:[e.jsx(Ge,{className:"w-4 h-4"}),"Pedido RÃ¡pido"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-indigo-400"}),e.jsx(L,{placeholder:"Buscar producto...",value:re,onChange:s=>as(s.target.value),className:"pl-8 h-9 w-[160px] md:w-[200px] bg-indigo-50/50 border-indigo-200 text-sm focus:ring-indigo-300"}),os.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white rounded-lg shadow-lg border border-slate-200 z-50 overflow-hidden max-h-64",children:os.map(s=>e.jsxs("button",{className:"w-full px-3 py-2.5 flex items-center gap-3 hover:bg-indigo-50 transition-colors text-left",onClick:()=>{hs(s),as("")},children:[s.image_url?e.jsx("img",{src:s.image_url,className:"w-8 h-8 rounded object-cover shrink-0"}):e.jsx("div",{className:"w-8 h-8 rounded bg-slate-100 shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-slate-800 truncate",children:s.name}),e.jsx("div",{className:"text-xs text-slate-400",children:N(s.price)})]})]},s.id))})]}),e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(L,{placeholder:"Buscar mesa...",value:q,onChange:s=>$s(s.target.value),className:"pl-8 h-9 w-[120px] md:w-[150px] bg-slate-50 border-slate-200 text-sm"})]}),e.jsxs(_t,{value:String(R),onValueChange:Zs,children:[e.jsx(St,{className:"w-[160px] md:w-[200px] h-9 bg-slate-50 border-slate-200",children:e.jsx(kt,{placeholder:"Seleccionar Sede"})}),e.jsx(Tt,{children:w.map(s=>e.jsx(It,{value:String(s.id),children:s.name},s.id))})]})]})]}),ne&&e.jsxs("div",{className:"bg-slate-900 text-white px-6 py-3 flex items-center justify-between z-20 animate-in fade-in slide-in-from-top duration-300",children:[e.jsxs("div",{className:"flex items-center gap-3 font-bold",children:[e.jsx(Be,{className:"w-5 h-5 text-indigo-400"}),e.jsxs("span",{children:["MODO CHECK-IN: Selecciona mesa para ",ne.customer_name," (",ne.party_size," pax)"]})]}),e.jsx(C,{variant:"secondary",size:"sm",className:"h-8 text-xs bg-white/20 hover:bg-white/30 text-white border-0",onClick:()=>rs(null),children:"Cancelar"})]}),W&&e.jsxs("div",{className:"bg-indigo-600 text-white px-6 py-3 flex items-center justify-between z-20 animate-in fade-in slide-in-from-top duration-300",children:[e.jsxs("div",{className:"flex items-center gap-3 font-bold",children:[e.jsx(Ge,{className:"w-5 h-5"}),e.jsx("span",{children:"PEDIDO RÃPIDO â€” Takeout / Delivery (sin mesa)"})]}),e.jsx(C,{variant:"secondary",size:"sm",className:"h-8 text-xs bg-white/20 hover:bg-white/30 text-white border-0",onClick:()=>{je(!1),c([]),F(null)},children:"Cancelar"})]}),e.jsx(ue,{className:"flex-1 p-6",children:Os?e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-6 pb-20",children:[n.filter(s=>b==="all"||String(s.id)===b).flatMap(s=>s.tables.filter(t=>q?t.name.toLowerCase().includes(q.toLowerCase()):!0).map(t=>{const d=j.some(U=>U.table_id===t.id&&["confirmed","pending"].includes(U.status));let h="bg-white border-slate-200",i="bg-slate-100 text-slate-500",y=e.jsx(Be,{className:"w-8 h-8 text-slate-300"}),_=t.status;_==="available"&&d?_="reserved":_==="reserved"&&!d&&(_="available");const Z=t.active_order?.id?De.has(t.active_order.id):!1,z=t.active_order?.waiter_collected===!0||(t.active_order?.id?Vs.has(t.active_order.id):!1);_==="occupied"&&z?(h="bg-emerald-50 border-emerald-400 ring-2 ring-emerald-300/50",i="bg-emerald-500 text-white",y=e.jsx(_e,{className:"w-8 h-8 text-emerald-500"})):_==="occupied"&&Z?(h="bg-green-50 border-green-300 ring-2 ring-green-300/30",i="bg-green-100 text-green-700",y=e.jsx(ye,{className:"w-8 h-8 text-green-500"})):_==="occupied"?(h="bg-red-50/30 border-red-200",i="bg-red-100 text-red-600",y=e.jsx(Qe,{className:"w-8 h-8 text-red-400"})):_==="reserved"?(h="bg-amber-50/30 border-amber-200",i="bg-amber-100 text-amber-600",y=e.jsx(ye,{className:"w-8 h-8 text-amber-400"})):_==="available"?(h="bg-white border-slate-200 hover:bg-slate-50",i="bg-slate-100 text-slate-500",y=e.jsx(Be,{className:"w-8 h-8 text-slate-300"})):_==="maintenance"&&(h="bg-slate-100 border-slate-200 opacity-50",y=e.jsx(ws,{className:"w-8 h-8 text-slate-400"}));const Fe=o?.id===t.id;return e.jsxs("div",{onClick:()=>Bs(t),className:`
                                                        relative h-40 rounded-xl border flex flex-col items-center justify-center gap-2 transition-all duration-200 cursor-pointer
                                                        ${h}
                                                        ${Fe?"border-2 border-slate-900 bg-white ring-2 ring-slate-900/10":"hover:border-slate-400"}
                                                    `,children:[e.jsx("div",{className:`absolute top-3 right-3 px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wider ${i}`,children:z?"ðŸ’° Cobrado":Z?"Listo":_==="available"?"Libre":_==="occupied"?"Ocupada":_==="reserved"?"Reservada":"Mant."}),t.status==="occupied"&&t.active_order&&e.jsxs("div",{className:"absolute top-3 left-3 flex items-center gap-1",children:[e.jsx(Qe,{className:"w-3 h-3 text-red-400"}),e.jsx("span",{className:"text-[10px] bg-red-50 px-1.5 py-0.5 rounded text-red-600 font-mono font-bold border border-red-200",children:tt(t.active_order.created_at)})]}),y,e.jsx("div",{className:"text-xl font-black text-slate-700 font-mono",children:t.name}),e.jsxs("div",{className:"text-xs text-slate-400 font-medium",children:[t.capacity," Pax"]}),t.status==="occupied"&&t.active_order&&z&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 text-center bg-emerald-100 py-1.5 border-t border-emerald-300 rounded-b-xl",children:e.jsxs("div",{className:"text-xs font-black text-emerald-800",children:["VERIFICAR ",N(t.active_order.total)]})}),t.status==="occupied"&&t.active_order&&!z&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 text-center bg-red-50/80 py-1.5 border-t border-red-200 rounded-b-xl",children:e.jsx("div",{className:"text-sm font-black text-red-700",children:N(t.active_order.total)})})]},t.id)})),n.length===0&&e.jsxs("div",{className:"col-span-full h-64 flex flex-col items-center justify-center text-slate-400 border-2 border-dashed border-slate-300 rounded-xl bg-slate-50",children:[e.jsx(ws,{className:"w-12 h-12 mb-4 opacity-50"}),e.jsx("h3",{className:"text-lg font-bold",children:"No hay zonas configuradas"}),e.jsx("p",{className:"text-sm",children:"Configura zonas y mesas en el panel de administraciÃ³n."})]}),n.length>0&&n.filter(s=>b==="all"||String(s.id)===b).every(s=>s.tables.filter(t=>!q||t.name.toLowerCase().includes(q.toLowerCase())).length===0)&&e.jsxs("div",{className:"col-span-full h-48 flex flex-col items-center justify-center text-slate-400 border-2 border-dashed border-slate-200 rounded-xl bg-slate-50/50",children:[e.jsx(se,{className:"w-10 h-10 mb-3 opacity-30"}),e.jsx("h3",{className:"text-base font-bold",children:q?"No se encontraron mesas":"Esta zona no tiene mesas"}),e.jsx("p",{className:"text-sm mt-1",children:q?`Sin resultados para "${q}"`:"Agrega mesas desde el panel de administraciÃ³n."})]})]}):e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-6 pb-20",children:Array.from({length:10}).map((s,t)=>e.jsxs("div",{className:"h-40 rounded-xl border border-slate-200 bg-slate-50 animate-pulse flex flex-col items-center justify-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-200"}),e.jsx("div",{className:"w-16 h-4 rounded bg-slate-200"}),e.jsx("div",{className:"w-10 h-3 rounded bg-slate-200"})]},t))})})]}),e.jsx("div",{className:"hidden lg:flex w-[400px] border-l border-slate-200 shrink-0 bg-white z-20 h-full",children:e.jsx(Cs,{cart:v,cartTotal:ls,selectedCustomer:Q,selectedTable:o,onUpdateQuantity:us,onRemoveFromCart:ps,onClearCart:js,onOpenCustomerModal:()=>Ne(!0),onShowCheckout:()=>M(!0),onSendToKitchen:fs,onCancelSentItem:gs,canPay:ns,isProcessing:p,isTakeoutMode:W,onAddProducts:()=>{if(!o&&!W){S.error("Selecciona una mesa primero");return}P(!0)},onFreeTable:bs,taxSettings:u})})]}),e.jsx(Ss,{open:r,onOpenChange:f,children:e.jsx(ks,{side:"right",className:"p-0 w-full sm:w-[400px]",children:e.jsx(Cs,{cart:v,cartTotal:ls,selectedCustomer:Q,selectedTable:o,onUpdateQuantity:us,onRemoveFromCart:ps,onClearCart:js,onOpenCustomerModal:()=>Ne(!0),onShowCheckout:()=>{M(!0),f(!1)},onSendToKitchen:fs,onCancelSentItem:gs,canPay:ns,isProcessing:p,isTakeoutMode:W,onAddProducts:()=>{f(!1),P(!0)},onFreeTable:bs,taxSettings:u})})}),e.jsx(Ut,{open:$,onOpenChange:P,categories:x,onProductSelect:hs}),e.jsx("div",{className:"lg:hidden fixed bottom-4 right-4 z-50",children:e.jsxs(C,{onClick:()=>f(!0),size:"lg",className:"rounded-full w-14 h-14 shadow-lg bg-slate-900 hover:bg-slate-800 text-white relative",children:[e.jsx(_e,{className:"w-6 h-6"}),v.length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-[10px] font-bold w-5 h-5 flex items-center justify-center rounded-full border-2 border-white",children:v.length})]})}),e.jsx(zt,{open:E,onOpenChange:M,total:zs,items:v,onSuccess:s=>{s&&(Es({orderId:s.orderId,items:[...v],paymentMethod:s.paymentMethod,cashAmount:s.cashAmount,change:s.change,customer:Q,table:o,tenant:a,taxSettings:u}),ss(!0)),c([]),M(!1),F(null),W||m(null),je(!1)},customer:Q,tenant:a,table:W?null:o,isWaiter:Rs,locationId:R}),e.jsx(Bt,{open:Ms,onOpenChange:ss,data:As}),e.jsx(Vt,{open:Gs,onOpenChange:Re,product:Ws,onAddToCart:(s,t,d,h,i)=>{Xs(s,d,h,t,i),Re(!1)}}),e.jsx(qt,{open:Ks,onOpenChange:Ne,onSelect:s=>{F(s),Ne(!1)}}),e.jsx(le,{open:Fs,onOpenChange:Me,children:e.jsxs(ie,{children:[e.jsxs(oe,{children:[e.jsx(ce,{children:"Â¿LlegÃ³ el cliente?"}),e.jsx(de,{asChild:!0,children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{children:"Confirma el check-in de esta reserva:"}),K&&e.jsxs("div",{className:"bg-slate-50 p-3 rounded-lg space-y-1 text-sm",children:[e.jsx("div",{className:"font-semibold text-slate-800",children:K.customer_name}),e.jsxs("div",{className:"text-slate-500",children:[K.reservation_time?.substring(0,5)," Â· ",K.party_size," personas"]}),ve&&e.jsxs("div",{className:"text-indigo-600 font-medium",children:["Mesa: ",ve.name]})]}),e.jsxs("p",{className:"text-xs text-slate-400",children:["La mesa cambiarÃ¡ a ",e.jsx("strong",{className:"text-red-500",children:"ocupada"})," y el cliente se vincularÃ¡ al pedido."]})]})})]}),e.jsxs(me,{children:[e.jsx(xe,{onClick:()=>{Ae(null),Ee(null)},children:"Cancelar"}),e.jsx(he,{onClick:Hs,className:"bg-slate-900 text-white hover:bg-slate-800",children:"SÃ­, Check-in"})]})]})}),e.jsx(le,{open:V,onOpenChange:H,children:e.jsxs(ie,{children:[e.jsxs(oe,{children:[e.jsx(ce,{children:"Â¿Cambiar de mesa?"}),e.jsx(de,{children:"Tienes productos en el carrito. Al cambiar de mesa, el carrito actual se vaciarÃ¡."})]}),e.jsxs(me,{children:[e.jsx(xe,{onClick:()=>H(!1),children:"Mantener mesa actual"}),e.jsx(he,{onClick:()=>{H(!1),Te&&(m(Te),Le(Te),es(null))},className:"bg-red-600 text-white hover:bg-red-700",children:"Vaciar y Cambiar"})]})]})}),e.jsx(le,{open:be,onOpenChange:I,children:e.jsxs(ie,{children:[e.jsxs(oe,{children:[e.jsx(ce,{children:"Â¿Vaciar carrito?"}),e.jsx(de,{children:"Se eliminarÃ¡n los productos que aÃºn no han sido enviados a cocina. Los productos ya enviados se mantendrÃ¡n."})]}),e.jsxs(me,{children:[e.jsx(xe,{children:"Cancelar"}),e.jsx(he,{onClick:et,className:"bg-red-600 text-white hover:bg-red-700",children:"SÃ­, Vaciar"})]})]})}),e.jsx(le,{open:!!J,onOpenChange:s=>{s||Y(null)},children:e.jsxs(ie,{children:[e.jsxs(oe,{children:[e.jsx(ce,{className:"text-red-600",children:"Â¿Anular este producto?"}),e.jsx(de,{children:"Este producto ya fue enviado a cocina. Al anularlo, se restarÃ¡ del total de la orden inmediatamente y cocina serÃ¡ notificada."})]}),e.jsxs(me,{children:[e.jsx(xe,{children:"Volver"}),e.jsx(he,{onClick:Js,className:"bg-red-600 text-white hover:bg-red-700",disabled:p,children:p?"Anulando...":"SÃ­, Anular Item"})]})]})}),e.jsx(le,{open:D,onOpenChange:te,children:e.jsxs(ie,{children:[e.jsxs(oe,{children:[e.jsx(ce,{className:"text-red-600",children:"Â¿Liberar Mesa Manualmente?"}),e.jsxs(de,{children:["Esta acciÃ³n cambiarÃ¡ el estado de la mesa ",e.jsx("strong",{className:"text-slate-900",children:o?.name})," a ",e.jsx("span",{className:"text-green-600 font-bold",children:"Disponible"})," sin procesar un pago. Ãšsala solo en casos excepcionales (error de sistema o cliente que se retirÃ³ sin consumir)."]})]}),e.jsxs(me,{children:[e.jsx(xe,{children:"Volver"}),e.jsx(he,{onClick:Ys,className:"bg-red-600 text-white hover:bg-red-700",children:"SÃ­, Liberar Mesa"})]})]})}),e.jsx(fe,{open:Ds,onOpenChange:s=>{s||(Ie(!1),Pe(null))},children:e.jsx(ge,{className:"max-w-md p-0 overflow-hidden rounded-2xl",children:ae?.active_order&&(()=>{const s=ae.active_order,t=s.payment_proof_url||s.payment_proof;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-emerald-600 p-5 text-white",children:e.jsxs(Se,{children:[e.jsxs(ke,{className:"flex items-center gap-2 text-white text-lg",children:[e.jsx(Ns,{className:"w-6 h-6"}),"Verificar Pago â€” ",ae.name]}),e.jsx(dt,{className:"text-emerald-100 mt-1",children:"El mesero registrÃ³ el cobro de esta mesa. Revisa los detalles y verifica."})]})}),e.jsxs("div",{className:"p-5 space-y-4",children:[e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 border border-slate-200",children:[e.jsxs("h4",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-3",children:["Resumen del Pedido #",s.id]}),s.items&&s.items.length>0?e.jsx("div",{className:"space-y-2",children:s.items.filter(d=>d.status!=="cancelled").map((d,h)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-slate-700",children:[d.quantity,"x ",d.product_name]}),e.jsx("span",{className:"font-semibold text-slate-900",children:N(Number(d.total)||Number(d.price)*d.quantity)})]},h))}):e.jsx("p",{className:"text-sm text-slate-400",children:"Items no disponibles en vista previa"}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-200 flex justify-between",children:[e.jsx("span",{className:"text-base font-black text-slate-900",children:"TOTAL"}),e.jsx("span",{className:"text-xl font-black text-emerald-700",children:N(s.total)})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-blue-50 rounded-xl p-4 border border-blue-200",children:[e.jsx(we,{className:"w-5 h-5 text-blue-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-blue-600 uppercase",children:"MÃ©todo de Pago"}),e.jsx("p",{className:"text-sm font-semibold text-slate-900 capitalize",children:{cash:"Efectivo",bank_transfer:"Transferencia Bancaria",dataphone:"DatÃ¡fono"}[s.payment_method||""]||s.payment_method||"No especificado"})]})]}),s.payment_reference&&e.jsxs("div",{className:"flex items-center gap-3 bg-amber-50 rounded-xl p-4 border border-amber-200",children:[e.jsx(ut,{className:"w-5 h-5 text-amber-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-amber-600 uppercase",children:"Referencia"}),e.jsx("p",{className:"text-sm font-semibold text-slate-900 font-mono",children:s.payment_reference})]})]}),t&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pt,{className:"w-4 h-4 text-slate-500"}),e.jsx("p",{className:"text-xs font-bold text-slate-500 uppercase",children:"Comprobante de Pago"})]}),e.jsx("a",{href:typeof t=="string"?t:"#",target:"_blank",rel:"noopener noreferrer",className:"block rounded-xl overflow-hidden border-2 border-slate-200 hover:border-emerald-400 transition-colors",children:e.jsx("img",{src:typeof t=="string"?t:"",alt:"Comprobante de pago",className:"w-full max-h-64 object-contain bg-slate-100"})}),e.jsx("p",{className:"text-[10px] text-slate-400 text-center",children:"Toca la imagen para verla completa"})]})]}),e.jsxs("div",{className:"p-4 border-t border-slate-100 bg-slate-50 space-y-2",children:[e.jsxs(C,{onClick:Us,disabled:$e,className:"w-full h-12 text-base font-bold bg-emerald-600 hover:bg-emerald-700 text-white shadow-lg",children:[$e?e.jsx(pe,{className:"w-5 h-5 mr-2 animate-spin"}):e.jsx(Ns,{className:"w-5 h-5 mr-2"}),$e?"Verificando...":"VERIFICAR Y COMPLETAR PEDIDO"]}),e.jsx("p",{className:"text-[10px] text-center text-slate-400",children:"Se marcarÃ¡ la orden como completada y la mesa quedarÃ¡ libre"})]})]})})()})})]})}export{Ga as default};
