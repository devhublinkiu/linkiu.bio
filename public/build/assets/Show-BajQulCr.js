import{r as d,u as L,a as c,j as e,H as M,L as f}from"./app-D9wldZxo.js";import{S as B}from"./SuperAdminLayout-CPtcwFpO.js";import{g as F}from"./echo-CmTENghG.js";import{B as l}from"./button-Dadb_Lep.js";import{T as I}from"./textarea-DBah2UDL.js";import{B as m}from"./badge-DyYF213F.js";import{C as i,a as j,b,c as U,d as x}from"./card-DbFVjWqh.js";import{A as g,k as N}from"./dropdown-menu-C4-9o8Rw.js";import{S as z}from"./separator-L5pP8n2q.js";import{S as v,a as w,b as y,c as C,d as r}from"./select-Bbe1RuXu.js";import{C as H}from"./chevron-left-BFxUkP0a.js";import{S as P}from"./shield-BtuNH23d.js";import{U as V}from"./user-D9c6nVY3.js";import{L as q}from"./lock-BHZn93rL.js";import{S as O}from"./send-D19unaN7.js";import{I as G}from"./info-sbCpQBy7.js";import{E as J}from"./external-link-pORnC0H4.js";import{C as K}from"./circle-check-CN90YBLh.js";import{f as Q}from"./formatDistanceToNow-CJnsltzk.js";import{e as W}from"./es-BteQoBuv.js";import"./chevron-right-BSwXEIvG.js";import"./createLucideIcon-CJjlOp5I.js";import"./chevrons-up-down-Cepco8Sn.js";import"./badge-check-CEpGdEtW.js";import"./ApplicationLogo-DuPOXIDR.js";import"./users-OjDIvTV8.js";import"./layout-grid-DMUl8Ye2.js";import"./utils-B0KHI9vB.js";import"./index-BDWpq_YI.js";import"./index-BrcTw33p.js";import"./index-BMdzuiHN.js";import"./index-tfOuMV4B.js";import"./trash-2-CMPgRqgc.js";import"./check-BAxbGpAF.js";import"./credit-card-CPDlDYf1.js";import"./shopping-bag-CQGcPT0-.js";import"./dialog-C0Lg02Tk.js";import"./x-dvUxMxq3.js";import"./input-rMsYcH4C.js";import"./sheet-BP6KOnln.js";import"./index-CbR7iZJO.js";import"./index-DeHGgcwY.js";import"./index-CXzOyCXW.js";import"./index-DdTS5Ad2.js";import"./index-CZBSMaku.js";import"./index-fFU5c_p6.js";import"./index-Dvu8qGWr.js";import"./index-D4lOZYra.js";import"./index-BdQq_4o_.js";import"./index--Jev_GdI.js";import"./chevron-down-Dux0wLDw.js";import"./chevron-up-IlwuOcq-.js";import"./constructNow-ChcPjMH_.js";import"./differenceInCalendarMonths-B3kfrhWB.js";import"./endOfMonth-DL9zlqV0.js";const S={open:{label:"Abierto",color:"bg-blue-100 text-blue-700"},in_progress:{label:"En progreso",color:"bg-amber-100 text-amber-700"},awaiting_response:{label:"Esperando respuesta",color:"bg-purple-100 text-purple-700"},resolved:{label:"Resuelto",color:"bg-emerald-100 text-emerald-700"},closed:{label:"Cerrado",color:"bg-slate-100 text-slate-700"}},_={low:{label:"Baja",color:"bg-slate-400"},medium:{label:"Media",color:"bg-blue-500"},high:{label:"Alta",color:"bg-orange-500"},urgent:{label:"Urgente",color:"bg-red-500"}},E={technical:"Problema Técnico",billing:"Facturación",account:"Mi Cuenta",feature_request:"Solicitud de Funcionalidad",other:"Otros"},X=s=>{try{const t=new Date(s);return isNaN(t.getTime())?"recientemente":Q(t,{addSuffix:!0,locale:W})}catch{return"recientemente"}};function ke({ticket:s}){const t=d.useRef(null),{data:o,setData:T,post:R,processing:p,reset:A,errors:Y}=L({message:""}),n=a=>{c.patch(route("superadmin.support.update",s.id),{status:a,priority:s.priority})},$=a=>{c.patch(route("superadmin.support.update",s.id),{status:s.status,priority:a})},D=a=>{a.preventDefault(),o.message.trim()&&R(route("superadmin.support.reply",s.id),{onSuccess:()=>{A("message")}})};return d.useEffect(()=>{t.current&&(t.current.scrollTop=t.current.scrollHeight)},[s.replies]),d.useEffect(()=>{const a=F();if(a){const u="superadmin-updates";return a.channel(u).listen(".ticket.replied",h=>{h.ticket_id===s.id&&(console.log("[Echo] Real-time reply received for this ticket:",h),c.reload())}),()=>{try{typeof a.leave=="function"&&a.leave(u)}catch{}}}},[s.id]),e.jsxs(B,{header:`Ticket ${s.reference_id||`#${s.id}`}`,breadcrumbs:[{label:"Soporte Técnico",href:route("superadmin.support.index")},{label:s.reference_id||`#${s.id}`}],children:[e.jsx(M,{title:`${s.subject} - Soporte Admin`}),e.jsxs("div",{className:"max-w-6xl mx-auto space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between flex-shrink-0",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-mono text-muted-foreground uppercase tracking-tight",children:"Referencia"}),e.jsx(m,{variant:"outline",className:"font-mono text-base font-bold",children:s?.reference_id||`#${s?.id}`})]})}),e.jsx(i,{children:e.jsx(j,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(l,{variant:"ghost",size:"icon",asChild:!0,children:e.jsx(f,{href:route("superadmin.support.index"),children:e.jsx(H,{className:"h-4 w-4"})})}),e.jsxs("div",{children:[e.jsx(b,{className:"text-lg",children:s.subject}),e.jsxs(U,{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"font-semibold",children:s.tenant.name}),e.jsx("span",{children:"•"}),e.jsx("span",{children:E[s.category]||s.category})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{variant:"secondary",children:(S?.[s.status]||S?.open||{label:"Abierto"}).label}),e.jsx(m,{variant:"outline",children:(_?.[s.priority]||_?.medium||{label:"Media"}).label})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx(i,{className:"lg:col-span-3",children:e.jsxs(x,{className:"p-0",children:[e.jsx("div",{ref:t,className:"h-[calc(100vh-400px)] overflow-y-auto p-6 space-y-6",children:s.replies.map(a=>e.jsx("div",{className:`flex ${a.is_staff?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`flex gap-3 max-w-[85%] ${a.is_staff?"flex-row-reverse":""}`,children:[e.jsx(g,{className:"h-8 w-8 mt-1 border",children:e.jsx(N,{className:a.is_staff?"bg-blue-600 text-white text-[10px]":"bg-slate-200 text-slate-600 text-[10px]",children:a.is_staff?e.jsx(P,{className:"h-4 w-4"}):e.jsx(V,{className:"h-4 w-4"})})}),e.jsxs("div",{className:`space-y-1 ${a.is_staff?"items-end":"items-start"}`,children:[e.jsxs("div",{className:`flex items-center gap-2 px-1 ${a.is_staff?"flex-row-reverse":""}`,children:[e.jsx("span",{className:"text-xs font-bold text-slate-700",children:a.user?.name||(a.is_staff?"Soporte":"Usuario")}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:X(a.created_at)})]}),e.jsx("div",{className:`p-4 rounded-2xl text-sm leading-relaxed ${a.is_staff?"bg-blue-600 text-white rounded-tr-none shadow-blue-100 shadow-md":"bg-white text-slate-700 border border-slate-200 rounded-tl-none shadow-sm"}`,children:a.message})]})]})},a.id))}),e.jsx("div",{className:"p-4 border-t bg-white",children:s.status==="closed"||s.status==="resolved"?e.jsxs("div",{className:"bg-slate-50 border rounded-xl p-4 flex flex-col items-center gap-3 text-center",children:[e.jsx("div",{className:"h-10 w-10 bg-slate-200 rounded-full flex items-center justify-center text-slate-500",children:e.jsx(q,{className:"h-5 w-5"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm font-semibold text-slate-900",children:["Ticket ",s.status==="resolved"?"Resuelto":"Cerrado"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Este ticket ya no acepta nuevas respuestas."})]}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>n("open"),children:"Reabrir Ticket"})]}):e.jsxs("form",{onSubmit:D,className:"space-y-3",children:[e.jsx(I,{placeholder:"Escribe tu respuesta aquí...",className:"min-h-[100px] bg-slate-50/50 focus:bg-white resize-none border-slate-200",value:o.message,onChange:a=>T("message",a.target.value)}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground",children:"Tu respuesta se enviará al correo del usuario."}),e.jsx(l,{type:"submit",disabled:p||!o.message.trim(),className:"gap-2 bg-blue-600 hover:bg-blue-700 text-white shadow-lg shadow-blue-100",children:p?"Enviando...":e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"h-4 w-4"})," Enviar Respuesta"]})})]})]})})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(i,{className:"shadow-sm border-slate-200 overflow-hidden",children:[e.jsx(j,{className:"bg-slate-50/50 border-b pb-4",children:e.jsxs(b,{className:"text-sm font-bold flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-blue-600"}),"Detalles del Ticket"]})}),e.jsxs(x,{className:"pt-4 space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground",children:"Estado"}),e.jsxs(v,{value:s.status,onValueChange:n,children:[e.jsx(w,{className:"h-9",children:e.jsx(y,{})}),e.jsxs(C,{children:[e.jsx(r,{value:"open",children:"Abierto"}),e.jsx(r,{value:"in_progress",children:"En progreso"}),e.jsx(r,{value:"awaiting_response",children:"Esperando respuesta"}),e.jsx(r,{value:"resolved",children:"Resuelto"}),e.jsx(r,{value:"closed",children:"Cerrado"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground",children:"Prioridad"}),e.jsxs(v,{value:s.priority,onValueChange:$,children:[e.jsx(w,{className:"h-9",children:e.jsx(y,{})}),e.jsxs(C,{children:[e.jsx(r,{value:"low",children:"Baja"}),e.jsx(r,{value:"medium",children:"Media"}),e.jsx(r,{value:"high",children:"Alta"}),e.jsx(r,{value:"urgent",children:"Urgente"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground",children:"Categoría"}),e.jsx("div",{className:"text-sm font-semibold text-slate-700",children:E[s.category]||s.category})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground",children:"ID Referencia"}),e.jsx("div",{className:"text-sm font-mono text-blue-600 font-bold",children:s.reference_id||`#${s.id}`})]}),e.jsx(z,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] uppercase font-bold text-muted-foreground mb-1",children:"Información del Cliente"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"h-6 w-6",children:e.jsx(N,{className:"text-[8px]",children:s.user.name.charAt(0)})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-semibold",children:s.user.name}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:s.user.email})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] uppercase font-bold text-muted-foreground mb-1",children:"Tienda (Tenant)"}),e.jsxs("div",{className:"bg-slate-50 rounded-lg p-2 border border-slate-100 flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium",children:s.tenant.name}),e.jsx(l,{variant:"ghost",size:"icon",className:"h-6 w-6",asChild:!0,children:e.jsx(f,{href:route("tenants.show",s.tenant.id),children:e.jsx(J,{className:"h-3 w-3"})})})]})]})]})]})]}),e.jsx(i,{className:"shadow-sm border-slate-200",children:e.jsx(x,{className:"pt-6 space-y-4",children:e.jsxs("div",{className:"flex items-center gap-3 text-emerald-600 bg-emerald-50 p-3 rounded-xl border border-emerald-100/50",children:[e.jsx(K,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold",children:"Acción Rápida"}),e.jsx("button",{onClick:()=>n("resolved"),className:"text-[10px] hover:underline",children:"Resolver ticket ahora"})]})]})})})]})]})]})]})}export{ke as default};
