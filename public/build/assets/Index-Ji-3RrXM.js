import{c as K,r as a,a as N,u as Q,j as e,H as W,L as y}from"./app-C6YMifTY.js";import{S as X}from"./SuperAdminLayout-owz7kWkR.js";import{B as x}from"./button-BdaJZ0B3.js";import{I as v}from"./input-Eblj3hbc.js";import{L as S}from"./label-D24g5yt_.js";import{T as Y,a as Z,b as A,c as o,d as ee,e as d}from"./table-ChZjPdEz.js";import{D as se,a as ae,b as re,c as te,d as ie,e as le}from"./dialog-IMN9tC2d.js";import{A as ne,a as oe,b as de,c as ce,d as me,e as xe,f as pe,g as ue}from"./alert-dialog-Bn8EVXlc.js";import{S as w,a as k,b as E,c as T,d as c}from"./select-kSnTiJyt.js";import{C as he}from"./checkbox-TBe_blUS.js";import{P as ge,A as je,j as fe,k as be}from"./dropdown-menu-SOMavdwh.js";import{S as Ne}from"./Pagination-C-KqWW8q.js";import{P as ve}from"./plus-Cqh028Vl.js";import{S as Se}from"./search-DJAv3Kik.js";import{M as De}from"./mail-BrIsSyEG.js";import{S as Ce}from"./shield-check-DElx5cgJ.js";import{S as _e}from"./store-Cm8zWcXf.js";import{P as ye}from"./pencil-BGbXfuDw.js";import{T as Ae}from"./trash-2-CdCRBxCQ.js";import"./chevron-right-C535Mj24.js";import"./createLucideIcon-BySXGuRP.js";import"./chevrons-up-down-JhLTbBEJ.js";import"./badge-check-CV7QNrff.js";import"./ApplicationLogo-D_xOgOcd.js";import"./users-DrSXnRGz.js";import"./layout-grid-Sb-Eozqq.js";import"./index-BfC7CqbM.js";import"./utils-DyIEM9Hy.js";import"./index-BqTUZrhs.js";import"./index-Br9IGBm2.js";import"./index-E7WpQLQ8.js";import"./index-4n3Yzccs.js";import"./x-a1jEoxTs.js";import"./index-BdQq_4o_.js";import"./index-CZchoUT1.js";import"./index-FjXa2hFn.js";import"./index-CpLyPKqI.js";import"./index-CYR4JIyf.js";import"./index-D2SAaREN.js";import"./chevron-down-BPnUVb9f.js";import"./check-C1SVBju5.js";import"./chevron-up-B3-_n9Ts.js";import"./circle-check-nEbbNZYN.js";import"./credit-card-DgCsg7Hg.js";import"./shopping-bag-Dvb7bWDl.js";import"./separator-BXKUKxOr.js";import"./sheet-DSRsPMRX.js";import"./index-DiNYh9qr.js";import"./index-qUve72FO.js";import"./ellipsis-D_UUA9jR.js";import"./chevron-left-BHuqazIP.js";function ys({users:t,filters:p,roles:U}){const{auth:u}=K().props,D=u.permissions||[],h=s=>D.includes("*")||D.includes(s),[P,g]=a.useState(!1),[F,j]=a.useState(!1),[R,C]=a.useState(null),[f,M]=a.useState(null),[O,m]=a.useState(!1),[i,H]=a.useState(p.search||""),[b,L]=a.useState(p.role||"all");a.useEffect(()=>{const s=setTimeout(()=>{i!==p.search&&N.get(route("users.index"),{search:i,role:b==="all"?"":b},{preserveState:!0,replace:!0})},300);return()=>clearTimeout(s)},[i]);const B=s=>{L(s),N.get(route("users.index"),{search:i,role:s==="all"?"":s},{preserveState:!0,replace:!0})},{data:l,setData:n,put:I,processing:q,errors:r,reset:we}=Q({name:"",email:"",is_super_admin:!1,role_id:null}),z=s=>{s.preventDefault(),I(route("users.update",R.id),{onSuccess:()=>{g(!1),C(null)}})},V=s=>{h("sa.users.create")||(s.preventDefault(),m(!0))},G=s=>{if(!h("sa.users.update")){m(!0);return}C(s),n({name:s.name,email:s.email,is_super_admin:!!s.is_super_admin,role_id:s.role_id}),g(!0)},$=s=>{if(!h("sa.users.delete")){m(!0);return}M(s),j(!0)},J=()=>{f&&N.delete(route("users.destroy",f.id),{onSuccess:()=>j(!1)})};return e.jsxs(X,{header:"Gestión de Usuarios",children:[e.jsx(ge,{open:O,onOpenChange:m}),e.jsx(W,{title:"Usuarios"}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Directorio de Usuarios"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Administra todos los usuarios registrados en la plataforma."})]}),e.jsx(x,{asChild:!0,className:"cursor-pointer",children:e.jsxs(y,{href:route("users.create"),onClick:V,children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Nuevo Usuario"]})})]}),e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsxs("div",{className:"relative w-full max-w-sm",children:[e.jsx(Se,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(v,{type:"search",placeholder:"Buscar por nombre o email...",className:"pl-9 bg-card",value:i,onChange:s=>H(s.target.value)})]}),e.jsxs(w,{value:b,onValueChange:B,children:[e.jsx(k,{className:"w-[200px] bg-card",children:e.jsx(E,{placeholder:"Filtrar por Rol"})}),e.jsxs(T,{children:[e.jsx(c,{value:"all",children:"Todos los Roles"}),e.jsx(c,{value:"superadmin",children:"Super Admins"}),e.jsx(c,{value:"user",children:"Usuarios"})]})]})]}),e.jsxs("div",{className:"bg-card rounded-xl border overflow-hidden",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsxs(A,{children:[e.jsx(o,{children:"Usuario"}),e.jsx(o,{children:"Rol"}),e.jsx(o,{children:"Tenants Asociados"}),e.jsx(o,{children:"Fecha Registro"}),e.jsx(o,{className:"text-right",children:"Acciones"})]})}),e.jsx(ee,{children:t.data.map(s=>e.jsxs(A,{children:[e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(je,{className:"h-9 w-9",children:[e.jsx(fe,{src:`https://ui-avatars.com/api/?name=${s.name}&background=random`}),e.jsx(be,{children:s.name.substring(0,2).toUpperCase()})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsxs("span",{className:"text-xs text-gray-400 flex items-center",children:[e.jsx(De,{className:"h-3 w-3 mr-1"}),s.email]})]})]})}),e.jsx(d,{children:s.is_super_admin?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-primary/10 px-2 py-0.5 text-[11px] font-bold text-primary uppercase tracking-tight ring-1 ring-inset ring-primary/20",children:[e.jsx(Ce,{className:"h-3 w-3"}),"Super Admin"]}):e.jsx("span",{className:"inline-flex items-center rounded-full bg-muted px-2 py-0.5 text-[11px] font-semibold text-muted-foreground uppercase tracking-tight ring-1 ring-inset ring-border",children:s.global_role?s.global_role.name:"Usuario"})}),e.jsx(d,{children:e.jsx("div",{className:"flex flex-wrap gap-1.5",children:s.tenants&&s.tenants.length>0?s.tenants.map(_=>e.jsxs(y,{href:"#",className:"inline-flex items-center px-1.5 py-0.5 rounded bg-muted/50 text-[10px] font-medium text-primary hover:bg-muted transition-colors border border-border",children:[e.jsx(_e,{className:"h-2.5 w-2.5 mr-1"}),_.name]},_.id)):e.jsx("span",{className:"text-[10px] text-muted-foreground/60 italic",children:"Sin tiendas"})})}),e.jsx(d,{className:"text-gray-500 text-xs",children:new Date(s.created_at).toLocaleDateString()}),e.jsxs(d,{className:"text-right space-x-1",children:[e.jsx(x,{variant:"ghost",size:"icon-xs",onClick:()=>G(s),children:e.jsx(ye,{className:"h-3.5 w-3.5 text-muted-foreground"})}),e.jsx(x,{variant:"ghost",size:"icon-xs",className:"text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>$(s),disabled:s.tenants&&s.tenants.length>0||s.id===u.user.id,title:s.id===u.user.id?"No puedes eliminar tu propia cuenta":s.tenants&&s.tenants.length>0?"No se puede eliminar usuario con tiendas activas":"Eliminar usuario",children:e.jsx(Ae,{className:"h-3.5 w-3.5"})})]})]},s.id))})]}),e.jsxs("div",{className:"px-4 py-3 border-t flex items-center justify-between",children:[e.jsxs("p",{className:"text-xs font-medium text-muted-foreground",children:["Mostrando ",e.jsx("span",{className:"text-foreground",children:t.from})," a ",e.jsx("span",{className:"text-foreground",children:t.to})," de ",e.jsx("span",{className:"text-foreground",children:t.total})," usuarios"]}),e.jsx(Ne,{links:t.links})]})]}),e.jsx(se,{open:P,onOpenChange:g,children:e.jsx(ae,{className:"sm:max-w-[425px]",children:e.jsxs("form",{onSubmit:z,children:[e.jsxs(re,{children:[e.jsx(te,{children:"Editar Usuario"}),e.jsx(ie,{children:"Modifica los detalles del usuario."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(S,{htmlFor:"e-name",children:"Nombre"}),e.jsx(v,{id:"e-name",value:l.name,onChange:s=>n("name",s.target.value),required:!0}),r.name&&e.jsx("span",{className:"text-red-500 text-xs",children:r.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(S,{htmlFor:"e-email",children:"Email"}),e.jsx(v,{id:"e-email",type:"email",value:l.email,onChange:s=>n("email",s.target.value),required:!0}),r.email&&e.jsx("span",{className:"text-red-500 text-xs",children:r.email})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(S,{htmlFor:"e-role",children:"Rol Global"}),e.jsxs(w,{onValueChange:s=>n("role_id",s==="none"?null:Number(s)),value:l.role_id?String(l.role_id):"none",children:[e.jsx(k,{id:"e-role",className:"w-full",children:e.jsx(E,{placeholder:"Seleccionar un rol..."})}),e.jsxs(T,{children:[e.jsx(c,{value:"none",children:"-- Ningún Rol (Usuario Normal) --"}),U.map(s=>e.jsx(c,{value:String(s.id),children:s.name},s.id))]})]}),r.role_id&&e.jsx("span",{className:"text-red-500 text-xs",children:r.role_id})]}),e.jsxs("div",{className:"flex items-center space-x-3 mt-2 border p-3 rounded-xl bg-primary/5 border-primary/10",children:[e.jsx(he,{id:"e-super",checked:l.is_super_admin,onCheckedChange:s=>n("is_super_admin",s===!0)}),e.jsxs("div",{className:"grid gap-1.5 leading-none",children:[e.jsx("label",{htmlFor:"e-super",className:"text-sm font-semibold leading-none cursor-pointer text-primary",children:"Es Super Administrador"}),e.jsx("p",{className:"text-[10px] text-muted-foreground font-medium uppercase tracking-tight",children:"Acceso total al panel de control"})]})]})]}),e.jsx(le,{children:e.jsx(x,{type:"submit",disabled:q,children:"Actualizar"})})]})})}),e.jsx(ne,{open:F,onOpenChange:j,children:e.jsxs(oe,{children:[e.jsxs(de,{children:[e.jsx(ce,{children:"¿Eliminar usuario?"}),e.jsxs(me,{children:["Esta acción eliminará permanentemente al usuario ",e.jsx("strong",{children:f?.name}),". Si tiene tiendas activas, estas podrían quedar huérfanas o inaccesibles."]})]}),e.jsxs(xe,{children:[e.jsx(pe,{children:"Cancelar"}),e.jsx(ue,{onClick:J,className:"bg-red-600 hover:bg-red-700",children:"Eliminar Cuenta"})]})]})})]})}export{ys as default};
