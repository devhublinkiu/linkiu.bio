import{c as pe,r as i,u as R,j as e,H as ue,R as he,t as b,a as M}from"./app-BxeeMXn5.js";import{A as xe}from"./AdminLayout-qCE3vY7L.js";import{S as O}from"./Pagination-CnT440XL.js";import{B as t}from"./button-7JWLOcK_.js";import{I as j}from"./input-DAizBa_g.js";import{L as f}from"./label-DvE9LE6F.js";import{S as ge,a as je,b as fe,c as Ne,d as F}from"./select-Mywosk_A.js";import{D as ve,a as Ce,b as be,c as _e,d as Se,e as ye}from"./dialog-bj0tKiGn.js";import{S as De,a as ke,b as Te,c as we,d as Ie}from"./sheet-Bbp6VhsK.js";import{T as Ae,a as qe,b as L,c as m,d as Ee,e as p}from"./table-3dZB4sa5.js";import{S as Pe}from"./switch-DaaS2XD2.js";import{C as H,d as z}from"./card-CZ4HJuOG.js";import{B as _}from"./badge-lrHzGyyu.js";import{A as Re,j as Me,k as Oe,P as Fe}from"./dropdown-menu-y9rp4bWE.js";import{S as Le}from"./separator-0SREGApO.js";import{A as He,a as ze,b as Be,c as Ve,d as $e,e as Ze,f as Ge,g as Qe}from"./alert-dialog-M1Oqq8sv.js";import{E as Ue,a as Je,e as Ke,c as We,d as Xe}from"./empty-gUYn75xU.js";import{P as B}from"./plus-CGb4S1OW.js";import{L as V}from"./loader-circle-Os_MzIh-.js";import{S as Ye}from"./square-pen-DyMbWI9a.js";import{T as es}from"./trash-2-Cefy4eHW.js";import{c as ss}from"./createLucideIcon-MMsaX1RM.js";import{C as rs}from"./circle-question-mark-CrycTEUL.js";import"./utils-C-R0dfCD.js";import"./progress-BPtmN4cS.js";import"./index-D1_1hXqK.js";import"./index-Dtj3r8is.js";import"./menuConfig--lJI1wgO.js";import"./video-BBI0Mdxh.js";import"./chef-hat-BUkOBHO9.js";import"./table-YYiP2uiH.js";import"./user-CUi44rAN.js";import"./map-pin-DbqcMmJZ.js";import"./banknote-o40mAnOF.js";import"./star-Cxzywz77.js";import"./users-Bu-h6n7y.js";import"./calendar-check-DZWxogn-.js";import"./calendar-BmHj6uld.js";import"./briefcase-ClT8Apdn.js";import"./truck-Dctgs6Id.js";import"./message-circle-BPpK8KIf.js";import"./credit-card-DdNcKhKR.js";import"./package-1Cz2kpnt.js";import"./shopping-bag-CWfZSTHo.js";import"./layout-dashboard-BHjPtgyJ.js";import"./badge-check-DHBa0N5U.js";import"./lock-D8DYOORy.js";import"./chevron-right-DPgD6mkS.js";import"./sparkles-Bns8Lzd1.js";import"./external-link-BEZwjyKz.js";import"./chevron-down-CUwoWnp1.js";import"./headphones-DG2WmJqQ.js";import"./shield-Bco25DSE.js";import"./sonner-CzgRTX_z.js";import"./ellipsis-BUaddE5J.js";import"./chevron-left-C6qfJShI.js";import"./index-BdQq_4o_.js";import"./index-BAK1YxAc.js";import"./index-D8L8_pCG.js";import"./index-DWUEdQX6.js";import"./index-B6i64pSH.js";import"./index-YFI2wHgC.js";import"./index-qgmO2-AH.js";import"./index-BUGEk3O6.js";import"./index-B6sjIBFy.js";import"./index-CYQStCBS.js";import"./check-DyXxeGP9.js";import"./chevron-up-CGTnGh2u.js";import"./x-CpN8cc9J.js";import"./circle-check-BQHjiPz9.js";import"./index-B9B_fttR.js";const as=[["path",{d:"M20 10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"hod4my"}],["path",{d:"M20 21a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.9a1 1 0 0 1-.88-.55l-.42-.85a1 1 0 0 0-.92-.6H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"w4yl2u"}],["path",{d:"M3 5a2 2 0 0 0 2 2h3",key:"f2jnh7"}],["path",{d:"M3 3v13a2 2 0 0 0 2 2h3",key:"k8epm1"}]],ts=ss("folder-tree",as);function br({categories:n,availableIcons:$,myRequests:S,parents:Z}){const N=S.data??[],G=S.links??[],{currentTenant:u,currentUserRole:x}=pe().props,[Q,y]=i.useState(!1),[U,o]=i.useState(!1),[J,h]=i.useState(!1),[c,D]=i.useState(null),[k,K]=i.useState(""),[r,v]=i.useState(null),[W,T]=i.useState(null),X=s=>x?x.is_owner===!0||x.permissions?.includes("*")===!0||x.permissions?.includes(s)===!0:!1,l=(s,a,me)=>{s&&(s.preventDefault(),s.stopPropagation()),X(a)?me():y(!0)},{data:C,setData:g,post:Y,put:ee,processing:w,errors:d,reset:se,clearErrors:I,transform:re}=R({name:"",category_icon_id:"",parent_id:"root"}),{data:ae,setData:A,post:te,processing:ie,errors:q,reset:ne}=R({requested_name:"",reference_image:null}),E=()=>{D(null),se(),I(),o(!0)},oe=s=>{D(s),I(),g({name:s.name,category_icon_id:s.category_icon_id.toString(),parent_id:s.parent_id?s.parent_id.toString():"root"}),o(!0)},ce=s=>{s.preventDefault(),re(a=>({...a,parent_id:a.parent_id==="root"?null:a.parent_id})),c?ee(route("tenant.categories.update",[u?.slug,c.id]),{onSuccess:()=>{b.success("Categoría actualizada correctamente"),o(!1)}}):Y(route("tenant.categories.store",u?.slug),{onSuccess:()=>{b.success("Categoría creada correctamente"),o(!1)}})},le=s=>{M.delete(route("tenant.categories.destroy",[u?.slug,s]),{onSuccess:()=>{b.success("Categoría eliminada con éxito"),v(null)}})},de=s=>{s.preventDefault(),te(route("tenant.categories.request-icon",u?.slug),{onSuccess:()=>{h(!1),ne()}})},P=$.filter(s=>s.name.toLowerCase().includes(k.toLowerCase()));return e.jsxs(xe,{title:"Categorías",children:[e.jsx(ue,{title:"Categorías"}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Categorías"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Organiza tus productos en categorías."})]}),e.jsxs(t,{onClick:s=>l(s,"categories.create",E),className:"cursor-pointer ring-0 hover:ring-0 focus:ring-0",children:[e.jsx(B,{})," Nueva Categoría"]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-3",children:[e.jsxs("div",{className:"md:col-span-2 space-y-4",children:[e.jsx(H,{children:e.jsx(z,{className:"p-0",children:e.jsxs(Ae,{children:[e.jsx(qe,{children:e.jsxs(L,{children:[e.jsx(m,{className:"w-[80px]",children:"Icono"}),e.jsx(m,{children:"Nombre"}),e.jsx(m,{children:"Tipo"}),e.jsx(m,{className:"text-center",children:"Productos"}),e.jsx(m,{className:"text-center",children:"Estado"}),e.jsx(m,{className:"text-right",children:"Acciones"})]})}),e.jsx(Ee,{children:n.data.map(s=>e.jsxs(L,{children:[e.jsx(p,{children:e.jsxs(Re,{className:"rounded-lg",children:[s.icon&&e.jsx(Me,{src:`/media/${s.icon.path}`,alt:s.icon.name,className:"object-contain p-1"}),e.jsx(Oe,{className:"bg-muted",children:e.jsx("div",{className:"size-2 rounded-full bg-slate-300"})})]})}),e.jsx(p,{className:"font-medium",children:s.name}),e.jsx(p,{children:s.parent?e.jsxs("div",{className:"flex flex-col text-[10px] uppercase tracking-wider font-bold",children:[e.jsx("span",{className:"text-muted-foreground",children:"Subcategoría"}),e.jsx("span",{children:s.parent.name})]}):e.jsx(_,{variant:"outline",children:"Principal"})}),e.jsx(p,{className:"text-center",children:e.jsx(_,{variant:"secondary",children:s.products_count||0})}),e.jsx(p,{className:"text-center",children:W===s.id?e.jsx(V,{className:"w-4 h-4 animate-spin mx-auto text-muted-foreground"}):e.jsx(Pe,{className:"cursor-pointer ring-0 hover:ring-0 focus:ring-0",checked:s.is_active,onCheckedChange:()=>l(null,"categories.update",()=>{T(s.id),M.patch(route("tenant.categories.toggle-active",[u?.slug,s.id]),{},{preserveScroll:!0,onFinish:()=>T(null)})})})}),e.jsx(p,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-1",children:[e.jsx(t,{size:"icon",variant:"ghost",className:"cursor-pointer ring-0 hover:ring-0 focus:ring-0",onClick:a=>l(a,"categories.update",()=>oe(s)),children:e.jsx(Ye,{})}),e.jsx(t,{size:"icon",variant:"ghost",className:"cursor-pointer ring-0 hover:ring-0 focus:ring-0 text-red-500 hover:text-red-600 hover:bg-red-50",onClick:a=>l(a,"categories.delete",()=>v(s)),children:e.jsx(es,{})})]})})]},s.id))})]})})}),n.data.length===0&&e.jsxs(Ue,{className:"border-2 border-dashed rounded-xl bg-white py-12",children:[e.jsxs(Je,{children:[e.jsx(Ke,{variant:"icon",children:e.jsx(ts,{className:"size-8 text-muted-foreground"})}),e.jsx(We,{children:"No tienes categorías creadas"}),e.jsx(Xe,{children:"Crea categorías para organizar tus productos en la carta digital y el POS."})]}),e.jsxs(t,{className:"mt-4 cursor-pointer",onClick:s=>l(s,"categories.create",E),children:[e.jsx(B,{className:"w-4 h-4 mr-2"})," Nueva Categoría"]})]}),n.data.length>0&&n.links&&n.links.length>1&&e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(O,{links:n.links})})]}),e.jsx("div",{className:"md:col-span-1",children:e.jsx(H,{children:e.jsxs(z,{className:"pt-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(rs,{className:"h-4 w-4"})," Mis Solicitudes de Iconos"]}),N.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No has solicitado iconos."}):e.jsxs("div",{className:"space-y-1",children:[N.map((s,a)=>e.jsxs(he.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center py-2 px-1",children:[e.jsx("span",{className:"text-sm font-medium",children:s.requested_name}),e.jsx(_,{variant:s.status==="approved"?"default":s.status==="rejected"?"destructive":"secondary",children:s.status==="approved"?"Aprobado":s.status==="rejected"?"Rechazado":"Pendiente"})]}),a<N.length-1&&e.jsx(Le,{className:"opacity-50"})]},s.id)),e.jsx("div",{className:"flex justify-center pt-2",children:e.jsx(O,{links:G,className:"scale-90"})})]}),e.jsx(t,{variant:"outline",className:"w-full mt-4 cursor-pointer ring-0 hover:ring-0 focus:ring-0",onClick:s=>l(s,"categories.create",()=>h(!0)),children:"Solicitar Icono Nuevo"})]})})})]}),e.jsx(De,{open:U,onOpenChange:o,children:e.jsxs(ke,{side:"right",children:[e.jsxs(Te,{children:[e.jsx(we,{children:c?"Editar Categoría":"Nueva Categoría"}),e.jsx(Ie,{children:"Configura los detalles de la categoría."})]}),e.jsxs("form",{onSubmit:ce,className:"space-y-6 mt-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"name",children:"Nombre"}),e.jsx(j,{id:"name",value:C.name,onChange:s=>g("name",s.target.value),required:!0,className:"ring-0 hover:ring-0 focus:ring-0"}),d.name&&e.jsx("p",{className:"text-red-500 text-xs",children:d.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"parent",children:"Categoría Superior (Opcional)"}),e.jsxs(ge,{value:C.parent_id,onValueChange:s=>g("parent_id",s),children:[e.jsx(je,{className:"ring-0 hover:ring-0 focus:ring-0 cursor-pointer",children:e.jsx(fe,{placeholder:"Selecciona..."})}),e.jsxs(Ne,{children:[e.jsx(F,{value:"root",children:"Ninguna (Categoría Principal)"}),Z.filter(s=>!c||s.id!==c.id).map(s=>e.jsx(F,{value:s.id.toString(),className:"cursor-pointer ring-0 hover:ring-0 focus:ring-0",children:s.name},s.id))]})]}),d.parent_id&&e.jsx("p",{className:"text-red-500 text-xs",children:d.parent_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Icono"}),e.jsx(j,{placeholder:"Buscar icono...",className:"mb-2 ring-0 hover:ring-0 focus:ring-0",value:k,onChange:s=>K(s.target.value)}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 border rounded-md p-2 max-h-48 overflow-y-auto",children:[P.map(s=>e.jsxs("div",{className:`cursor-pointer rounded border p-2 flex flex-col items-center justify-center gap-1 transition-colors cursor-pointer ${C.category_icon_id==s.id.toString()?"border-primary bg-primary/5":"border-muted hover:bg-muted/50"}`,onClick:()=>g("category_icon_id",s.id.toString()),children:[e.jsx("img",{src:`/media/${s.path}`,alt:s.name,className:"w-8 h-8 object-contain"}),e.jsx("span",{className:"text-[10px] truncate w-full text-center",title:s.name,children:s.name})]},s.id)),P.length===0&&e.jsx("div",{className:"col-span-4 text-center py-4 text-xs text-muted-foreground",children:"No se encontraron iconos."})]}),d.category_icon_id&&e.jsx("p",{className:"text-red-500 text-xs",children:d.category_icon_id}),e.jsxs("div",{className:"text-xs text-center pt-2",children:["¿No encuentras el icono? ",e.jsx("button",{type:"button",className:"text-blue-600 underline",onClick:()=>h(!0),children:"Solicita uno nuevo"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(t,{type:"button",variant:"outline",className:"cursor-pointer ring-0 hover:ring-0 focus:ring-0",onClick:()=>o(!1),children:"Cancelar"}),e.jsxs(t,{type:"submit",disabled:w,className:"cursor-pointer ring-0 hover:ring-0 focus:ring-0",children:[w?e.jsx(V,{className:"w-4 h-4 animate-spin mr-2"}):null,c?"Guardar Cambios":"Crear Categoría"]})]})]})]})}),e.jsx(ve,{open:J,onOpenChange:h,children:e.jsxs(Ce,{children:[e.jsxs(be,{children:[e.jsx(_e,{children:"Solicitar Nuevo Icono"}),e.jsx(Se,{children:"Sube una imagen de referencia y nosotros crearemos el icono para ti."})]}),e.jsxs("form",{onSubmit:de,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"req_name",children:"Nombre del Icono"}),e.jsx(j,{id:"req_name",value:ae.requested_name,onChange:s=>A("requested_name",s.target.value),required:!0,className:"ring-0 hover:ring-0 focus:ring-0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{id:"req_image",type:"file",accept:"image/*",onChange:s=>A("reference_image",s.target.files?s.target.files[0]:null),required:!0,className:"ring-0 hover:ring-0 focus:ring-0 border-dashed"}),e.jsx("p",{className:"text-[0.8rem] text-muted-foreground",children:"Máximo 2MB"}),q.reference_image&&e.jsx("p",{className:"text-red-500 text-xs",children:q.reference_image})]}),e.jsxs(ye,{children:[e.jsx(t,{type:"button",variant:"outline",className:"cursor-pointer ring-0 hover:ring-0 focus:ring-0",onClick:()=>h(!1),children:"Cancelar"}),e.jsx(t,{type:"submit",disabled:ie,className:"cursor-pointer ring-0 hover:ring-0 focus:ring-0",children:"Enviar Solicitud"})]})]})]})}),e.jsx(He,{open:!!r,onOpenChange:s=>!s&&v(null),children:e.jsxs(ze,{children:[e.jsxs(Be,{children:[e.jsx(Ve,{children:"¿Eliminar Categoría?"}),e.jsx($e,{children:(r?.all_products_count??r?.products_count??0)>0||(r?.children_count||0)>0?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-red-500 font-bold",children:"No se puede eliminar esta categoría."}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[((r?.all_products_count??r?.products_count)||0)>0&&e.jsxs("li",{children:["Tiene ",e.jsx("span",{className:"font-bold",children:r?.all_products_count??r?.products_count})," productos asociados."]}),(r?.children_count||0)>0&&e.jsxs("li",{children:["Tiene ",e.jsx("span",{className:"font-bold",children:r?.children_count})," subcategorías asociadas."]})]}),e.jsx("p",{className:"text-sm",children:"Debes mover o eliminar estos elementos antes de borrar la categoría."})]}):e.jsxs("p",{children:["¿Estás seguro de que deseas eliminar la categoría ",e.jsx("span",{className:"font-bold",children:r?.name}),"? Esta acción no se puede deshacer."]})})]}),e.jsxs(Ze,{children:[e.jsx(Ge,{className:"cursor-pointer ring-0 hover:ring-0 focus:ring-0",children:"Cerrar"}),((r?.all_products_count??r?.products_count)||0)===0&&(!r?.children_count||r.children_count===0)&&e.jsx(Qe,{onClick:()=>r&&le(r.id),variant:"destructive",className:"cursor-pointer ring-0 hover:ring-0 focus:ring-0",children:"Eliminar"})]})]})}),e.jsx(Fe,{open:Q,onOpenChange:y})]})}export{br as default};
