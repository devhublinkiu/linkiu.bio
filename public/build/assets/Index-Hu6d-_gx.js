import{r as i,t as p,j as e,b as v,H as K,L as U}from"./app-D9wldZxo.js";import{A as W}from"./AdminLayout-C86srUOQ.js";import{g as q}from"./echo-CmTENghG.js";import{B as I}from"./button-Dadb_Lep.js";import{S as G,a as J,b as Q,c as X,d as M}from"./select-Bbe1RuXu.js";import{A as Y,a as Z,b as ee,c as te,d as se,e as ae,f as re,g as oe}from"./alert-dialog-BL6dXcRY.js";import{KitchenOrderCard as ie}from"./KitchenOrderCard-BkbF3KrL.js";import{J as D}from"./dropdown-menu-C4-9o8Rw.js";import{A as ne}from"./arrow-left-CN9XnZib.js";import{C as le}from"./chef-hat-D6sEz8YW.js";import{R as ce}from"./refresh-cw-CsuI6meo.js";import{U as de}from"./utensils-crossed-DV4GRZe2.js";import{A as me}from"./index-DagmFQ0c.js";import{c as T}from"./createLucideIcon-CJjlOp5I.js";import"./utils-B0KHI9vB.js";import"./badge-DyYF213F.js";import"./card-DbFVjWqh.js";import"./progress-D5NiGDeK.js";import"./index-DdTS5Ad2.js";import"./index-CZBSMaku.js";import"./menuConfig-GyORRgsI.js";import"./video-DRtFkuCB.js";import"./table-rgWYlWzZ.js";import"./user-D9c6nVY3.js";import"./map-pin-Du3W4-OO.js";import"./banknote-DTNMynPY.js";import"./star-D-Iirb7f.js";import"./users-OjDIvTV8.js";import"./calendar-check-fjlZrFwy.js";import"./calendar-BW0rhnMu.js";import"./briefcase-Crq0rSJT.js";import"./truck-Db-Ebch9.js";import"./message-circle-DrNrCoj8.js";import"./credit-card-CPDlDYf1.js";import"./package-BPq1-jLc.js";import"./shopping-bag-CQGcPT0-.js";import"./layout-dashboard-BqLojFjH.js";import"./badge-check-CEpGdEtW.js";import"./lock-BHZn93rL.js";import"./chevron-right-BSwXEIvG.js";import"./sparkles-JbdQIbjf.js";import"./separator-L5pP8n2q.js";import"./external-link-pORnC0H4.js";import"./chevron-down-Dux0wLDw.js";import"./headphones-DD_UyCnk.js";import"./shield-BtuNH23d.js";import"./sonner-DQ2kSMfY.js";import"./index-BdQq_4o_.js";import"./index-BrcTw33p.js";import"./index-fFU5c_p6.js";import"./index-Dvu8qGWr.js";import"./index-BDWpq_YI.js";import"./index-BMdzuiHN.js";import"./index-tfOuMV4B.js";import"./index-CbR7iZJO.js";import"./index-DeHGgcwY.js";import"./index--Jev_GdI.js";import"./check-BAxbGpAF.js";import"./chevron-up-IlwuOcq-.js";import"./scroll-area-BJL3Hmbm.js";import"./proxy-Cin13Ko-.js";import"./clock-CeESiC7i.js";import"./ban-Dw8pJ6VU.js";import"./loader-circle-B4dqvKUy.js";import"./circle-check-CN90YBLh.js";import"./trash-2-CMPgRqgc.js";import"./dialog-C0Lg02Tk.js";import"./x-dvUxMxq3.js";import"./input-rMsYcH4C.js";import"./sheet-BP6KOnln.js";import"./index-CXzOyCXW.js";import"./index-D4lOZYra.js";const pe=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],he=T("wifi-off",pe);const xe=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],ue=T("wifi",xe);function Rt({orders:O,tenant:r,currentLocationId:R,locations:y=[]}){const[h,x]=i.useState(O),[_,k]=i.useState(null),[g,b]=i.useState(!1),[l,j]=i.useState("all"),[n,L]=i.useState(R),[u,N]=i.useState(null),C=i.useCallback(()=>{try{const t=window.AudioContext||window.webkitAudioContext,s=new t;[830,1046,1318].forEach((o,a)=>{const c=s.createOscillator(),m=s.createGain();c.type="sine",c.frequency.value=o,m.gain.setValueAtTime(.4,s.currentTime+a*.18),m.gain.exponentialRampToValueAtTime(.01,s.currentTime+a*.18+.3),c.connect(m),m.connect(s.destination),c.start(s.currentTime+a*.18),c.stop(s.currentTime+a*.18+.3)})}catch{p.info("ðŸ”” Nuevo pedido recibido",{icon:e.jsx(D,{className:"w-4 h-4 text-blue-500"})})}},[]),A=i.useCallback(async(t,s)=>{k(t);try{(await v.post(route("tenant.admin.kitchen.ready",{tenant:r.slug,order:t}),{status:s})).data.success&&(s==="ready"?(x(o=>o.filter(a=>a.id!==t)),p.success("Pedido despachado")):(x(o=>o.map(a=>a.id===t?{...a,status:"preparing"}:a)),p.success("Pedido marcado como preparando")))}catch{p.error("Error al actualizar pedido")}finally{k(null),N(null)}},[r.slug]),P=t=>{N({id:t,action:"ready"})},$=t=>{A(t,"preparing")},z=()=>{u&&A(u.id,u.action)};i.useEffect(()=>{const t=q();if(!t?.connector||!r.id){b(!1);return}b(!0);const s=n?`tenant.${r.id}.location.${n}.kitchen`:`tenant.${r.id}.kitchen`;let d=null;try{d=t.channel(s).listen(".order.sent",o=>{const a=o;x(c=>{const m=c.findIndex(f=>f.id===a.id);if(m!==-1){const f=[...c];return f[m]=a,f}return[...c,a]}),C(),p.info(`Nuevo pedido: ${a.ticket_number}`,{description:`${a.service_type==="dine_in"?a.table?.name||"Mesa":"Para llevar"}`,icon:e.jsx(D,{className:"w-4 h-4 text-blue-500"})})})}catch(o){console.error("Error subscribing to Echo channel:",o),b(!1)}return()=>{try{t.leave(s)}catch{}}},[r.id,n,C]),i.useEffect(()=>{if(g)return;const s=setInterval(async()=>{try{const d={};n&&(d.location_id=String(n)),l!=="all"&&(d.status=l);const o=await v.get(route("tenant.admin.kitchen.orders",{tenant:r.slug}),{params:d});x(o.data)}catch{}},3e4);return()=>clearInterval(s)},[g,r.slug,n,l]);const[S,E]=i.useState(!1),F=async()=>{E(!0);try{const t={};n&&(t.location_id=String(n));const s=await v.get(route("tenant.admin.kitchen.orders",{tenant:r.slug}),{params:t});x(s.data),p.success("Comandas actualizadas")}catch{p.error("Error al refrescar")}finally{E(!1)}},H=t=>{const s=t==="all"?null:Number(t);L(s),window.location.href=route("tenant.admin.kitchen.index",{tenant:r.slug,...s?{location_id:s}:{}})},w=l==="all"?h:h.filter(t=>t.status===l),V=h.filter(t=>t.status==="confirmed").length,B=h.filter(t=>t.status==="preparing").length;return e.jsxs(W,{hideSidebar:!0,hideNavbar:!0,hideFooter:!0,maxwidth:"w-full h-screen",children:[e.jsx(K,{title:"Monitor de Cocina"}),e.jsxs("div",{className:"flex flex-col h-screen bg-slate-900 overflow-hidden",children:[e.jsxs("header",{className:"bg-slate-800 border-b border-slate-700 p-4 flex justify-between items-center shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(I,{variant:"ghost",size:"icon",className:"text-slate-400 hover:text-white hover:bg-slate-700 rounded-full",asChild:!0,children:e.jsx(U,{href:route("tenant.dashboard",{tenant:r.slug}),children:e.jsx(ne,{className:"w-6 h-6"})})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-blue-600 p-2 rounded-lg",children:e.jsx(le,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-white tracking-tight",children:"MONITOR DE COCINA"}),e.jsx("p",{className:"text-xs text-slate-400 font-medium uppercase tracking-widest",children:"Panel de Control de Comandas"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[y.length>1&&e.jsxs(G,{value:n?String(n):"all",onValueChange:H,children:[e.jsx(J,{className:"w-[160px] h-9 bg-slate-700 border-slate-600 text-white text-xs",children:e.jsx(Q,{placeholder:"Todas las sedes"})}),e.jsxs(X,{children:[e.jsx(M,{value:"all",children:"Todas las sedes"}),y.map(t=>e.jsx(M,{value:String(t.id),children:t.name},t.id))]})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-slate-700/50 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>j("all"),className:`px-3 py-1.5 rounded text-[10px] font-bold uppercase transition-colors ${l==="all"?"bg-slate-600 text-white":"text-slate-400 hover:text-white"}`,children:["Todos (",h.length,")"]}),e.jsxs("button",{onClick:()=>j("confirmed"),className:`px-3 py-1.5 rounded text-[10px] font-bold uppercase transition-colors ${l==="confirmed"?"bg-slate-100 text-slate-900":"text-slate-400 hover:text-white"}`,children:["Nuevos (",V,")"]}),e.jsxs("button",{onClick:()=>j("preparing"),className:`px-3 py-1.5 rounded text-[10px] font-bold uppercase transition-colors ${l==="preparing"?"bg-blue-600 text-white":"text-slate-400 hover:text-white"}`,children:["Preparando (",B,")"]})]}),e.jsx("div",{className:"h-10 w-px bg-slate-700 mx-1"}),e.jsx(I,{variant:"ghost",size:"icon",className:"text-slate-400 hover:text-white hover:bg-slate-700",onClick:F,disabled:S,children:e.jsx(ce,{className:`w-5 h-5 ${S?"animate-spin":""}`})}),e.jsxs("div",{className:"hidden lg:flex gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-slate-100"}),e.jsx("span",{className:"text-[10px] text-slate-300 font-bold uppercase",children:"A tiempo"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-amber-500"}),e.jsx("span",{className:"text-[10px] text-slate-300 font-bold uppercase",children:"Retraso"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),e.jsx("span",{className:"text-[10px] text-slate-300 font-bold uppercase",children:"Urgente"})]})]}),e.jsx("div",{className:"h-10 w-px bg-slate-700 mx-1"}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-mono font-bold text-blue-400 leading-none",children:w.length}),e.jsx("span",{className:"text-[10px] text-slate-500 font-bold uppercase",children:"Activos"})]})]})]}),e.jsx("main",{className:"flex-1 p-4 overflow-hidden relative",children:w.length===0?e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-slate-600",children:[e.jsx(de,{className:"w-24 h-24 mb-4 opacity-10"}),e.jsx("h2",{className:"text-2xl font-bold opacity-20",children:l!=="all"?"SIN COMANDAS EN ESTE FILTRO":"COCINA SIN COMANDAS"}),e.jsx("p",{className:"text-slate-700 opacity-20",children:"Esperando nuevos pedidos..."})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-4 h-full content-start overflow-y-auto pr-2 custom-scrollbar",children:e.jsx(me,{mode:"popLayout",children:w.map(t=>e.jsx(ie,{order:t,onReady:P,onPreparing:$,processingId:_},t.id))})})}),e.jsx("footer",{className:"bg-slate-800/50 p-2 shrink-0 border-t border-slate-700",children:e.jsxs("div",{className:"flex justify-center items-center gap-4 text-[10px] text-slate-500 font-mono uppercase tracking-widest",children:[g?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"w-3.5 h-3.5 text-green-500"}),e.jsx("span",{className:"text-green-400",children:"Tiempo Real Conectado"}),e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"})]}):e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"w-3.5 h-3.5 text-amber-500"}),e.jsx("span",{className:"text-amber-400",children:"Modo Polling (30s)"}),e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-amber-500"})]}),e.jsx("span",{className:"opacity-50",children:"|"}),e.jsx("span",{children:"KDS v2.0"})]})})]}),e.jsx(Y,{open:!!u,onOpenChange:t=>{t||N(null)},children:e.jsxs(Z,{children:[e.jsxs(ee,{children:[e.jsx(te,{children:"Â¿Despachar pedido?"}),e.jsxs(se,{children:["El pedido serÃ¡ marcado como ",e.jsx("strong",{className:"text-green-600",children:"Listo"})," y notificado al POS. Esta acciÃ³n no se puede deshacer."]})]}),e.jsxs(ae,{children:[e.jsx(re,{children:"Cancelar"}),e.jsx(oe,{onClick:z,className:"bg-green-600 text-white hover:bg-green-700",children:"SÃ­, Despachar"})]})]})}),e.jsx("style",{children:`
                .custom-scrollbar::-webkit-scrollbar {
                    width: 6px;
                }
                .custom-scrollbar::-webkit-scrollbar-track {
                    background: rgba(30, 41, 59, 0.5);
                    border-radius: 10px;
                }
                .custom-scrollbar::-webkit-scrollbar-thumb {
                    background: #334155;
                    border-radius: 10px;
                }
                .custom-scrollbar::-webkit-scrollbar-thumb:hover {
                    background: #475569;
                }
            `})]})}export{Rt as default};
