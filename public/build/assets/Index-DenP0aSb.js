import{c as A,r as l,u as k,j as e,H as R}from"./app-D9wldZxo.js";import{S as B}from"./SuperAdminLayout-CPtcwFpO.js";import{P as H}from"./dropdown-menu-C4-9o8Rw.js";import{C as M,a as F,b as I,c as L,d as O}from"./card-DbFVjWqh.js";import{T as q,a as V,b as h,c as t,d as G,e as s}from"./table-B6cmMBvL.js";import{B as o}from"./badge-DyYF213F.js";import{B as d}from"./button-Dadb_Lep.js";import{D as W,a as X,b as $,c as J,d as K,e as Q}from"./dialog-C0Lg02Tk.js";import{L as N}from"./label-DoqMNi9Z.js";import{T as C}from"./textarea-DBah2UDL.js";import{S as U}from"./Pagination-3BS96hmy.js";import{E as Y,a as Z,b as ee,c as re,d as se}from"./empty-SlYDCCGq.js";import{f as ae}from"./format-Du31obhd.js";import{F as w}from"./file-text-DOpJ3jdL.js";import{C as te}from"./circle-check-big-DObkKIth.js";import{C as oe}from"./circle-x-Eb_n5uBr.js";import{e as ie}from"./es-BteQoBuv.js";import"./echo-CmTENghG.js";import"./chevron-right-BSwXEIvG.js";import"./createLucideIcon-CJjlOp5I.js";import"./chevrons-up-down-Cepco8Sn.js";import"./badge-check-CEpGdEtW.js";import"./ApplicationLogo-DuPOXIDR.js";import"./users-OjDIvTV8.js";import"./layout-grid-DMUl8Ye2.js";import"./utils-B0KHI9vB.js";import"./index-BDWpq_YI.js";import"./index-BrcTw33p.js";import"./index-BMdzuiHN.js";import"./index-tfOuMV4B.js";import"./circle-check-CN90YBLh.js";import"./trash-2-CMPgRqgc.js";import"./check-BAxbGpAF.js";import"./credit-card-CPDlDYf1.js";import"./shopping-bag-CQGcPT0-.js";import"./input-rMsYcH4C.js";import"./separator-L5pP8n2q.js";import"./index-CZBSMaku.js";import"./sheet-BP6KOnln.js";import"./x-dvUxMxq3.js";import"./index-CbR7iZJO.js";import"./index-DeHGgcwY.js";import"./index-CXzOyCXW.js";import"./index-DdTS5Ad2.js";import"./index-fFU5c_p6.js";import"./index-Dvu8qGWr.js";import"./index-D4lOZYra.js";import"./ellipsis-BfbyL5_C.js";import"./chevron-left-BFxUkP0a.js";function ar({payments:c}){const{auth:P}=A().props,x=P.permissions||[],u=r=>x.includes("*")||x.includes(r),[D,p]=l.useState(!1),[j,g]=l.useState(null),[a,f]=l.useState(null),{data:b,setData:m,put:S,processing:v,errors:ne,reset:T}=k({action:"",notes:""}),[E,i]=l.useState(!1),y=(r,n)=>{if(!u("sa.payments.update")){p(!0);return}g(r),f(n),m({action:n,notes:""}),i(!0)},_=r=>{r.preventDefault(),j&&S(route("payments.update",j.id),{onSuccess:()=>{i(!1),T(),g(null),f(null)}})},z=r=>{switch(r){case"paid":return e.jsx(o,{className:"bg-green-100 text-green-700 border-green-200 hover:bg-green-100",children:"Pagado"});case"pending_review":return e.jsx(o,{variant:"secondary",className:"bg-yellow-100 text-yellow-700 border-yellow-200 hover:bg-yellow-100",children:"Revisión"});case"rejected":return e.jsx(o,{variant:"destructive",children:"Rechazado"});case"pending":return e.jsx(o,{variant:"outline",children:"Pendiente"});default:return e.jsx(o,{variant:"secondary",children:r})}};return e.jsxs(B,{header:"Gestión de Pagos",children:[e.jsx(H,{open:D,onOpenChange:p}),e.jsx(R,{title:"Pagos"}),e.jsx("div",{className:"max-w-7xl mx-auto py-6",children:e.jsxs(M,{children:[e.jsxs(F,{children:[e.jsx(I,{children:"Pagos Pendientes"}),e.jsx(L,{children:"Revisa y aprueba los reportes de pago de los planes."})]}),e.jsxs(O,{children:[e.jsxs(q,{children:[e.jsx(V,{children:e.jsxs(h,{children:[e.jsx(t,{children:"Fecha"}),e.jsx(t,{children:"Cliente"}),e.jsx(t,{children:"Plan"}),e.jsx(t,{children:"Valor"}),e.jsx(t,{children:"Comprobante"}),e.jsx(t,{children:"Estado"}),e.jsx(t,{className:"text-right",children:"Acciones"})]})}),e.jsx(G,{children:c.data.length>0?c.data.map(r=>e.jsxs(h,{children:[e.jsx(s,{children:ae(new Date(r.created_at),"dd MMM yyyy",{locale:ie})}),e.jsx(s,{children:e.jsx("div",{className:"font-medium text-sm",children:r.tenant?.name})}),e.jsx(s,{children:r.subscription?.plan?.name}),e.jsxs(s,{children:["$",Number(r.amount).toLocaleString()]}),e.jsx(s,{children:r.proof_of_payment_path?e.jsxs("a",{href:route("media.proxy",{path:r.proof_of_payment_path}),target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-blue-600 hover:underline",onClick:n=>{u("sa.payments.proof.view")||(n.preventDefault(),p(!0))},children:[e.jsx(w,{className:"w-4 h-4 mr-1.5"}),e.jsx("span",{className:"font-medium",children:"Ver comprobante"})]}):e.jsx("span",{className:"text-gray-400 text-xs italic",children:"Sin adjunto"})}),e.jsx(s,{children:z(r.status)}),e.jsx(s,{className:"text-right",children:r.status==="pending_review"&&e.jsxs("div",{className:"flex justify-end gap-1.5",children:[e.jsx(d,{size:"sm",variant:"outline",className:"h-8 w-8 p-0 text-green-600 hover:text-green-700 hover:bg-green-50 border-green-200",onClick:()=>y(r,"approve"),title:"Aprobar",children:e.jsx(te,{className:"w-4 h-4"})}),e.jsx(d,{size:"sm",variant:"outline",className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50 border-red-200",onClick:()=>y(r,"reject"),title:"Rechazar",children:e.jsx(oe,{className:"w-4 h-4"})})]})})]},r.id)):e.jsx(h,{children:e.jsx(s,{colSpan:7,className:"h-[400px]",children:e.jsxs(Y,{className:"h-full",children:[e.jsx(Z,{children:e.jsx("div",{className:"bg-gray-50 p-4 rounded-full mb-4",children:e.jsx(w,{className:"h-8 w-8 text-gray-400"})})}),e.jsxs(ee,{children:[e.jsx(re,{children:"No hay pagos pendientes"}),e.jsx(se,{children:"Todas las solicitudes de pago han sido procesadas o no hay registros aún."})]})]})})})})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(U,{links:c.links})})]})]})}),e.jsx(W,{open:E,onOpenChange:i,children:e.jsxs(X,{children:[e.jsxs($,{children:[e.jsx(J,{children:a==="approve"?"Aprobar Pago":"Rechazar Pago"}),e.jsx(K,{children:a==="approve"?"Al aprobar, la suscripción se extenderá automáticamente. ¿Confirmas que recibiste el dinero?":"Indica la razón del rechazo para que el cliente pueda corregirlo."})]}),e.jsxs("form",{onSubmit:_,className:"space-y-6 pt-4",children:[a==="reject"&&e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx(N,{children:"Motivo del rechazo"}),e.jsx(C,{placeholder:"Ej: No se ve el número de transferencia...",value:b.notes,onChange:r=>m("notes",r.target.value),required:!0})]}),a==="approve"&&e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx(N,{children:"Notas internas (opcional)"}),e.jsx(C,{placeholder:"Ej: Aprobado por Whatsapp...",value:b.notes,onChange:r=>m("notes",r.target.value)})]}),e.jsxs(Q,{children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>i(!1),children:"Cancelar"}),e.jsx(d,{type:"submit",disabled:v,variant:a==="approve"?"default":"destructive",className:a==="approve"?"bg-green-600 hover:bg-green-700":"",children:v?"Procesando...":a==="approve"?"Aprobar Pago":"Rechazar Pago"})]})]})]})})]})}export{ar as default};
