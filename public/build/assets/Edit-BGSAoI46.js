import{u as G,r as P,j as e,H,L as Y,a as W}from"./app-DC0VdX9s.js";import{S as J}from"./SuperAdminLayout-8dtwKfpn.js";import{B as j}from"./button-CwaftRC9.js";import{I as m}from"./input-DycfGEDM.js";import{L as c}from"./label-CJzxxbAT.js";import{T as Q}from"./textarea-BEpKSmjI.js";import{C as f,a as v,b as _,c as N,d as y}from"./card-Ctcbb2M4.js";import{S as I,a as L,b as O,c as E,d as g}from"./select-DSPRbMko.js";import{S as b}from"./switch-CUkZieeb.js";import{S as X}from"./separator-BvfwgiHl.js";import{C as Z}from"./checkbox-DrgpDXfK.js";import{F as p}from"./field-o5DPVIv6.js";import{M as ee,C as se}from"./MediaInput-eAxeuybs.js";import{V as C,M as q,a as re,b as te,L as ae}from"./menuConfig-CKxoUB1h.js";import{A as ie}from"./arrow-left-CNe8FPCt.js";import{T as le}from"./trash-2-BoAeUuPT.js";import{P as ce}from"./plus-B0JvlXZt.js";import"./dropdown-menu-DQ3ZhwFW.js";import"./createLucideIcon-DJ4NDwYV.js";import"./utils-DBZkxVr1.js";import"./chevron-right-PTgBRbQi.js";import"./index-0coVNd7N.js";import"./index-CzsG3l2v.js";import"./index-DnYW8pH5.js";import"./index-D2N1-uIE.js";import"./circle-check-C5cvU04D.js";import"./check-CDE1QUCE.js";import"./credit-card-Br8ESLwS.js";import"./shopping-bag-C6Zaioqk.js";import"./dialog-BgrajDqf.js";import"./x-B_AiqYVR.js";import"./sheet-DMF7JpR0.js";import"./index-CfjIlq6E.js";import"./index-DdpLosxE.js";import"./index-B8PFW4lY.js";import"./index-DFaq0Ini.js";import"./index-BmeUzyeu.js";import"./index-BfEwHv9F.js";import"./index-CSYYB_ev.js";import"./index-rHpqUtkR.js";import"./chevrons-up-down-BtLav8rf.js";import"./badge-check-BS0cRFCH.js";import"./ApplicationLogo-BQIlgRPv.js";import"./users-Cgy2ffiO.js";import"./layout-grid-RI3UXLIL.js";import"./index-BdQq_4o_.js";import"./index-CO4p0QfG.js";import"./chevron-down-DoRy1-En.js";import"./chevron-up-CH3XZgRm.js";import"./MediaManagerModal-B7dmr6cJ.js";import"./scroll-area-BSLQcsoD.js";import"./alert-dialog-aPMYaqyp.js";import"./empty-RpHymF0w.js";import"./upload-CK6Byfq4.js";import"./search-Lvq2PmNZ.js";import"./loader-circle-BsvfhnNb.js";import"./folder-plus-CuQPjsYm.js";import"./download-BixqI9ha.js";import"./image-ByQ6p7Ds.js";import"./video-MJZj3Bpt.js";import"./chef-hat-BD-YlOcT.js";import"./table-CXHlPgh7.js";import"./user-CvUPnKZS.js";import"./map-pin-N8LTMDOp.js";import"./banknote-oh6wB0_E.js";import"./star-Ccup-E-P.js";import"./calendar-check-D7EtMSGq.js";import"./calendar-BN8FUoZ8.js";import"./briefcase-D8fTsXA3.js";import"./truck-88x5atPF.js";import"./message-circle-dn3KuYwe.js";import"./package-BYrkzaAT.js";import"./layout-dashboard-CvWgsk9y.js";function Ps({plan:i,verticals:w}){const{data:r,setData:l,post:ne,processing:D,errors:u}=G({_method:"PUT",name:i.name,slug:i.slug,vertical_id:i.vertical_id.toString(),description:i.description||"",monthly_price:i.monthly_price.toString(),currency:i.currency,quarterly_discount_percent:i.quarterly_discount_percent,semiannual_discount_percent:i.semiannual_discount_percent,yearly_discount_percent:i.yearly_discount_percent,trial_days:i.trial_days,no_initial_payment_required:!!i.no_initial_payment_required,support_level:i.support_level,allow_custom_slug:!!i.allow_custom_slug,is_public:!!i.is_public,is_featured:!!i.is_featured,highlight_text:i.highlight_text||"",sort_order:i.sort_order,features:i.features?.filter(s=>typeof s=="string")||[""],cover:null,cover_path:i.cover_path||"",cover_preview:i.cover_url}),k=(()=>{const s=i.features?.find(t=>typeof t=="object"&&!Array.isArray(t)&&t!==null)||{},a=w.find(t=>t.id.toString()===i.vertical_id.toString());if(a){const t=a.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),n=Object.keys(C).find(o=>o===t)||"default",x=C[n]||[],h={};return x.forEach(o=>{h[o]=s.hasOwnProperty(o)?s[o]:!0}),h}return{}})(),[F,M]=P.useState(k),A=(()=>{if(!i.limits)return{};const s={};return Object.entries(i.limits).forEach(([a,t])=>{const n=te[a]??a;s[n]=t.toString()}),s})(),[T,V]=P.useState(A);P.useEffect(()=>{const s=w.find(a=>a.id.toString()===r.vertical_id);if(s){const a=s.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),t=Object.keys(C).find(d=>d===a)||"default",n=C[t]||[],h=r.vertical_id===i.vertical_id.toString()?i.features?.find(d=>typeof d=="object"&&!Array.isArray(d)&&d!==null)||{}:{},o={};n.forEach(d=>{o[d]=h.hasOwnProperty(d)?h[d]:!0}),M(o)}},[r.vertical_id]);const B=(s,a)=>{M(t=>({...t,[s]:a}))},K=(s,a)=>{V(t=>({...t,[s]:a}))},R=(s,a)=>{const t=[...r.features];t[s]=a,l("features",t)},U=()=>{l("features",[...r.features,""])},z=s=>{const a=r.features.filter((t,n)=>n!==s);l("features",a)},S=(s,a)=>(parseFloat(r.monthly_price)||0)*s*(1-a/100),$=s=>{s.preventDefault();const t=[...r.features.filter(x=>typeof x=="string"&&x.trim()!==""),F],n={};Object.entries(T).forEach(([x,h])=>{const o=parseInt(h);if(!isNaN(o)&&o>0){const d=ae[x]??x;n[d]=o}}),W.post(route("plans.update",i.id),{...r,_method:"PUT",features:t,limits:Object.keys(n).length>0?n:null})};return e.jsxs(J,{header:`Editar Plan: ${i.name}`,children:[e.jsx(H,{title:"Editar Plan"}),e.jsxs("div",{className:"max-w-4xl mx-auto py-6",children:[e.jsx(j,{variant:"ghost",className:"mb-4 pl-0 hover:bg-transparent",asChild:!0,children:e.jsxs(Y,{href:route("plans.index"),className:"flex items-center gap-2 text-muted-foreground hover:text-gray-900",children:[e.jsx(ie,{className:"h-4 w-4"}),"Volver al listado"]})}),e.jsxs("form",{onSubmit:$,className:"space-y-8",children:[e.jsxs(f,{children:[e.jsxs(v,{children:[e.jsx(_,{children:"Información Básica"}),e.jsx(N,{children:"Detalles principales del plan y su vertical asociada."})]}),e.jsxs(y,{className:"grid gap-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx(c,{htmlFor:"vertical",children:"Vertical de Negocio"}),e.jsxs(I,{value:r.vertical_id,onValueChange:s=>l("vertical_id",s),children:[e.jsx(L,{children:e.jsx(O,{placeholder:"Selecciona una vertical"})}),e.jsx(E,{children:w.map(s=>e.jsx(g,{value:s.id.toString(),children:s.name},s.id))})]}),e.jsx(p,{children:u.vertical_id})]}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx(c,{htmlFor:"currency",children:"Moneda"}),e.jsxs(I,{value:r.currency,onValueChange:s=>l("currency",s),children:[e.jsx(L,{children:e.jsx(O,{placeholder:"Moneda"})}),e.jsxs(E,{children:[e.jsx(g,{value:"COP",children:"Peso Colombiano (COP)"}),e.jsx(g,{value:"USD",children:"Dólar Americano (USD)"})]})]}),e.jsx(p,{children:u.currency})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx(c,{htmlFor:"name",children:"Nombre del Plan"}),e.jsx(m,{id:"name",value:r.name,onChange:s=>l("name",s.target.value),required:!0}),e.jsx(p,{children:u.name})]}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx(c,{htmlFor:"slug",children:"Slug (URL amigable)"}),e.jsx(m,{id:"slug",value:r.slug,onChange:s=>l("slug",s.target.value),required:!0}),e.jsx(p,{children:u.slug})]})]}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx(c,{htmlFor:"description",children:"Descripción Corta"}),e.jsx(Q,{id:"description",value:r.description,onChange:s=>l("description",s.target.value)}),e.jsx(p,{children:u.description})]}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx(c,{children:"Imagen de Portada / Icono"}),e.jsx(ee,{value:r.cover_preview,onChange:(s,a)=>{l(s?t=>({...t,cover_preview:s,cover_path:a?.path||""}):t=>({...t,cover_preview:null,cover_path:""}))},error:u.cover}),e.jsx("p",{className:"text-[0.75rem] text-muted-foreground mt-1",children:"Recomendado: 800x600px o Icono SVG."}),e.jsx(p,{children:u.cover})]})]})]}),e.jsxs(f,{children:[e.jsxs(v,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5 text-blue-600"}),e.jsx(_,{children:"Motor de Precios"})]}),e.jsx(N,{children:"Define el precio base mensual y los descuentos por permanencia."})]}),e.jsx(y,{className:"space-y-8",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-8 items-center",children:[e.jsxs("div",{className:"p-6 bg-blue-50/50 rounded-xl border border-blue-100 flex flex-col gap-1.5",children:[e.jsx(c,{htmlFor:"monthly_price",className:"text-base font-semibold text-blue-900",children:"Precio Base Mensual"}),e.jsxs("div",{className:"mt-1 relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 font-bold text-gray-500",children:"$"}),e.jsx(m,{id:"monthly_price",type:"number",min:"0",step:"0.01",className:"pl-8 text-lg font-bold",placeholder:"0.00",value:r.monthly_price,onChange:s=>l("monthly_price",s.target.value),required:!0})]}),e.jsx("p",{className:"text-xs text-blue-600/80 mt-1",children:"Este es el precio que pagará el usuario si elige facturación mes a mes."}),e.jsx(p,{children:u.monthly_price})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h4",{className:"font-medium text-gray-900 text-sm uppercase tracking-wide",children:"Descuentos por Periodo"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"w-40 flex-shrink-0 flex flex-col gap-1.5",children:[e.jsx(c,{htmlFor:"quarterly",className:"text-xs text-gray-500 uppercase",children:"Trimestral (-%)"}),e.jsxs("div",{className:"relative mt-0.5",children:[e.jsx(m,{id:"quarterly",type:"number",min:"0",max:"100",value:r.quarterly_discount_percent,onChange:s=>l("quarterly_discount_percent",parseInt(s.target.value)||0)}),e.jsx("span",{className:"absolute right-3 top-2.5 text-xs font-bold text-gray-400",children:"%"})]})]}),e.jsxs("div",{className:"flex-1 pt-4",children:[e.jsx("div",{className:"text-[0.7rem] text-gray-500 uppercase tracking-tight",children:"Precio Final / periodo"}),e.jsx("div",{className:"font-bold text-green-700 text-lg",children:new Intl.NumberFormat("es-CO",{style:"currency",currency:r.currency}).format(S(3,r.quarterly_discount_percent))})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"w-40 flex-shrink-0 flex flex-col gap-1.5",children:[e.jsx(c,{htmlFor:"semiannual",className:"text-xs text-gray-500 uppercase",children:"Semestral (-%)"}),e.jsxs("div",{className:"relative mt-0.5",children:[e.jsx(m,{id:"semiannual",type:"number",min:"0",max:"100",value:r.semiannual_discount_percent,onChange:s=>l("semiannual_discount_percent",parseInt(s.target.value)||0)}),e.jsx("span",{className:"absolute right-3 top-2.5 text-xs font-bold text-gray-400",children:"%"})]})]}),e.jsxs("div",{className:"flex-1 pt-4",children:[e.jsx("div",{className:"text-[0.7rem] text-gray-500 uppercase tracking-tight",children:"Precio Final / periodo"}),e.jsx("div",{className:"font-bold text-green-700 text-lg",children:new Intl.NumberFormat("es-CO",{style:"currency",currency:r.currency}).format(S(6,r.semiannual_discount_percent))})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"w-40 flex-shrink-0 flex flex-col gap-1.5",children:[e.jsx(c,{htmlFor:"yearly",className:"text-xs text-gray-500 uppercase",children:"Anual (-%)"}),e.jsxs("div",{className:"relative mt-0.5",children:[e.jsx(m,{id:"yearly",type:"number",min:"0",max:"100",value:r.yearly_discount_percent,onChange:s=>l("yearly_discount_percent",parseInt(s.target.value)||0)}),e.jsx("span",{className:"absolute right-3 top-2.5 text-xs font-bold text-gray-400",children:"%"})]})]}),e.jsxs("div",{className:"flex-1 pt-4",children:[e.jsx("div",{className:"text-[0.7rem] text-gray-500 uppercase tracking-tight",children:"Precio Final / periodo"}),e.jsx("div",{className:"font-bold text-green-700 text-lg",children:new Intl.NumberFormat("es-CO",{style:"currency",currency:r.currency}).format(S(12,r.yearly_discount_percent))})]})]})]})]})})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs(f,{className:"h-full",children:[e.jsxs(v,{children:[e.jsx(_,{children:"Características (Features)"}),e.jsx(N,{children:"Lista de beneficios que verá el usuario."})]}),e.jsxs(y,{className:"space-y-4",children:[r.features.map((s,a)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{value:s,onChange:t=>R(a,t.target.value),placeholder:`Característica #${a+1}`}),e.jsx(j,{type:"button",variant:"ghost",size:"icon",onClick:()=>z(a),disabled:r.features.length===1,children:e.jsx(le,{className:"h-4 w-4 text-red-400"})})]},a)),e.jsxs(j,{type:"button",variant:"outline",size:"sm",onClick:U,className:"w-full border-dashed",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"})," Agregar Característica"]}),e.jsx(p,{children:u.features})]})]})}),e.jsx("div",{className:"space-y-6",children:e.jsxs(f,{children:[e.jsx(v,{children:e.jsx(_,{children:"Configuración"})}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx(c,{children:"Días de Prueba Gratis"}),e.jsx(m,{type:"number",min:"0",value:r.trial_days,onChange:s=>l("trial_days",parseInt(s.target.value)||0)})]}),e.jsxs("div",{className:"flex items-center justify-between border p-3 rounded-lg",children:[e.jsx(c,{htmlFor:"no-payment",className:"text-sm cursor-pointer",children:"Sin Tarjeta Requerida"}),e.jsx(b,{id:"no-payment",checked:r.no_initial_payment_required,onCheckedChange:s=>l("no_initial_payment_required",s)})]}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx(c,{children:"Nivel de Soporte"}),e.jsxs(I,{value:r.support_level,onValueChange:s=>l("support_level",s),children:[e.jsx(L,{children:e.jsx(O,{})}),e.jsxs(E,{children:[e.jsx(g,{value:"basic",children:"Básico (Email)"}),e.jsx(g,{value:"priority",children:"Prioritario (24h)"}),e.jsx(g,{value:"dedicated",children:"Dedicado (WhatsApp)"})]})]})]}),e.jsx(X,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(c,{className:"cursor-pointer",htmlFor:"public",children:"Público"}),e.jsx(b,{id:"public",checked:r.is_public,onCheckedChange:s=>l("is_public",s)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(c,{className:"cursor-pointer",htmlFor:"featured",children:"Plan Destacado"}),e.jsx(b,{id:"featured",checked:r.is_featured,onCheckedChange:s=>l("is_featured",s)})]}),r.is_featured&&e.jsxs("div",{className:"flex flex-col gap-1.5 pt-2 animate-in fade-in slide-in-from-top-1",children:[e.jsx(c,{children:"Texto Destacado"}),e.jsx(m,{value:r.highlight_text,onChange:s=>l("highlight_text",s.target.value),placeholder:"Ej. Más Popular"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(c,{className:"cursor-pointer",htmlFor:"custom-slug",children:"Slug Personalizado"}),e.jsx(b,{id:"custom-slug",checked:r.allow_custom_slug,onCheckedChange:s=>l("allow_custom_slug",s)})]})]})]})})]}),e.jsxs(f,{children:[e.jsxs(v,{children:[e.jsx(_,{children:"Permisos de Módulos"}),e.jsx(N,{children:"Define qué módulos del sidebar estarán activos para este plan y sus límites."})]}),e.jsxs(y,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Object.keys(F).length>0?Object.entries(F).map(([s,a])=>e.jsxs("div",{className:"flex items-center gap-3 border p-3 rounded-lg hover:bg-slate-50 transition-colors",children:[e.jsx(Z,{id:`mod-${s}`,checked:a,onCheckedChange:t=>B(s,t)}),e.jsx(c,{htmlFor:`mod-${s}`,className:"cursor-pointer text-sm font-medium leading-none flex-1",children:re[s]||s}),q[s]&&e.jsx(m,{type:"number",min:0,placeholder:"∞",className:"w-20 h-8 text-xs text-center",value:T[s]||"",onChange:t=>K(s,t.target.value),title:q[s],disabled:!a})]},s)):e.jsx("p",{className:"text-sm text-gray-500 col-span-full",children:"No se detectaron módulos para esta vertical. Intenta cambiar la vertical para recargar los valores por defecto."})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-3",children:"Los campos numéricos definen el máximo permitido. Vacío = ilimitado."})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4",children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>window.history.back(),children:"Cancelar"}),e.jsx(j,{type:"submit",disabled:D,className:"min-w-[150px]",children:D?"Guardando...":"Actualizar Plan"})]})]})]})]})}export{Ps as default};
