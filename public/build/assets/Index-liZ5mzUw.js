import{c as be,r as c,t as R,a as k,j as e,H as je}from"./app-DC0VdX9s.js";import{A as ge}from"./AdminLayout-Dzjitp-M.js";import{C as re,a as Ne,d as ve,e as ye}from"./card-Ctcbb2M4.js";import{B as N}from"./button-CwaftRC9.js";import{B as p}from"./badge-DFjV9KOO.js";import{S as we}from"./scroll-area-BSLQcsoD.js";import{I as _e}from"./input-DycfGEDM.js";import{S as J,a as Z,b as ee,c as se,d as y}from"./select-DSPRbMko.js";import{D as Ce,a as ke,b as Se,c as Ae,d as Te}from"./dialog-BgrajDqf.js";import{A as Ee,a as $e,b as De,c as Pe,d as Me,e as Le,f as Ie,g as Be}from"./alert-dialog-aPMYaqyp.js";import{T as Oe,a as Ve,b as z,c as h,d as qe,e as x}from"./table-D7wH3Ebt.js";import{f as b,R as Fe}from"./currency-SDXQbMYw.js";import{P as Re}from"./dropdown-menu-DQ3ZhwFW.js";import{B as te}from"./building-2-BykyQWMA.js";import{F as ze}from"./funnel-CHa8SDPF.js";import{S as Ue}from"./search-Lvq2PmNZ.js";import{c as B}from"./createLucideIcon-DJ4NDwYV.js";import{S as Ge}from"./shopping-bag-C6Zaioqk.js";import{U}from"./utensils-Bwnb85mG.js";import{E as He}from"./eye-Bt8lf5RY.js";import{L as M}from"./loader-circle-BsvfhnNb.js";import{U as ne}from"./user-CvUPnKZS.js";import{M as We}from"./map-pin-N8LTMDOp.js";import{S as Xe}from"./sticky-note-Cdlm-Jh9.js";import{C as Qe}from"./credit-card-Br8ESLwS.js";import{C as Ke}from"./clock-BVGW0r2l.js";import{B as Ye}from"./ban-rZ6qqRdC.js";import{C as Je}from"./circle-check-C5cvU04D.js";import"./utils-DBZkxVr1.js";import"./progress-CWUpZELJ.js";import"./index-DFaq0Ini.js";import"./index-BmeUzyeu.js";import"./menuConfig-CKxoUB1h.js";import"./video-MJZj3Bpt.js";import"./chef-hat-BD-YlOcT.js";import"./table-CXHlPgh7.js";import"./banknote-oh6wB0_E.js";import"./star-Ccup-E-P.js";import"./users-Cgy2ffiO.js";import"./calendar-check-D7EtMSGq.js";import"./calendar-BN8FUoZ8.js";import"./briefcase-D8fTsXA3.js";import"./truck-88x5atPF.js";import"./message-circle-dn3KuYwe.js";import"./package-BYrkzaAT.js";import"./layout-dashboard-CvWgsk9y.js";import"./badge-check-BS0cRFCH.js";import"./lock-DkNijD7J.js";import"./chevron-right-PTgBRbQi.js";import"./sparkles-DvAZDr9v.js";import"./separator-BvfwgiHl.js";import"./external-link-B-C3sQPA.js";import"./chevron-down-DoRy1-En.js";import"./headphones-FLe6YHx9.js";import"./shield-BUqaht8L.js";import"./sonner-CJs5tr0z.js";import"./index-CzsG3l2v.js";import"./index-D2N1-uIE.js";import"./index-CSYYB_ev.js";import"./index-BdQq_4o_.js";import"./index-BfEwHv9F.js";import"./index-0coVNd7N.js";import"./index-DnYW8pH5.js";import"./index-CfjIlq6E.js";import"./index-DdpLosxE.js";import"./index-CO4p0QfG.js";import"./check-CDE1QUCE.js";import"./chevron-up-CH3XZgRm.js";import"./x-B_AiqYVR.js";import"./trash-2-BoAeUuPT.js";import"./sheet-DMF7JpR0.js";import"./index-B8PFW4lY.js";import"./index-rHpqUtkR.js";const Ze=[["circle",{cx:"18.5",cy:"17.5",r:"3.5",key:"15x4ox"}],["circle",{cx:"5.5",cy:"17.5",r:"3.5",key:"1noe27"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["path",{d:"M12 17.5V14l-3-3 4-3 2 3h2",key:"1npguv"}]],es=B("bike",Ze);const ss=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m12 8-4 4 4 4",key:"15vm53"}],["path",{d:"M16 12H8",key:"1fr5h0"}]],ts=B("circle-arrow-left",ss);const as=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],L=B("clipboard-list",as);const ls=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],rs=B("history",ls),u={pending:{label:"Pendiente",color:"bg-yellow-100 text-yellow-700 border-yellow-300",kanbanColor:"bg-yellow-50 border-yellow-200"},confirmed:{label:"Confirmado",color:"bg-blue-100 text-blue-700 border-blue-300",kanbanColor:"bg-blue-50 border-blue-200"},preparing:{label:"En Cocina",color:"bg-orange-100 text-orange-700 border-orange-300",kanbanColor:"bg-orange-50 border-orange-200"},ready:{label:"Listo",color:"bg-purple-100 text-purple-700 border-purple-300",kanbanColor:"bg-purple-50 border-purple-200"},completed:{label:"Entregado",color:"bg-green-100 text-green-700 border-green-300",kanbanColor:"bg-green-50 border-green-200"},cancelled:{label:"Cancelado",color:"bg-red-100 text-red-700 border-red-300",kanbanColor:"bg-red-50 border-red-200"}},I={dine_in:{label:"Mesa",icon:U},takeout:{label:"Para Llevar",icon:Ge},delivery:{label:"Domicilio",icon:es}},ae={cash:"Efectivo",bank_transfer:"Transferencia",transfer:"Transferencia",card:"Tarjeta",dataphone:"Datáfono"},w={pending:{status:"confirmed",label:"Confirmar",color:"bg-blue-600 hover:bg-blue-700"},confirmed:{status:"preparing",label:"A Cocina",color:"bg-orange-500 hover:bg-orange-600"},preparing:{status:"ready",label:"Listo",color:"bg-purple-600 hover:bg-purple-700"},ready:{status:"completed",label:"Entregar",color:"bg-green-600 hover:bg-green-700"}};function kt({tenant:n,orders:d,isHistory:o,locations:_,currentLocationId:S}){const{currentUserRole:m}=be().props,[j,G]=c.useState(!1),[H,W]=c.useState(d.data||[]),[a,A]=c.useState(null),[ie,O]=c.useState(!1),[oe,X]=c.useState(!1),[C,Q]=c.useState(null),[f,v]=c.useState(null),[T,ce]=c.useState(""),de=s=>m?m.is_owner===!0||Array.isArray(m.permissions)&&m.permissions.includes("*")||Array.isArray(m.permissions)&&m.permissions.includes(s):!1,E=(s,t)=>{de(s)?t():G(!0)},[$,me]=c.useState("all"),[xe,pe]=c.useState(!1);c.useEffect(()=>{const s=setTimeout(()=>pe(!0),300);return()=>clearTimeout(s)},[]),c.useEffect(()=>{W(d.data||[])},[d]),c.useEffect(()=>{if(o)return;const s=window.Echo;if(!s?.connector||!n.id)return;const t=`tenant.${n.id}.orders`;try{s.channel(t).listen(".order.created",r=>{const i=r;he(),R.success(i.message||`Nuevo pedido #${i.id}`,{id:`new-order-${i.id}`,duration:15e3,description:`${i.customer_name} — ${b(Number(i.total)||0)}`,style:{background:"#eff6ff",border:"2px solid #3b82f6",fontWeight:"bold"}}),k.reload({only:["orders"]})})}catch(l){console.error("Error subscribing to Echo channel:",l)}return()=>{try{s.leave(t)}catch{}}},[n.id,o]);const he=()=>{try{const s=window.AudioContext||window.webkitAudioContext,t=new s;[830,1046,1318].forEach((r,i)=>{const g=t.createOscillator(),P=t.createGain();g.type="sine",g.frequency.value=r,P.gain.setValueAtTime(.4,t.currentTime+i*.18),P.gain.exponentialRampToValueAtTime(.01,t.currentTime+i*.18+.3),g.connect(P),P.connect(t.destination),g.start(t.currentTime+i*.18),g.stop(t.currentTime+i*.18+.3)})}catch{}},V=c.useMemo(()=>{let s=H;if(T.trim()){const t=T.toLowerCase();s=s.filter(l=>l.customer_name?.toLowerCase().includes(t)||l.customer_phone?.includes(t)||l.ticket_number?.toLowerCase().includes(t)||String(l.id).includes(t))}return $!=="all"&&(s=s.filter(t=>t.service_type===$)),s},[H,T,$]),q=s=>{const t=V.filter(l=>l.status===s);return s==="completed"?t.slice(0,5):t},ue=(s,t)=>{Q(s),k.post(route("tenant.admin.gastronomy.orders.update-status",{tenant:n.slug,order:s}),{status:t},{preserveScroll:!0,onSuccess:()=>{R.success("Estado actualizado"),W(l=>l.map(r=>r.id===s?{...r,status:t}:r)),O(!1),A(null),v(null)},onError:l=>{const r=l.status||l.order||"Error al actualizar estado";R.error(typeof r=="string"?r:"Error al actualizar estado")},onFinish:()=>Q(null)})},D=async s=>{A(s),O(!0),X(!0);try{const t=await fetch(route("tenant.admin.gastronomy.orders.show",{tenant:n.slug,order:s.id}),{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(t.ok){const l=await t.json();A(l)}}catch{}finally{X(!1)}},fe=s=>{const t={tenant:n.slug};s!=="all"&&(t.location_id=s),o&&(t.history="1"),k.visit(route("tenant.admin.gastronomy.orders.index",t))},F=[{id:"pending",title:"Pendientes"},{id:"confirmed",title:"Confirmados"},{id:"preparing",title:"En Cocina"},{id:"ready",title:"Listos"},{id:"completed",title:"Entregados"}],K=({type:s})=>{const t=I[s];if(!t)return e.jsx(L,{className:"w-4 h-4"});const l=t.icon;return e.jsx(l,{className:"w-4 h-4"})},Y=s=>{const t=Math.floor((Date.now()-new Date(s).getTime())/6e4);return t<1?"Ahora":t<60?`${t}m`:`${Math.floor(t/60)}h ${t%60}m`};return e.jsxs(ge,{title:"Gestión de Pedidos",breadcrumbs:[{label:"Gastronomía"},{label:"Pedidos"}],maxwidth:"max-w-[2000px]",children:[e.jsx(je,{title:"Gestión de Pedidos"}),e.jsxs("div",{className:"p-4 md:p-6 h-[calc(100vh-80px)] flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold tracking-tight text-slate-900",children:o?"Historial de Pedidos":"Tablero de Pedidos"}),e.jsx("p",{className:"text-sm text-slate-500",children:o?"Consulta pedidos antiguos y cancelados.":"Gestiona tus pedidos en tiempo real."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[_.length>1&&e.jsxs(J,{value:S?String(S):"all",onValueChange:fe,children:[e.jsxs(Z,{className:"w-[180px] h-9",children:[e.jsx(te,{className:"w-4 h-4 mr-1 text-slate-400"}),e.jsx(ee,{placeholder:"Todas las sedes"})]}),e.jsxs(se,{children:[e.jsx(y,{value:"all",children:"Todas las sedes"}),_.map(s=>e.jsx(y,{value:String(s.id),children:s.name},s.id))]})]}),e.jsxs(J,{value:$,onValueChange:me,children:[e.jsxs(Z,{className:"w-[150px] h-9",children:[e.jsx(ze,{className:"w-4 h-4 mr-1 text-slate-400"}),e.jsx(ee,{})]}),e.jsxs(se,{children:[e.jsx(y,{value:"all",children:"Todos"}),e.jsx(y,{value:"dine_in",children:"Mesa"}),e.jsx(y,{value:"takeout",children:"Para Llevar"}),e.jsx(y,{value:"delivery",children:"Domicilio"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ue,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-slate-400"}),e.jsx(_e,{placeholder:"Buscar ticket, nombre, tel...",value:T,onChange:s=>ce(s.target.value),className:"pl-9 h-9 w-[200px]"})]}),e.jsxs(N,{variant:o?"outline":"secondary",size:"sm",onClick:()=>k.visit(route("tenant.admin.gastronomy.orders.index",{tenant:n.slug,history:o?"0":"1"})),className:"gap-1.5",children:[o?e.jsx(ts,{className:"w-4 h-4"}):e.jsx(rs,{className:"w-4 h-4"}),o?"Tablero":"Historial"]})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden bg-slate-50/50 rounded-xl border border-slate-200",children:xe?o?e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"flex-1 overflow-auto p-4",children:e.jsx(re,{children:e.jsxs(Oe,{children:[e.jsx(Ve,{children:e.jsxs(z,{children:[e.jsx(h,{className:"w-[90px]",children:"Ticket"}),e.jsx(h,{children:"Fecha"}),e.jsx(h,{children:"Cliente"}),e.jsx(h,{children:"Tipo"}),e.jsx(h,{children:"Sede"}),e.jsx(h,{children:"Estado"}),e.jsx(h,{children:"Pago"}),e.jsx(h,{className:"text-right",children:"Total"}),e.jsx(h,{className:"text-center w-[80px]",children:"Ver"})]})}),e.jsx(qe,{children:V.length===0?e.jsx(z,{children:e.jsxs(x,{colSpan:9,className:"text-center h-32 text-slate-400",children:[e.jsx(L,{className:"w-8 h-8 mx-auto mb-2 opacity-40"}),"Sin pedidos en el historial."]})}):V.map(s=>{const t=u[s.status]||u.pending;return e.jsxs(z,{className:"cursor-pointer hover:bg-slate-50",onClick:()=>D(s),children:[e.jsx(x,{className:"font-bold font-mono",children:s.ticket_number||`#${s.id}`}),e.jsx(x,{className:"text-xs text-slate-500",children:new Date(s.created_at).toLocaleString("es-CO")}),e.jsxs(x,{children:[e.jsx("div",{className:"font-medium text-sm",children:s.customer_name}),s.customer_phone&&e.jsx("div",{className:"text-xs text-slate-400",children:s.customer_phone})]}),e.jsx(x,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(K,{type:s.service_type}),I[s.service_type]?.label||s.service_type]})}),e.jsx(x,{className:"text-xs text-slate-500",children:s.location?.name||"—"}),e.jsx(x,{children:e.jsx(p,{variant:"outline",className:`text-[10px] ${t.color}`,children:t.label})}),e.jsxs(x,{className:"text-xs",children:[!!s.waiter_collected&&e.jsx(p,{variant:"outline",className:"text-[10px] bg-emerald-50 text-emerald-700 border-emerald-300",children:"Mesero"}),!s.waiter_collected&&s.payment_method&&e.jsx("span",{children:ae[s.payment_method]||s.payment_method})]}),e.jsx(x,{className:"text-right font-bold",children:b(Number(s.total))}),e.jsx(x,{className:"text-center",children:e.jsx(N,{variant:"ghost",size:"sm",onClick:l=>{l.stopPropagation(),D(s)},children:e.jsx(He,{className:"w-4 h-4"})})})]},s.id)})})]})})}),d.last_page>1&&e.jsxs("div",{className:"p-3 border-t border-slate-200 bg-white flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-slate-500",children:[d.from," – ",d.to," de ",d.total]}),e.jsx("div",{className:"flex gap-1",children:d.links.map((s,t)=>{let l=s.label;return(l.includes("previous")||l.includes("Previous")||l.includes("laquo"))&&(l="← Anterior"),(l.includes("next")||l.includes("Next")||l.includes("raquo"))&&(l="Siguiente →"),l=l.replace(/&laquo;|&raquo;|pagination\./g,"").trim(),e.jsx(N,{variant:s.active?"default":"outline",size:"sm",disabled:!s.url,onClick:()=>s.url&&k.visit(s.url),className:"h-8 px-3 text-xs",children:l},t)})})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"md:hidden p-3",children:[e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:F.map(s=>{const t=q(s.id).length;return e.jsxs(N,{variant:"outline",size:"sm",className:`flex-shrink-0 gap-1 ${u[s.id].color}`,onClick:()=>{document.getElementById(`kanban-mobile-${s.id}`)?.scrollIntoView({behavior:"smooth"})},children:[s.title," ",e.jsx(p,{variant:"secondary",className:"ml-1 h-5 px-1.5 text-[10px]",children:t})]},s.id)})}),e.jsx("div",{className:"space-y-6 mt-2",children:F.map(s=>{const t=q(s.id);return e.jsxs("div",{id:`kanban-mobile-${s.id}`,children:[e.jsxs("h3",{className:`text-sm font-bold px-2 py-1 rounded mb-2 ${u[s.id].color}`,children:[s.title," (",t.length,")"]}),t.length===0?e.jsx("p",{className:"text-center text-xs text-slate-400 py-4 italic",children:"Sin pedidos"}):e.jsx("div",{className:"space-y-2",children:t.map(l=>e.jsx(le,{order:l,onView:()=>D(l),onAction:(r,i)=>E("orders.update",()=>v({orderId:l.id,status:r,label:i})),processing:C===l.id,getElapsed:Y},l.id))})]},s.id)})})]}),e.jsx("div",{className:"hidden md:flex flex-1 overflow-x-auto h-full p-4",children:e.jsx("div",{className:"flex gap-3 h-full w-full",children:F.map(s=>{const t=q(s.id),l=u[s.id];return e.jsxs("div",{className:`flex-1 min-w-[220px] flex flex-col rounded-xl border ${l.kanbanColor} h-full`,children:[e.jsxs("div",{className:`p-3 border-b font-bold text-sm flex justify-between items-center rounded-t-xl ${l.color}`,children:[e.jsx("span",{children:s.title}),e.jsx(p,{variant:"secondary",className:"bg-white/70 text-xs",children:t.length})]}),e.jsx(we,{className:"flex-1 p-2",children:e.jsxs("div",{className:"space-y-2",children:[t.map(r=>e.jsx(le,{order:r,onView:()=>D(r),onAction:(i,g)=>E("orders.update",()=>v({orderId:r.id,status:i,label:g})),processing:C===r.id,getElapsed:Y},r.id)),t.length===0&&e.jsxs("div",{className:"text-center py-10 text-slate-400",children:[e.jsx(L,{className:"w-8 h-8 mx-auto mb-2 opacity-30"}),e.jsx("p",{className:"text-xs italic",children:"Sin pedidos"})]})]})})]},s.id)})})})]}):e.jsx("div",{className:"flex gap-4 p-4 h-full",children:[1,2,3,4,5].map(s=>e.jsx("div",{className:"flex-1 min-w-[200px] bg-slate-100 rounded-xl animate-pulse"},s))})})]}),e.jsx(Ee,{open:!!f,onOpenChange:s=>{s||v(null)},children:e.jsxs($e,{children:[e.jsxs(De,{children:[e.jsxs(Pe,{children:['¿Cambiar estado a "',f?.label,'"?']}),e.jsx(Me,{children:f?.status==="cancelled"?"Esta acción cancelará el pedido. El cliente será notificado.":"El estado del pedido cambiará y se notificará al cliente."})]}),e.jsxs(Le,{children:[e.jsx(Ie,{children:"Volver"}),e.jsxs(Be,{className:f?.status==="cancelled"?"bg-red-600 hover:bg-red-700":"bg-blue-600 hover:bg-blue-700",onClick:()=>f&&ue(f.orderId,f.status),children:[C?e.jsx(M,{className:"w-4 h-4 mr-2 animate-spin"}):null,"Sí, ",f?.label]})]})]})}),e.jsx(Ce,{open:ie,onOpenChange:s=>{s||(O(!1),A(null))},children:e.jsx(ke,{className:"max-w-lg p-0 overflow-hidden max-h-[90vh]",children:a&&e.jsxs("div",{className:"flex flex-col max-h-[90vh]",children:[e.jsx("div",{className:"p-5 border-b border-slate-100 bg-slate-50",children:e.jsxs(Se,{children:[e.jsxs(Ae,{className:"flex items-center gap-2 text-lg",children:[e.jsx(Fe,{className:"w-5 h-5 text-slate-600"}),"Pedido ",a.ticket_number||`#${a.id}`]}),e.jsxs(Te,{className:"flex items-center gap-3 mt-1",children:[e.jsx("span",{className:"text-xs",children:new Date(a.created_at).toLocaleString("es-CO")}),e.jsx(p,{variant:"outline",className:`text-[10px] ${u[a.status]?.color||""}`,children:u[a.status]?.label||a.status}),e.jsxs("span",{className:"text-xs flex items-center gap-1",children:[e.jsx(K,{type:a.service_type}),I[a.service_type]?.label]})]})]})}),e.jsxs("div",{className:"overflow-y-auto flex-1 p-5 space-y-4",children:[e.jsxs("div",{className:"bg-slate-50 p-3 rounded-lg space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-slate-400"}),e.jsx("span",{className:"font-bold",children:a.customer_name})]}),a.customer_phone&&e.jsx("p",{className:"text-sm text-slate-500 ml-6",children:a.customer_phone}),a.table&&e.jsxs("p",{className:"text-sm text-slate-500 ml-6 flex items-center gap-1",children:[e.jsx(U,{className:"w-3 h-3"})," ",a.table.name]}),a.location&&e.jsxs("p",{className:"text-sm text-slate-500 ml-6 flex items-center gap-1",children:[e.jsx(te,{className:"w-3 h-3"})," ",a.location.name]}),a.creator&&e.jsxs("p",{className:"text-xs text-slate-400 ml-6",children:["Creado por: ",a.creator.name]}),a.delivery_address&&e.jsxs("p",{className:"text-sm text-slate-500 ml-6 flex items-center gap-1",children:[e.jsx(We,{className:"w-3 h-3"}),a.delivery_address.neighborhood," — ",a.delivery_address.address]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-bold uppercase text-slate-500 mb-2",children:"Productos"}),e.jsx("div",{className:"space-y-1",children:a.items?.map(s=>{const t=s.status==="cancelled",l=s.variant_options?Array.isArray(s.variant_options)?s.variant_options:Object.values(s.variant_options):[];return e.jsxs("div",{className:`flex justify-between items-start py-2 px-2 rounded-lg ${t?"bg-red-50 opacity-60":"hover:bg-slate-50"}`,children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold bg-slate-100 w-6 h-6 flex items-center justify-center rounded-full text-xs flex-shrink-0",children:s.quantity}),e.jsxs("div",{children:[e.jsx("span",{className:`text-sm font-medium ${t?"line-through text-red-500":"text-slate-900"}`,children:s.product?.name||s.product_name}),t&&e.jsx(p,{variant:"destructive",className:"ml-2 text-[9px] h-4",children:"Anulado"}),l.length>0&&e.jsx("div",{className:"text-[11px] text-slate-500 mt-0.5",children:l.map((r,i)=>e.jsxs("span",{children:[r.name||r.group_name,": ",r.value||r.option_name,r.price&&Number(r.price)>0?` (+${b(Number(r.price))})`:"",i<l.length-1?" · ":""]},i))}),s.notes&&e.jsxs("p",{className:"text-[11px] text-amber-600 flex items-center gap-1 mt-0.5",children:[e.jsx(Xe,{className:"w-3 h-3"})," ",s.notes]})]})]}),e.jsx("span",{className:`text-sm font-mono font-semibold flex-shrink-0 ${t?"line-through text-red-400":"text-slate-700"}`,children:b(Number(s.total))})]},s.id)})}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-200 space-y-1",children:[a.subtotal&&e.jsxs("div",{className:"flex justify-between text-sm text-slate-500",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:b(Number(a.subtotal))})]}),a.tax_amount&&Number(a.tax_amount)>0&&e.jsxs("div",{className:"flex justify-between text-sm text-slate-500",children:[e.jsx("span",{children:"Impuestos"}),e.jsx("span",{children:b(Number(a.tax_amount))})]}),e.jsxs("div",{className:"flex justify-between font-black text-lg",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:b(Number(a.total))})]})]})]}),(a.payment_method||!!a.waiter_collected)&&e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg space-y-1",children:[e.jsx("h4",{className:"text-xs font-bold uppercase text-blue-600",children:"Información de Pago"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Qe,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"font-semibold",children:ae[a.payment_method||""]||a.payment_method||"No especificado"})]}),!!a.waiter_collected&&e.jsx(p,{variant:"outline",className:"bg-emerald-50 text-emerald-700 border-emerald-300 text-[10px]",children:"Cobrado por Mesero"}),a.payment_reference&&e.jsxs("p",{className:"text-xs text-slate-500",children:["Ref: ",a.payment_reference]})]}),a.payment_proof_url&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-bold uppercase text-slate-500 mb-1",children:"Comprobante"}),e.jsx("a",{href:a.payment_proof_url,target:"_blank",rel:"noopener noreferrer",className:"block rounded-lg overflow-hidden border border-slate-200 hover:border-blue-400 transition-colors",children:e.jsx("img",{src:a.payment_proof_url,alt:"Comprobante",className:"w-full max-h-48 object-contain bg-slate-100"})})]}),a.status_history&&a.status_history.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-bold uppercase text-slate-500 mb-2",children:"Historial de Estados"}),e.jsx("div",{className:"space-y-1",children:a.status_history.map(s=>e.jsxs("div",{className:"flex items-start gap-2 text-xs text-slate-600 py-1",children:[e.jsx(Ke,{className:"w-3 h-3 mt-0.5 text-slate-400 flex-shrink-0"}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-semibold",children:[s.from_status?`${u[s.from_status]?.label||s.from_status} → `:"",u[s.to_status]?.label||s.to_status]}),s.user&&e.jsxs("span",{className:"text-slate-400",children:[" — ",s.user.name]}),e.jsx("span",{className:"text-slate-400 ml-1",children:new Date(s.created_at).toLocaleString("es-CO")}),s.notes&&e.jsx("p",{className:"text-slate-500 italic",children:s.notes})]})]},s.id))})]}),oe&&e.jsxs("div",{className:"flex items-center justify-center py-4 text-slate-400 gap-2",children:[e.jsx(M,{className:"w-4 h-4 animate-spin"})," Cargando detalle..."]})]}),e.jsxs("div",{className:"p-4 border-t border-slate-100 bg-slate-50 flex gap-2",children:[w[a.status]&&e.jsxs(N,{className:`flex-1 h-10 font-bold text-white ${w[a.status].color}`,disabled:C===a.id,onClick:()=>E("orders.update",()=>v({orderId:a.id,status:w[a.status].status,label:w[a.status].label})),children:[C===a.id?e.jsx(M,{className:"w-4 h-4 mr-2 animate-spin"}):null,w[a.status].label]}),a.status!=="completed"&&a.status!=="cancelled"&&e.jsxs(N,{variant:"outline",className:"h-10 border-red-200 text-red-600 hover:bg-red-50",onClick:()=>E("orders.update",()=>v({orderId:a.id,status:"cancelled",label:"Cancelar"})),children:[e.jsx(Ye,{className:"w-4 h-4 mr-1"})," Cancelar"]})]})]})})}),e.jsx(Re,{open:j,onOpenChange:G})]})}function le({order:n,onView:d,onAction:o,processing:_,getElapsed:S}){const m=w[n.status];return e.jsxs(re,{className:"cursor-pointer hover:shadow-md transition-all border-slate-200 overflow-hidden",onClick:d,children:[e.jsx(Ne,{className:"p-3 pb-1.5 space-y-0",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs(p,{variant:"outline",className:"h-5 gap-1 pl-1 pr-2 text-[10px]",children:[e.jsx(ns,{type:n.service_type}),n.ticket_number||`#${n.id}`]}),e.jsx("span",{className:"text-[10px] text-slate-400 font-mono",children:S(n.created_at)})]}),!!n.waiter_collected&&e.jsx(p,{variant:"outline",className:"text-[9px] bg-emerald-50 text-emerald-700 border-emerald-300 h-4",children:"Mesero"})]})}),e.jsxs(ve,{className:"p-3 py-1.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[e.jsx(ne,{className:"w-3 h-3 text-slate-400"}),e.jsx("span",{className:"text-sm font-medium truncate",children:n.customer_name})]}),n.table&&e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-slate-500",children:[e.jsx(U,{className:"w-3 h-3"})," ",n.table.name]}),e.jsx("div",{className:"text-[11px] text-slate-500 line-clamp-2 mt-1",children:n.items?.map(j=>`${j.quantity}x ${j.product?.name||j.product_name}`).join(", ")})]}),e.jsxs(ye,{className:"p-3 pt-1.5 flex justify-between items-center border-t border-slate-100 bg-slate-50/50",children:[e.jsx("span",{className:"font-bold text-sm",children:b(Number(n.total))}),m&&e.jsx(N,{size:"sm",className:`h-7 text-[11px] text-white ${m.color}`,disabled:_,onClick:j=>{j.stopPropagation(),o(m.status,m.label)},children:_?e.jsx(M,{className:"w-3 h-3 animate-spin"}):m.label}),n.status==="completed"&&e.jsxs(p,{variant:"outline",className:"text-[10px] bg-green-50 text-green-700 border-green-300",children:[e.jsx(Je,{className:"w-3 h-3 mr-0.5"}),"OK"]})]})]})}function ns({type:n}){const d=I[n];if(!d)return e.jsx(L,{className:"w-4 h-4"});const o=d.icon;return e.jsx(o,{className:"w-4 h-4"})}export{kt as default};
