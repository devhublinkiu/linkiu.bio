import{c as A,r as l,u as k,j as e,H as R}from"./app-Bo0l-nyL.js";import{S as B}from"./SuperAdminLayout-C--MnbTX.js";import{P as H}from"./dropdown-menu-BLdek0j6.js";import{C as M,a as F,b as I,c as L,d as O}from"./card-CLdEHqC0.js";import{T as q,a as V,b as h,c as t,d as G,e as s}from"./table-BukWaDUS.js";import{B as o}from"./badge-T_0PRSRY.js";import{B as d}from"./button-10Bc0E3d.js";import{D as W,a as X,b as $,c as J,d as K,e as Q}from"./dialog-NO27f9rI.js";import{L as N}from"./label-BvJxTSA7.js";import{T as C}from"./textarea-DtyekHu-.js";import{S as U}from"./Pagination-DKFmSjQ7.js";import{E as Y,a as Z,b as ee,c as re,d as se}from"./empty-Bya45bLo.js";import{f as ae}from"./format-Du31obhd.js";import{F as w}from"./file-text-BmlKQd1A.js";import{C as te}from"./circle-check-big-B5WRnMMs.js";import{C as oe}from"./circle-x-CrBdEz9E.js";import{e as ne}from"./es-BteQoBuv.js";import"./chevron-right-B4UhmXxg.js";import"./createLucideIcon-3AckdKRt.js";import"./chevrons-up-down-CDiH0g-q.js";import"./badge-check-DcDsd9yF.js";import"./ApplicationLogo-BrXO3AMH.js";import"./users-Cl7FA0jJ.js";import"./layout-grid-CS-h8BvL.js";import"./utils-DvD3N-9F.js";import"./index-Bj75TZ4c.js";import"./index-nKjDUAgZ.js";import"./index-CXl70Eho.js";import"./index-BaTs_s0z.js";import"./circle-check-D-62-mjA.js";import"./trash-2-CGD0dP--.js";import"./check-BxakoWLx.js";import"./credit-card-C_0EBMTX.js";import"./shopping-bag-ovPa-jWO.js";import"./input-BQLGMA-c.js";import"./separator-rnPeP9N4.js";import"./index-CS0_ycFC.js";import"./sheet-Bz3Lea4F.js";import"./x-0PRwyTAe.js";import"./index-UkxbaV1a.js";import"./index-Ce-cpEu5.js";import"./index-DU1na7Ze.js";import"./index-DlxfeT00.js";import"./index-DY8QIQU5.js";import"./index-BrTki0md.js";import"./index-Q_gv5oQO.js";import"./ellipsis-Dqcxt_C-.js";import"./chevron-left-D1zMcYAS.js";function sr({payments:c}){const{auth:P}=A().props,x=P.permissions||[],u=r=>x.includes("*")||x.includes(r),[D,p]=l.useState(!1),[j,g]=l.useState(null),[a,f]=l.useState(null),{data:b,setData:m,put:S,processing:v,errors:ie,reset:T}=k({action:"",notes:""}),[E,n]=l.useState(!1),y=(r,i)=>{if(!u("sa.payments.update")){p(!0);return}g(r),f(i),m({action:i,notes:""}),n(!0)},_=r=>{r.preventDefault(),j&&S(route("payments.update",j.id),{onSuccess:()=>{n(!1),T(),g(null),f(null)}})},z=r=>{switch(r){case"paid":return e.jsx(o,{className:"bg-green-100 text-green-700 border-green-200 hover:bg-green-100",children:"Pagado"});case"pending_review":return e.jsx(o,{variant:"secondary",className:"bg-yellow-100 text-yellow-700 border-yellow-200 hover:bg-yellow-100",children:"Revisión"});case"rejected":return e.jsx(o,{variant:"destructive",children:"Rechazado"});case"pending":return e.jsx(o,{variant:"outline",children:"Pendiente"});default:return e.jsx(o,{variant:"secondary",children:r})}};return e.jsxs(B,{header:"Gestión de Pagos",children:[e.jsx(H,{open:D,onOpenChange:p}),e.jsx(R,{title:"Pagos"}),e.jsx("div",{className:"max-w-7xl mx-auto py-6",children:e.jsxs(M,{children:[e.jsxs(F,{children:[e.jsx(I,{children:"Pagos Pendientes"}),e.jsx(L,{children:"Revisa y aprueba los reportes de pago de los planes."})]}),e.jsxs(O,{children:[e.jsxs(q,{children:[e.jsx(V,{children:e.jsxs(h,{children:[e.jsx(t,{children:"Fecha"}),e.jsx(t,{children:"Cliente"}),e.jsx(t,{children:"Plan"}),e.jsx(t,{children:"Valor"}),e.jsx(t,{children:"Comprobante"}),e.jsx(t,{children:"Estado"}),e.jsx(t,{className:"text-right",children:"Acciones"})]})}),e.jsx(G,{children:c.data.length>0?c.data.map(r=>e.jsxs(h,{children:[e.jsx(s,{children:ae(new Date(r.created_at),"dd MMM yyyy",{locale:ne})}),e.jsx(s,{children:e.jsx("div",{className:"font-medium text-sm",children:r.tenant?.name})}),e.jsx(s,{children:r.subscription?.plan?.name}),e.jsxs(s,{children:["$",Number(r.amount).toLocaleString()]}),e.jsx(s,{children:r.proof_of_payment_path?e.jsxs("a",{href:route("media.proxy",{path:r.proof_of_payment_path}),target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-blue-600 hover:underline",onClick:i=>{u("sa.payments.proof.view")||(i.preventDefault(),p(!0))},children:[e.jsx(w,{className:"w-4 h-4 mr-1.5"}),e.jsx("span",{className:"font-medium",children:"Ver comprobante"})]}):e.jsx("span",{className:"text-gray-400 text-xs italic",children:"Sin adjunto"})}),e.jsx(s,{children:z(r.status)}),e.jsx(s,{className:"text-right",children:r.status==="pending_review"&&e.jsxs("div",{className:"flex justify-end gap-1.5",children:[e.jsx(d,{size:"sm",variant:"outline",className:"h-8 w-8 p-0 text-green-600 hover:text-green-700 hover:bg-green-50 border-green-200",onClick:()=>y(r,"approve"),title:"Aprobar",children:e.jsx(te,{className:"w-4 h-4"})}),e.jsx(d,{size:"sm",variant:"outline",className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50 border-red-200",onClick:()=>y(r,"reject"),title:"Rechazar",children:e.jsx(oe,{className:"w-4 h-4"})})]})})]},r.id)):e.jsx(h,{children:e.jsx(s,{colSpan:7,className:"h-[400px]",children:e.jsxs(Y,{className:"h-full",children:[e.jsx(Z,{children:e.jsx("div",{className:"bg-gray-50 p-4 rounded-full mb-4",children:e.jsx(w,{className:"h-8 w-8 text-gray-400"})})}),e.jsxs(ee,{children:[e.jsx(re,{children:"No hay pagos pendientes"}),e.jsx(se,{children:"Todas las solicitudes de pago han sido procesadas o no hay registros aún."})]})]})})})})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(U,{links:c.links})})]})]})}),e.jsx(W,{open:E,onOpenChange:n,children:e.jsxs(X,{children:[e.jsxs($,{children:[e.jsx(J,{children:a==="approve"?"Aprobar Pago":"Rechazar Pago"}),e.jsx(K,{children:a==="approve"?"Al aprobar, la suscripción se extenderá automáticamente. ¿Confirmas que recibiste el dinero?":"Indica la razón del rechazo para que el cliente pueda corregirlo."})]}),e.jsxs("form",{onSubmit:_,className:"space-y-6 pt-4",children:[a==="reject"&&e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx(N,{children:"Motivo del rechazo"}),e.jsx(C,{placeholder:"Ej: No se ve el número de transferencia...",value:b.notes,onChange:r=>m("notes",r.target.value),required:!0})]}),a==="approve"&&e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx(N,{children:"Notas internas (opcional)"}),e.jsx(C,{placeholder:"Ej: Aprobado por Whatsapp...",value:b.notes,onChange:r=>m("notes",r.target.value)})]}),e.jsxs(Q,{children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>n(!1),children:"Cancelar"}),e.jsx(d,{type:"submit",disabled:v,variant:a==="approve"?"default":"destructive",className:a==="approve"?"bg-green-600 hover:bg-green-700":"",children:v?"Procesando...":a==="approve"?"Aprobar Pago":"Rechazar Pago"})]})]})]})})]})}export{sr as default};
