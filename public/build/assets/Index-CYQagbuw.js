import{c as L,r as g,u as I,j as e,H as $,t as o,a as P}from"./app-D9wldZxo.js";import{A as W}from"./AdminLayout-C86srUOQ.js";import{B as j}from"./button-Dadb_Lep.js";import{I as C}from"./input-rMsYcH4C.js";import{L as d}from"./label-DoqMNi9Z.js";import{T as J,a as K,b as F,c as m,d as Q,e as p}from"./table-B6cmMBvL.js";import{D as X,a as Y,b as Z,c as ee,d as se,e as re}from"./dialog-C0Lg02Tk.js";import{S as v,a as f,b as N,c as b,d as t}from"./select-Bbe1RuXu.js";import{P as ae,A as ie,j as oe,k as te,D as le,i as ne,l as ce,p as de}from"./dropdown-menu-C4-9o8Rw.js";import{B as U}from"./badge-DyYF213F.js";import{A as me,a as pe,b as ue,c as he,d as xe,e as ge,f as je,g as ve}from"./alert-dialog-BL6dXcRY.js";import{U as fe}from"./user-plus-DRZbgBZs.js";import{M as Ne}from"./mail-4iT3QRj0.js";import{U as be}from"./user-D9c6nVY3.js";import{S as we}from"./shield-BtuNH23d.js";import{B as k}from"./building-2-B_WRXADU.js";import{T as q}from"./trash-2-CMPgRqgc.js";import{E as De}from"./ellipsis-BfbyL5_C.js";import"./echo-CmTENghG.js";import"./utils-B0KHI9vB.js";import"./card-DbFVjWqh.js";import"./progress-D5NiGDeK.js";import"./index-DdTS5Ad2.js";import"./index-CZBSMaku.js";import"./menuConfig-GyORRgsI.js";import"./video-DRtFkuCB.js";import"./createLucideIcon-CJjlOp5I.js";import"./chef-hat-D6sEz8YW.js";import"./table-rgWYlWzZ.js";import"./map-pin-Du3W4-OO.js";import"./banknote-DTNMynPY.js";import"./star-D-Iirb7f.js";import"./users-OjDIvTV8.js";import"./calendar-check-fjlZrFwy.js";import"./calendar-BW0rhnMu.js";import"./briefcase-Crq0rSJT.js";import"./truck-Db-Ebch9.js";import"./message-circle-DrNrCoj8.js";import"./credit-card-CPDlDYf1.js";import"./package-BPq1-jLc.js";import"./shopping-bag-CQGcPT0-.js";import"./layout-dashboard-BqLojFjH.js";import"./badge-check-CEpGdEtW.js";import"./lock-BHZn93rL.js";import"./chevron-right-BSwXEIvG.js";import"./sparkles-JbdQIbjf.js";import"./separator-L5pP8n2q.js";import"./external-link-pORnC0H4.js";import"./chevron-down-Dux0wLDw.js";import"./headphones-DD_UyCnk.js";import"./sonner-DQ2kSMfY.js";import"./index-BDWpq_YI.js";import"./index-BrcTw33p.js";import"./index-BMdzuiHN.js";import"./index-tfOuMV4B.js";import"./x-dvUxMxq3.js";import"./index-BdQq_4o_.js";import"./index-fFU5c_p6.js";import"./index-Dvu8qGWr.js";import"./index-CbR7iZJO.js";import"./index-DeHGgcwY.js";import"./index--Jev_GdI.js";import"./check-BAxbGpAF.js";import"./chevron-up-IlwuOcq-.js";import"./circle-check-CN90YBLh.js";import"./sheet-BP6KOnln.js";import"./index-CXzOyCXW.js";import"./index-D4lOZYra.js";function Os({members:B,roles:y,locations:A,currentTenant:w}){const{currentUserRole:u}=L().props,[V,D]=g.useState(!1),[Se,_e]=g.useState(null),[h,S]=g.useState(null),[H,x]=g.useState(!1),i=s=>u?u.is_owner||u.permissions.includes("*")||u.permissions.includes(s):!1,l=(s,r)=>{i(s)?r():x(!0)},{data:n,setData:c,post:O,processing:E,errors:a,reset:G,clearErrors:Ce}=I({email:"",name:"",password:"",role_id:"",location_id:""});I({role_id:""});const R=s=>{s.preventDefault(),l("users.create",()=>{O(route("tenant.members.store",{tenant:w?.slug}),{onSuccess:()=>{D(!1),G(),o.success("Miembro invitado correctamente")},onError:()=>{o.error("Error al invitar miembro")}})})},M=(s,r,_)=>{l("users.update",()=>{P.put(route("tenant.members.update",{tenant:w?.slug,member:s}),{role_id:r==="role_id"?_:void 0,location_id:r==="location_id"?_==="all"?null:_:void 0},{onSuccess:()=>o.success("Usuario actualizado"),onError:()=>o.error("Error al actualizar")})})},z=s=>{l("users.delete",()=>{P.delete(route("tenant.members.destroy",{tenant:w?.slug,member:s}),{onSuccess:()=>{o.success("Miembro eliminado"),S(null)},onError:()=>o.error("No se pudo eliminar al miembro")})})},T=()=>{l("users.create",()=>D(!0))};return e.jsxs(W,{title:"Equipo",children:[e.jsx($,{title:"Equipo"}),e.jsx(ae,{open:H,onOpenChange:x}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Equipo"}),e.jsx("p",{className:"text-slate-500",children:"Gestiona los miembros de tu equipo y sus permisos."})]}),e.jsxs(X,{open:V,onOpenChange:s=>{s?T():D(!1)},children:[e.jsxs(j,{className:"cursor-pointer ring-0 hover:ring-0 focus:ring-0",onClick:T,children:[e.jsx(fe,{className:"mr-2 h-4 w-4"}),"Agregar Miembro"]}),e.jsxs(Y,{className:"sm:max-w-[425px]",children:[e.jsxs(Z,{children:[e.jsx(ee,{children:"Agregar Nuevo Miembro"}),e.jsx(se,{children:"Invita a un usuario existente por su correo electrónico para unirse a tu equipo."})]}),e.jsxs("form",{onSubmit:R,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"email",children:"Correo Electrónico"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ne,{className:"absolute left-3 top-3 h-4 w-4 text-slate-400"}),e.jsx(C,{id:"email",type:"email",placeholder:"correo@ejemplo.com",className:"pl-9 ring-0 hover:ring-0 focus:ring-0",value:n.email,onChange:s=>c("email",s.target.value)})]}),a.email&&e.jsx("p",{className:"text-sm text-red-500",children:a.email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"name",children:"Nombre (Solo para nuevos usuarios)"}),e.jsxs("div",{className:"relative",children:[e.jsx(be,{className:"absolute left-3 top-3 h-4 w-4 text-slate-400"}),e.jsx(C,{id:"name",placeholder:"Nombre Completo",className:"pl-9 ring-0 hover:ring-0 focus:ring-0",value:n.name,onChange:s=>c("name",s.target.value)})]}),a.name&&e.jsx("p",{className:"text-sm text-red-500",children:a.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"password",children:"Contraseña (Solo para nuevos usuarios)"}),e.jsx(C,{id:"password",type:"password",placeholder:"******",className:"ring-0 hover:ring-0 focus:ring-0",value:n.password,onChange:s=>c("password",s.target.value)}),e.jsx("p",{className:"text-[10px] text-slate-500",children:"Si el usuario ya existe, estos campos se ignorarán."}),a.password&&e.jsx("p",{className:"text-sm text-red-500",children:a.password})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"role",children:"Rol Asignado"}),e.jsxs(v,{onValueChange:s=>c("role_id",s),value:n.role_id,children:[e.jsx(f,{className:"cursor-pointer ring-0 hover:ring-0 focus:ring-0",children:e.jsx(N,{placeholder:"Selecciona un rol"})}),e.jsx(b,{children:y.map(s=>e.jsx(t,{value:String(s.id),className:"cursor-pointer",children:s.name},s.id))})]}),a.role_id&&e.jsx("p",{className:"text-sm text-red-500",children:a.role_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"location",children:"Sede Asignada (Opcional)"}),e.jsxs(v,{onValueChange:s=>c("location_id",s),value:n.location_id,children:[e.jsx(f,{className:"cursor-pointer ring-0 hover:ring-0 focus:ring-0",children:e.jsx(N,{placeholder:"Global (Todas las sedes)"})}),e.jsxs(b,{children:[e.jsx(t,{value:"all",children:"Global (Todas las sedes)"}),A.map(s=>e.jsx(t,{value:String(s.id),className:"cursor-pointer",children:s.name},s.id))]})]}),a.location_id&&e.jsx("p",{className:"text-sm text-red-500",children:a.location_id})]}),e.jsx(re,{children:e.jsx(j,{type:"submit",disabled:E,className:"w-full cursor-pointer ring-0 hover:ring-0 focus:ring-0",children:E?"Procesando...":"Agregar Miembro"})})]})]})]})]}),e.jsx("div",{className:"rounded-xl border border-slate-200 bg-white overflow-hidden shadow-sm",children:e.jsxs(J,{children:[e.jsx(K,{children:e.jsxs(F,{className:"hover:bg-transparent",children:[e.jsx(m,{className:"w-[30%]",children:"Usuario"}),e.jsx(m,{children:"Rol Actual"}),e.jsx(m,{children:"Sede Asignada"}),e.jsx(m,{children:"Fecha de Ingreso"}),e.jsx(m,{className:"text-right",children:"Acciones"})]})}),e.jsx(Q,{children:B.map(s=>e.jsxs(F,{children:[e.jsx(p,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ie,{children:[e.jsx(oe,{src:s.profile_photo_url}),e.jsx(te,{children:s.name.substring(0,2).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-900",children:s.name}),e.jsx("div",{className:"text-xs text-slate-500",children:s.email})]})]})}),e.jsx(p,{children:s.role_type==="owner"?e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(U,{className:"bg-amber-100 text-amber-800 hover:bg-amber-100 border-amber-200",children:[e.jsx(we,{className:"w-3 h-3 mr-1"}),"Propietario"]})}):e.jsx("div",{onClickCapture:r=>{i("users.update")||(r.stopPropagation(),r.preventDefault(),x(!0))},children:e.jsxs(v,{defaultValue:s.pivot.role_id?String(s.pivot.role_id):void 0,onValueChange:r=>M(s.id,"role_id",r),disabled:!i("users.update"),children:[e.jsx(f,{className:`w-[160px] h-8 text-xs cursor-pointer ring-0 hover:ring-0 focus:ring-0 ${i("users.update")?"":"opacity-50 cursor-not-allowed"}`,children:e.jsx(N,{placeholder:s.role_label})}),e.jsx(b,{children:y.map(r=>e.jsx(t,{value:String(r.id),className:"cursor-pointer",children:r.name},r.id))})]})})}),e.jsx(p,{children:s.role_type==="owner"?e.jsxs(U,{variant:"outline",className:"text-[10px] h-6 px-2 border-primary/20 bg-primary/5 text-primary",children:[e.jsx(k,{className:"w-3 h-3 mr-1"}),"Acceso Total"]}):e.jsx("div",{onClickCapture:r=>{i("users.update")||(r.stopPropagation(),r.preventDefault(),x(!0))},children:e.jsxs(v,{defaultValue:s.pivot.location_id?String(s.pivot.location_id):"all",onValueChange:r=>M(s.id,"location_id",r),disabled:!i("users.update"),children:[e.jsx(f,{className:`w-[180px] h-8 text-xs cursor-pointer ring-0 hover:ring-0 focus:ring-0 ${i("users.update")?"":"opacity-50 cursor-not-allowed"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-3 h-3 text-primary"}),e.jsx(N,{placeholder:"Global"})]})}),e.jsxs(b,{children:[e.jsx(t,{value:"all",className:"cursor-pointer",children:"Global (Todas las sedes)"}),A.map(r=>e.jsx(t,{value:String(r.id),className:"cursor-pointer",children:r.name},r.id))]})]})})}),e.jsx(p,{className:"text-slate-500 text-sm",children:new Date(s.pivot.created_at).toLocaleDateString()}),e.jsx(p,{className:"text-right",children:s.role_type==="owner"?e.jsx(j,{variant:"ghost",size:"icon",className:"h-8 w-8 opacity-50 cursor-not-allowed",disabled:!0,children:e.jsx(q,{className:"h-4 w-4 text-slate-300"})}):e.jsxs(le,{children:[e.jsx(ne,{asChild:!0,children:e.jsx(j,{variant:"ghost",size:"icon",className:"h-8 w-8 cursor-pointer ring-0 hover:ring-0 focus:ring-0",children:e.jsx(De,{className:"h-4 w-4"})})}),e.jsx(ce,{align:"end",children:e.jsxs(de,{variant:"destructive",className:"cursor-pointer ring-0 hover:ring-0 focus:ring-0",onSelect:()=>l("users.delete",()=>S(s)),children:[e.jsx(q,{className:"mr-2 h-4 w-4"}),"Eliminar del Equipo"]})})]})})]},s.id))})]})})]}),e.jsx(me,{open:!!h,onOpenChange:s=>!s&&S(null),children:e.jsxs(pe,{children:[e.jsxs(ue,{children:[e.jsx(he,{children:"¿Eliminar Miembro?"}),e.jsxs(xe,{children:["¿Estás seguro de que deseas eliminar a ",e.jsx("span",{className:"font-bold",children:h?.name})," del equipo? Esta acción no se puede deshacer."]})]}),e.jsxs(ge,{children:[e.jsx(je,{className:"cursor-pointer ring-0 hover:ring-0 focus:ring-0",children:"Cancelar"}),e.jsx(ve,{onClick:()=>h&&z(h.id),variant:"destructive",className:"cursor-pointer ring-0 hover:ring-0 focus:ring-0",children:"Eliminar"})]})]})})]})}export{Os as default};
