import{r as g,u as U,t as S,j as e,H as O}from"./app-arqQV-bc.js";import{B as f}from"./button-Bd640uTA.js";import{C as B,a as M,b as G,c as H,d as q,e as J}from"./card-BQPJWSk4.js";import{C as W}from"./checkbox-BVsmtN0_.js";import{F as c}from"./field-BGHyIQrm.js";import{I as o}from"./input-CnYabjbM.js";import{I as K,a as Q,b as X}from"./input-group-pyB9IH1x.js";import{L as n}from"./label-DAA58jPO.js";import{S as p,a as j,b as w,c as b,d}from"./select-Ci9oU9C1.js";import{S as Y}from"./SuperAdminLayout-DBJxSbv0.js";import{c as v}from"./utils-BegMJZHH.js";import{S as Z}from"./shopping-bag-TtCDC01g.js";import{C as $}from"./credit-card-4AdI57T8.js";import{U as ee}from"./user-KA4Ja2_R.js";import{B as ae}from"./building-2-BDCC0dOe.js";import{C as E}from"./circle-check-CJmQNw_U.js";import{A as se}from"./arrow-left-XHfuuPY4.js";import{A as re}from"./arrow-right-CgtrnG0j.js";import"./index-B_Os2ghw.js";import"./index-CJZqa-kr.js";import"./index-DLsOI5U2.js";import"./index-DzhEK4jt.js";import"./check-BZhepUpU.js";import"./createLucideIcon-kbomgvBs.js";import"./separator-DpUia1Ar.js";import"./index-C-vN8jX4.js";import"./textarea-E7RJ8JN8.js";import"./index-BdQq_4o_.js";import"./index-Bz80iYGN.js";import"./index-DiBfayRM.js";import"./index-CwhdJaVg.js";import"./index-C9GonLHF.js";import"./index-CfChaKac.js";import"./chevron-down-CS-ozzzB.js";import"./chevron-up-D9DUAay6.js";import"./dropdown-menu-mNq1McYa.js";import"./chevron-right-CyE8jcbn.js";import"./trash-2-D8UpIHBH.js";import"./dialog-Do7ESPrT.js";import"./x-hBSqTjfa.js";import"./sheet-BJFcoitR.js";import"./index-iS2GCZ5y.js";import"./index-CVnnicxK.js";import"./index-DDCOIm2e.js";import"./chevrons-up-down-CmD-hWyD.js";import"./badge-check-C3DjHgnO.js";import"./ApplicationLogo-CDotYN88.js";import"./users-DyLj9nwM.js";import"./layout-grid-DSJln_pY.js";function aa({verticals:F,plans:k}){const t=(()=>{const a=localStorage.getItem("tenant_wizard_draft");return a?JSON.parse(a):null})(),[i,m]=g.useState(t?.currentStep||1),{data:s,setData:r,post:A,processing:y,errors:l,reset:T}=U({vertical_id:t?.data?.vertical_id||"",category_id:t?.data?.category_id||"",plan_id:t?.data?.plan_id||"",billing_cycle:t?.data?.billing_cycle||"monthly",owner_name:t?.data?.owner_name||"",owner_email:t?.data?.owner_email||"",owner_doc_type:t?.data?.owner_doc_type||"CC",owner_doc_number:t?.data?.owner_doc_number||"",owner_phone:t?.data?.owner_phone||"",owner_address:t?.data?.owner_address||"",owner_country:t?.data?.owner_country||"Colombia",owner_state:t?.data?.owner_state||"",owner_city:t?.data?.owner_city||"",owner_password:t?.data?.owner_password||"",tenant_name:t?.data?.tenant_name||"",slug:t?.data?.slug||"",regime:t?.data?.regime||"comun",tenant_doc_type:t?.data?.tenant_doc_type||"NIT",tenant_doc_number:t?.data?.tenant_doc_number||"",verification_digit:t?.data?.verification_digit||"",tenant_contact_email:t?.data?.tenant_contact_email||"",tenant_address:t?.data?.tenant_address||"",tenant_state:t?.data?.tenant_state||"",tenant_city:t?.data?.tenant_city||"",use_owner_address:t?.data?.use_owner_address||!1});g.useEffect(()=>{localStorage.setItem("tenant_wizard_draft",JSON.stringify({data:s,currentStep:i}))},[s,i]);const P=()=>{localStorage.removeItem("tenant_wizard_draft"),T(),m(1),S.success("Formulario reiniciado")},V=F.find(a=>a.id.toString()===s.vertical_id)?.categories||[],I=k.filter(a=>a.vertical_id.toString()===s.vertical_id),h=k.find(a=>a.id.toString()===s.plan_id)?.allow_custom_slug!==!1;g.useEffect(()=>{if(!s.tenant_name)return;const a=s.tenant_name.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,"");if(h)s.slug||r("slug",a);else{const _=a.length;let x;if(_>6){const u=a.substring(0,2),N=a.substring(_-4),C=Math.random().toString(36).substring(2,6);x=u+C+N}else{const u=Math.random().toString(36).substring(2,5);x=a+u}r("slug",x)}},[s.tenant_name,h]),g.useEffect(()=>{s.use_owner_address&&r(a=>({...a,tenant_address:a.owner_address,tenant_state:a.owner_state,tenant_city:a.owner_city}))},[s.use_owner_address,s.owner_address,s.owner_state,s.owner_city]),g.useEffect(()=>{if(Object.keys(l).length>0){const a=["vertical_id","category_id"],_=["plan_id","billing_cycle"],x=["owner_name","owner_email","owner_doc_number","owner_password","owner_address","owner_doc_type","owner_phone","owner_state","owner_city"],u=N=>N.some(C=>l[C]);u(a)?m(1):u(_)?m(2):u(x)?m(3):m(4),S.error("Por favor verifica los campos resaltados en rojo.")}},[l]);const R=()=>{i<4&&m(i+1)},z=()=>{i>1&&m(i-1)},L=a=>{a.preventDefault(),A(route("tenants.store"),{onSuccess:()=>{localStorage.removeItem("tenant_wizard_draft"),S.success("¡Tienda, Usuario y Suscripción creados!")},onError:_=>{console.error("Submission Error:",_)}})},D=[{id:1,title:"Concepto",icon:Z,desc:"Vertical y Categoría"},{id:2,title:"Plan",icon:$,desc:"Suscripción y Ciclo"},{id:3,title:"Propietario",icon:ee,desc:"Datos Personales"},{id:4,title:"Negocio",icon:ae,desc:"Datos Fiscales"}];return e.jsxs(Y,{header:"Alta de Nueva Tienda",children:[e.jsx(O,{title:"Nueva Tienda"}),e.jsxs("div",{className:"max-w-5xl mx-auto py-6",children:[e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx(f,{variant:"ghost",size:"sm",onClick:P,className:"text-red-500 hover:text-red-700 hover:bg-red-50",children:"Reiniciar Formulario"})}),e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex justify-between relative",children:[e.jsx("div",{className:"absolute left-0 top-6 w-full h-1 bg-gray-100 -z-10 rounded-full",children:e.jsx("div",{className:"h-full bg-blue-600 transition-all duration-500 rounded-full",style:{width:(i-1)/3*100+"%"}})}),D.map(a=>e.jsxs("div",{className:"flex flex-col items-center gap-2 bg-white/50 backdrop-blur-sm p-2 rounded-lg",children:[e.jsx("div",{className:v("w-12 h-12 rounded-full flex items-center justify-center border-2 transition-all duration-300",i>=a.id?"bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-200":"bg-white border-gray-200 text-gray-400"),children:e.jsx(a.icon,{className:"w-5 h-5"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:v("text-xs font-bold uppercase tracking-wider",i>=a.id?"text-blue-700":"text-gray-400"),children:a.title}),e.jsx("div",{className:"text-[10px] text-gray-500 font-medium hidden sm:block",children:a.desc})]})]},a.id))]})}),e.jsx("form",{onSubmit:L,children:e.jsxs(B,{className:"min-h-[400px] flex flex-col justify-between shadow-xl border-gray-200",children:[e.jsxs(M,{className:"bg-gray-50/50 border-b pb-8",children:[e.jsxs(G,{className:"text-xl flex items-center gap-2",children:[e.jsx("span",{className:"bg-blue-100 text-blue-700 w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold",children:i}),D[i-1].title]}),e.jsxs(H,{children:["Completa la información solicitada en el paso ",i," de 4."]})]}),e.jsxs(q,{className:"pt-8",children:[i===1&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-8 animate-in fade-in slide-in-from-right-4 duration-500",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Vertical de Negocio"}),e.jsxs(p,{value:s.vertical_id,onValueChange:a=>r("vertical_id",a),children:[e.jsx(j,{className:"h-12 border-blue-100 bg-blue-50/30",children:e.jsx(w,{placeholder:"Selecciona una vertical..."})}),e.jsx(b,{children:F.map(a=>e.jsx(d,{value:a.id.toString(),children:a.name},a.id))})]}),e.jsx(c,{children:l.vertical_id})]})}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Categoría Específica"}),e.jsxs(p,{value:s.category_id,onValueChange:a=>r("category_id",a),disabled:!s.vertical_id,children:[e.jsx(j,{className:"h-12",children:e.jsx(w,{placeholder:"Selecciona una categoría..."})}),e.jsx(b,{children:V.map(a=>e.jsx(d,{value:a.id.toString(),children:a.name},a.id))})]}),e.jsx(c,{children:l.category_id})]})})]}),i===2&&e.jsxs("div",{className:"space-y-8 animate-in fade-in slide-in-from-right-4 duration-500",children:[e.jsx("div",{className:"grid md:grid-cols-3 gap-6",children:I.length===0?e.jsx("div",{className:"col-span-3 py-12 text-center text-muted-foreground border-2 border-dashed rounded-xl",children:"No hay planes disponibles para esta vertical."}):I.map(a=>e.jsxs("div",{className:v("cursor-pointer border rounded-xl p-6 transition-all hover:shadow-lg relative",s.plan_id===a.id.toString()?"border-blue-500 bg-blue-50 ring-2 ring-blue-200":"border-gray-200 bg-white"),onClick:()=>r("plan_id",a.id.toString()),children:[s.plan_id===a.id.toString()&&e.jsx("div",{className:"absolute top-4 right-4 text-blue-600",children:e.jsx(E,{className:"h-6 w-6"})}),e.jsx("h3",{className:"font-bold text-lg mb-1",children:a.name}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900 mb-2",children:[new Intl.NumberFormat("es-CO",{style:"currency",currency:a.currency}).format(a.monthly_price),e.jsx("span",{className:"text-sm font-normal text-muted-foreground",children:"/mes"})]}),e.jsx("p",{className:"text-sm text-gray-500 mb-4 line-clamp-2",children:a.description}),a.allow_custom_slug===!1&&e.jsx("div",{className:"mt-2 text-xs bg-orange-100 text-orange-700 px-2 py-1 rounded inline-block",children:"Slug automático"})]},a.id))}),e.jsx(c,{className:"text-center",children:l.plan_id}),e.jsxs("div",{className:"max-w-md mx-auto p-6 bg-gray-50 rounded-xl border",children:[e.jsx(n,{className:"mb-4 block text-center font-medium",children:"Ciclo de Facturación"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:["monthly","quarterly","semiannual","yearly"].map(a=>e.jsxs("button",{type:"button",onClick:()=>r("billing_cycle",a),className:v("px-4 py-2 rounded-lg text-sm font-medium border transition-colors",s.billing_cycle===a?"bg-black text-white border-black":"bg-white text-gray-700 border-gray-200 hover:bg-gray-100"),children:[a==="monthly"&&"Mensual",a==="quarterly"&&"Trimestral",a==="semiannual"&&"Semestral",a==="yearly"&&"Anual"]},a))})]})]}),i===3&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-x-8 gap-y-4 animate-in fade-in slide-in-from-right-4 duration-500",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"owner_name",children:"Nombre Completo"}),e.jsx(o,{id:"owner_name",name:"owner_name",value:s.owner_name,onChange:a=>r("owner_name",a.target.value)}),e.jsx(c,{children:l.owner_name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"owner_email",children:"Correo Electrónico"}),e.jsx(o,{id:"owner_email",name:"owner_email",type:"email",value:s.owner_email,onChange:a=>r("owner_email",a.target.value)}),e.jsx(c,{children:l.owner_email})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Tipo Doc"}),e.jsxs(p,{value:s.owner_doc_type,onValueChange:a=>r("owner_doc_type",a),children:[e.jsx(j,{children:e.jsx(w,{})}),e.jsxs(b,{children:[e.jsx(d,{value:"CC",children:"CC"}),e.jsx(d,{value:"CE",children:"CE"}),e.jsx(d,{value:"PAS",children:"Pasaporte"})]})]})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx(n,{htmlFor:"owner_doc_number",children:"Número Documento"}),e.jsx(o,{id:"owner_doc_number",name:"owner_doc_number",value:s.owner_doc_number,onChange:a=>r("owner_doc_number",a.target.value)}),e.jsx(c,{children:l.owner_doc_number})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"owner_phone",children:"Celular / WhatsApp"}),e.jsx(o,{id:"owner_phone",name:"owner_phone",value:s.owner_phone,onChange:a=>r("owner_phone",a.target.value)})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(n,{htmlFor:"owner_address",children:"Dirección Personal"}),e.jsx(o,{id:"owner_address",name:"owner_address",value:s.owner_address,onChange:a=>r("owner_address",a.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 md:col-span-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"owner_country",children:"País"}),e.jsx(o,{id:"owner_country",name:"owner_country",value:s.owner_country,onChange:a=>r("owner_country",a.target.value),readOnly:!0,className:"bg-gray-50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"owner_state",children:"Departamento"}),e.jsx(o,{id:"owner_state",name:"owner_state",value:s.owner_state,onChange:a=>r("owner_state",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"owner_city",children:"Ciudad"}),e.jsx(o,{id:"owner_city",name:"owner_city",value:s.owner_city,onChange:a=>r("owner_city",a.target.value)})]})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2 pt-4 border-t",children:[e.jsx(n,{htmlFor:"owner_password",className:"text-red-600",children:"Contraseña Temporal"}),e.jsx(o,{id:"owner_password",name:"owner_password",type:"text",value:s.owner_password,onChange:a=>r("owner_password",a.target.value),placeholder:"Asignar contraseña de acceso..."}),e.jsx(c,{children:l.owner_password})]})]}),i===4&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-x-8 gap-y-4 animate-in fade-in slide-in-from-right-4 duration-500",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"tenant_name",children:"Nombre del Negocio (Público)"}),e.jsx(o,{id:"tenant_name",name:"tenant_name",value:s.tenant_name??"",onChange:a=>r("tenant_name",a.target.value)}),e.jsx(c,{children:l.tenant_name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"slug",children:"Slug (URL)"}),e.jsxs(K,{children:[e.jsx(Q,{className:"bg-muted text-muted-foreground border-r-0",children:"linkiu.bio/"}),e.jsx(X,{id:"slug",name:"slug",className:v("text-sm",!h&&"bg-muted text-muted-foreground cursor-not-allowed"),value:s.slug??"",onChange:a=>r("slug",a.target.value),readOnly:!h})]}),!h&&e.jsxs("p",{className:"text-xs text-amber-600 mt-1 flex items-center gap-1",children:[e.jsx("span",{className:"inline-block w-1 h-1 bg-amber-600 rounded-full"}),"Este plan genera un slug único mezclando caracteres aleatorios"]}),e.jsx(c,{children:l.slug})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Régimen Fiscal"}),e.jsxs(p,{value:s.regime,onValueChange:a=>r("regime",a),children:[e.jsx(j,{children:e.jsx(w,{})}),e.jsxs(b,{children:[e.jsx(d,{value:"comun",children:"Responsable de IVA"}),e.jsx(d,{value:"simple",children:"No Responsable de IVA"}),e.jsx(d,{value:"especial",children:"Régimen Simple / Especial"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("div",{className:"space-y-2 col-span-1",children:[e.jsx(n,{children:"Doc"}),e.jsxs(p,{value:s.tenant_doc_type,onValueChange:a=>r("tenant_doc_type",a),children:[e.jsx(j,{children:e.jsx(w,{})}),e.jsxs(b,{children:[e.jsx(d,{value:"NIT",children:"NIT"}),e.jsx(d,{value:"RUT",children:"RUT"})]})]})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx(n,{htmlFor:"tenant_doc_number",children:"Número"}),e.jsx(o,{id:"tenant_doc_number",name:"tenant_doc_number",value:s.tenant_doc_number??"",onChange:a=>r("tenant_doc_number",a.target.value)})]}),e.jsxs("div",{className:"col-span-1 space-y-2",children:[e.jsx(n,{htmlFor:"verification_digit",children:"DV"}),e.jsx(o,{id:"verification_digit",name:"verification_digit",value:s.verification_digit??"",maxLength:1,onChange:a=>r("verification_digit",a.target.value)})]})]}),e.jsxs("div",{className:"md:col-span-2 flex items-center gap-2 py-2",children:[e.jsx(W,{id:"use_owner_address",checked:s.use_owner_address,onCheckedChange:a=>r("use_owner_address",a===!0)}),e.jsx(n,{htmlFor:"use_owner_address",className:"font-normal cursor-pointer",children:"Usar la misma dirección del propietario"})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(n,{htmlFor:"tenant_address",children:"Dirección Fiscal"}),e.jsx(o,{id:"tenant_address",name:"tenant_address",value:s.tenant_address??"",onChange:a=>r("tenant_address",a.target.value),disabled:s.use_owner_address})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"tenant_state",children:"Departamento"}),e.jsx(o,{id:"tenant_state",name:"tenant_state",value:s.tenant_state??"",onChange:a=>r("tenant_state",a.target.value),disabled:s.use_owner_address})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"tenant_city",children:"Ciudad"}),e.jsx(o,{id:"tenant_city",name:"tenant_city",value:s.tenant_city??"",onChange:a=>r("tenant_city",a.target.value),disabled:s.use_owner_address})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2 pt-4",children:[e.jsx(n,{htmlFor:"tenant_contact_email",children:"Email de Contacto (Público)"}),e.jsx(o,{id:"tenant_contact_email",name:"tenant_contact_email",value:s.tenant_contact_email??"",onChange:a=>r("tenant_contact_email",a.target.value),placeholder:"contacto@mitienda.com"})]})]})]}),e.jsxs(J,{className:"bg-gray-50 flex justify-between border-t py-6",children:[e.jsxs(f,{type:"button",variant:"outline",onClick:z,disabled:i===1||y,children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Anterior"]}),i<4?e.jsxs(f,{type:"button",onClick:R,disabled:y,children:["Siguiente",e.jsx(re,{className:"h-4 w-4 ml-2"})]}):e.jsx(f,{type:"submit",disabled:y,className:"bg-green-600 hover:bg-green-700 w-48",children:y?"Creando Tienda...":e.jsxs(e.Fragment,{children:["Finalizar y Crear",e.jsx(E,{className:"h-4 w-4 ml-2"})]})})]})]})})]})]})}export{aa as default};
