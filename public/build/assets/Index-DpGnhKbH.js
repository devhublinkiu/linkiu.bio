import{c as he,r as a,a as D,u as B,j as e,H as pe}from"./app-CzmtjlCW.js";import{B as _}from"./badge-C86koyY8.js";import{B as o}from"./button-DHDYV-Vu.js";import{C as I}from"./checkbox-CzUTQ9CK.js";import{D as H,f as ue,a as M,b as R,c as G,d as L,e as z}from"./dialog-CDtZpi6V.js";import{E as ge,a as je,c as fe,d as ve}from"./empty-CWOb4KhK.js";import{F as x}from"./field-l6HuMPt2.js";import{I as J}from"./input-CkrKzdip.js";import{I as be,a as Ne,b as Ce}from"./input-group-DCsiFJcf.js";import{L as r}from"./label-s6Z-YQDs.js";import{S as w,a as A,b as E,c as T,d as h}from"./select-BsP5-Mx7.js";import{T as Se,a as De,b as q,c,d as _e,e as i}from"./table-BLm2Cm7o.js";import{A as we,a as Ae,b as Ee,c as Te,d as qe,e as ye,f as Pe,g as ke}from"./alert-dialog-BdvmeaMn.js";import{P as Fe}from"./dropdown-menu-CkPxOfJq.js";import{S as Ve}from"./SuperAdminLayout-A6iBy4mt.js";import{S as Oe}from"./Pagination-BXFtDScs.js";import{P as Be}from"./plus-BCBDbY-P.js";import{S as Ie}from"./search-CetFsz5w.js";import{S as He}from"./shield-alert-C1ocMXzS.js";import{B as Me}from"./badge-check-bj2LNrR7.js";import{S as Re}from"./store-DXptSnWg.js";import{P as Ge}from"./pencil-DgSLU81f.js";import{T as Le}from"./trash-2-D8FHOsLd.js";import"./utils-BH2tHD_A.js";import"./index-Bik950zP.js";import"./index-tuvqS7go.js";import"./index-CqTlmCQK.js";import"./index-i2FoVhyH.js";import"./check-CDpry8EA.js";import"./createLucideIcon-CaH5oZCX.js";import"./index-DLCIQy2W.js";import"./index-D4uLenfM.js";import"./x-B2qOMX6F.js";import"./separator-C7VYnuGU.js";import"./index-B7u58P25.js";import"./textarea-BVs60Bnz.js";import"./index-BdQq_4o_.js";import"./index-Bdv8as05.js";import"./index-BKdn1L7U.js";import"./index-0rkHg0Ic.js";import"./chevron-down-DmTOaxVY.js";import"./chevron-up-Dd6KBSzl.js";import"./chevron-right-CP3Al_6X.js";import"./circle-check-DxCp2NCp.js";import"./credit-card-o3EdvoAE.js";import"./shopping-bag-BzAvYKks.js";import"./sheet-BCCP-sjc.js";import"./index-DewdYm7G.js";import"./index-CoSHAo9V.js";import"./index-BPIYxXZn.js";import"./chevrons-up-down-DP41UalB.js";import"./ApplicationLogo-CUFauJCk.js";import"./users-CiV-Fhl_.js";import"./layout-grid-Do7wAopY.js";import"./ellipsis-tJHsxw3Y.js";import"./chevron-left-BrVnOOoC.js";function Us({categories:p,verticals:u,filters:g,flash:ze}){const{auth:K,route:t}=he().props,y=K.permissions||[],j=s=>y.includes("*")||y.includes(s),P=p.data||p,Q=p.links||[],[U,k]=a.useState(!1),[W,f]=a.useState(!1),[X,v]=a.useState(!1),[Y,F]=a.useState(null),[l,Z]=a.useState(null),[$,d]=a.useState(!1),[n,ee]=a.useState(g.search||""),[b,se]=a.useState(g.vertical_id||"all");a.useEffect(()=>{const s=setTimeout(()=>{n!==g.search&&D.get(t("categories.index"),{search:n,vertical_id:b==="all"?"":b},{preserveState:!0,replace:!0})},300);return()=>clearTimeout(s)},[n]);const ae=s=>{se(s),D.get(t("categories.index"),{search:n,vertical_id:s==="all"?"":s},{preserveState:!0,replace:!0})},{data:N,setData:C,post:re,processing:ie,errors:V,reset:te}=B({name:"",vertical_id:"",require_verification:!1}),le=s=>{s.preventDefault(),re(t("categories.store"),{onSuccess:()=>{te(),k(!1)}})},{data:S,setData:m,put:ne,processing:oe,errors:O,reset:Je}=B({name:"",vertical_id:"",require_verification:!1}),ce=s=>{if(!j("sa.categories.update")){d(!0);return}F(s),m({name:s.name,vertical_id:s.vertical_id.toString(),require_verification:!!s.require_verification}),f(!0)},de=s=>{s.preventDefault(),ne(t("categories.update",Y.id),{onSuccess:()=>{f(!1),F(null)}})},me=s=>{if(!j("sa.categories.delete")){d(!0);return}Z(s),v(!0)},xe=()=>{l&&D.delete(t("categories.destroy",l.id),{onSuccess:()=>v(!1)})};return e.jsxs(Ve,{header:"Categorías de Negocio",children:[e.jsx(Fe,{open:$,onOpenChange:d}),e.jsx(pe,{title:"Categorías"}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold tracking-tight",children:"Gestión de Categorías"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Define las reglas para cada tipo de negocio."})]}),e.jsxs(H,{open:U,onOpenChange:k,children:[e.jsx(ue,{asChild:!0,children:e.jsxs(o,{onClick:s=>{j("sa.categories.create")||(s.preventDefault(),d(!0))},children:[e.jsx(Be,{className:"mr-2 h-4 w-4"}),"Nueva Categoría"]})}),e.jsx(M,{className:"sm:max-w-[425px]",children:e.jsxs("form",{onSubmit:le,children:[e.jsxs(R,{children:[e.jsx(G,{children:"Crear Categoría"}),e.jsx(L,{children:"Añade una nueva categoría para que los tenants la seleccionen."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx(r,{htmlFor:"c-name",children:"Nombre"}),e.jsx(J,{id:"c-name",value:N.name,onChange:s=>C("name",s.target.value),required:!0}),e.jsx(x,{children:V.name})]}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx(r,{htmlFor:"c-vertical",children:"Vertical"}),e.jsxs(w,{value:N.vertical_id,onValueChange:s=>C("vertical_id",s),children:[e.jsx(A,{className:"w-full",children:e.jsx(E,{placeholder:"Selecciona Vertical..."})}),e.jsx(T,{children:u.map(s=>e.jsx(h,{value:s.id.toString(),children:s.name},s.id))})]}),e.jsx(x,{children:V.vertical_id})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2 border p-3 rounded-md bg-gray-50",children:[e.jsx(I,{id:"c-verif",checked:N.require_verification,onCheckedChange:s=>C("require_verification",s===!0)}),e.jsxs("div",{className:"grid gap-1.5 leading-none",children:[e.jsx(r,{htmlFor:"c-verif",className:"text-sm font-medium leading-none cursor-pointer",children:"Requiere Aprobación Manual"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Para negocios regulados (Salud, Alcohol)."})]})]})]}),e.jsx(z,{children:e.jsx(o,{type:"submit",disabled:ie,children:"Guardar"})})]})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsx("div",{className:"w-full max-sm:w-full md:max-w-sm",children:e.jsxs(be,{children:[e.jsx(Ne,{children:e.jsx(Ie,{className:"h-4 w-4"})}),e.jsx(Ce,{type:"search",placeholder:"Buscar categorías...",value:n,onChange:s=>ee(s.target.value)})]})}),e.jsxs(w,{value:b,onValueChange:ae,children:[e.jsx(A,{className:"w-full md:w-[200px] bg-white",children:e.jsx(E,{placeholder:"Filtrar por Vertical"})}),e.jsxs(T,{children:[e.jsx(h,{value:"all",children:"Todas las Verticales"}),u.map(s=>e.jsx(h,{value:s.id.toString(),children:s.name},s.id))]})]})]}),e.jsx("div",{className:"bg-white rounded-md border shadow-sm",children:e.jsxs(Se,{children:[e.jsx(De,{children:e.jsxs(q,{children:[e.jsx(c,{children:"Nombre"}),e.jsx(c,{children:"Vertical"}),e.jsx(c,{children:"Aprobación"}),e.jsx(c,{children:"Tiendas"}),e.jsx(c,{className:"text-right",children:"Acciones"})]})}),e.jsxs(_e,{children:[P.map(s=>e.jsxs(q,{children:[e.jsxs(i,{className:"font-medium",children:[e.jsx("div",{children:s.name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["/",s.slug]})]}),e.jsx(i,{children:e.jsx(_,{variant:"outline",children:s.vertical?.name})}),e.jsx(i,{children:s.require_verification?e.jsxs(_,{variant:"secondary",className:"gap-1 text-amber-600 bg-amber-50 hover:bg-amber-100",children:[e.jsx(He,{className:"h-3 w-3"}),"Manual"]}):e.jsxs(_,{variant:"secondary",className:"gap-1 text-green-600 bg-green-50 hover:bg-green-100",children:[e.jsx(Me,{className:"h-3 w-3"}),"Automática"]})}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-center text-gray-500",children:[e.jsx(Re,{className:"h-4 w-4 mr-1"}),s.tenants_count]})}),e.jsxs(i,{className:"text-right space-x-2",children:[e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>ce(s),children:e.jsx(Ge,{className:"h-4 w-4 text-gray-500"})}),e.jsx(o,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-700 hover:bg-red-50",onClick:()=>me(s),children:e.jsx(Le,{className:"h-4 w-4"})})]})]},s.id)),P.length===0&&e.jsx(q,{children:e.jsx(i,{colSpan:5,className:"py-12",children:e.jsx(ge,{children:e.jsxs(je,{children:[e.jsx(fe,{children:"No se encontraron categorías"}),e.jsx(ve,{children:"No hay categorías registradas que coincidan con tu búsqueda."})]})})})})]})]})}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(Oe,{links:Q})}),e.jsx(H,{open:W,onOpenChange:f,children:e.jsx(M,{className:"sm:max-w-[425px]",children:e.jsxs("form",{onSubmit:de,children:[e.jsxs(R,{children:[e.jsx(G,{children:"Editar Categoría"}),e.jsx(L,{children:"Modifica los datos de la categoría."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx(r,{htmlFor:"e-name",children:"Nombre"}),e.jsx(J,{id:"e-name",value:S.name,onChange:s=>m("name",s.target.value),required:!0}),e.jsx(x,{children:O.name})]}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx(r,{htmlFor:"e-vertical",children:"Vertical"}),e.jsxs(w,{value:S.vertical_id,onValueChange:s=>m("vertical_id",s),children:[e.jsx(A,{className:"w-full",children:e.jsx(E,{placeholder:"Selecciona Vertical..."})}),e.jsx(T,{children:u.map(s=>e.jsx(h,{value:s.id.toString(),children:s.name},s.id))})]}),e.jsx(x,{children:O.vertical_id})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2 border p-3 rounded-md bg-gray-50",children:[e.jsx(I,{id:"e-verif",checked:S.require_verification,onCheckedChange:s=>m("require_verification",s===!0)}),e.jsx("div",{className:"grid gap-1.5 leading-none",children:e.jsx(r,{htmlFor:"e-verif",className:"text-sm font-medium leading-none cursor-pointer",children:"Requiere Aprobación Manual"})})]})]}),e.jsx(z,{children:e.jsx(o,{type:"submit",disabled:oe,children:"Actualizar"})})]})})}),e.jsx(we,{open:X,onOpenChange:v,children:e.jsxs(Ae,{children:[e.jsxs(Ee,{children:[e.jsx(Te,{children:"¿Estás completamente seguro?"}),e.jsxs(qe,{children:["Esta acción no se puede deshacer. Se eliminará la categoría ",e.jsx("strong",{children:l?.name}),".",l?.tenants_count>0&&e.jsxs("div",{className:"mt-2 p-2 bg-red-50 text-red-600 rounded-md font-medium border border-red-200",children:["⚠️ ¡Atención! Esta categoría tiene ",l.tenants_count," tiendas asociadas. El sistema bloqueará esta eliminación."]})]})]}),e.jsxs(ye,{children:[e.jsx(Pe,{children:"Cancelar"}),e.jsx(ke,{onClick:xe,className:"bg-red-600 hover:bg-red-700",children:"Eliminar"})]})]})})]})}export{Us as default};
