import{r as o,c as S,t as w,j as e}from"./app-BWcZUh_k.js";import{i as $,n as k}from"./util-CeAI_f06.js";import{S as z,b as L}from"./sheet-CXe3NyIA.js";import{B as E}from"./button-Bx2UyVdr.js";import{u as M}from"./PublicLayout-DK-hC5Ba.js";import{f as N}from"./utils-kbTUnUPe.js";import{X as A}from"./x-CnE69C72.js";import{S as F}from"./shopping-bag-D1_yKv0G.js";import{C as P}from"./chevron-left-Dbk6k2rI.js";import{C as B}from"./chevron-right-BEfVsxal.js";import{M as W}from"./minus-B9w_aohc.js";import{P as O}from"./plus-CeP7VFm4.js";var R=function(s,u,b){if(!$)return[u,k,k];if(!s)throw new Error("useLocalStorage key may not be falsy");var c=JSON.parse,i=o.useRef(function(r){try{var f=b?b.raw?String:b.serializer:JSON.stringify,g=localStorage.getItem(r);return g!==null?c(g):(u&&localStorage.setItem(r,f(u)),u)}catch{return u}}),v=o.useState(function(){return i.current(s)}),m=v[0],x=v[1];o.useLayoutEffect(function(){return x(i.current(s))},[s]);var h=o.useCallback(function(r){try{var f=typeof r=="function"?r(m):r;if(typeof f>"u")return;var g=void 0;b||(g=JSON.stringify(f)),localStorage.setItem(s,g),x(c(g))}catch{}},[s,x]),j=o.useCallback(function(){try{localStorage.removeItem(s),x(void 0)}catch{}},[s,x]);return[m,h,j]};function V(){const{currentTenant:s}=S().props,b=`linkiu_favorites_${s?.slug||"default"}`,[c,i]=R(b,[]),v=o.useCallback((h,j)=>{const r=c||[];let f;r.includes(h)?(w.info("Eliminado de favoritos"),f=r.filter(g=>g!==h)):(w.success(j?`¡${j} agregado a favoritos!`:"Agregado a favoritos"),f=[...r,h]),i(f)},[c,i]),m=o.useCallback(h=>(c||[]).includes(h),[c]),x=o.useMemo(()=>(c||[]).length,[c]);return{favorites:c||[],toggleFavorite:v,isFavorite:m,favoritesCount:x}}function I({product:s,isOpen:u,onClose:b}){const{addToCart:c}=M(),[i,v]=o.useState(1),[m,x]=o.useState({}),h=o.useRef(null);o.useEffect(()=>{u&&(v(1),x({}))},[u,s.id]);const j=a=>{if(h.current){const{current:t}=h,n=t.clientWidth;t.scrollBy({left:a==="left"?-n:n,behavior:"smooth"})}},r=Number(s.price),f=o.useMemo(()=>{let a=r;return s.variant_groups&&s.variant_groups.forEach(t=>{(m[t.id]||[]).forEach(d=>{const l=t.options.find(p=>p.id===d);l&&(a+=Number(l.price_adjustment))})}),a*i},[s,m,i,r]),g=(a,t,n)=>{const d=s.variant_groups?.find(l=>l.id===a);d&&x(l=>{const p=l[a]||[];if(n==="radio")return{...l,[a]:[t]};if(p.includes(t))return{...l,[a]:p.filter(C=>C!==t)};const y=[...p,t];return d.max_selection>0&&y.length>d.max_selection?(w.error(`Máximo ${d.max_selection} opción(es) en ${d.name}`),l):{...l,[a]:y}})},_=()=>{if(s.variant_groups)for(const t of s.variant_groups){const n=m[t.id]||[];if(t.is_required&&n.length<t.min_selection){w.error(`Debes seleccionar al menos ${t.min_selection} opción(es) en ${t.name}`);return}if(t.max_selection>0&&n.length>t.max_selection){w.error(`Máximo ${t.max_selection} opción(es) en ${t.name}`);return}}const a=[];s.variant_groups&&s.variant_groups.forEach(t=>{(m[t.id]||[]).forEach(d=>{const l=t.options.find(p=>p.id===d);l&&a.push({name:t.name,value:l.name,price:Number(l.price_adjustment)})})}),c({...s,image_url:s.image_url??s.imageUrl,price:f/i,quantity:i,variant_selections:m,variant_options:a}),b(),v(1),x({})};return e.jsx(z,{open:u,onOpenChange:a=>!a&&b(),children:e.jsxs(L,{side:"bottom",className:"h-[80vh] w-full max-w-[480px] mx-auto left-0 right-0 p-0 rounded-t-[2rem] bg-slate-50 flex flex-col overflow-hidden border-none focus-visible:outline-none shadow-2xl",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 flex justify-center pt-3 pb-1 z-50 pointer-events-none",children:e.jsx("div",{className:"w-12 h-1.5 bg-slate-200/50 backdrop-blur-sm rounded-full"})}),e.jsx("button",{onClick:b,className:"absolute top-4 right-4 z-50 bg-black/20 backdrop-blur-md text-white p-2 rounded-full hover:bg-black/30 transition-colors",children:e.jsx(A,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 max-h-[75vh] overflow-y-auto",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:[e.jsxs("div",{className:"h-64 sm:h-72 w-full relative group",children:[e.jsxs("div",{ref:h,className:"w-full h-full overflow-x-auto flex flex-nowrap snap-x snap-mandatory",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:[s.image_url&&e.jsxs("div",{className:"w-full h-full shrink-0 snap-center relative",children:[e.jsx("img",{src:s.image_url,alt:s.name,className:"w-full h-full object-cover",draggable:!1}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-900/60 to-transparent pointer-events-none"})]}),(s.gallery_urls||s.gallery)?.map((a,t)=>typeof a=="string"&&a.startsWith("http")?e.jsxs("div",{className:"w-full h-full shrink-0 snap-center relative",children:[e.jsx("img",{src:a,alt:`${s.name} - ${t+1}`,className:"w-full h-full object-cover",draggable:!1}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-900/60 to-transparent pointer-events-none"})]},t):null),!s.image_url&&(!s.gallery_urls||s.gallery_urls.length===0)&&e.jsx("div",{className:"w-full h-full bg-slate-200 flex items-center justify-center snap-center",children:e.jsx(F,{className:"w-12 h-12 text-slate-300"})})]}),s.gallery_urls&&s.gallery_urls.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>j("left"),className:"absolute left-2 top-1/2 -translate-y-1/2 z-20 bg-white/20 backdrop-blur-md text-white p-2 rounded-full hover:bg-white/30 transition-colors active:scale-95 shadow-sm",children:e.jsx(P,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>j("right"),className:"absolute right-2 top-1/2 -translate-y-1/2 z-20 bg-white/20 backdrop-blur-md text-white p-2 rounded-full hover:bg-white/30 transition-colors active:scale-95 shadow-sm",children:e.jsx(B,{className:"w-5 h-5"})})]}),s.gallery_urls&&s.gallery_urls.length>0&&e.jsxs("div",{className:"absolute bottom-4 left-0 right-0 flex justify-center gap-1.5 z-20",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-white/80 shadow-sm"}),s.gallery_urls.map((a,t)=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-white/40"},t))]}),s.gallery_urls&&s.gallery_urls.length>0&&e.jsxs("div",{className:"absolute bottom-4 right-4 bg-black/30 backdrop-blur-md px-2 py-1 rounded-lg text-[10px] font-bold text-white z-20 pointer-events-none",children:[1+(s.gallery_urls?.length||0)," Fotos"]})]}),e.jsxs("div",{className:"p-6 pb-8 -mt-12 relative z-10 flex flex-col gap-6",children:[e.jsxs("div",{className:"bg-white rounded-3xl p-5 shadow-sm border border-slate-100",children:[e.jsx("h2",{className:"text-2xl font-black text-slate-900 leading-tight mb-2",children:s.name}),s.short_description&&e.jsx("p",{className:"text-slate-500 text-sm leading-relaxed",children:s.short_description}),e.jsxs("div",{className:"mt-4 flex items-baseline gap-2",children:[e.jsx("span",{className:"text-2xl font-black text-slate-900",children:N(r)}),s.original_price&&Number(s.original_price)>r&&e.jsx("span",{className:"text-slate-400 line-through text-sm",children:N(Number(s.original_price))})]})]}),(s.preparation_time||s.calories)&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.preparation_time&&e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-slate-100 flex items-center gap-3",children:[e.jsx("div",{className:"bg-amber-100 p-2 rounded-xl text-amber-600",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-slate-400 font-bold uppercase tracking-wider",children:"Tiempo"}),e.jsx("div",{className:"text-sm font-bold text-slate-900",children:s.preparation_time})]})]}),s.calories&&e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-slate-100 flex items-center gap-3",children:[e.jsx("div",{className:"bg-rose-100 p-2 rounded-xl text-rose-600",children:e.jsxs("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.879 16.121A3 3 0 1012.015 11L11 14H9c0 .768.293 1.536.879 2.121z"})]})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-slate-400 font-bold uppercase tracking-wider",children:"Calorías"}),e.jsx("div",{className:"text-sm font-bold text-slate-900",children:s.calories})]})]})]}),(s.tags?.length||0)>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:s.tags?.map((a,t)=>e.jsxs("span",{className:"bg-slate-100 text-slate-600 px-3 py-1 rounded-full text-xs font-bold border border-slate-200",children:["#",a]},t))}),s.variant_groups?.map(a=>e.jsxs("div",{className:"bg-white rounded-3xl p-5 shadow-sm border border-slate-100",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"font-bold text-slate-900 text-lg",children:a.name}),a.is_required&&e.jsx("span",{className:"bg-slate-100 text-slate-600 text-[10px] font-bold px-2 py-1 rounded-full",children:"Obligatorio"})]}),e.jsx("div",{className:"space-y-3",children:a.options.map(t=>{const n=(m[a.id]||[]).includes(t.id),d=Number(t.price_adjustment),l=t.is_available===!1;return e.jsxs("label",{className:`flex items-center justify-between p-3 rounded-xl border transition-all ${l?"cursor-not-allowed opacity-60 bg-slate-50 border-slate-100":n?"border-slate-900 bg-slate-50 cursor-pointer":"border-slate-100 hover:border-slate-200 cursor-pointer"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center ${n?"bg-slate-900 border-slate-900":"border-slate-300"}`,children:n&&e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})}),e.jsxs("span",{className:`font-medium ${n?"text-slate-900":"text-slate-600"}`,children:[t.name,l&&e.jsx("span",{className:"text-slate-400 text-xs ml-1",children:"(no disponible)"})]})]}),e.jsx("input",{type:a.type==="radio"?"radio":"checkbox",name:`group-${a.id}`,className:"hidden",checked:n,disabled:l,onChange:()=>!l&&g(a.id,t.id,a.type)}),d>0&&!l&&e.jsxs("span",{className:"text-sm font-bold text-slate-900",children:["+",N(d)]})]},t.id)})})]},a.id))]})]}),e.jsxs("div",{className:"bg-white p-4 border-t border-slate-100 shadow-[0_-5px_20px_rgba(0,0,0,0.05)]",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-4",children:[e.jsx("span",{className:"font-bold text-slate-900",children:"Cantidad"}),e.jsxs("div",{className:"flex items-center bg-slate-100 rounded-xl p-1 h-10",children:[e.jsx("button",{onClick:()=>v(Math.max(1,i-1)),className:"w-10 h-full flex items-center justify-center bg-white rounded-lg shadow-sm text-slate-600 active:scale-95 transition-transform",children:e.jsx(W,{className:"w-4 h-4"})}),e.jsx("span",{className:"w-12 text-center font-bold text-lg",children:i}),e.jsx("button",{onClick:()=>v(i+1),className:"w-10 h-full flex items-center justify-center bg-white rounded-lg shadow-sm text-slate-900 active:scale-95 transition-transform",children:e.jsx(O,{className:"w-4 h-4"})})]})]}),e.jsxs(E,{onClick:_,className:"w-full h-14 text-lg font-bold rounded-2xl bg-slate-900 hover:bg-slate-800 shadow-xl shadow-slate-900/10 active:scale-[0.98] transition-all flex justify-between items-center px-6",children:[e.jsx("span",{children:"Agregar"}),e.jsx("span",{children:N(f)})]})]})]})})}export{I as P,V as u};
