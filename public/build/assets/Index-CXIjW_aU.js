import{r as g,j as e,R as ye,c as Je,u as Xe,a as M,H as Ye,t as _}from"./app-D9wldZxo.js";import{g as Ke}from"./echo-CmTENghG.js";import{A as Qe}from"./AdminLayout-C86srUOQ.js";import{B as v}from"./button-Dadb_Lep.js";import{I as E}from"./input-rMsYcH4C.js";import{B as D}from"./badge-DyYF213F.js";import{L as S}from"./label-DoqMNi9Z.js";import{S as xe}from"./separator-L5pP8n2q.js";import{A as Ze,a as es,b as ss,c as ts,d as as,e as rs,f as ns,g as is}from"./alert-dialog-BL6dXcRY.js";import{D as Y,a as K,b as Q,c as Z,d as ee,e as ue}from"./dialog-C0Lg02Tk.js";import{S as he,a as ge,b as fe,c as ve,d as se}from"./select-Bbe1RuXu.js";import{S as os}from"./switch-BIQUlD4u.js";import{f as N,s as H}from"./format-Du31obhd.js";import{n as ls,i as V,a as _e,b as we,e as re,s as Se,c as cs}from"./isSameMonth-d7r8RW-d.js";import{C as ds}from"./chevron-left-BFxUkP0a.js";import{C as ms}from"./chevron-right-BSwXEIvG.js";import{a as ne}from"./addDays-B8IlFpsM.js";import{e as Ce}from"./endOfMonth-DL9zlqV0.js";import{c as ke,e as R}from"./es-BteQoBuv.js";import{c as ps}from"./constructNow-ChcPjMH_.js";import{C as A}from"./clock-CeESiC7i.js";import{U as F}from"./users-OjDIvTV8.js";import{A as te}from"./armchair-DAb3EjUi.js";import{P as xs}from"./dropdown-menu-C4-9o8Rw.js";import{E as us,a as hs,e as gs,c as fs,d as vs}from"./empty-SlYDCCGq.js";import{F as js}from"./funnel-BZsMhn6I.js";import{S as je}from"./menuConfig-GyORRgsI.js";import{c as Me}from"./createLucideIcon-CJjlOp5I.js";import{P as bs}from"./phone-CjM3-a2W.js";import{M as Ns}from"./map-pin-Du3W4-OO.js";import{P as ys}from"./pencil-BtBbIayn.js";import{D as be}from"./dollar-sign-BPdK9bmd.js";import{C as Ne}from"./circle-x-Eb_n5uBr.js";import{C as _s}from"./circle-check-big-DObkKIth.js";import"./utils-B0KHI9vB.js";import"./card-DbFVjWqh.js";import"./progress-D5NiGDeK.js";import"./index-DdTS5Ad2.js";import"./index-CZBSMaku.js";import"./badge-check-CEpGdEtW.js";import"./lock-BHZn93rL.js";import"./sparkles-JbdQIbjf.js";import"./external-link-pORnC0H4.js";import"./chevron-down-Dux0wLDw.js";import"./headphones-DD_UyCnk.js";import"./user-D9c6nVY3.js";import"./shield-BtuNH23d.js";import"./sonner-DQ2kSMfY.js";import"./index-BDWpq_YI.js";import"./index-BrcTw33p.js";import"./index-BMdzuiHN.js";import"./index-tfOuMV4B.js";import"./x-dvUxMxq3.js";import"./index-BdQq_4o_.js";import"./index-fFU5c_p6.js";import"./index-Dvu8qGWr.js";import"./index-CbR7iZJO.js";import"./index-DeHGgcwY.js";import"./index--Jev_GdI.js";import"./check-BAxbGpAF.js";import"./chevron-up-IlwuOcq-.js";import"./circle-check-CN90YBLh.js";import"./trash-2-CMPgRqgc.js";import"./credit-card-CPDlDYf1.js";import"./shopping-bag-CQGcPT0-.js";import"./sheet-BP6KOnln.js";import"./index-CXzOyCXW.js";import"./index-D4lOZYra.js";import"./video-DRtFkuCB.js";import"./chef-hat-D6sEz8YW.js";import"./table-rgWYlWzZ.js";import"./banknote-DTNMynPY.js";import"./star-D-Iirb7f.js";import"./calendar-check-fjlZrFwy.js";import"./calendar-BW0rhnMu.js";import"./briefcase-Crq0rSJT.js";import"./truck-Db-Ebch9.js";import"./message-circle-DrNrCoj8.js";import"./package-BPq1-jLc.js";import"./layout-dashboard-BqLojFjH.js";const ws=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],L=Me("calendar-days",ws);const Ss=[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]],Cs=Me("timer",Ss);function De(o,i){const{start:a,end:p}=ls(i?.in,o);let d=+a>+p;const u=d?+a:+p,h=d?p:a;h.setHours(0,0,0,0);let m=1;const c=[];for(;+h<=u;)c.push(ke(a,h)),h.setDate(h.getDate()+m),h.setHours(0,0,0,0);return d?c.reverse():c}function ae(o,i){return V(ke(o,o),ps(o))}function ks(o,i,a){return ne(o,-i,a)}function Ms(o,i,a){return _e(o,-i,a)}function Ds(o,i,a){return we(o,-i,a)}function ie(o){const i=o.substring(0,10);return new Date(i+"T00:00:00")}const Re=Array.from({length:16},(o,i)=>i+7),oe={pending:"bg-yellow-100 border-yellow-300 text-yellow-800",confirmed:"bg-emerald-100 border-emerald-300 text-emerald-800",seated:"bg-blue-100 border-blue-300 text-blue-800",cancelled:"bg-red-100 border-red-300 text-red-800",no_show:"bg-slate-100 border-slate-300 text-slate-600"},Rs={pending:"bg-yellow-500",confirmed:"bg-emerald-500",seated:"bg-blue-500",cancelled:"bg-red-500",no_show:"bg-slate-400"};function Os({reservations:o,currentDate:i,viewMode:a,onViewChange:p,onDateChange:d,onReservationClick:u}){const h=r=>{d((r==="prev"?a==="day"?ks:a==="week"?Ds:Ms:a==="day"?ne:a==="week"?we:_e)(i,1))},m=()=>d(new Date),c=g.useMemo(()=>{if(a==="day")return N(i,"EEEE d 'de' MMMM, yyyy",{locale:R});if(a==="week"){const r=H(i,{weekStartsOn:1}),j=re(i,{weekStartsOn:1});return`${N(r,"d MMM",{locale:R})} — ${N(j,"d MMM yyyy",{locale:R})}`}return N(i,"MMMM yyyy",{locale:R})},[i,a]);return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border overflow-hidden",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 px-4 py-3 border-b bg-slate-50/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{variant:"outline",size:"sm",onClick:()=>h("prev"),children:e.jsx(ds,{className:"w-4 h-4"})}),e.jsx(v,{variant:"outline",size:"sm",onClick:m,className:"text-xs font-medium",children:"Hoy"}),e.jsx(v,{variant:"outline",size:"sm",onClick:()=>h("next"),children:e.jsx(ms,{className:"w-4 h-4"})}),e.jsx("h2",{className:"text-sm font-bold text-slate-800 ml-2 capitalize",children:c})]}),e.jsx("div",{className:"flex items-center bg-slate-100 rounded-lg p-0.5",children:["day","week","month"].map(r=>e.jsx("button",{onClick:()=>p(r),className:`px-3 py-1.5 text-xs font-semibold rounded-md transition-all ${a===r?"bg-white shadow text-indigo-700":"text-slate-500 hover:text-slate-700"}`,children:r==="day"?"Día":r==="week"?"Semana":"Mes"},r))})]}),a==="month"&&e.jsx(Es,{currentDate:i,reservations:o,onDayClick:r=>{d(r),p("day")},onReservationClick:u}),a==="week"&&e.jsx(As,{currentDate:i,reservations:o,onReservationClick:u,onDayClick:r=>{d(r),p("day")}}),a==="day"&&e.jsx(Is,{currentDate:i,reservations:o,onReservationClick:u})]})}function Es({currentDate:o,reservations:i,onDayClick:a,onReservationClick:p}){const d=Se(o),u=Ce(o),h=H(d,{weekStartsOn:1}),m=re(u,{weekStartsOn:1}),c=De({start:h,end:m}),r=["Lun","Mar","Mié","Jue","Vie","Sáb","Dom"],j=n=>i.filter(b=>{const C=b.reservation_date?ie(b.reservation_date):null;return C&&V(C,n)});return e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"grid grid-cols-7 mb-1",children:r.map(n=>e.jsx("div",{className:"text-center text-[11px] font-bold text-slate-400 uppercase py-2",children:n},n))}),e.jsx("div",{className:"grid grid-cols-7 gap-px bg-slate-100 rounded-lg overflow-hidden",children:c.map(n=>{const b=j(n),C=cs(n,o),y=ae(n);return e.jsxs("button",{onClick:()=>a(n),className:`min-h-[90px] p-1.5 text-left transition-colors ${C?"bg-white hover:bg-indigo-50":"bg-slate-50/50 text-slate-300"} ${y?"ring-2 ring-inset ring-indigo-500":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:`text-xs font-bold ${y?"bg-indigo-600 text-white w-6 h-6 flex items-center justify-center rounded-full":""}`,children:N(n,"d")}),b.length>0&&e.jsx(D,{variant:"outline",className:"text-[9px] h-4 px-1 font-black bg-indigo-50 text-indigo-700 border-indigo-200",children:b.length})]}),e.jsxs("div",{className:"space-y-0.5",children:[b.slice(0,3).map(w=>e.jsxs("div",{onClick:q=>{q.stopPropagation(),p(w)},className:`text-[9px] leading-tight px-1 py-0.5 rounded border truncate cursor-pointer hover:opacity-80 ${oe[w.status]}`,children:[w.reservation_time?.substring(0,5)," ",w.customer_name]},w.id)),b.length>3&&e.jsxs("div",{className:"text-[9px] text-slate-400 pl-1",children:["+",b.length-3," más"]})]})]},n.toISOString())})})]})}function As({currentDate:o,reservations:i,onReservationClick:a,onDayClick:p}){const d=H(o,{weekStartsOn:1}),u=De({start:d,end:ne(d,6)}),h=m=>i.filter(c=>{const r=c.reservation_date?ie(c.reservation_date):null;return r&&V(r,m)});return e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"min-w-[700px]",children:e.jsxs("div",{className:"grid grid-cols-[60px_repeat(7,1fr)]",children:[e.jsx("div",{className:"border-b border-r bg-slate-50 p-2"}),u.map(m=>e.jsxs("button",{onClick:()=>p(m),className:`border-b border-r p-2 text-center hover:bg-indigo-50 transition-colors ${ae(m)?"bg-indigo-50":"bg-slate-50"}`,children:[e.jsx("div",{className:"text-[10px] uppercase font-bold text-slate-400",children:N(m,"EEE",{locale:R})}),e.jsx("div",{className:`text-sm font-black mt-0.5 ${ae(m)?"bg-indigo-600 text-white w-7 h-7 flex items-center justify-center rounded-full mx-auto":"text-slate-700"}`,children:N(m,"d")})]},m.toISOString())),Re.map(m=>e.jsxs(ye.Fragment,{children:[e.jsx("div",{className:"border-r border-b px-2 py-3 text-[10px] font-bold text-slate-400 text-right",children:`${m}:00`}),u.map(c=>{const j=h(c).filter(n=>parseInt(n.reservation_time?.substring(0,2)||"0")===m);return e.jsx("div",{className:"border-r border-b p-0.5 min-h-[48px] relative",children:j.map(n=>e.jsxs("button",{onClick:()=>a(n),className:`w-full text-left text-[10px] leading-tight px-1.5 py-1 rounded border mb-0.5 cursor-pointer hover:shadow transition-shadow ${oe[n.status]}`,children:[e.jsx("div",{className:"font-bold truncate",children:n.customer_name}),e.jsxs("div",{className:"flex items-center gap-1 opacity-70",children:[e.jsx(A,{className:"w-2.5 h-2.5"}),n.reservation_time?.substring(0,5),e.jsx(F,{className:"w-2.5 h-2.5 ml-1"}),n.party_size]})]},n.id))},`${c.toISOString()}-${m}`)})]},m))]})})})}function Is({currentDate:o,reservations:i,onReservationClick:a}){const p=i.filter(c=>{const r=c.reservation_date?ie(c.reservation_date):null;return r&&V(r,o)}),d=Re.map(c=>({hour:c,label:`${c}:00`,reservations:p.filter(r=>parseInt(r.reservation_time?.substring(0,2)||"0")===c)})),u=p.filter(c=>c.status==="pending").length,h=p.filter(c=>c.status==="confirmed").length,m=p.filter(c=>c.status==="seated").length;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-4 px-4 py-3 bg-slate-50/70 border-b text-xs",children:[e.jsxs("span",{className:"font-bold text-slate-600",children:[p.length," reservas"]}),u>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-yellow-500"}),u," pendientes"]}),h>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-emerald-500"}),h," confirmadas"]}),m>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500"}),m," sentados"]})]}),e.jsx("div",{className:"divide-y",children:d.map(({hour:c,label:r,reservations:j})=>e.jsxs("div",{className:"grid grid-cols-[70px_1fr] min-h-[56px]",children:[e.jsx("div",{className:"flex items-start justify-end pr-3 pt-2 text-xs font-bold text-slate-400 border-r",children:r}),e.jsx("div",{className:"p-1.5 space-y-1.5",children:j.map(n=>e.jsxs("button",{onClick:()=>a(n),className:`w-full text-left px-3 py-2.5 rounded-lg border transition-all hover:shadow-md cursor-pointer ${oe[n.status]}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${Rs[n.status]}`}),e.jsx("span",{className:"font-bold text-sm",children:n.customer_name})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs opacity-70",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(A,{className:"w-3 h-3"}),n.reservation_time?.substring(0,5)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(F,{className:"w-3 h-3"}),n.party_size]}),n.table&&e.jsxs("span",{className:"flex items-center gap-1 font-medium",children:[e.jsx(te,{className:"w-3 h-3"}),n.table.name]})]})]}),n.notes&&e.jsxs("p",{className:"text-[10px] mt-1 italic opacity-60 truncate",children:['"',n.notes,'"']})]},n.id))})]},c))})]})}function Ts(o){const i=o.substring(0,10);return new Date(i+"T00:00:00")}function la({reservations:o,tables:i,locations:a,filters:p}){const{currentTenant:d,currentUserRole:u}=Je().props,[h,m]=g.useState(!1),c=s=>u?u.is_owner||u.permissions.includes("*")||u.permissions.includes(s):!1,r=(s,l,f)=>{s&&s.preventDefault(),c(l)?f():m(!0)},[j,n]=g.useState(()=>{const s=new Date;return new Date(s.getFullYear(),s.getMonth(),s.getDate())}),[b,C]=g.useState("week"),[y,w]=g.useState(p.location_id||""),[q,k]=g.useState(!1),[Oe,I]=g.useState(!1),[Ee,T]=g.useState(!1),[t,Ae]=g.useState(null),[B,le]=g.useState(null),[z,Ie]=g.useState("seated"),[ce,de]=g.useState(""),[Te,$]=g.useState(!1),[ze,P]=g.useState(!1),[W,me]=g.useState(""),[G,pe]=g.useState(""),x=Xe({reservation_price_per_person:0,reservation_min_anticipation:2,reservation_slot_duration:60,reservation_payment_proof_required:!1}),$e=(s,l)=>l==="day"?{start:s,end:s}:l==="week"?{start:H(s,{weekStartsOn:1}),end:re(s,{weekStartsOn:1})}:{start:Se(s),end:Ce(s)},U=(s,l,f)=>{const{start:X,end:O}=$e(s,l);M.get(route("tenant.admin.reservations.index",{tenant:d.slug}),{date:N(s,"yyyy-MM-dd"),start_date:N(X,"yyyy-MM-dd"),end_date:N(O,"yyyy-MM-dd"),view:l,location_id:f==="all"?"":f},{preserveState:!0})},Pe=s=>{n(s),U(s,b,y)},Le=s=>{C(s),U(j,s,y)},Fe=s=>{w(s),U(j,b,s)};ye.useEffect(()=>{const s=Ke();return s&&d?.id&&s.channel(`tenant.${d.id}.reservations`).listen(".reservation.created",()=>{M.reload({only:["reservations"]})}),()=>{try{s&&d?.id&&s.connector?.ably?.connection?.state==="connected"&&s.leave(`tenant.${d.id}.reservations`)}catch{}}},[d?.id]);const He=s=>{Ae(s),P(!1),me(s.reservation_date||""),pe(s.reservation_time?.substring(0,5)||""),k(!0)},Ve=()=>{t&&M.put(route("tenant.admin.reservations.update",{tenant:d.slug,reservation:t.id}),{status:t.status,reservation_date:W,reservation_time:G},{onSuccess:()=>{_.success("Reserva reagendada. Se notificó al cliente por WhatsApp."),P(!1),k(!1)},onError:()=>{_.error("No se pudo reagendar la reserva. Intenta de nuevo.")}})},J=(s,l)=>{if(l==="confirmed"&&s.table_id){M.put(route("tenant.admin.reservations.update",{tenant:d.slug,reservation:s.id}),{status:"confirmed",table_id:s.table_id},{onSuccess:()=>{_.success("Reserva confirmada"),k(!1)},onError:()=>{_.error("No se pudo confirmar la reserva. Intenta de nuevo.")}});return}if(l==="seated"||l==="confirmed"){Ie(l),le(s.table_id||null),k(!1),I(!0);return}M.put(route("tenant.admin.reservations.update",{tenant:d.slug,reservation:s.id}),{status:l},{onSuccess:()=>{_.success(`Reserva ${l==="cancelled"?"cancelada":"actualizada"}`),k(!1)},onError:()=>{_.error("No se pudo actualizar la reserva. Intenta de nuevo.")}})},qe=()=>{t&&M.put(route("tenant.admin.reservations.update",{tenant:d.slug,reservation:t.id}),{status:z,table_id:B},{onSuccess:()=>{I(!1),_.success(z==="seated"?"Cliente sentado. Mesa ocupada.":"Reserva confirmada.")},onError:()=>{_.error("No se pudo completar la acción. Intenta de nuevo.")}})},Be=()=>{const s=y&&y!=="all"?y:a[0]?.id.toString()||"";de(s);const l=a.find(f=>f.id.toString()===s);l&&x.setData({reservation_price_per_person:l.reservation_price_per_person,reservation_min_anticipation:l.reservation_min_anticipation,reservation_slot_duration:l.reservation_slot_duration,reservation_payment_proof_required:l.reservation_payment_proof_required||!1}),T(!0)},We=s=>{de(s);const l=a.find(f=>f.id.toString()===s);l&&x.setData({reservation_price_per_person:l.reservation_price_per_person,reservation_min_anticipation:l.reservation_min_anticipation,reservation_slot_duration:l.reservation_slot_duration,reservation_payment_proof_required:l.reservation_payment_proof_required||!1})},Ge=()=>{x.put(route("tenant.admin.reservations.settings.update",{tenant:d.slug,location:ce}),{onSuccess:()=>{T(!1),_.success("Configuración de sede actualizada")},onError:()=>{_.error("No se pudo actualizar la configuración. Intenta de nuevo.")}})},Ue=s=>{switch(s){case"pending":return e.jsx(D,{variant:"outline",className:"bg-yellow-100 text-yellow-800",children:"Pendiente"});case"confirmed":return e.jsx(D,{variant:"outline",className:"bg-green-100 text-green-800",children:"Confirmada"});case"seated":return e.jsx(D,{variant:"outline",className:"bg-blue-100 text-blue-800",children:"Sentado"});case"cancelled":return e.jsx(D,{variant:"outline",className:"bg-red-100 text-red-800",children:"Cancelada"});default:return e.jsx(D,{variant:"outline",children:s})}};return e.jsxs(Qe,{title:"Gestión de Reservas",breadcrumbs:[{label:"Gastronomía"},{label:"Reservas"}],children:[e.jsx(Ye,{title:"Gestión de Reservas"}),e.jsx("div",{className:"py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(js,{className:"w-4 h-4 text-slate-400"}),e.jsxs(he,{value:y||"all",onValueChange:Fe,children:[e.jsx(ge,{className:"w-[180px] h-9 text-sm",children:e.jsx(fe,{placeholder:"Todas las Sedes"})}),e.jsxs(ve,{children:[e.jsx(se,{value:"all",children:"Todas las Sedes"}),a.map(s=>e.jsx(se,{value:s.id.toString(),children:s.name},s.id))]})]})]})}),e.jsxs(v,{variant:"outline",size:"sm",onClick:s=>r(s,"reservations.update",Be),className:"gap-2",children:[e.jsx(je,{className:"w-4 h-4"})," Configuración"]})]}),o.length===0&&!y?e.jsx(us,{className:"border-2 border-dashed rounded-xl bg-white py-12",children:e.jsxs(hs,{children:[e.jsx(gs,{variant:"icon",children:e.jsx(L,{className:"size-4"})}),e.jsx(fs,{children:"No hay reservas registradas"}),e.jsx(vs,{children:"Las reservas creadas por los clientes aparecerán aquí."})]})}):e.jsx(Os,{reservations:o,currentDate:j,viewMode:b,onViewChange:Le,onDateChange:Pe,onReservationClick:He})]})}),e.jsx(Y,{open:q,onOpenChange:k,children:e.jsxs(K,{className:"sm:max-w-md",children:[e.jsxs(Q,{children:[e.jsx(Z,{className:"text-lg",children:"Detalle de Reserva"}),e.jsx(ee,{children:t&&Ue(t.status)})]}),t&&e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-800",children:[e.jsx(F,{className:"w-4 h-4 text-indigo-600"}),e.jsx("span",{className:"font-bold text-lg",children:t.customer_name})]}),e.jsxs("div",{className:"flex items-center gap-2 text-slate-600 text-sm",children:[e.jsx(bs,{className:"w-4 h-4"}),e.jsx("span",{children:t.customer_phone})]}),t.location&&e.jsxs("div",{className:"flex items-center gap-2 text-slate-500 text-sm",children:[e.jsx(Ns,{className:"w-4 h-4"}),e.jsx("span",{children:t.location.name})]})]}),e.jsxs("div",{className:"bg-slate-50 rounded-lg p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(A,{className:"w-4 h-4 text-indigo-600"}),t.reservation_time.substring(0,5)]}),e.jsxs("span",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(F,{className:"w-4 h-4 text-indigo-600"}),t.party_size," personas"]})]}),t.table&&e.jsxs("div",{className:"flex items-center gap-2 text-indigo-600 font-medium text-sm",children:[e.jsx(te,{className:"w-4 h-4"}),"Mesa: ",t.table.name]}),t.reservation_date&&e.jsxs("div",{className:"text-xs text-slate-400",children:["Fecha: ",N(Ts(t.reservation_date),"d 'de' MMMM, yyyy",{locale:R})]})]}),t.status!=="cancelled"&&t.status!=="seated"&&e.jsx("div",{className:"border rounded-lg p-3 bg-white",children:ze?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-xs font-bold text-slate-700 flex items-center gap-1",children:[e.jsx(L,{className:"w-3.5 h-3.5"})," Reagendar reserva"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(S,{className:"text-xs",children:"Nueva fecha"}),e.jsx(E,{type:"date",value:W,onChange:s=>me(s.target.value),min:N(new Date,"yyyy-MM-dd"),className:"text-sm"})]}),e.jsxs("div",{children:[e.jsx(S,{className:"text-xs",children:"Nueva hora"}),e.jsx(E,{type:"time",value:G,onChange:s=>pe(s.target.value),className:"text-sm"})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(v,{size:"sm",variant:"ghost",onClick:()=>P(!1),children:"Cancelar"}),e.jsxs(v,{size:"sm",onClick:s=>r(s,"reservations.update",Ve),disabled:!W||!G,className:"gap-1",children:[e.jsx(L,{className:"w-3.5 h-3.5"})," Guardar y Notificar"]})]}),e.jsx("p",{className:"text-[10px] text-slate-400",children:"Se enviará notificación por WhatsApp al cliente con la nueva fecha/hora."})]}):e.jsxs("button",{type:"button",onClick:s=>r(s,"reservations.update",()=>P(!0)),className:"flex items-center gap-2 text-sm text-indigo-600 hover:text-indigo-800 font-medium transition-colors w-full",children:[e.jsx(L,{className:"w-4 h-4"}),e.jsx(ys,{className:"w-3 h-3"}),"Reagendar reserva"]})}),t.notes&&e.jsxs("div",{className:"bg-yellow-50 p-3 rounded-lg text-sm text-yellow-800 italic",children:['"',t.notes,'"']}),t.payment_proof&&t.payment_proof_url&&e.jsxs("div",{className:"mt-2 border rounded-lg p-2 bg-slate-50",children:[e.jsxs("p",{className:"text-xs font-bold text-slate-700 mb-2 flex items-center gap-1",children:[e.jsx(be,{className:"w-3 h-3"})," Comprobante de Pago"]}),e.jsxs("a",{href:t.payment_proof_url,target:"_blank",rel:"noopener noreferrer",className:"block relative group overflow-hidden rounded-md border border-slate-200",children:[e.jsx("img",{src:t.payment_proof_url,alt:"Comprobante",className:"w-full h-auto max-h-[200px] object-cover transition-transform group-hover:scale-105"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center text-white text-xs font-bold",children:"Clic para ver completo"})]})]}),e.jsx(xe,{}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2",children:[t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(v,{size:"sm",variant:"destructive",className:"gap-1",onClick:s=>r(s,"reservations.update",()=>$(!0)),children:[e.jsx(Ne,{className:"w-4 h-4"})," Cancelar"]}),e.jsxs(v,{size:"sm",className:"gap-1 ml-auto",onClick:s=>r(s,"reservations.update",()=>J(t,"confirmed")),children:[e.jsx(_s,{className:"w-4 h-4"})," Confirmar + Asignar Mesa"]})]}),t.status==="confirmed"&&e.jsxs(e.Fragment,{children:[e.jsxs(v,{size:"sm",variant:"outline",className:"gap-1",onClick:s=>r(s,"reservations.update",()=>$(!0)),children:[e.jsx(Ne,{className:"w-4 h-4"})," Cancelar"]}),e.jsxs(v,{size:"sm",className:"gap-1 ml-auto",onClick:s=>r(s,"reservations.update",()=>J(t,"seated")),children:[e.jsx(te,{className:"w-4 h-4"})," Sentar (Check-in)"]})]}),(t.status==="cancelled"||t.status==="seated")&&e.jsx("p",{className:"text-xs text-slate-400 italic w-full text-center",children:t.status==="seated"?"El cliente ya está sentado.":"Reserva cancelada."})]})]})]})}),e.jsx(Ze,{open:Te,onOpenChange:$,children:e.jsxs(es,{children:[e.jsxs(ss,{children:[e.jsx(ts,{children:"¿Cancelar esta reserva?"}),e.jsxs(as,{children:["Esta acción cancelará la reserva de ",e.jsx("strong",{children:t?.customer_name})," y liberará la mesa asignada. El cliente no será notificado automáticamente."]})]}),e.jsxs(rs,{children:[e.jsx(ns,{children:"Volver"}),e.jsx(is,{variant:"destructive",onClick:()=>{t&&J(t,"cancelled"),$(!1)},children:"Sí, cancelar reserva"})]})]})}),e.jsx(Y,{open:Oe,onOpenChange:I,children:e.jsxs(K,{className:"sm:max-w-lg",children:[e.jsxs(Q,{children:[e.jsxs(Z,{children:["Asignar Mesa a ",t?.customer_name]}),e.jsx(ee,{children:t&&e.jsxs("span",{children:["Reserva para las ",e.jsx("strong",{children:t.reservation_time.substring(0,5)})," — ",t.party_size," personas"]})})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3 py-4 max-h-[400px] overflow-y-auto",children:i.filter(s=>{if(!t?.location)return!0;const l=a.find(f=>f.name===t.location?.name)?.id;return!s.location_id||s.location_id===l}).map(s=>{const l=s.reservations||[],f=l.length>0,X=B===s.id;return e.jsxs("button",{onClick:()=>le(s.id),className:`rounded-xl border-2 p-3 text-left transition-all ${X?"border-indigo-600 bg-indigo-50 ring-2 ring-indigo-200":s.status==="occupied"?"border-red-200 bg-red-50 hover:border-red-400 opacity-75":f?"border-amber-200 bg-amber-50 hover:border-amber-400":"border-slate-200 bg-white hover:border-emerald-400 hover:bg-emerald-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-bold text-sm",children:s.name}),s.status==="occupied"?e.jsx("span",{className:"text-[9px] font-black uppercase bg-red-500 text-white px-1.5 py-0.5 rounded-full",children:"Ocupada (POS)"}):f?e.jsx("span",{className:"text-[9px] font-black uppercase bg-amber-500 text-white px-1.5 py-0.5 rounded-full",children:"Reservada"}):e.jsx("span",{className:"text-[9px] font-black uppercase bg-emerald-500 text-white px-1.5 py-0.5 rounded-full",children:"Libre"})]}),f&&e.jsx("div",{className:"space-y-1",children:l.map(O=>e.jsxs("div",{className:"text-[10px] text-amber-800 bg-amber-100 rounded px-1.5 py-0.5",children:[e.jsx(A,{className:"w-2.5 h-2.5 inline mr-0.5"}),O.reservation_time.substring(0,5)," — ",O.customer_name]},O.id))}),!f&&s.status!=="occupied"&&e.jsx("p",{className:"text-[10px] text-emerald-600 font-medium",children:"Disponible"}),s.status==="occupied"&&e.jsx("p",{className:"text-[10px] text-red-600 font-medium",children:"Mesa en servicio"})]},s.id)})}),e.jsxs(ue,{children:[e.jsx(v,{variant:"ghost",onClick:()=>I(!1),children:"Cancelar"}),e.jsx(v,{onClick:qe,disabled:z==="seated"&&!B,children:z==="seated"?"Confirmar y Sentar":"Confirmar Reserva"})]})]})}),e.jsx(Y,{open:Ee,onOpenChange:T,children:e.jsxs(K,{className:"sm:max-w-[425px]",children:[e.jsxs(Q,{children:[e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5 text-indigo-600"}),"Configuración de Reservas"]}),e.jsx(ee,{children:"Ajusta los parámetros globales de reserva para tus sedes."})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{children:"Seleccionar Sede para configurar"}),e.jsxs(he,{value:ce,onValueChange:We,children:[e.jsx(ge,{children:e.jsx(fe,{placeholder:"Selecciona sede"})}),e.jsx(ve,{children:a.map(s=>e.jsx(se,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsx(xe,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(Cs,{className:"w-4 h-4 text-slate-400"})," Anticipación Mínima (Horas)"]}),e.jsx(E,{type:"number",step:"0.5",value:x.data.reservation_min_anticipation,onChange:s=>x.setData("reservation_min_anticipation",parseFloat(s.target.value))}),x.errors.reservation_min_anticipation&&e.jsx("p",{className:"text-xs text-red-600",children:x.errors.reservation_min_anticipation}),e.jsx("p",{className:"text-[11px] text-slate-500 italic",children:"Ej: 0.5 para permitir reservas con 30 min de antelación."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-slate-400"})," Duración de la Reserva (Minutos)"]}),e.jsx(E,{type:"number",step:"15",value:x.data.reservation_slot_duration,onChange:s=>x.setData("reservation_slot_duration",parseInt(s.target.value))}),x.errors.reservation_slot_duration&&e.jsx("p",{className:"text-xs text-red-600",children:x.errors.reservation_slot_duration})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4 text-slate-400"})," Valor por Persona (Depósito)"]}),e.jsx(E,{type:"number",value:x.data.reservation_price_per_person,onChange:s=>x.setData("reservation_price_per_person",parseFloat(s.target.value))}),x.errors.reservation_price_per_person&&e.jsx("p",{className:"text-xs text-red-600",children:x.errors.reservation_price_per_person}),e.jsx("p",{className:"text-[11px] text-slate-500 italic",children:"Monto informativo o garantía por comensal."})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-100",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(S,{className:"text-sm font-bold text-slate-700",children:"Comprobante de Pago Obligatorio"}),e.jsx("p",{className:"text-[10px] text-slate-500",children:"Si se activa, el cliente deberá subir una foto del pago para completar la reserva."})]}),e.jsx(os,{checked:x.data.reservation_payment_proof_required,onCheckedChange:s=>x.setData("reservation_payment_proof_required",s)})]})]})]}),e.jsxs(ue,{children:[e.jsx(v,{variant:"ghost",onClick:()=>T(!1),children:"Cancelar"}),e.jsx(v,{onClick:s=>r(s,"reservations.update",Ge),disabled:x.processing,children:x.processing?"Guardando...":"Guardar Configuración"})]})]})}),e.jsx(xs,{open:h,onOpenChange:m})]})}export{la as default};
