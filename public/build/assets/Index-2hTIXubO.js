import{c as G,r as f,j as e,H as Q,L as U,a as _,t as b}from"./app-Bo0l-nyL.js";import{A as J}from"./AdminLayout-C6Sg4Zll.js";import{C as S,a as P,b as A,d as E,e as K}from"./card-CLdEHqC0.js";import{B as n}from"./button-10Bc0E3d.js";import{B as D}from"./badge-T_0PRSRY.js";import{P as X}from"./progress-D0S33OG3.js";import{D as ee,a as se,b as te,c as ae,d as re,e as le}from"./dialog-NO27f9rI.js";import{P as ie}from"./PaymentUploadModal-DqeSTj2d.js";import{P as ne}from"./dropdown-menu-BLdek0j6.js";import{c as m}from"./utils-DvD3N-9F.js";import{s as j}from"./index-BsxvijQw.js";import{a as ce}from"./menuConfig-BOuu1B4n.js";import{Z as oe}from"./zap-iM1apaM2.js";import{C as de}from"./clock-CrkUijLd.js";import{C as me}from"./calendar-D4jj149y.js";import{C as L}from"./circle-alert-BtaHG5e1.js";import{E as pe}from"./eye-BYADnBQT.js";import{U as xe}from"./upload-CESSpqcB.js";import{B as ue}from"./banknote-DJcUNiBm.js";import{S as he}from"./shield-check-C8RmYxKr.js";import{C as ge}from"./check-BxakoWLx.js";import"./badge-check-DcDsd9yF.js";import"./createLucideIcon-3AckdKRt.js";import"./lock-C0idjUkm.js";import"./chevron-right-B4UhmXxg.js";import"./sparkles-vlQ-BtbS.js";import"./separator-rnPeP9N4.js";import"./index-CS0_ycFC.js";import"./external-link-Y_4JyQ6V.js";import"./chevron-down-CPoZLJYe.js";import"./headphones-CjhisdwC.js";import"./user-acg25hwS.js";import"./shield-BGp86V--.js";import"./sonner-CzapNevX.js";import"./index-DlxfeT00.js";import"./index-Bj75TZ4c.js";import"./index-nKjDUAgZ.js";import"./index-CXl70Eho.js";import"./index-BaTs_s0z.js";import"./x-0PRwyTAe.js";import"./file-text-BmlKQd1A.js";import"./loader-circle-PUm0Wiqp.js";import"./circle-check-D-62-mjA.js";import"./trash-2-CGD0dP--.js";import"./credit-card-C_0EBMTX.js";import"./shopping-bag-ovPa-jWO.js";import"./input-BQLGMA-c.js";import"./sheet-Bz3Lea4F.js";import"./index-UkxbaV1a.js";import"./index-Ce-cpEu5.js";import"./index-DU1na7Ze.js";import"./index-DY8QIQU5.js";import"./index-BrTki0md.js";import"./index-Q_gv5oQO.js";import"./video-BGNY4j_B.js";import"./chef-hat-CDDba4XX.js";import"./table-BLeiRYc-.js";import"./map-pin-D3kvadl2.js";import"./star-CdjPFmgy.js";import"./users-Cl7FA0jJ.js";import"./calendar-check-DPCeCTk6.js";import"./briefcase-BYvTdAUi.js";import"./truck-NgeJ0yFz.js";import"./message-circle-DoLMoG-m.js";import"./package-BgNM9KIq.js";import"./layout-dashboard-Cko18NrJ.js";function As({tenant:p,plans:q,pendingInvoice:x}){const{props:B}=G(),u=B.flash||{},y=B.currentUserRole,t=p.latest_subscription,o=t?.plan,[l,F]=f.useState("monthly"),[M,O]=f.useState(!1),[$,T]=f.useState(!1),[d,N]=f.useState({show:!1,currentSlug:"",newAutoSlug:"",pendingPlanId:null,pendingBillingCycle:"monthly"}),R=s=>y?y.is_owner||y.permissions.includes("*")||y.permissions.includes(s):!1,w=(s,a)=>{R(s)?a():T(!0)};f.useEffect(()=>{u?.slug_warning&&N({show:!0,currentSlug:u.current_slug||"",newAutoSlug:u.new_auto_slug||"",pendingPlanId:u.pending_plan_id||null,pendingBillingCycle:u.pending_billing_cycle||"monthly"})},[u]);const I=()=>{w("billing.manage",()=>{_.post(j("tenant.subscription.advance-invoice",{tenant:p.slug}),{},{onSuccess:()=>{b.success("Factura generada. Ya puedes reportar tu pago.")},onError:()=>{b.error("Error al generar la factura anticipada")}})})},H=(s,a=!1)=>{if(s.id===o?.id&&l===t?.billing_cycle){b.info("Ya te encuentras en este plan y ciclo");return}w("billing.manage",()=>{_.post(j("tenant.subscription.change-plan",{tenant:p.slug}),{plan_id:s.id,billing_cycle:l,confirm_slug_loss:a},{onSuccess:i=>{i.props?.flash?.slug_warning||(b.success("Solicitud de cambio procesada correctamente"),N({show:!1,currentSlug:"",newAutoSlug:"",pendingPlanId:null,pendingBillingCycle:"monthly"}))},onError:i=>{console.error(i),b.error("Error al procesar el cambio de plan")}})})},W=()=>{if(d.pendingPlanId){const s=q.find(a=>a.id===d.pendingPlanId);s&&H(s,!0)}},k=s=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(s),V=()=>{if(!t)return"N/A";const s=t.status==="trialing"?t.trial_days_remaining:t.days_remaining;if(s<=0)return"0 días";if(s<30)return`${s} días`;const a=Math.floor(s/30),i=s%30;return a>0&&i>0?`${a} ${a===1?"mes":"meses"} y ${i} ${i===1?"día":"días"}`:a>0?`${a} ${a===1?"mes":"meses"}`:`${s} días`},Y=s=>{switch(s){case"monthly":return"Mensual";case"quarterly":return"Trimestral";case"semiannual":return"Semestral";case"yearly":return"Anual";default:return s}};return e.jsxs(J,{children:[e.jsx(Q,{title:"Mi Plan y Suscripción"}),e.jsx(ne,{open:$,onOpenChange:T}),e.jsxs("div",{className:"max-w-7xl mx-auto space-y-16 pb-20",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-black tracking-tighter uppercase text-slate-900",children:"Planes y Suscripción"}),e.jsx("p",{className:"text-slate-400 font-bold uppercase tracking-widest text-[11px]",children:"Gestiona tu nivel de servicio y activa nuevas funcionalidades."})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsxs(S,{className:"md:col-span-2 shadow-xl border overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 right-0 p-12 opacity-[0.03] rotate-12",children:e.jsx(oe,{className:"w-48 h-48"})}),e.jsx(P,{className:"pb-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(D,{variant:"outline",className:"text-primary border-primary/20 mb-2 uppercase tracking-widest font-black text-[10px]",children:"Plan Actual"}),e.jsx(A,{className:"text-3xl font-black",children:o?.name||"Inactivo"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-[10px] font-black text-muted-foreground uppercase tracking-widest mb-1",children:"Estado"}),e.jsx(D,{variant:t?.status==="active"||t?.status==="trialing"?"default":"destructive",children:t?.status==="trialing"?"En Prueba":"Suscripción Activa"})]})]})}),e.jsxs(E,{className:"space-y-6 relative z-10",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs font-bold uppercase tracking-widest",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progreso del Ciclo"}),e.jsxs("span",{className:"text-primary",children:[t?.percent_completed,"% completado"]})]}),e.jsx(X,{value:t?.percent_completed,className:"h-2 bg-muted shadow-inner"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-6 pt-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black text-muted-foreground uppercase tracking-widest mb-1",children:t?.status==="trialing"?"Días de Prueba":"Tiempo Restante"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-black",children:V()})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black text-muted-foreground uppercase tracking-widest mb-1",children:"Próximo Cobro"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-black",children:t?.next_payment_date?new Date(t.next_payment_date).toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"}):"Pendiente"})]})]}),e.jsxs("div",{className:"col-span-2 md:col-span-1 border-t md:border-t-0 md:border-l pt-4 md:pt-0 md:pl-6",children:[e.jsxs("p",{className:"text-[10px] font-black text-muted-foreground uppercase tracking-widest mb-1",children:["Valor ",Y(t?.billing_cycle||"")]}),e.jsx("p",{className:"text-xl font-black text-primary",children:k(t?.billing_cycle==="yearly"?o?.yearly_price||0:t?.billing_cycle==="semiannual"?o?.semiannual_price||0:t?.billing_cycle==="quarterly"?o?.quarterly_price||0:o?.monthly_price||0)})]})]}),e.jsx("div",{className:"pt-4 flex flex-wrap gap-4 border-t",children:x?e.jsxs("div",{className:"flex items-center gap-4 bg-muted/30 p-4 rounded-2xl border w-full animate-in fade-in slide-in-from-top-2",children:[e.jsx("div",{className:"h-10 w-10 bg-muted rounded-xl flex items-center justify-center text-amber-600",children:e.jsx(L,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs font-black uppercase tracking-tight",children:"Tienes una factura pendiente"}),e.jsxs("p",{className:"text-[10px] font-bold text-muted-foreground uppercase tracking-widest",children:["#",x.id," • ",k(x.amount)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{size:"sm",variant:"outline",className:"h-9 px-4 rounded-xl font-bold bg-background",asChild:!0,children:e.jsxs(U,{href:j("tenant.invoices.show",{tenant:p?.slug,invoice:x.id}),children:[e.jsx(pe,{className:"w-4 h-4 mr-2"})," Detalle"]})}),e.jsxs(n,{size:"sm",className:"h-9 px-6 rounded-xl font-black",onClick:()=>w("billing.manage",()=>O(!0)),children:[e.jsx(xe,{className:"w-4 h-4 mr-2"})," Pagar Ahora"]})]})]}):e.jsxs("div",{className:"flex items-center justify-between w-full bg-muted/30 p-4 rounded-2xl border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-9 w-9 bg-background rounded-xl shadow-sm border flex items-center justify-center text-muted-foreground",children:e.jsx(ue,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-black uppercase tracking-tight",children:"¿Quieres pagar por adelantado?"}),e.jsx("p",{className:"text-[10px] font-bold text-muted-foreground uppercase tracking-widest",children:"Asegura tu servicio para el próximo ciclo"})]})]}),e.jsx(n,{size:"sm",variant:"outline",className:"h-9 px-6 rounded-xl font-bold bg-background transition-all hover:scale-[1.02]",onClick:I,children:"Adelantar Pago"})]})})]})]}),e.jsxs(S,{className:"shadow-lg border bg-muted/30 flex flex-col justify-between",children:[e.jsx(P,{className:"pb-4",children:e.jsxs(A,{className:"text-sm font-bold flex items-center gap-2 text-muted-foreground uppercase tracking-widest",children:[e.jsx(he,{className:"w-4 h-4"}),"Tu Seguridad"]})}),e.jsxs(E,{className:"space-y-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground font-medium leading-relaxed",children:"Tu información de facturación está protegida. Si tienes dudas sobre tu plan actual, puedes ver tus facturas anteriores."}),e.jsx(n,{variant:"outline",className:"w-full h-10 font-bold bg-background",asChild:!0,children:e.jsx(U,{href:j("tenant.invoices.index",{tenant:p?.slug}),children:"Ver Historial de Facturas"})})]})]})]}),e.jsxs("div",{className:"space-y-12",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-8",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"text-2xl font-black tracking-tighter uppercase text-slate-900",children:"Selecciona tu Plan"}),e.jsx("p",{className:"text-[11px] font-bold text-slate-400 uppercase tracking-widest",children:"Escoge la opción que mejor se adapte a tu marca."})]}),e.jsx("div",{className:"bg-slate-100 p-1.5 rounded-2xl flex items-center gap-1",children:["monthly","quarterly","yearly"].map(s=>e.jsxs(n,{variant:l===s?"default":"ghost",size:"sm",className:m("h-10 px-6 rounded-xl font-black text-[10px] uppercase tracking-widest transition-all",l===s?"bg-slate-900 text-white shadow-lg":"text-slate-400 hover:text-slate-600"),onClick:()=>F(s),children:[s==="monthly"?"Mensual":s==="quarterly"?"Trimestral":"Anual",s==="yearly"&&e.jsx(D,{className:"ml-2 bg-green-500 text-[8px] py-0 px-1 border-none text-white",children:"-15%"})]},s))})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:q.map(s=>{const a=s.name.toLowerCase().includes("pro")||s.name.toLowerCase().includes("premium"),i=l==="yearly"?s.yearly_price:l==="quarterly"?s.quarterly_price||0:s.monthly_price,C=s.id===o?.id&&l===t?.billing_cycle;return e.jsxs(S,{className:m("relative transition-all duration-500 border-2 flex flex-col h-full overflow-hidden group",a?"border-primary shadow-2xl shadow-primary/10 z-10 scale-[1.02]":"border-slate-100 hover:border-slate-200"),children:[a&&e.jsx("div",{className:"absolute top-0 right-0 left-0 bg-primary text-white py-2 text-[10px] font-black uppercase tracking-[0.2em] text-center",children:"¡Oferta por tiempo limitado!"}),e.jsxs(P,{className:m("pt-6",a&&"pt-14"),children:[e.jsx(A,{className:"text-xl font-black tracking-tighter text-slate-900 uppercase",children:s.name}),e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-4xl font-black text-slate-900 tracking-tighter",children:k(i)}),e.jsxs("span",{className:"text-slate-400 text-[10px] font-bold uppercase",children:["/",l==="monthly"?"mes":"ciclo"]})]})})]}),e.jsxs(E,{className:"flex-1 px-8 flex flex-col",children:[e.jsx(n,{disabled:C,onClick:()=>w("billing.manage",()=>{_.visit(j("tenant.subscription.checkout",{tenant:p.slug,plan_id:s.id,billing_cycle:l}))}),className:m("w-full h-8 rounded-2xl font-black text-[11px] uppercase tracking-widest transition-all",C?"bg-slate-100 text-slate-400 border shadow-none":a?"bg-primary hover:bg-primary/90 text-white shadow-lg shadow-primary/20":"bg-slate-900 hover:bg-slate-800 text-white"),children:C?"Plan Actual":"Continuar al Pago"}),e.jsx("div",{className:"w-full space-y-2 pt-4 border-t border-slate-50",children:(()=>{const c=s.features;if(!c)return null;let g=[];return Array.isArray(c)?c.forEach(r=>{typeof r=="string"?g.push(r):typeof r=="object"&&r!==null&&Object.keys(r).forEach(h=>{(r[h]===!0||r[h]===1||r[h]==="1")&&g.push(h)})}):typeof c=="object"&&Object.keys(c).forEach(r=>{(c[r]===!0||c[r]===1||c[r]==="1")&&g.push(r)}),g.length===0?null:g.map((r,h)=>{const v=r.startsWith("-"),z=v?r.substring(1):r,Z=ce[z]||z;return e.jsxs("div",{className:m("flex items-center justify-start",v?"opacity-30":"opacity-100"),children:[e.jsx(ge,{className:m("w-4 h-4 mr-2",v?"text-slate-400":"text-slate-600")}),e.jsx("span",{className:m("text-[12px] font-bold",v?"text-slate-400":"text-slate-600"),children:Z})]},h)})})()})]}),e.jsx(K,{className:"pb-8 pt-0 px-8 flex flex-col gap-4"})]},s.id)})})]}),e.jsxs("div",{className:"bg-muted/30 rounded-3xl p-10 flex flex-col md:flex-row items-center justify-between gap-8 border",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary",children:[e.jsx(L,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-black uppercase tracking-widest",children:"Importante"})]}),e.jsx("h4",{className:"text-xl font-black uppercase",children:"¿Necesitas un plan personalizado?"}),e.jsx("p",{className:"text-muted-foreground text-sm font-medium",children:"Si tu proyecto requiere límites especiales o integraciones dedicadas, estamos aquí para ayudarte."})]}),e.jsx(n,{size:"lg",className:"rounded-2xl font-black h-14 px-8 border-2 shadow-sm min-w-[200px]",variant:"outline",children:"Contactar Soporte"})]})]}),x&&e.jsx(ie,{isOpen:M,onClose:()=>O(!1),invoice:x}),e.jsx(ee,{open:d.show,onOpenChange:s=>!s&&N({...d,show:!1}),children:e.jsxs(se,{className:"sm:max-w-md",children:[e.jsxs(te,{children:[e.jsxs(ae,{className:"flex items-center gap-2 text-amber-600",children:[e.jsx(L,{className:"w-5 h-5"}),"Advertencia: Perderás tu URL personalizada"]}),e.jsx(re,{asChild:!0,className:"pt-4 space-y-3",children:e.jsxs("div",{children:[e.jsxs("p",{children:["El plan que seleccionaste ",e.jsx("strong",{children:"no permite URL personalizada"}),". Si continúas, tu tienda cambiará de dirección:"]}),e.jsxs("div",{className:"bg-slate-50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Actual:"}),e.jsxs("code",{className:"bg-muted px-2 py-1 rounded font-bold text-sm",children:["/",d.currentSlug]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Nueva:"}),e.jsxs("code",{className:"bg-muted px-2 py-1 rounded font-bold text-sm",children:["/",d.newAutoSlug]})]})]}),e.jsx("p",{className:"text-amber-600 text-sm font-bold",children:"⚠️ Todos los enlaces anteriores a tu tienda dejarán de funcionar."})]})})]}),e.jsxs(le,{className:"gap-2 sm:gap-0",children:[e.jsx(n,{variant:"outline",onClick:()=>N({...d,show:!1}),children:"Cancelar"}),e.jsx(n,{variant:"destructive",onClick:W,children:"Entiendo, cambiar de plan"})]})]})})]})}export{As as default};
