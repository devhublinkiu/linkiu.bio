import{r,c as ge,b as w,t as p,j as e,a as je}from"./app-Bo0l-nyL.js";import{B as n}from"./button-10Bc0E3d.js";import{S as be}from"./scroll-area-BjAISIzb.js";import{I as z}from"./input-BQLGMA-c.js";import{L as Ne}from"./label-BvJxTSA7.js";import{c as y}from"./utils-DvD3N-9F.js";import{D as ae,a as se,b as ve,c as te,d as re,e as we}from"./dialog-NO27f9rI.js";import{A as ye,a as Ce,b as De,c as Se,d as ke,e as Fe,f as Ee,g as Ae}from"./alert-dialog-CMJa1J5s.js";import{E as Le,a as Pe,e as Me,c as ze,d as Te}from"./empty-Bya45bLo.js";import{P as _e}from"./dropdown-menu-BLdek0j6.js";import{U as T}from"./upload-CESSpqcB.js";import{S as Ue}from"./search-EFBB3uIl.js";import{A as Ie}from"./arrow-left-iwTIuTJY.js";import{L as C}from"./loader-circle-PUm0Wiqp.js";import{F as ee}from"./folder-plus-DGAAOF2Y.js";import{c as Be}from"./createLucideIcon-3AckdKRt.js";import{D as Oe}from"./download-CVVYH8u7.js";import{T as He}from"./trash-2-CGD0dP--.js";import{I as le}from"./image-Btr2v_Lz.js";const qe=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],Ke=Be("folder",qe);function Ve({onSelect:j,multiple:_=!1,apiRoute:d,className:D}){const[U,I]=r.useState([]),[S,B]=r.useState(!1),[k,ne]=r.useState(""),[ie,b]=r.useState(!1),[F,N]=r.useState(null),[oe,f]=r.useState(!1),[v,E]=r.useState(""),[Ge,O]=r.useState([]),[u,ce]=r.useState(1),[A,de]=r.useState(1),[o,H]=r.useState(null),[L,q]=r.useState(!1),[Re,K]=r.useState(0),[me,P]=r.useState(!1),[M,V]=r.useState(!1),{auth:G,currentTenant:pe,currentUserRole:R}=ge().props,l=!!pe,i=route().params,Z=r.useCallback(()=>d||(l&&i.tenant?route("tenant.media.list",i.tenant):route("media.list")),[d,l,i.tenant]),m=r.useCallback(async(a=1)=>{B(!0);try{const s={};l||(s.global=!0),o&&(s.folder=o),a>1&&(s.page=a);const t=await w.get(Z(),{params:s}),c=t.data?.data??t.data,g=Array.isArray(c)?c:[];I(g),t.data?.links?O(t.data.links):O([]),ce(t.data?.meta?.current_page??1),de(t.data?.meta?.last_page??1)}catch(s){console.error("Error fetching files:",s),p.error("Error cargando archivos")}finally{B(!1)}},[o,Z,l]);r.useEffect(()=>{m(1)},[o,m]);const J=async a=>{if(a.trim()){V(!0);try{const s=l?"tenant.media.folder.create":"media.folder.create",t=l?{tenant:i.tenant}:{},c=route(s,t);await w.post(c,{name:a.trim(),parent_folder:o}),p.success("Carpeta creada"),f(!1),E(""),m(1)}catch(s){const t=s?.response?.data?.message??"Error creando carpeta";p.error(t)}finally{V(!1)}}},Q=async a=>{const s=new FormData;s.append("file",a[0]),o&&s.append("folder",o),q(!0);try{const t=l?"tenant.media.store":"media.store",c=l?{tenant:i.tenant}:{},g=route(t,c);await w.post(g,s,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:$=>{const fe=Math.round($.loaded*100/($.total||1));K(fe)}}),p.success("Archivo subido"),m(u)}catch(t){console.error(t),p.error("Error al subir archivo")}finally{q(!1),K(0)}},ue=async a=>{const s=a.target.files;!s||s.length===0||Q(s)},he=async a=>{try{const s=l?"tenant.media.destroy":"media.destroy",t=l?{tenant:i.tenant,id:a}:{id:a};await w.delete(route(s,t)),p.success("Eliminado"),N(null),I(c=>c.filter(g=>g.id!==a))}catch{p.error("Error al eliminar"),N(null)}},xe=a=>{a.preventDefault(),P(!1);const s=a.dataTransfer.files;s&&s.length>0&&Q(s)},W=U.filter(a=>a.name?.toLowerCase().includes(k.toLowerCase())||a.alt_text?.toLowerCase().includes(k.toLowerCase())),h=l?R?.permissions||[]:G.permissions||[],X=l?R?.is_owner:G.user?.is_super_admin,x=X||h.includes("*")||(l?h.includes("media.upload"):h.includes("sa.media.upload")),Y=X||h.includes("*")||(l?h.includes("media.delete"):h.includes("sa.media.delete"));return e.jsxs("div",{className:y("flex flex-col h-full bg-white relative rounded-xl border border-slate-200 overflow-hidden",D),onDragOver:a=>{a.preventDefault(),x&&P(!0)},onDragLeave:a=>{a.preventDefault(),P(!1)},onDrop:a=>{x?xe(a):a.preventDefault()},children:[me&&x&&e.jsx("div",{className:"absolute inset-0 z-50 bg-primary/10 border-2 border-dashed border-primary flex items-center justify-center backdrop-blur-[1px]",children:e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg flex flex-col items-center",children:[e.jsx(T,{className:"w-12 h-12 text-primary mb-2"}),e.jsx("h3",{className:"text-lg font-bold text-primary",children:"Soltar para subir aquí"})]})}),e.jsxs("div",{className:"p-4 flex flex-wrap gap-4 items-center border-b bg-white",children:[e.jsx(_e,{open:ie,onOpenChange:b}),e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(Ue,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),e.jsx(z,{placeholder:"Buscar...",className:"pl-9 bg-white",value:k,onChange:a=>ne(a.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[o&&e.jsxs(n,{variant:"ghost",size:"sm",onClick:()=>H(null),className:"gap-1",children:[e.jsx(Ie,{className:"w-4 h-4"}),"Volver"]}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>m(),title:"Recargar",children:e.jsx(C,{className:y("h-4 w-4",S&&"animate-spin")})}),e.jsxs(n,{variant:"secondary",size:"sm",onClick:()=>{x?f(!0):b(!0)},disabled:M,className:"gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),"Nueva Carpeta"]}),e.jsx(z,{type:"file",className:"hidden",id:"manager-file-upload",onChange:ue,accept:"image/*",disabled:L}),e.jsxs(n,{disabled:L,onClick:()=>{x?document.getElementById("manager-file-upload")?.click():b(!0)},className:"gap-2",size:"sm",children:[L?e.jsx(C,{className:"w-4 h-4 animate-spin"}):e.jsx(T,{className:"w-4 h-4"}),"Subir"]})]})]}),e.jsxs(be,{className:"flex-1 p-4 bg-slate-50/30",children:[S&&U.length===0?e.jsx("div",{className:"flex items-center justify-center h-40",children:e.jsx(C,{className:"w-8 h-8 animate-spin text-primary"})}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-4",children:W.map(a=>{const s=a.type==="folder";return e.jsxs("div",{className:"flex flex-col gap-1 group",children:[e.jsxs("div",{className:y("relative aspect-square bg-white rounded-xl border border-slate-200 overflow-hidden cursor-pointer transition-all shadow-sm flex flex-col items-center justify-center",s?"bg-amber-50/50 border-amber-100 hover:bg-amber-100/50":"hover:bg-slate-50"),onClick:()=>{s?H(a.name||null):j?j(a):l&&i.tenant&&je.visit(route("tenant.media.show",{tenant:i.tenant,id:a.id}))},children:[s?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"w-16 h-16 text-amber-400 mb-2",fill:"currentColor",fillOpacity:.2}),e.jsx("span",{className:"font-medium text-slate-700 truncate w-full text-center px-2",children:a.name})]}):e.jsx("img",{src:a.url,alt:a.alt_text||"File",className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute inset-x-0 bottom-0 p-2 bg-gradient-to-t from-black/60 via-black/30 to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex justify-between items-end",children:[!s&&e.jsx("span",{className:"text-xs text-white truncate max-w-[70%] font-medium drop-shadow-sm px-1 pb-0.5",children:a.name}),e.jsxs("div",{className:"flex gap-1 ml-auto",children:[!s&&e.jsx(n,{variant:"ghost",size:"icon",className:"h-6 w-6 text-white hover:bg-white/20 hover:text-white",title:"Descargar",asChild:!0,onClick:t=>t.stopPropagation(),children:e.jsx("a",{href:l&&i.tenant?route("tenant.media.download",{tenant:i.tenant,id:a.id}):a.url,...l&&i.tenant?{}:{target:"_blank",rel:"noopener noreferrer"},children:e.jsx(Oe,{className:"h-3 w-3"})})}),e.jsx(n,{variant:"destructive",size:"icon",className:y("h-6 w-6",!Y&&"opacity-70"),title:"Eliminar",onClick:t=>{t.stopPropagation(),Y?N(a.id):b(!0)},children:e.jsx(He,{className:"h-3 w-3"})})]})]})]}),!s&&e.jsxs("div",{className:"px-1",children:[e.jsx("p",{className:"text-xs text-slate-600 truncate font-medium",title:a.name,children:a.name}),e.jsx("p",{className:"text-[10px] text-slate-400 truncate",children:a.size?(a.size/1024).toFixed(1)+" KB":""})]})]},a.id)})}),!S&&W.length===0&&e.jsxs(Le,{className:"col-span-full border-0",children:[e.jsxs(Pe,{children:[e.jsx(Me,{variant:"icon",children:e.jsx(le,{className:"size-8 text-slate-400"})}),e.jsx(ze,{children:"Sin archivos"}),e.jsx(Te,{children:o?"Esta carpeta está vacía.":"Sube tu primer archivo o crea una carpeta para organizar."})]}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-center mt-2",children:x&&e.jsxs(e.Fragment,{children:[e.jsxs(n,{size:"sm",onClick:()=>document.getElementById("manager-file-upload")?.click(),className:"gap-1",children:[e.jsx(T,{className:"w-4 h-4"}),"Subir archivo"]}),e.jsxs(n,{size:"sm",variant:"outline",onClick:()=>f(!0),className:"gap-1",children:[e.jsx(ee,{className:"w-4 h-4"}),"Nueva carpeta"]})]})})]}),A>1&&e.jsxs("div",{className:"col-span-full mt-4 flex items-center justify-center gap-2",children:[e.jsx(n,{variant:"outline",size:"sm",disabled:u<=1,onClick:()=>m(u-1),children:"Anterior"}),e.jsxs("span",{className:"text-sm text-slate-600",children:["Página ",u," de ",A]}),e.jsx(n,{variant:"outline",size:"sm",disabled:u>=A,onClick:()=>m(u+1),children:"Siguiente"})]})]}),e.jsx(ye,{open:F!==null,onOpenChange:a=>!a&&N(null),children:e.jsxs(Ce,{children:[e.jsxs(De,{children:[e.jsx(Se,{children:"¿Eliminar este elemento?"}),e.jsx(ke,{children:"Se eliminará el archivo o carpeta de forma permanente. Esta acción no se puede deshacer."})]}),e.jsxs(Fe,{children:[e.jsx(Ee,{children:"Cancelar"}),e.jsx(Ae,{variant:"destructive",onClick:()=>F!=null&&he(F),children:"Eliminar"})]})]})}),e.jsx(ae,{open:oe,onOpenChange:f,children:e.jsxs(se,{className:"sm:max-w-[400px]",children:[e.jsxs(ve,{children:[e.jsx(te,{children:"Nueva carpeta"}),e.jsx(re,{children:"Escribe el nombre de la carpeta."})]}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"grid gap-2",children:[e.jsx(Ne,{htmlFor:"new-folder-name",children:"Nombre"}),e.jsx(z,{id:"new-folder-name",value:v,onChange:a=>E(a.target.value),placeholder:"Ej: Marketing",onKeyDown:a=>a.key==="Enter"&&J(v)})]})}),e.jsxs(we,{children:[e.jsx(n,{variant:"outline",onClick:()=>{f(!1),E("")},children:"Cancelar"}),e.jsxs(n,{disabled:!v.trim()||M,onClick:()=>J(v),className:"gap-2",children:[M?e.jsx(C,{className:"w-4 h-4 animate-spin"}):null,"Crear"]})]})]})})]})}function pa({open:j,onOpenChange:_,...d}){return e.jsx(ae,{open:j,onOpenChange:_,children:e.jsxs(se,{className:"max-w-4xl h-[80vh] flex flex-col p-0 gap-0 overflow-hidden bg-white",children:[e.jsxs("div",{className:"p-4 border-b flex items-center justify-between bg-slate-50/50",children:[e.jsxs(te,{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5 text-primary"}),"Mis Archivos"]}),e.jsx(re,{className:"sr-only",children:"Gestor de archivos multimedia para seleccionar y subir imágenes."})]}),e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(Ve,{...d,className:"border-0 rounded-none h-full",onSelect:D=>{d.onSelect&&d.onSelect(D)}})})]})})}export{Ke as F,pa as M,Ve as a};
