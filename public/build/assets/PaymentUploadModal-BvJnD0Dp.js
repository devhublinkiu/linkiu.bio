import{c as k,r as b,u as F,j as e,t as o}from"./app-BWZ_nHt1.js";import{D as P,a as E,b as S,c as L,d as R,e as B}from"./dialog-5zjqAkxW.js";import{B as l}from"./button-Zm_FOSge.js";import{U as N}from"./upload-DzqgEUdA.js";import{X as v}from"./x-Bj9BVCWR.js";import{F as U}from"./file-text-Dx5Gvi74.js";import{L as z}from"./loader-circle-CTkVBqSa.js";import{C as M}from"./circle-check-sQ4QhFFV.js";function _({isOpen:n,onClose:d,invoice:m}){const{auth:A,currentTenant:x}=k().props,p=b.useRef(null),[u,a]=b.useState(null),{data:t,setData:i,post:w,processing:h,errors:f,reset:j,clearErrors:y}=F({invoice_id:m?.id,proof:null}),C=s=>{const r=s.target.files?.[0];if(r)if(i("proof",r),r.type.startsWith("image/")){const c=new FileReader;c.onloadend=()=>{a(c.result)},c.readAsDataURL(r)}else a(null)},D=s=>{if(s.preventDefault(),!t.proof){o.error("Por favor selecciona un archivo");return}if(!x?.slug){o.error("Error de sesión: No se pudo identificar la tienda");return}w(route("tenant.invoices.store",{tenant:x.slug}),{onSuccess:()=>{o.success("Comprobante enviado correctamente"),j(),a(null),d()},onError:r=>{console.error(r),o.error("Error al subir el comprobante")}})},g=()=>{j(),y(),a(null),d()};return e.jsx(P,{open:n,onOpenChange:g,children:e.jsxs(E,{className:"sm:max-w-md border-primary/10 shadow-2xl",children:[e.jsxs(S,{children:[e.jsxs(L,{className:"text-xl font-black text-slate-900 flex items-center gap-2",children:[e.jsx(N,{className:"w-5 h-5 text-primary"}),"Subir Comprobante"]}),e.jsxs(R,{className:"text-slate-500 font-medium",children:["Carga el recibo de transferencia para la Factura #",m?.id]})]}),e.jsxs("form",{onSubmit:D,className:"space-y-6 pt-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{onClick:()=>p.current?.click(),className:"border-2 border-dashed border-slate-200 rounded-2xl p-8 flex flex-col items-center justify-center gap-3 hover:border-primary/50 hover:bg-primary/5 transition-all cursor-pointer group",children:[e.jsx("input",{type:"file",ref:p,className:"hidden",accept:"image/*,.pdf",onChange:C}),u?e.jsxs("div",{className:"relative w-full aspect-video rounded-xl overflow-hidden border border-slate-100 shadow-sm",children:[e.jsx("img",{src:u,alt:"Vista previa",className:"w-full h-full object-cover"}),e.jsx(l,{type:"button",variant:"destructive",size:"icon",className:"absolute top-2 right-2 h-8 w-8 rounded-full",onClick:s=>{s.stopPropagation(),a(null),i("proof",null)},children:e.jsx(v,{className:"w-4 h-4"})})]}):t.proof?e.jsxs("div",{className:"flex items-center gap-3 bg-slate-50 p-4 rounded-xl w-full border border-slate-100",children:[e.jsx("div",{className:"h-10 w-10 bg-blue-100 text-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(U,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-bold text-slate-700 truncate",children:t.proof.name}),e.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest",children:"PDF Seleccionado"})]}),e.jsx(l,{type:"button",variant:"ghost",size:"icon",onClick:s=>{s.stopPropagation(),i("proof",null)},children:e.jsx(v,{className:"w-4 h-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-14 w-14 bg-slate-50 rounded-2xl flex items-center justify-center text-slate-400 group-hover:bg-primary/10 group-hover:text-primary transition-all",children:e.jsx(N,{className:"w-7 h-7"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-bold text-slate-700",children:"Haz clic para seleccionar"}),e.jsx("p",{className:"text-xs text-slate-500 font-medium mt-1",children:"Soporta JPG, PNG o PDF (Máximo 4MB)"})]})]})]}),f.proof&&e.jsxs("p",{className:"text-xs font-bold text-red-500 flex items-center gap-1",children:[e.jsx(T,{className:"w-3 h-3"})," ",f.proof]})]}),e.jsxs(B,{className:"flex-col sm:flex-row gap-2 pb-2",children:[e.jsx(l,{type:"button",variant:"ghost",onClick:g,className:"font-bold text-slate-500 order-2 sm:order-1",children:"Cancelar"}),e.jsx(l,{disabled:h||!t.proof,className:"font-bold shadow-lg shadow-primary/20 order-1 sm:order-2",children:h?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"w-4 h-4 mr-2 animate-spin"}),"Subiendo..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Enviar Comprobante"]})})]})]})]})})}function T(n){return e.jsxs("svg",{...n,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]})}export{_ as P};
