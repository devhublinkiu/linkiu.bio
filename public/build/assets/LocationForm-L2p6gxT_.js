import{c as G,r as k,u as W,j as e,t as _,R as g}from"./app-Bo0l-nyL.js";import{B as p}from"./button-10Bc0E3d.js";import{I as d}from"./input-BQLGMA-c.js";import{L as c}from"./label-BvJxTSA7.js";import{T as L}from"./textarea-DtyekHu-.js";import{S as $}from"./switch-BptM_5y0.js";import{T as J,a as Q,b as j,c as N}from"./tabs-BO4ak3vv.js";import{S as X}from"./scroll-area-BjAISIzb.js";import{B as v}from"./badge-T_0PRSRY.js";import{c as M}from"./utils-DvD3N-9F.js";import{S as E}from"./separator-rnPeP9N4.js";import{L as b}from"./leaflet-B17dporo.js";import{I as F}from"./info-BeX3WNrB.js";import{S as R}from"./smartphone-pb-6aARX.js";import{M as Y}from"./map-pin-D3kvadl2.js";import{C as Z}from"./clock-CrkUijLd.js";import{V as A}from"./video-BGNY4j_B.js";import{M as K}from"./message-circle-DoLMoG-m.js";import{G as ee}from"./globe-LfayGfnr.js";import{S as se}from"./search-EFBB3uIl.js";import{C as ae}from"./calendar-D4jj149y.js";import{C as re}from"./copy-DkIpylUw.js";import{P as te}from"./plus-F5si6Vay.js";import{T as D}from"./trash-2-CGD0dP--.js";import{X as le}from"./x-0PRwyTAe.js";import{L as oe}from"./loader-circle-PUm0Wiqp.js";import{S as ie}from"./save-BcfYaDfb.js";delete b.Icon.Default.prototype._getIconUrl;b.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const I=[{key:"monday",label:"Lunes"},{key:"tuesday",label:"Martes"},{key:"wednesday",label:"Miércoles"},{key:"thursday",label:"Jueves"},{key:"friday",label:"Viernes"},{key:"saturday",label:"Sábado"},{key:"sunday",label:"Domingo"}];function ne({position:r,setPosition:u,zoom:C=13}){const h=g.useRef(null),o=g.useRef(null),x=g.useRef(null);return g.useEffect(()=>{if(!(!h.current||o.current))return o.current=b.map(h.current).setView(r,C),b.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap"}).addTo(o.current),x.current=b.marker(r).addTo(o.current),u&&o.current.on("click",f=>{const{lat:y,lng:a}=f.latlng;u([y,a])}),setTimeout(()=>{o.current?.invalidateSize()},300),()=>{o.current?.remove(),o.current=null}},[]),g.useEffect(()=>{o.current&&x.current&&(x.current.setLatLng(r),o.current.flyTo(r,o.current.getZoom()))},[r]),e.jsx("div",{ref:h,className:"h-full w-full"})}function Ie({location:r,onSuccess:u,onCancel:C}){const{currentTenant:h}=G().props,[o,x]=k.useState(r?.latitude&&r?.longitude?[Number(r.latitude),Number(r.longitude)]:[4.6097,-74.0817]),[f,y]=k.useState(!1),{data:a,setData:t,post:P,patch:B,processing:S,errors:i,transform:ce}=W({name:r?.name||"",manager:r?.manager||"",description:r?.description||"",is_main:r?.is_main||!1,phone:r?.phone||"",whatsapp:r?.whatsapp||"",whatsapp_message:r?.whatsapp_message||"",state:r?.state||"",city:r?.city||"",address:r?.address||"",latitude:r?.latitude||4.6097,longitude:r?.longitude||-74.0817,opening_hours:r?.opening_hours||{monday:[{open:"08:00",close:"18:00"}],tuesday:[{open:"08:00",close:"18:00"}],wednesday:[{open:"08:00",close:"18:00"}],thursday:[{open:"08:00",close:"18:00"}],friday:[{open:"08:00",close:"18:00"}],saturday:[{open:"08:00",close:"14:00"}],sunday:[]},social_networks:r?.social_networks||{facebook:"",instagram:"",tiktok:""},is_active:r?.is_active??!0,short_video:null,remove_short:!1});k.useEffect(()=>{t(s=>({...s,latitude:o[0],longitude:o[1]}))},[o]);const z=async()=>{if(!a.address||!a.city)return;y(!0);const s=`${a.address}, ${a.city}, ${a.state}, Colombia`;try{const n=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(s)}&limit=1`,{headers:{"User-Agent":"LinkiuApp/1.0"}})).json();if(n&&n.length>0){const{lat:m,lon:w}=n[0],H=[parseFloat(m),parseFloat(w)];x(H)}}catch{}finally{y(!1)}};k.useEffect(()=>{const s=setTimeout(()=>{a.address&&a.city&&z()},1500);return()=>clearTimeout(s)},[a.address,a.city,a.state]);const U=s=>{s.preventDefault(),r?B(route("tenant.locations.update",[h?.slug,r.id]),{forceFormData:!0,onSuccess:()=>{_.success("Sede actualizada"),u()},onError:()=>_.error("Revisa los errores en el formulario.")}):P(route("tenant.locations.store",h?.slug),{onSuccess:()=>{_.success("Sede creada"),u()}})},V=s=>{const l={...a.opening_hours};l[s]||(l[s]=[]),l[s].push({open:"08:00",close:"18:00"}),t("opening_hours",l)},O=(s,l)=>{const n={...a.opening_hours};n[s].splice(l,1),t("opening_hours",n)},T=(s,l,n,m)=>{const w={...a.opening_hours};w[s][l][n]=m,t("opening_hours",w)},q=()=>{const s=a.opening_hours.monday||[],l={...a.opening_hours};I.forEach(n=>{n.key!=="monday"&&(l[n.key]=JSON.parse(JSON.stringify(s)))}),t("opening_hours",l),_.success("Horarios replicados a todos los días")};return e.jsxs("form",{onSubmit:U,className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(X,{className:"flex-1",children:e.jsx("div",{className:"p-6",children:e.jsxs(J,{defaultValue:"general",className:"w-full",children:[e.jsxs(Q,{className:M("grid w-full mb-8",r?"grid-cols-5":"grid-cols-4"),children:[e.jsxs(j,{value:"general",className:"gap-2",children:[e.jsx(F,{className:"size-4"})," General"]}),e.jsxs(j,{value:"contact",className:"gap-2",children:[e.jsx(R,{className:"size-4"})," Contacto"]}),e.jsxs(j,{value:"location",className:"gap-2",children:[e.jsx(Y,{className:"size-4"})," Ubicación"]}),e.jsxs(j,{value:"hours",className:"gap-2",children:[e.jsx(Z,{className:"size-4"})," Horarios"]}),r&&e.jsxs(j,{value:"short",className:"gap-2",children:[e.jsx(A,{className:"size-4"})," Short"]})]}),e.jsx(N,{value:"general",className:"space-y-6 animate-in fade-in slide-in-from-right-4 duration-300",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"name",className:"font-bold",children:"Nombre de la Sede"}),e.jsx(d,{id:"name",value:a.name,onChange:s=>t("name",s.target.value),placeholder:"Ej: Sede Norte / Principal / Local 101",className:"h-11",required:!0}),i.name&&e.jsx("p",{className:"text-xs font-bold text-red-500",children:i.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"manager",className:"font-bold",children:"Encargado"}),e.jsx(d,{id:"manager",value:a.manager||"",onChange:s=>t("manager",s.target.value),placeholder:"Nombre de la persona responsable",className:"h-11"}),i.manager&&e.jsx("p",{className:"text-xs font-bold text-red-500",children:i.manager})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"description",className:"font-bold",children:"Descripción Corta"}),e.jsx(L,{id:"description",value:a.description||"",onChange:s=>t("description",s.target.value),placeholder:"Breve detalle de la sede...",className:"min-h-[80px]"}),i.description&&e.jsx("p",{className:"text-xs font-bold text-red-500",children:i.description})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 rounded-xl border border-slate-100",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(c,{className:"text-sm font-bold",children:"¿Es la sede principal?"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Solo puede haber una sede principal."}),a.is_main&&r&&e.jsx("p",{className:"text-xs text-amber-600 font-medium mt-1",children:"La sede principal anterior dejará de serlo."})]}),e.jsx($,{checked:a.is_main,onCheckedChange:s=>t("is_main",s)})]})]})}),e.jsxs(N,{value:"contact",className:"space-y-6 animate-in fade-in slide-in-from-right-4 duration-300",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"phone",className:"font-bold",children:"Teléfono Fijo/Celular"}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-3 top-3 size-4 text-muted-foreground"}),e.jsx(d,{id:"phone",value:a.phone||"",onChange:s=>t("phone",s.target.value),className:"pl-10 h-11",placeholder:"+57..."})]}),i.phone&&e.jsx("p",{className:"text-xs font-bold text-red-500",children:i.phone})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"whatsapp",className:"font-bold",children:"WhatsApp Operativo"}),e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute left-3 top-3 size-4 text-green-600"}),e.jsx(d,{id:"whatsapp",value:a.whatsapp||"",onChange:s=>t("whatsapp",s.target.value),className:"pl-10 h-11",placeholder:"+57..."})]}),i.whatsapp&&e.jsx("p",{className:"text-xs font-bold text-red-500",children:i.whatsapp})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"wa_message",className:"font-bold text-xs uppercase tracking-wider text-slate-500",children:"Mensaje predeterminado de WhatsApp"}),e.jsx(L,{id:"wa_message",value:a.whatsapp_message||"",onChange:s=>t("whatsapp_message",s.target.value),placeholder:"Ej: Hola, quiero contactar con la sede norte...",className:"min-h-[60px]"}),e.jsx("p",{className:"text-[10px] text-muted-foreground italic",children:"Este mensaje aparecerá cuando el cliente haga clic en el botón de WhatsApp."})]}),e.jsx(E,{className:"my-4"}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs(c,{className:"font-bold flex items-center gap-2",children:[e.jsx(ee,{className:"size-4 text-primary"})," Redes Sociales (Opcional)"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{variant:"outline",className:"w-20 justify-center",children:"Facebook"}),e.jsx(d,{value:a.social_networks.facebook,onChange:s=>t("social_networks",{...a.social_networks,facebook:s.target.value}),placeholder:"URL perfil...",className:"h-9"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{variant:"outline",className:"w-20 justify-center",children:"Instagram"}),e.jsx(d,{value:a.social_networks.instagram,onChange:s=>t("social_networks",{...a.social_networks,instagram:s.target.value}),placeholder:"@usuario...",className:"h-9"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{variant:"outline",className:"w-20 justify-center",children:"TikTok"}),e.jsx(d,{value:a.social_networks.tiktok,onChange:s=>t("social_networks",{...a.social_networks,tiktok:s.target.value}),placeholder:"@usuario...",className:"h-9"})]})]})]})]}),e.jsxs(N,{value:"location",className:"space-y-6 animate-in fade-in slide-in-from-right-4 duration-300",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{className:"font-bold",children:"Departamento / Estado"}),e.jsx(d,{value:a.state||"",onChange:s=>t("state",s.target.value),placeholder:"Ej: Antioquia",className:"h-11"}),i.state&&e.jsx("p",{className:"text-xs font-bold text-red-500",children:i.state})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{className:"font-bold",children:"Ciudad / Municipio"}),e.jsx(d,{value:a.city||"",onChange:s=>t("city",s.target.value),placeholder:"Ej: Medellín",className:"h-11"}),i.city&&e.jsx("p",{className:"text-xs font-bold text-red-500",children:i.city})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{className:"font-bold",children:"Dirección Completa"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{value:a.address||"",onChange:s=>t("address",s.target.value),placeholder:"Ej: Calle 10 # 43 - 50...",className:"h-11 flex-1"}),e.jsx(p,{type:"button",variant:"outline",onClick:z,disabled:f||!a.address,className:"h-11 px-3 border-dashed hover:border-primary hover:text-primary transition-all",title:"Buscar en el mapa",children:e.jsx(se,{className:M("size-4",f&&"animate-spin")})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{className:"font-bold flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Puntero en el Mapa"}),f&&e.jsx(v,{variant:"secondary",className:"bg-blue-50 text-blue-600 animate-pulse border-blue-100 py-0 h-5 text-[10px]",children:"Buscando ubicación..."})]}),e.jsxs(v,{variant:"secondary",className:"font-normal text-[10px]",children:["Lat: ",a.latitude?.toFixed(4)," Lng: ",a.longitude?.toFixed(4)]})]}),e.jsx("div",{className:"h-[250px] w-full rounded-xl overflow-hidden border shadow-inner bg-slate-50",children:e.jsx(ne,{position:o,setPosition:x})}),e.jsxs("p",{className:"text-[10px] text-muted-foreground flex items-center gap-1",children:[e.jsx(F,{className:"size-3"})," Haz clic en el mapa para ajustar la ubicación exacta para Waze y Google Maps."]})]})]}),e.jsxs(N,{value:"hours",className:"space-y-6 animate-in fade-in slide-in-from-right-4 duration-300",children:[e.jsxs("div",{className:"p-4 bg-slate-50 rounded-xl border border-slate-100 flex items-start gap-3 mb-4",children:[e.jsx(ae,{className:"size-5 text-primary mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-bold text-slate-800",children:"Horarios de Atención"}),e.jsx("p",{className:"text-[11px] text-slate-500",children:'Configura los rangos de apertura. Si un día no tiene rangos, aparecerá como "Cerrado".'})]}),e.jsxs(p,{type:"button",variant:"outline",size:"sm",onClick:q,className:"h-8 text-xs font-bold gap-1.5 border-dashed hover:border-primary hover:text-primary",title:"Copiar horario de Lunes a todos los días",children:[e.jsx(re,{className:"size-3.5"}),"Replicar Lunes"]})]}),e.jsx("div",{className:"space-y-4",children:I.map(s=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(c,{className:"font-bold text-sm min-w-[80px]",children:s.label}),e.jsxs(p,{type:"button",variant:"ghost",size:"sm",className:"h-7 text-xs text-primary hover:bg-primary/5 font-bold",onClick:()=>V(s.key),children:[e.jsx(te,{className:"size-3 mr-1"})," Añadir Rango"]})]}),e.jsxs("div",{className:"space-y-2",children:[a.opening_hours[s.key]?.map((l,n)=>e.jsxs("div",{className:"flex items-center gap-2 animate-in fade-in slide-in-from-left-2 duration-300",children:[e.jsx(d,{type:"time",value:l.open,onChange:m=>T(s.key,n,"open",m.target.value),className:"h-9 w-[120px] text-xs"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"a"}),e.jsx(d,{type:"time",value:l.close,onChange:m=>T(s.key,n,"close",m.target.value),className:"h-9 w-[120px] text-xs"}),e.jsx(p,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8 text-red-500 hover:text-red-600 hover:bg-red-50",onClick:()=>O(s.key,n),children:e.jsx(D,{className:"size-3.5"})})]},n)),(!a.opening_hours[s.key]||a.opening_hours[s.key].length===0)&&e.jsx("p",{className:"text-[10px] text-muted-foreground italic pl-1",children:"Cerrado"})]}),e.jsx(E,{className:"mt-2 opacity-50"})]},s.key))})]}),r&&e.jsx(N,{value:"short",className:"space-y-6 animate-in fade-in slide-in-from-right-4 duration-300",children:e.jsxs("div",{className:"p-4 bg-slate-50 rounded-xl border border-slate-100",children:[e.jsxs("h4",{className:"text-sm font-bold text-slate-800 flex items-center gap-2 mb-1",children:[e.jsx(A,{className:"size-4 text-primary"})," Short de la sede"]}),e.jsx("p",{className:"text-[11px] text-slate-500 mb-4",children:"Video vertical (máx 10 s) para el selector de sedes. MP4 o MOV, recomendado 1080×1920, máx 50 MB."}),r.short_embed_url&&!a.remove_short&&!a.short_video&&e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx(c,{className:"text-xs font-bold text-slate-600",children:"Vista previa"}),e.jsx("div",{className:"aspect-[9/16] max-h-[320px] w-full max-w-[180px] rounded-xl overflow-hidden border bg-black",children:e.jsx("iframe",{title:"Short sede",src:r.short_embed_url+"?autoplay=false&preload=true",className:"w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}),e.jsxs(p,{type:"button",variant:"outline",size:"sm",className:"text-red-600 border-red-200 hover:bg-red-50 hover:border-red-300",onClick:()=>{t("remove_short",!0),t("short_video",null)},children:[e.jsx(D,{className:"size-3.5 mr-1.5"})," Quitar short"]})]}),a.remove_short&&e.jsx("p",{className:"text-xs text-amber-600 font-medium mb-2",children:"El short se eliminará al guardar."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"short_video",className:"font-bold",children:"Subir nuevo short"}),e.jsx(d,{id:"short_video",type:"file",accept:"video/mp4,video/quicktime",className:"h-10 cursor-pointer",onChange:s=>{const l=s.target.files?.[0];l&&(t("short_video",l),t("remove_short",!1))}}),a.short_video&&e.jsxs("p",{className:"text-xs text-green-600 font-medium",children:[a.short_video.name," (se subirá al guardar)"]}),i.short_video&&e.jsx("p",{className:"text-xs font-bold text-red-500",children:i.short_video})]})]})})]})})}),e.jsxs("div",{className:"p-6 border-t bg-slate-50/50 flex justify-between items-center gap-4",children:[e.jsxs(p,{type:"button",variant:"ghost",onClick:C,className:"font-bold text-slate-600 cursor-pointer",children:[e.jsx(le,{className:"mr-2 size-4"})," Cancelar"]}),e.jsxs(p,{type:"submit",disabled:S,className:"px-10 h-11 font-bold cursor-pointer",children:[S?e.jsx(oe,{className:"mr-2 size-4 animate-spin"}):e.jsx(ie,{className:"mr-2 size-4"}),r?"Guardar Cambios":"Crear Sede"]})]})]})}export{Ie as L};
