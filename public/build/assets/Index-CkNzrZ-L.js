import{r as l,t as g,c as Ls,j as e,H as $s,L as Is,b as ae}from"./app-CzmtjlCW.js";import{A as Ds}from"./AdminLayout-8eumfWMV.js";import{C as Se,a as ke,b as Te,d as Ae}from"./card-Cio2ZpWt.js";import{B as N}from"./button-DHDYV-Vu.js";import{B as re}from"./badge-C86koyY8.js";import{S as Ee}from"./scroll-area-BkKwIDU9.js";import{T as Pe,a as Me,b as Oe,c as Le}from"./tabs-D2Zj1Laj.js";import{T as Rs}from"./textarea-BVs60Bnz.js";import{D as $e,a as Ie,b as De,c as Re,e as qs}from"./dialog-CDtZpi6V.js";import{S as Bs,a as Vs,b as Fs,c as Us,d as Gs}from"./select-BsP5-Mx7.js";import{A as qe,a as Be,b as Ve,c as Fe,d as Ue,e as Ge,f as Qe,g as He}from"./alert-dialog-BdvmeaMn.js";import{I as le}from"./input-CkrKzdip.js";import{c as ne}from"./utils-BH2tHD_A.js";import{c as L,R as $,f as b}from"./currency-CbSp2N4L.js";import{A as Qs}from"./arrow-left-CHMgq-Bp.js";import{C as Hs}from"./menuConfig-CPl-cWmx.js";import{T as ie}from"./table-BzVM_9Rr.js";import{P as We}from"./package-A6FRi7Sy.js";import{S as oe}from"./search-CetFsz5w.js";import{C as Ws}from"./circle-alert-DEEKRgFJ.js";import{U as ss}from"./utensils-K4erno8v.js";import{C as zs}from"./circle-check-big-3tN7PW87.js";import{U as Js}from"./utensils-crossed-AhKdsxaf.js";import{T as ze}from"./trash-2-D8FHOsLd.js";import{P as ce}from"./plus-BCBDbY-P.js";import{S as Je}from"./sticky-note-D6e10pkf.js";import{M as Ze}from"./minus-DAU_1RQK.js";import{L as Xe}from"./loader-circle-CrqYqwPq.js";import{S as Zs}from"./send-CObxMUfB.js";import{C as Xs}from"./clock-D1X9wNgA.js";import{C as Ks}from"./copy-C9nfhKYY.js";import{X as Ys}from"./x-B2qOMX6F.js";import{C as et}from"./camera-CDlfp1aJ.js";import{B as Ke}from"./banknote-B4QtVHv_.js";import{C as Ye}from"./credit-card-o3EdvoAE.js";import{W as st}from"./wallet-9RLcy1Im.js";import"./progress-thUTkzo2.js";import"./index-CoSHAo9V.js";import"./index-B7u58P25.js";import"./dropdown-menu-CkPxOfJq.js";import"./createLucideIcon-CaH5oZCX.js";import"./chevron-right-CP3Al_6X.js";import"./index-DLCIQy2W.js";import"./index-Bik950zP.js";import"./index-tuvqS7go.js";import"./index-D4uLenfM.js";import"./circle-check-DxCp2NCp.js";import"./check-CDpry8EA.js";import"./shopping-bag-BzAvYKks.js";import"./separator-C7VYnuGU.js";import"./sheet-BCCP-sjc.js";import"./index-0rkHg0Ic.js";import"./index-i2FoVhyH.js";import"./index-DewdYm7G.js";import"./index-Bdv8as05.js";import"./index-BKdn1L7U.js";import"./index-BPIYxXZn.js";import"./badge-check-bj2LNrR7.js";import"./lock-nV4mWcAC.js";import"./sparkles-p-mrIi5N.js";import"./external-link-Ckra4gVk.js";import"./chevron-down-DmTOaxVY.js";import"./headphones-CE-eXCS3.js";import"./user-D2yrztw3.js";import"./shield-1cQx-8mE.js";import"./sonner-CR6Tr01l.js";import"./index-BdQq_4o_.js";import"./index-CqTlmCQK.js";import"./chevron-up-Dd6KBSzl.js";import"./video-C_obWpYx.js";import"./chef-hat-DMkmJSds.js";import"./map-pin-BE5u9cGW.js";import"./star-BWFeNTek.js";import"./users-CiV-Fhl_.js";import"./calendar-check-BhZMHGo-.js";import"./calendar-CLz13BXv.js";import"./briefcase-BgyLfkCE.js";import"./truck-BuohTmzx.js";import"./message-circle-BMB1KwoB.js";import"./layout-dashboard-C295RkTP.js";function Oa({categories:p,zones:I,tenant:v,locations:de=[],currentLocationId:ts,taxSettings:m,paymentMethods:as=[],bankAccounts:me=[]}){const[o,M]=l.useState(null),[d,y]=l.useState([]),[A,rs]=l.useState(""),[D,xe]=l.useState(!1),[pe,tt]=l.useState(ts),[ls,ns]=l.useState(!1),[T,is]=l.useState(""),[h,R]=l.useState("dine_in"),[w,q]=l.useState(I),[os,B]=l.useState(!1),[cs,V]=l.useState(!1),[at,rt]=l.useState(!1),[lt,nt]=l.useState(""),[u,ds]=l.useState(null),[ms,F]=l.useState(!1),[S,U]=l.useState(1),[E,he]=l.useState({}),[G,ue]=l.useState(""),[O,Q]=l.useState(new Set),[fe,xs]=l.useState(new Set),[ps,H]=l.useState(!1),[k,be]=l.useState(""),[W,je]=l.useState(""),[ge,z]=l.useState(null),[Ne,J]=l.useState(""),[Z,ve]=l.useState(!1);l.useEffect(()=>{const s=setTimeout(()=>ns(!0),200);return()=>clearTimeout(s)},[]);const X=l.useCallback(()=>{try{const s=window.AudioContext||window.webkitAudioContext,t=new s;[830,1046,1318].forEach((a,r)=>{const i=t.createOscillator(),n=t.createGain();i.type="sine",i.frequency.value=a,n.gain.setValueAtTime(.4,t.currentTime+r*.18),n.gain.exponentialRampToValueAtTime(.01,t.currentTime+r*.18+.3),i.connect(n),n.connect(t.destination),i.start(t.currentTime+r*.18),i.stop(t.currentTime+r*.18+.3)})}catch{}},[]),K=l.useMemo(()=>{const s=new Set;return w.forEach(t=>{t.tables.forEach(a=>{a.active_order?.id&&s.add(a.active_order.id)})}),fe.forEach(t=>s.add(t)),Array.from(s)},[w,fe]),Y=l.useRef(w);l.useEffect(()=>{Y.current=w},[w]);const we=l.useRef(o);l.useEffect(()=>{we.current=o},[o]),l.useEffect(()=>{const s=window.Echo;if(!s?.connector||!v.id||K.length===0)return;const t=[];return K.forEach(a=>{const r=`tenant.${v.id}.orders.${a}`;try{s.channel(r).listen(".order.status.updated",i=>{const n=i;if(n.comment==="payment_verified"){X();let c="";Y.current.forEach(f=>{f.tables.forEach(x=>{x.active_order?.id===n.id&&(c=x.name)})}),g.success(`Pago verificado — ${c||`Pedido #${n.id}`} completado`,{id:`verified-${n.id}`,duration:15e3,description:"Caja aprobó el pago. Mesa liberada.",style:{background:"#ecfdf5",border:"2px solid #059669",fontWeight:"bold"}}),q(f=>f.map(x=>({...x,tables:x.tables.map(_=>_.active_order?.id===n.id?{..._,status:"available",active_order:void 0}:_)}))),Q(f=>{const x=new Set(f);return x.delete(n.id),x}),we.current?.active_order?.id===n.id&&(y([]),M(null))}else if(n.status==="ready"){Q(f=>new Set(f).add(n.id)),X();let c="";Y.current.forEach(f=>{f.tables.forEach(x=>{x.active_order?.id===n.id&&(c=x.name)})}),g.success(`Pedido ${c||`#${n.id}`} LISTO`,{id:`ready-${n.id}`,duration:2e4,description:"Cocina lo despachó — llévaselo al cliente",style:{background:"#ecfdf5",border:"2px solid #10b981",fontWeight:"bold"}})}else n.status==="preparing"&&g.info(`Pedido #${n.id} en preparación`,{id:`preparing-${n.id}`,duration:5e3})}),t.push(r)}catch(i){console.error("[Echo] Error subscribing to channel:",r,i)}}),()=>{t.forEach(a=>{try{s.leave(a)}catch{}})}},[v.id,K,X]);const hs=s=>{if(M(s),s.active_order?.items&&s.active_order.items.length>0){const t=s.active_order.items.map(a=>({id:`sent-${a.id}`,product_id:a.product_id,product_name:a.product_name,price:parseFloat(String(a.price)),quantity:a.quantity,variant_options:typeof a.variant_options=="string"?JSON.parse(a.variant_options):a.variant_options||[],notes:a.notes||"",is_sent:!0}));y(a=>{const r=a.filter(i=>!i.is_sent);return[...t,...r]})}else y(t=>t.filter(a=>!a.is_sent))};l.useEffect(()=>{const s=t=>{d.length>0&&(t.preventDefault(),t.returnValue="")};return window.addEventListener("beforeunload",s),()=>window.removeEventListener("beforeunload",s)},[d.length]);const us=Ls().props.auth?.user?.name||"Mesero",ee=l.useMemo(()=>{if(!A)return null;const s=[];return p.forEach(t=>{t.products&&t.products.forEach(a=>{a.name.toLowerCase().includes(A.toLowerCase())&&s.push(a)})}),s},[p,A]),{subtotal:fs,taxAmount:bs,grandTotal:js}=l.useMemo(()=>{const t=d.filter(a=>!a.is_sent).reduce((a,r)=>a+r.price*r.quantity,0);return L(t,m?.tax_rate||0,m?.price_includes_tax||!1)},[d,m]),se=l.useMemo(()=>{const s=d.reduce((a,r)=>a+r.price*r.quantity,0),{grandTotal:t}=L(s,m?.tax_rate||0,m?.price_includes_tax||!1);return t},[d,m]),_e=s=>{ds(s),U(1),he({}),ue(""),F(!0)},te=l.useMemo(()=>{if(!u)return 0;let s=Number(u.price);return u.variant_groups&&u.variant_groups.forEach(t=>{(E[t.id]||[]).forEach(r=>{const i=t.options.find(n=>n.id===r);i&&(s+=Number(i.price_adjustment))})}),s},[u,E]),gs=(s,t,a)=>{he(r=>{const i=r[s]||[];return a==="radio"?{...r,[s]:[t]}:i.includes(t)?{...r,[s]:i.filter(n=>n!==t)}:{...r,[s]:[...i,t]}})},Ns=()=>{if(!u)return;if(u.variant_groups){for(const r of u.variant_groups)if(r.is_required&&(E[r.id]||[]).length<r.min_selection){g.error(`Selecciona al menos ${r.min_selection} opción en ${r.name}`);return}}const s=[];u.variant_groups&&u.variant_groups.forEach(r=>{(E[r.id]||[]).forEach(n=>{const c=r.options.find(f=>f.id===n);c&&s.push({id:c.id,name:`${r.name}: ${c.name}`,price_adjustment:c.price_adjustment,price:Number(c.price_adjustment),group_name:r.name,option_name:c.name})})});const a={id:`item-${Date.now()}-${Math.random()}`,product_id:u.id,product_name:u.name,price:te,quantity:S,variant_options:s,notes:G.trim()};y(r=>[...r,a]),g.success(`Añadido: ${u.name}`),F(!1)},ye=(s,t)=>{y(a=>a.map(r=>{if(r.id===s){const i=Math.max(1,r.quantity+t);return{...r,quantity:i}}return r}))},vs=s=>{y(t=>t.filter(a=>a.id!==s))},j=l.useMemo(()=>d.filter(s=>!s.is_sent),[d]),ws=()=>{j.length!==0&&V(!0)},_s=()=>{y(s=>s.filter(t=>t.is_sent)),V(!1)},ys=()=>{if(h==="dine_in"&&!o){g.error("Selecciona una mesa primero");return}if(j.length===0){g.error("No hay productos nuevos para enviar");return}B(!0)},Cs=async()=>{B(!1),xe(!0);try{const s=await ae.post(route("tenant.admin.waiters.store",{tenant:v.slug}),{service_type:h,table_id:h==="dine_in"?o?.id:null,customer_name:h==="dine_in"&&o?`Mesa ${o.name}`:"Mostrador",location_id:pe,items:j.map(t=>({product_id:t.product_id,quantity:t.quantity,variant_options:t.variant_options,notes:t.notes||void 0})),send_to_kitchen:!0});if(s.data.success){const t=s.data.order_id,a=s.data.total,r=d.filter(c=>c.is_sent),i=j.map((c,f)=>({...c,id:`sent-new-${Date.now()}-${f}`,is_sent:!0})),n=[...r,...i];if(h==="dine_in"&&o){const c=o.id,f=o.active_order?.created_at||new Date().toISOString();q(x=>x.map(_=>({..._,tables:_.tables.map(P=>P.id===c?{...P,status:"occupied",active_order:{id:t||P.active_order?.id||0,table_id:c,customer_name:`Mesa ${P.name}`,total:a||0,status:"confirmed",created_at:f,items:n.map((C,Os)=>({id:Os+1,product_id:C.product_id,product_name:C.product_name,quantity:C.quantity,price:C.price,total:C.price*C.quantity,variant_options:C.variant_options,notes:C.notes}))}}:P)}))),t&&xs(x=>new Set(x).add(t)),t&&O.has(t)&&Q(x=>{const _=new Set(x);return _.delete(t),_})}g.success("✅ Pedido enviado a cocina"),y(n),h==="takeout"&&(M(null),R("dine_in"))}}catch(s){if(ae.isAxiosError(s)&&s.response?.data?.errors){const t=s.response.data.errors,a=Object.values(t)[0];g.error(Array.isArray(a)?a[0]:String(a))}else g.error("Error al enviar pedido")}finally{xe(!1)}},Ss=s=>{window.location.href=route("tenant.admin.waiters.index",{tenant:v.slug,location_id:s})},ks=()=>{if(!o?.active_order){g.error("Esta mesa no tiene pedido activo");return}be(""),je(""),z(null),J(""),H(!0)},Ts=s=>{const t=s.target.files?.[0];if(!t)return;z(t);const a=new FileReader;a.onload=()=>J(a.result),a.readAsDataURL(t)},As=async()=>{if(!(!o?.active_order?.id||!k)){ve(!0);try{const s=new FormData;s.append("order_id",String(o.active_order.id)),s.append("payment_method",k),W&&s.append("payment_reference",W),ge&&s.append("payment_proof",ge),await ae.post(route("tenant.admin.waiters.payment-proof",{tenant:v.slug}),s,{headers:{"Content-Type":"multipart/form-data"}}),g.success("Pago registrado — caja lo verificará"),H(!1),q(t=>t.map(a=>({...a,tables:a.tables.map(r=>r.id===o?.id&&r.active_order?{...r,active_order:{...r.active_order,waiter_collected:!0}}:r)})))}catch{g.error("Error al registrar el pago")}finally{ve(!1)}}},Es=s=>{navigator.clipboard.writeText(s),g.success("Copiado al portapapeles")},Ps={cash:{label:"Efectivo",icon:e.jsx(Ke,{className:"w-5 h-5"})},bank_transfer:{label:"Transferencia",icon:e.jsx(st,{className:"w-5 h-5"})},dataphone:{label:"Datáfono",icon:e.jsx(Ye,{className:"w-5 h-5"})}},Ce=as.filter(s=>s.is_active).map(s=>s.type),Ms=s=>{const t=new Date(s),r=new Date().getTime()-t.getTime(),i=Math.floor(r/6e4);if(i<60)return`${i}m`;const n=Math.floor(i/60),c=i%60;return`${n}h${c}m`};return e.jsxs(Ds,{hideSidebar:!0,hideNavbar:!0,hideFooter:!0,maxwidth:"w-full h-screen",children:[e.jsx($s,{title:"Panel de Meseros"}),e.jsxs("div",{className:"flex flex-col h-screen bg-slate-50 overflow-hidden",children:[e.jsxs("header",{className:"bg-white border-b border-slate-200 p-4 flex justify-between items-center shrink-0 shadow-sm z-10",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(N,{variant:"ghost",size:"icon",className:"text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-full",asChild:!0,children:e.jsx(Is,{href:route("tenant.dashboard",{tenant:v.slug}),children:e.jsx(Qs,{className:"w-6 h-6"})})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-blue-600 p-2 rounded-lg",children:e.jsx(Hs,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-slate-800 tracking-tight leading-none",children:"PANEL DE MESEROS"}),e.jsx("p",{className:"text-[10px] text-slate-400 font-bold uppercase tracking-widest mt-1",children:"Gestión de Mesas y Comandas"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[de.length>1&&e.jsxs(Bs,{value:String(pe||""),onValueChange:Ss,children:[e.jsx(Vs,{className:"w-[160px] h-9 bg-slate-50 border-slate-200 text-sm",children:e.jsx(Fs,{placeholder:"Sede"})}),e.jsx(Us,{children:de.map(s=>e.jsx(Gs,{value:String(s.id),children:s.name},s.id))})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-slate-100 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>{R("dine_in")},className:`px-3 py-1.5 rounded text-xs font-bold transition-colors ${h==="dine_in"?"bg-white text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(ie,{className:"w-3.5 h-3.5 inline mr-1"}),"Mesa"]}),e.jsxs("button",{onClick:()=>{R("takeout"),M(null)},className:`px-3 py-1.5 rounded text-xs font-bold transition-colors ${h==="takeout"?"bg-indigo-600 text-white shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(We,{className:"w-3.5 h-3.5 inline mr-1"}),"Para llevar"]})]}),e.jsx("div",{className:"h-8 w-px bg-slate-200 mx-1"}),o&&e.jsxs("div",{className:"hidden sm:flex flex-col items-end",children:[e.jsx("span",{className:"text-[10px] text-slate-400 font-bold uppercase",children:"Atendiendo"}),e.jsxs("span",{className:"text-sm font-black text-blue-600",children:["Mesa ",o.name]})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-[10px] text-slate-400 font-bold uppercase",children:"Sesión"}),e.jsx("span",{className:"text-sm font-bold text-slate-700",children:us})]})]})]}),e.jsxs("div",{className:"flex-1 p-4 grid grid-cols-1 lg:grid-cols-12 gap-6 overflow-hidden",children:[e.jsxs("div",{className:"lg:col-span-8 flex flex-col gap-4 overflow-hidden",children:[e.jsx("div",{className:"flex gap-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(oe,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4"}),e.jsx(le,{placeholder:"Buscar productos...",className:"pl-10",value:A,onChange:s=>rs(s.target.value)})]})}),e.jsx(Ee,{className:"flex-1 bg-white rounded-xl border border-slate-200 p-4",children:ls?A?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:ee&&ee.length>0?ee.map(s=>e.jsx(es,{product:s,onAdd:_e},s.id)):e.jsxs("div",{className:"col-span-full flex flex-col items-center justify-center py-12 text-slate-400",children:[e.jsx(oe,{className:"w-10 h-10 mb-3 opacity-40"}),e.jsx("p",{className:"text-sm font-medium",children:"No se encontraron productos"})]})}):p.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-slate-400",children:[e.jsx(Ws,{className:"w-12 h-12 mb-3 opacity-30"}),e.jsx("p",{className:"text-sm font-bold",children:"No hay categorías registradas"})]}):e.jsxs(Pe,{defaultValue:p[0]?.id.toString(),className:"w-full",children:[e.jsx(Me,{className:"w-full justify-start overflow-x-auto h-auto p-1 bg-slate-100/50 mb-4",children:p.map(s=>e.jsx(Oe,{value:s.id.toString(),className:"py-2 px-4",children:s.name},s.id))}),p.map(s=>e.jsx(Le,{value:s.id.toString(),children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:s.products&&s.products.length>0?s.products.map(t=>e.jsx(es,{product:t,onAdd:_e},t.id)):e.jsxs("div",{className:"col-span-full flex flex-col items-center justify-center py-12 text-slate-400",children:[e.jsx(ss,{className:"w-8 h-8 mb-2 opacity-30"}),e.jsx("p",{className:"text-sm font-medium",children:"Sin productos en esta categoría"})]})})},s.id))]}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:Array.from({length:8}).map((s,t)=>e.jsx("div",{className:"aspect-square rounded-xl bg-slate-100 animate-pulse"},t))})})]}),e.jsxs("div",{className:"lg:col-span-4 flex flex-col gap-4 overflow-hidden",children:[h==="dine_in"&&e.jsxs(Se,{className:"shrink-0 border-slate-200",children:[e.jsx(ke,{className:"p-4 pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Te,{className:"text-sm font-bold flex items-center gap-2 uppercase tracking-wider text-slate-500",children:[e.jsx(ie,{className:"w-4 h-4 text-blue-500"}),"Selección de Mesa"]}),e.jsxs("div",{className:"relative",children:[e.jsx(oe,{className:"absolute left-2 top-1/2 -translate-y-1/2 w-3 h-3 text-slate-400"}),e.jsx(le,{placeholder:"Buscar...",value:T,onChange:s=>is(s.target.value),className:"pl-7 h-7 w-[100px] text-xs bg-slate-50"})]})]})}),e.jsx(Ae,{className:"p-4 pt-0",children:w.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-slate-400",children:[e.jsx(ie,{className:"w-8 h-8 mb-2 opacity-30"}),e.jsx("p",{className:"text-xs font-medium",children:"No hay zonas ni mesas registradas"})]}):e.jsxs(Pe,{defaultValue:w[0]?.id.toString(),className:"w-full",children:[e.jsx(Me,{className:"w-full overflow-x-auto justify-start h-auto p-0.5 bg-slate-50 mb-3",children:w.map(s=>e.jsx(Oe,{value:s.id.toString(),className:"text-[10px] uppercase py-1 px-2",children:s.name},s.id))}),w.map(s=>e.jsx(Le,{value:s.id.toString(),className:"mt-0",children:e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[s.tables.filter(t=>!T||t.name.toLowerCase().includes(T.toLowerCase())).map(t=>e.jsxs("button",{onClick:()=>hs(t),className:ne("flex flex-col items-center justify-center p-2 rounded-lg border text-sm transition-all relative",o?.id===t.id?"bg-blue-600 border-blue-600 text-white shadow-md ring-2 ring-blue-100":t.active_order?.waiter_collected?"bg-emerald-100 border-emerald-400 text-emerald-800 ring-2 ring-emerald-200":t.active_order?.id&&O.has(t.active_order.id)?"bg-green-100 border-green-400 text-green-800 ring-2 ring-green-200 animate-pulse":t.status==="occupied"?"bg-amber-50 border-amber-200 text-amber-700":"bg-white border-slate-200 text-slate-600 hover:border-blue-300"),children:[e.jsx("span",{className:"font-bold",children:t.name}),t.active_order?.waiter_collected&&o?.id!==t.id&&e.jsxs("div",{className:"flex items-center gap-0.5 mt-0.5",children:[e.jsx($,{className:"w-3 h-3 text-emerald-600"}),e.jsx("span",{className:"text-[8px] font-black text-emerald-700 uppercase",children:"Cobrado"})]}),!t.active_order?.waiter_collected&&t.active_order?.id&&O.has(t.active_order.id)&&o?.id!==t.id&&e.jsxs("div",{className:"flex items-center gap-0.5 mt-0.5",children:[e.jsx(zs,{className:"w-3 h-3 text-green-600"}),e.jsx("span",{className:"text-[8px] font-black text-green-700 uppercase",children:"Listo"})]}),t.status==="occupied"&&t.active_order&&!t.active_order.waiter_collected&&!(t.active_order.id&&O.has(t.active_order.id))&&e.jsxs("div",{className:"flex flex-col items-center mt-0.5",children:[e.jsx("span",{className:"text-[8px] font-mono opacity-70",children:Ms(t.active_order.created_at)}),e.jsx("span",{className:"text-[8px] font-bold",children:b(t.active_order.total)})]}),t.status==="occupied"&&!t.active_order&&e.jsx("div",{className:"w-1 h-1 rounded-full bg-amber-500 mt-1"})]},t.id)),s.tables.filter(t=>!T||t.name.toLowerCase().includes(T.toLowerCase())).length===0&&e.jsx("div",{className:"col-span-full py-4 text-center text-xs text-slate-400",children:T?"Sin resultados":"Sin mesas"})]})},s.id))]})})]}),h==="takeout"&&e.jsxs("div",{className:"bg-indigo-50 border border-indigo-200 rounded-xl p-4 flex items-center gap-3",children:[e.jsx(We,{className:"w-8 h-8 text-indigo-600 shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-indigo-900 text-sm",children:"Pedido Para Llevar"}),e.jsx("p",{className:"text-xs text-indigo-600",children:"Sin mesa — directo a cocina"})]})]}),e.jsxs(Se,{className:"flex-1 flex flex-col overflow-hidden border-slate-200 shadow-sm",children:[e.jsxs(ke,{className:"p-4 pb-2 bg-slate-50/50 flex flex-row items-center justify-between",children:[e.jsxs(Te,{className:"text-sm font-bold flex items-center gap-2 uppercase tracking-wider text-slate-500",children:[e.jsx(Js,{className:"w-4 h-4 text-green-500"}),"Pedido Actual"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[o&&h==="dine_in"&&e.jsxs(re,{variant:"secondary",className:"bg-blue-100 text-blue-700 border-blue-200",children:["Mesa ",o.name]}),h==="takeout"&&e.jsx(re,{variant:"secondary",className:"bg-indigo-100 text-indigo-700 border-indigo-200",children:"Para llevar"}),d.length>0&&e.jsx(N,{variant:"ghost",size:"icon",className:"h-7 w-7 text-red-400 hover:text-red-600",onClick:ws,children:e.jsx(ze,{className:"w-4 h-4"})})]})]}),e.jsxs(Ae,{className:"p-0 flex-1 overflow-hidden flex flex-col",children:[e.jsx(Ee,{className:"flex-1 px-4 py-2",children:d.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-40 text-slate-400 opacity-60",children:[e.jsx(ce,{className:"w-8 h-8 mb-2 border-2 border-dashed rounded-full p-1"}),e.jsx("p",{className:"text-sm font-medium",children:"Carrito vacío"})]}):e.jsxs("div",{className:"space-y-2",children:[d.filter(s=>s.is_sent).length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 py-1",children:[e.jsx("div",{className:"h-px flex-1 bg-orange-200"}),e.jsx("span",{className:"text-[9px] font-bold uppercase text-orange-500 tracking-widest",children:"En cocina"}),e.jsx("div",{className:"h-px flex-1 bg-orange-200"})]}),d.filter(s=>s.is_sent).map(s=>e.jsxs("div",{className:"flex flex-col gap-0.5 pb-2 border-b border-orange-100 last:border-0 opacity-70",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("span",{className:"font-medium text-xs text-slate-600 leading-tight",children:[s.quantity,"x ",s.product_name]}),e.jsx("span",{className:"font-bold text-xs text-slate-500",children:b(s.price*s.quantity)})]}),s.notes&&e.jsxs("p",{className:"text-[9px] text-amber-500 italic pl-3",children:["→ ",s.notes]})]},s.id))]}),d.filter(s=>!s.is_sent).length>0&&e.jsxs("div",{className:"space-y-2",children:[d.filter(s=>s.is_sent).length>0&&e.jsxs("div",{className:"flex items-center gap-2 py-1",children:[e.jsx("div",{className:"h-px flex-1 bg-blue-200"}),e.jsx("span",{className:"text-[9px] font-bold uppercase text-blue-500 tracking-widest",children:"Nuevos"}),e.jsx("div",{className:"h-px flex-1 bg-blue-200"})]}),d.filter(s=>!s.is_sent).map(s=>e.jsxs("div",{className:"flex flex-col gap-1 pb-3 border-b border-slate-100 last:border-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("span",{className:"font-semibold text-sm text-slate-800 leading-tight",children:s.product_name}),e.jsx("span",{className:"font-bold text-sm text-slate-900",children:b(s.price*s.quantity)})]}),s.variant_options&&s.variant_options.length>0&&e.jsx("p",{className:"text-[10px] text-blue-600 font-medium leading-tight",children:s.variant_options.map(t=>t.option_name||t.name).join(" · ")}),s.notes&&e.jsxs("p",{className:"text-[10px] text-amber-600 font-medium flex items-center gap-1",children:[e.jsx(Je,{className:"w-3 h-3 inline"}),s.notes]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-slate-100 rounded-lg p-1",children:[e.jsx(N,{variant:"ghost",size:"icon",className:"h-6 w-6 rounded-md hover:bg-white",onClick:()=>ye(s.id,-1),children:e.jsx(Ze,{className:"w-3 h-3"})}),e.jsx("span",{className:"text-xs font-bold w-4 text-center",children:s.quantity}),e.jsx(N,{variant:"ghost",size:"icon",className:"h-6 w-6 rounded-md hover:bg-white",onClick:()=>ye(s.id,1),children:e.jsx(ce,{className:"w-3 h-3"})})]}),e.jsx(N,{variant:"ghost",size:"icon",className:"h-7 w-7 text-red-400 hover:text-red-500 hover:bg-red-50",onClick:()=>vs(s.id),children:e.jsx(ze,{className:"w-3.5 h-3.5"})})]})]},s.id))]})]})}),e.jsxs("div",{className:"p-4 bg-slate-50 border-t border-slate-200 space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[d.some(s=>s.is_sent)&&e.jsxs("div",{className:"flex justify-between items-center px-1 pb-1 mb-1 border-b border-dashed border-slate-200",children:[e.jsx("span",{className:"text-slate-400 text-[10px] font-bold uppercase",children:"Total Mesa"}),e.jsx("span",{className:"text-sm font-bold text-slate-600",children:b(se)})]}),j.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("span",{className:"text-slate-500 text-xs",children:"Nuevos - Subtotal"}),e.jsx("span",{className:"text-sm font-medium",children:b(fs)})]}),m&&m.tax_rate>0&&e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsxs("span",{className:"text-slate-500 text-xs",children:[m.tax_name," (",m.tax_rate,"%)"]}),e.jsx("span",{className:"text-sm font-medium",children:b(bs)})]})]}),e.jsxs("div",{className:"flex justify-between items-center px-1 pt-1 border-t border-dashed border-slate-200",children:[e.jsx("span",{className:"text-slate-500 font-bold uppercase text-[10px] tracking-widest",children:j.length>0?"Total Nuevos":"Total Mesa"}),e.jsx("span",{className:"text-xl font-black text-slate-900",children:b(j.length>0?js:se)})]})]}),e.jsxs(N,{className:"w-full bg-blue-600 hover:bg-blue-700 h-12 text-lg font-bold shadow-lg shadow-blue-200",disabled:j.length===0||h==="dine_in"&&!o||D,onClick:ys,children:[D?e.jsx(Xe,{className:"w-5 h-5 mr-2 animate-spin"}):e.jsx(Zs,{className:"w-5 h-5 mr-2"}),D?"Enviando...":j.length>0?`ENVIAR ${j.length} NUEVO${j.length>1?"S":""} A COCINA`:"ENVIAR A COCINA"]}),o?.active_order&&d.some(s=>s.is_sent)&&(o.active_order.waiter_collected?e.jsxs(N,{variant:"outline",disabled:!0,className:"w-full h-10 border-amber-300 bg-amber-50 text-amber-700 font-bold cursor-not-allowed",children:[e.jsx(Xs,{className:"w-4 h-4 mr-2 animate-pulse"}),"EN APROBACIÓN — CAJA VERIFICANDO"]}):e.jsxs(N,{variant:"outline",className:"w-full h-10 border-emerald-300 text-emerald-700 hover:bg-emerald-50 font-bold",onClick:ks,children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"PRE-CUENTA / COBRAR"]}))]})]})]})]})]})]}),e.jsx($e,{open:ms,onOpenChange:F,children:e.jsxs(Ie,{className:"sm:max-w-[500px] max-h-[90vh] flex flex-col p-0 gap-0 bg-white border-0 shadow-2xl",children:[e.jsx(De,{className:"p-4 border-b border-slate-100 flex-shrink-0",children:e.jsxs(Re,{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-bold text-lg text-slate-900",children:u?.name}),e.jsx("span",{className:"text-lg font-black text-blue-600",children:b(te)})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[u?.variant_groups?.map(s=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-slate-800 text-sm",children:s.name}),s.is_required&&e.jsx("span",{className:"bg-red-50 text-red-600 text-[10px] font-bold px-2 py-0.5 rounded-full uppercase",children:"Requerido"})]}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:s.options.map(t=>{const a=(E[s.id]||[]).includes(t.id),r=Number(t.price_adjustment);return e.jsxs("label",{className:`flex items-center justify-between p-3 rounded-lg border cursor-pointer transition-all active:scale-[0.99] ${a?"border-blue-600 bg-blue-50/50 ring-1 ring-blue-600":"border-slate-200 hover:border-slate-300 bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-4 h-4 rounded-full border flex items-center justify-center transition-colors ${a?"bg-blue-600 border-blue-600":"border-slate-300"}`,children:a&&e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full"})}),e.jsx("span",{className:`text-sm font-medium ${a?"text-blue-900":"text-slate-700"}`,children:t.name})]}),e.jsx("input",{type:s.type==="radio"?"radio":"checkbox",name:`group-${s.id}`,className:"hidden",checked:a,onChange:()=>gs(s.id,t.id,s.type)}),r>0&&e.jsxs("span",{className:"text-xs font-bold text-slate-600",children:["+",b(r)]})]},t.id)})})]},s.id)),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"font-bold text-slate-800 text-sm flex items-center gap-2",children:[e.jsx(Je,{className:"w-4 h-4 text-amber-500"}),"Nota para cocina"]}),e.jsx(Rs,{placeholder:"Ej: Sin cebolla, extra salsa...",value:G,onChange:s=>ue(s.target.value),className:"resize-none h-20 text-sm",maxLength:200}),e.jsxs("p",{className:"text-[10px] text-slate-400 text-right",children:[G.length,"/200"]})]})]}),e.jsxs(qs,{className:"p-4 border-t border-slate-100 bg-slate-50 flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"flex items-center justify-center bg-white rounded-xl border border-slate-200 h-12 w-full sm:w-auto px-1 shadow-sm",children:[e.jsx("button",{onClick:()=>U(Math.max(1,S-1)),className:"w-10 h-full flex items-center justify-center text-slate-500 hover:text-red-600",children:e.jsx(Ze,{className:"w-4 h-4"})}),e.jsx("span",{className:"w-10 text-center font-bold text-lg text-slate-900",children:S}),e.jsx("button",{onClick:()=>U(S+1),className:"w-10 h-full flex items-center justify-center text-slate-500 hover:text-blue-600",children:e.jsx(ce,{className:"w-4 h-4"})})]}),e.jsxs(N,{onClick:Ns,className:"flex-1 h-12 text-base font-bold bg-blue-600 hover:bg-blue-700 text-white shadow-lg shadow-blue-600/20",children:[e.jsxs("span",{children:["Agregar ",S>1&&`(${S})`]}),e.jsx("span",{className:"ml-auto bg-black/20 px-2 py-0.5 rounded text-sm",children:b(te*S)})]})]})]})}),e.jsx(qe,{open:os,onOpenChange:B,children:e.jsxs(Be,{children:[e.jsxs(Ve,{children:[e.jsx(Fe,{children:"¿Enviar pedido a cocina?"}),e.jsxs(Ue,{children:[j.length," producto",j.length>1?"s":""," nuevo",j.length>1?"s":"",".",h==="dine_in"&&o&&e.jsxs(e.Fragment,{children:[" Mesa: ",e.jsx("strong",{children:o.name}),"."]}),h==="takeout"&&e.jsx(e.Fragment,{children:" Pedido para llevar."})," ","Esta acción enviará la comanda a cocina."]})]}),e.jsxs(Ge,{children:[e.jsx(Qe,{children:"Revisar"}),e.jsx(He,{onClick:Cs,className:"bg-blue-600 text-white hover:bg-blue-700",children:"Sí, Enviar"})]})]})}),e.jsx(qe,{open:cs,onOpenChange:V,children:e.jsxs(Be,{children:[e.jsxs(Ve,{children:[e.jsx(Fe,{children:"¿Vaciar carrito?"}),e.jsx(Ue,{children:"Se eliminarán todos los productos del pedido actual."})]}),e.jsxs(Ge,{children:[e.jsx(Qe,{children:"Cancelar"}),e.jsx(He,{onClick:_s,className:"bg-red-600 text-white hover:bg-red-700",children:"Sí, Vaciar"})]})]})}),e.jsx($e,{open:ps,onOpenChange:H,children:e.jsxs(Ie,{className:"sm:max-w-[500px] max-h-[90vh] flex flex-col p-0 gap-0 bg-white border-0 shadow-2xl",children:[e.jsx(De,{className:"p-4 border-b border-slate-100 flex-shrink-0",children:e.jsxs(Re,{className:"flex items-center gap-2 text-lg font-bold text-slate-900",children:[e.jsx($,{className:"w-5 h-5 text-emerald-600"}),"Pre-cuenta — ",o?.name]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-5",children:[e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 space-y-2",children:[e.jsx("h3",{className:"text-xs font-bold uppercase text-slate-400 tracking-widest mb-2",children:"Detalle del pedido"}),d.filter(s=>s.is_sent).map(s=>e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsxs("span",{className:"text-sm text-slate-700",children:[s.quantity,"x ",s.product_name]}),e.jsx("span",{className:"text-sm font-bold text-slate-900",children:b(s.price*s.quantity)})]},s.id)),e.jsxs("div",{className:"border-t border-dashed border-slate-200 pt-2 mt-2",children:[e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"Subtotal"}),e.jsx("span",{className:"text-sm font-medium",children:b((()=>{const t=d.filter(a=>a.is_sent).reduce((a,r)=>a+r.price*r.quantity,0);return L(t,m?.tax_rate||0,m?.price_includes_tax||!1).subtotal})())})]}),m&&m.tax_rate>0&&e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsxs("span",{className:"text-xs text-slate-500",children:[m.tax_name," (",m.tax_rate,"%)"]}),e.jsx("span",{className:"text-sm font-medium",children:b((()=>{const t=d.filter(a=>a.is_sent).reduce((a,r)=>a+r.price*r.quantity,0);return L(t,m?.tax_rate||0,m?.price_includes_tax||!1).taxAmount})())})]}),e.jsxs("div",{className:"flex justify-between items-baseline pt-2 border-t border-slate-200 mt-2",children:[e.jsx("span",{className:"text-sm font-black uppercase text-slate-800",children:"Total"}),e.jsx("span",{className:"text-2xl font-black text-slate-900",children:b(se)})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-xs font-bold uppercase text-slate-400 tracking-widest",children:"¿Cómo paga el cliente?"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[["cash","bank_transfer","dataphone"].filter(s=>Ce.includes(s)).map(s=>{const t=Ps[s],a=k===s;return e.jsxs("button",{onClick:()=>be(s),className:ne("flex flex-col items-center gap-2 p-3 rounded-xl border-2 transition-all text-center",a?"border-emerald-500 bg-emerald-50 text-emerald-800 ring-1 ring-emerald-500":"border-slate-200 bg-white text-slate-600 hover:border-slate-300"),children:[e.jsx("div",{className:ne("p-2 rounded-lg",a?"bg-emerald-100":"bg-slate-100"),children:t.icon}),e.jsx("span",{className:"text-xs font-bold",children:t.label})]},s)}),Ce.length===0&&e.jsx("div",{className:"col-span-3 text-center py-4 text-slate-400 text-sm",children:"No hay métodos de pago configurados"})]})]}),k==="bank_transfer"&&me.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-xs font-bold uppercase text-slate-400 tracking-widest",children:"Datos para transferencia"}),me.map(s=>e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-3 space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-bold text-sm text-blue-900",children:s.bank_name}),e.jsx(re,{variant:"secondary",className:"text-[10px] bg-blue-100 text-blue-700",children:s.account_type})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-mono text-blue-800 tracking-wide",children:s.account_number}),e.jsx("button",{onClick:()=>Es(s.account_number),className:"text-blue-500 hover:text-blue-700",children:e.jsx(Ks,{className:"w-3.5 h-3.5"})})]}),e.jsxs("p",{className:"text-xs text-blue-600",children:[s.account_holder," — ",s.holder_id]})]},s.id)),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-slate-600",children:"Referencia / Nro. de transacción"}),e.jsx(le,{placeholder:"Ej: 123456789",value:W,onChange:s=>je(s.target.value),className:"text-sm"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-600",children:"Foto del comprobante"}),e.jsx("div",{className:"relative",children:Ne?e.jsxs("div",{className:"relative rounded-xl overflow-hidden border border-slate-200",children:[e.jsx("img",{src:Ne,alt:"Comprobante",className:"w-full max-h-48 object-contain bg-slate-50"}),e.jsx("button",{onClick:()=>{z(null),J("")},className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:e.jsx(Ys,{className:"w-3 h-3"})})]}):e.jsxs("label",{className:"flex flex-col items-center gap-2 p-6 border-2 border-dashed border-slate-300 rounded-xl cursor-pointer hover:border-blue-400 hover:bg-blue-50/50 transition-colors",children:[e.jsx(et,{className:"w-8 h-8 text-slate-400"}),e.jsx("span",{className:"text-xs text-slate-500 font-medium",children:"Toca para tomar foto o seleccionar imagen"}),e.jsx("input",{type:"file",accept:"image/*",capture:"environment",className:"hidden",onChange:Ts})]})})]})]}),k==="cash"&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-xl p-4 text-center",children:[e.jsx(Ke,{className:"w-8 h-8 text-green-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-bold text-green-800",children:"Recoge el efectivo y llévalo a caja"}),e.jsx("p",{className:"text-xs text-green-600 mt-1",children:"Caja completará el cobro"})]}),k==="dataphone"&&e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-xl p-4 text-center",children:[e.jsx(Ye,{className:"w-8 h-8 text-purple-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-bold text-purple-800",children:"Lleva al cliente al datáfono o acércalo"}),e.jsx("p",{className:"text-xs text-purple-600 mt-1",children:"Caja confirmará el cobro"})]})]}),e.jsxs("div",{className:"p-4 border-t border-slate-100 bg-slate-50 flex-shrink-0 space-y-2",children:[e.jsxs(N,{onClick:As,disabled:!k||Z,className:"w-full h-12 text-base font-bold bg-emerald-600 hover:bg-emerald-700 text-white shadow-lg",children:[Z?e.jsx(Xe,{className:"w-5 h-5 mr-2 animate-spin"}):e.jsx($,{className:"w-5 h-5 mr-2"}),Z?"Registrando...":"REGISTRAR PAGO"]}),e.jsx("p",{className:"text-[10px] text-center text-slate-400",children:"El pago se enviará a caja para verificación"})]})]})})]})}function es({product:p,onAdd:I}){const v=p.variant_groups&&p.variant_groups.length>0;return e.jsxs("button",{onClick:()=>I(p),className:"flex flex-col text-left bg-white border border-slate-200 rounded-xl overflow-hidden hover:border-blue-400 hover:shadow-md transition-all group relative",children:[e.jsx("div",{className:"aspect-square bg-slate-100 flex items-center justify-center overflow-hidden",children:p.image_url?e.jsx("img",{src:p.image_url,alt:p.name,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"}):e.jsx(ss,{className:"w-8 h-8 text-slate-300"})}),v&&e.jsx("span",{className:"absolute top-1.5 right-1.5 bg-blue-600 text-white text-[8px] font-bold px-1.5 py-0.5 rounded-full uppercase",children:"Opciones"}),e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsx("h3",{className:"font-bold text-xs text-slate-800 line-clamp-2 leading-tight group-hover:text-blue-600 transition-colors",children:p.name}),e.jsx("p",{className:"text-blue-600 font-black text-sm",children:b(p.price)})]})]})}export{Oa as default};
